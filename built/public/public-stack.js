/**
 * https://github.com/TAIAUT/Ideafy
 * Proprietary License - All rights reserved
 * Author: Vincent Weyl <vincent.weyl@taiaut.com>
 * Copyright (c) 2012-2013 TAIAUT
 */

define(["OObject","Bind.plugin","service/map","Amy/Stack-plugin","./detail-stack/public-idea","./detail-stack/public-edit","./detail-stack/public-sendmail","./detail-stack/public-share","service/config","Store","lib/spin.min"],function(e,t,i,n,s,a,r,o,c,l,d){return function(){var i,u,p,g,h=new e,v=new e,b=new n,m=c.get("labels"),f=c.get("observer"),y=new l,w=0,L=new d({color:"#808080",lines:10,length:12,width:6,radius:10,top:328}).spin();return h.plugins.addAll({detailstack:b}),h.template='<div class="detail-stack" data-detailstack="destination"></div>',v.template='<div class="msgsplash"><div class="header blue-dark"><span data-labels="bind:innerHTML, noideafound"></span></div><div class="innersplash"><span data-labels="bind: innerHTML, tryotherview"></span></div></div>',v.plugins.add("labels",new t(m)),h.reset=function(e,t){y=e,w=t,y.getNbItems()?(b.getStack().show("#public-ideadetail"),i.hideCache(),L.spin(h.dom),i.reset(e,t).then(function(){L.stop(),cache.classList.add("invisible")})):b.getStack().show("#empty-list")},h.displayEmpty=function(){b.getStack().show("#empty-list")},h.action=function(e){var t=y.get(w).id;switch(e){case"#public-edit":g.reset(t),b.getStack().show("#public-edit");break;case"#public-favorites":break;case"#public-share":p.reset(t),b.getStack().show("#public-share");break;case"close":b.getStack().show("#public-ideadetail");break;default:b.getStack().show("#public-ideadetail")}},h.edit=function(e){g.reset(e),b.getStack().show("#public-edit")},h.sendMail=function(e){u.reset(e),b.getStack().show("#public-sendmail")},h.share=function(e){p.reset(e._id),b.getStack().show("#public-share")},i=new s(h.action),g=new a(h.action),u=new r(h.action),p=new o(h.action),b.getStack().add("#public-ideadetail",i),b.getStack().add("#public-edit",g),b.getStack().add("#public-sendmail",u),b.getStack().add("#public-share",p),b.getStack().add("#empty-list",v),f.watch("public-viewidea",function(e){h.viewIdea(e)}),f.watch("public-edit",function(e){h.edit(e)}),f.watch("public-sendmail",function(e){h.sendMail(e)}),f.watch("public-share",function(e){h.share(e)}),h}});