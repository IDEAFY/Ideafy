/**
 * https://github.com/TAIAUT/Ideafy
 * Proprietary License - All rights reserved
 * Authors: Vincent Weyl <vincent.weyl@taiaut.com> - Olivier Wietrich <Olivier.Wietrich@taiaut.com
 * Copyright (c) 2012-2013 TAIAUT
 */

define(["OObject","Place.plugin","Amy/Stack-plugin","Amy/Control-plugin","public/public","library/library","brainstorm/brainstorm","connect/connect","dashboard/dashboard","service/map","service/config","./notify","service/newidea","service/help","service/new2q","service/new2c","service/tips"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m){return function(){var v=new e,g,y,b,w=new c,E,S,x,T,N,C=new r(this),k=l.get("observer"),L=l.get("user"),A=new n;return v.plugins.addAll({dockstack:A,dockcontrol:C,place:new t({notify:w})}),v.template='<div id="wrapper"><nav id="dock" data-dockcontrol="radio:a,selected,touchstart,setCurrentWidget"><a class="dock-item selected" href="#public" data-dockcontrol="init"></a><a class="dock-item" href="#library"></a><a class="dock-item" href="#brainstorm"></a><a class="dock-item" href="#connect"></a><a class="dock-item" href="#dashboard"></a></nav><div class="stack" data-dockstack="destination"></div><div id="notify" data-place="place:notify"></div></div>',v.place(f.get("dock")),v.init=function(){E=new i,S=new s,x=new o,T=new u,N=new a,A.getStack().add("#public",E),A.getStack().add("#library",S),A.getStack().add("#brainstorm",x),A.getStack().add("#connect",T),A.getStack().add("#dashboard",N),w.init(),g=new h,y=new d,b=new m},v.start=function(t){var n=v.dom.querySelector('a[href="#public"]'),r=v.dom.querySelector("a.selected"),i=v.dom.querySelector('a[href="'+L.get("settings").startupScreen+'"]');L.get("settings").startupScreen?(C.radioClass(i,r,"selected"),C.init(i),A.getStack().show(L.get("settings").startupScreen)):(r!==n&&(C.radioClass(n,r,"selected"),C.init(n)),A.getStack().show("#public")),(t||L.get("settings").showTips!==!1)&&b.init(t)},v.reset=function(){E.reset(),S.reset(),x.reset(),T.reset(),N.reset(),w.reset()},this.setCurrentWidget=function(e){var t=e.target.getAttribute("href"),n=3e3;t!==A.getStack().getCurrentName()?(A.getStack().getCurrentScreen().hideMenu(),A.getStack().show(t),A.getStack().getCurrentScreen().showMenu(),setTimeout(function(){A.getStack().getCurrentScreen().hideMenu()},n)):A.getStack().getCurrentScreen().showMenu()},k.watch("replay-session",function(e,t){var n=document.querySelector(".dock-item.selected"),r=document.querySelector(".dock-item[href='#brainstorm']");A.getStack().show("#brainstorm"),C.radioClass(r,n,"selected"),C.init(r)}),k.watch("display-doc",function(){var e=document.querySelector(".dock-item.selected"),t=document.querySelector(".dock-item[href='#library']");A.getStack().show("#library"),C.radioClass(t,e,"selected"),C.init(t)}),k.watch("display-message",function(e){var t=document.querySelector(".dock-item.selected"),n=document.querySelector(".dock-item[href='#connect']");A.getStack().show("#connect"),C.radioClass(n,t,"selected"),C.init(n)}),k.watch("display-tutorials",function(e){var t=document.querySelector(".dock-item.selected"),n=document.querySelector(".dock-item[href='#dashboard']");A.getStack().show("#dashboard"),C.radioClass(n,t,"selected"),C.init(n)}),k.watch("join-musession",function(e){var t=document.querySelector(".dock-item.selected"),n=document.querySelector(".dock-item[href='#brainstorm']");A.getStack().getCurrentName()!=="#brainstorm"&&(A.getStack().show("#brainstorm"),C.radioClass(n,t,"selected"),C.init(n))}),k.watch("goto-screen",function(e){var t=document.querySelector(".dock-item.selected"),n=document.querySelector(".dock-item[href='"+e+"']");A.getStack().getCurrentName()!==e&&(A.getStack().show(e),C.radioClass(n,t,"selected"),C.init(n))}),v}});