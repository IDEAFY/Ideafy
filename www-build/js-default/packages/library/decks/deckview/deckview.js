/**
 * https://github.com/TAIAUT/Ideafy
 * Proprietary License - All rights reserved
 * Author: Vincent Weyl <vincent.weyl@taiaut.com>
 * Copyright (c) 2012-2013 TAIAUT
 */

define(["OObject","Bind.plugin","Event.plugin","Place.plugin","Amy/Stack-plugin","Store","service/map","./deckdetails","./cardlist","service/config","./cardeditor/newcard"],function(e,t,n,r,i,s,o,u,a,f,l){return function(f){var c=new e,h=new l(f),p=new s([{name:"characters",active:!1,count:0},{name:"contexts",active:!1,count:0},{name:"problems",active:!1,count:0},{name:"techno",active:!1,count:0}]),d=new i,v="",m="";return c.plugins.addAll({cardmenu:new t(p,{setClass:function(e){this.classList.add(e)},setActive:function(e){e?this.classList.add("active"):this.classList.remove("active")}}),place:new r({newCard:h}),deckviewstack:d,deckviewevent:new n(c)}),c.template='<div><div data-place="place: newCard"></div><ul class="card-menu" data-cardmenu="foreach"><li><div class="card-type" data-cardmenu = "bind: setClass, name; bind:setActive, active" data-deckviewevent="listen: mousedown, viewCards"></div><div class="card-count" data-cardmenu="bind:innerHTML, count"></div></li></li></ul><div id="deckviewstack" data-deckviewstack="destination"></div></div>',c.viewCards=function(e,t){var n=t.getAttribute("data-cardmenu_id");p.loop(function(e,t){t===parseInt(n)?p.update(t,"active",!0):p.update(t,"active",!1)}),d.getStack().show(p.get(n).name)},c.editCard=function(t,n){h.reset(t,n,m,v)},c.hideEditView=function(){h.close()},c.reset=function(t,n){["details","characters","contexts","problems","techno"].forEach(function(e){d.getStack().get(e).reset(t)}),m=t._id,v=t.title,p.reset([]),["characters","contexts","problems","techno"].forEach(function(e){t.content[e][0]==="newcard"?p.alter("push",{name:e,active:!1,count:t.content[e].length-1}):p.alter("push",{name:e,active:!1,count:t.content[e].length})}),n?d.getStack().show(n):d.getStack().show("details")},c.init=function(){d.getStack().add("details",new u(f)),d.getStack().add("characters",new a("characters",c.editCard,f)),d.getStack().add("contexts",new a("contexts",c.editCard,f)),d.getStack().add("problems",new a("problems",c.editCard,f)),d.getStack().add("techno",new a("techno",c.editCard,f))},c}});