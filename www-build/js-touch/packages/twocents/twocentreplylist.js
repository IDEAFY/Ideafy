define(["OObject","Store","Bind.plugin","Event.plugin","service/utils","service/config","twocents/writetwocentreply","service/avatar"],function(e,t,n,r,i,s,o,u){function a(e,a,f,l){var c=new t(e),h=this,p,d=s.get("user"),v=s.get("labels"),m=s.get("transport");h.plugins.addAll({reply:new n(c,{date:function g(g){g&&(this.innerHTML=i.formatDate(g))},setFirstname:function(e){var t=this.getAttribute("data-reply_id");this.innerHTML=e,c.get(t).author===d.get("_id")&&(this.innerHTML=v.get("youlbl"))},setReplylbl:function(e){var t=this.getAttribute("data-reply_id");this.innerHTML=v.get("twocentreplycommentlbl"),c.get(t).author===d.get("_id")&&(this.innerHTML=v.get("yourepliedlbl"))},setAvatar:function(t){var n=document.createDocumentFragment(),r=new u([t]);r.place(n),this.hasChildNodes()?this.replaceChild(n,this.firstChild):this.appendChild(n)},setVisible:function(e){e&&e===d.get("_id")?this.setAttribute("style","display: block;"):this.setAttribute("style","display: none;")},setInVisible:function(e){e&&e===d.get("_id")?this.setAttribute("style","display: none;"):this.setAttribute("style","display: block;")}}),replyevent:new r(h),labels:new n(v)}),h.template='<ul class="replies" data-reply="foreach"><li class="twocentReply"><div class="twocentHeader"><div class="replyAvatar" data-reply="bind:setAvatar, author"></div><div class="twocentAuthor" data-reply="bind: setFirstname, firstname"></div><span class="commentLabel" data-labels="bind: setReplylbl, firstname"></span><br/><div class="twocentDate date" data-reply="bind: date, date"></div><div class="twocentMenu"><div class="twocentButton twocentEditButton" data-reply="bind: setVisible, author" data-replyevent="listen: touchstart, edit"></div><div class="twocentButton twocentDeleteButton" data-reply="bind: setVisible, author" data-replyevent="listen: touchstart, deleteTwocentReply"></div><div class="twocentButton twocentReplyButton" data-reply="bind: setInVisible, author" data-replyevent="listen:touchstart, reply"></div></div></div><p class="twocentMessage replyMessage" data-reply="bind: innerHTML, message"></p><div class="writePublicTwocentReply replyToReply invisible"></div></li></ul>',h.edit=function(t,n){var r=n.getAttribute("data-reply_id"),i=h.dom.children[r],s=new o,u=function(){h.dom.replaceChild(i,s.dom)},l=document.createDocumentFragment();s.reset(a,f,e[r],r,null,u),s.render(),s.place(l),h.dom.replaceChild(l,i),UI=h.dom},h.deleteTwocentReply=function(e,t){var n=t.getAttribute("data-reply_id"),r={docId:a,type:"deltcreply",twocent:f,position:n};m.request("WriteTwocent",r,function(e){e!=="ok"&&alert(s.get("labels").get("somethingwrong"))})},h.reply=function(t,n){var r=n.getAttribute("data-reply_id"),i=document.querySelector(".twocent[data-twocents_id='"+f+"']"),s=i.querySelector(".writePublicTwocentReply[data-reply_id='"+r+"']"),u=document.createDocumentFragment(),l=new o(s);l.reset(a,f,null,r,e[r].firstname),l.render(),l.place(u),s.hasChildNodes()||s.appendChild(u),s.classList.remove("invisible")}}return function(n,r,i,s){return a.prototype=new e,new a(n,r,i,s)}});