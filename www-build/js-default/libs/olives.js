/**
 * @license Olives <VERSION> http://flams.github.com/olives
 * The MIT License (MIT)
 * Copyright (c) 2012-2013 Olivier Scherrer <pode.fr@gmail.com> - Olivier Wietrich <olivier.wietrich@gmail.com>
 */

/**
 * Olives http://flams.github.com/olives
 * The MIT License (MIT)
 * Copyright (c) 2012-2013 Olivier Scherrer <pode.fr@gmail.com> - Olivier Wietrich <olivier.wietrich@gmail.com>
 */

define("DomUtils",["Tools"],function(e){return{getNodes:function(t,n){return this.isAcceptedType(t)?(t.parentNode||document.createDocumentFragment().appendChild(t),t.parentNode.querySelectorAll(n||"*")):!1},getDataset:function(t){var n=0,r,i={},s,o;if(this.isAcceptedType(t)){if(t.hasOwnProperty("dataset"))return t.dataset;for(r=t.attributes.length;n<r;n++)s=t.attributes[n].name.split("-"),s.shift()=="data"&&(i[o=s.join("-")]=t.getAttribute("data-"+o));return i}return!1},isAcceptedType:function(t){return t instanceof HTMLElement||t instanceof SVGElement?!0:!1},setAttribute:function(t,n,r){return t instanceof HTMLElement?(t[n]=r,!0):t instanceof SVGElement?(t.setAttribute(n,r),!0):!1},matches:function(n,r,i){return e.toArray(this.getNodes(n,r)).indexOf(i)>-1}}}),define("Bind.plugin",["Store","Observable","Tools","DomUtils"],function(t,n,r,i){return function(n,s){function l(e){f[e]&&(f[e].forEach(function(e){o.unwatchValue(e)}),delete f[e])}var o=null,u={},a={},f={};this.observers=f,this.setModel=function(n){return n instanceof t?(o=n,!0):!1},this.getModel=function(){return o},this.ItemRenderer=function(t,n){var s=null,u=null,a=null,f=null,c=null;this.setRenderer=function(t){return s=t,!0},this.getRenderer=function(){return s},this.setRootNode=function(t){var n;return i.isAcceptedType(t)?(a=t,n=a.querySelector("*"),this.setRenderer(n),n&&a.removeChild(n),!0):!1},this.getRootNode=function(){return a},this.setPlugins=function(t){return u=t,!0},this.getPlugins=function(){return u},this.items={},this.setStart=function(t){return f=parseInt(t,10),f},this.getStart=function(){return f},this.setNb=function(t){return c=t=="*"?t:parseInt(t,10),c},this.getNb=function(){return c},this.addItem=function(t){var n,r;return typeof t=="number"&&!this.items[t]?(r=this.getNextItem(t),n=this.create(t),n?(r?a.insertBefore(n,r):a.appendChild(n),!0):!1):!1},this.getNextItem=function(t){var n=Object.keys(this.items).map(function(e){return Number(e)}),i=r.closestGreater(t,n),s=n[i];if(s!=t)return this.items[s];return},this.removeItem=function(t){var n=this.items[t];return n?(a.removeChild(n),delete this.items[t],l(t),!0):!1},this.create=function(t){if(o.has(t)){var n=s.cloneNode(!0),a=i.getNodes(n);return r.toArray(a).forEach(function(e){e.setAttribute("data-"+u.name+"_id",t)}),this.items[t]=n,u.apply(n),n}},this.render=function(){var t=c=="*"?o.getNbItems():c,n=[];if(c!==null&&f!==null){r.loop(this.items,function(e,r){r=Number(r),(r<f||r>=f+t||!o.has(r))&&n.push(r)},this),n.sort(r.compareNumbers).reverse().forEach(this.removeItem,this);for(var i=f,s=t+f;i<s;i++)this.addItem(i);return!0}return!1},this.setPlugins(t),this.setRootNode(n)},this.setItemRenderer=function(t,n){t=t||"default",a[t]=n},this.getItemRenderer=function(t){return a[t]},this.foreach=function(t,n,r,i){var s=new this.ItemRenderer(this.plugins,t);s.setStart(r||0),s.setNb(i||"*"),s.render(),o.watch("added",s.render,s),o.watch("deleted",function(e){s.render(),l(e)},this),this.setItemRenderer(n,s)},this.updateStart=function(t,n){var r=this.getItemRenderer(t);return r?(r.setStart(n),!0):!1},this.updateNb=function(t,n){var r=this.getItemRenderer(t);return r?(r.setNb(n),!0):!1},this.refresh=function(t){var n=this.getItemRenderer(t);return n?(n.render(),!0):!1},this.bind=function(t,n,s){s=s||"";var u=t.getAttribute("data-"+this.plugins.name+"_id"),a=s.split("."),f=u||a.shift(),l=u?s:a.join("."),c=r.getNestedProperty(o.get(f),l),h=r.toArray(arguments).slice(3);if(c||c===0||c===!1)this.execBinding.apply(this,[t,n,c].concat(h))||i.setAttribute(t,n,c);this.hasBinding(n)||t.addEventListener("change",function(e){o.has(f)&&(l?o.update(f,s,t[n]):o.set(f,t[n]))},!0),this.observers[f]=this.observers[f]||[],this.observers[f].push(o.watchValue(f,function(e){this.execBinding.apply(this,[t,n,r.getNestedProperty(e,l)].concat(h))||i.setAttribute(t,n,r.getNestedProperty(e,l))},this))},this.set=function(t){return i.isAcceptedType(t)&&t.name?(o.set(t.name,t.value),!0):!1},this.getItemIndex=function(t){var n=i.getDataset(t);return n&&typeof n[this.plugins.name+"_id"]!="undefined"?+n[this.plugins.name+"_id"]:!1},this.form=function(t){if(t&&t.nodeName=="FORM"){var n=this;return t.addEventListener("submit",function(e){r.toArray(t.querySelectorAll("[name]")).forEach(n.set,n),e.preventDefault()},!0),!0}return!1},this.addBinding=function(t,n){return t&&typeof t=="string"&&typeof n=="function"?(u[t]=n,!0):!1},this.execBinding=function(t,n){return this.hasBinding(n)?(u[n].apply(t,Array.prototype.slice.call(arguments,2)),!0):!1},this.hasBinding=function(t){return u.hasOwnProperty(t)},this.getBinding=function(t){return u[t]},this.addBindings=function(t){return r.loop(t,function(e,t){this.addBinding(t,e)},this)},this.setModel(n),this.addBindings(s)}}),define("Event.plugin",["DomUtils"],function(t){return function(n,r){var i=null,s={mousedown:"touchstart",mouseup:"touchend",mousemove:"touchmove"},o=!!r;this.addEventListener=function(t,n,r,i){t.addEventListener(this.map(n),r,!!i)},this.listen=function(t,n,r,s){this.addEventListener(t,n,function(e){i[r].call(i,e,t)},!!s)},this.delegate=function(n,r,s,o,u){this.addEventListener(n,s,function(e){t.matches(n,r,e.target)&&i[o].call(i,e,n)},!!u)},this.getParent=function(){return i},this.setParent=function(t){return t instanceof Object?(i=t,!0):!1},this.map=function(t){return o?s[t]||t:t},this.setMap=function(t,n){return typeof t=="string"&&typeof n=="string"?(s[t]=n,!0):!1},this.setParent(n)}}),define("LocalStore",["Store","Tools"],function(t,n){function r(){var e=null,t=localStorage,r=function(){t.setItem(e,this.toJSON())};this.setLocalStorage=function(n){return n&&n.setItem instanceof Function?(t=n,!0):!1},this.getLocalStorage=function(){return t},this.sync=function(s){var o;return typeof s=="string"?(e=s,o=JSON.parse(t.getItem(s)),n.loop(o,function(e,t){this.has(t)||this.set(t,e)},this),r.call(this),this.watch("added",r,this),this.watch("updated",r,this),this.watch("deleted",r,this),!0):!1}}return function(n){return r.prototype=new t(n),new r}}),define("Plugins",["Tools","DomUtils"],function(t,n){return function(r){var i={},s=function(t){return t.trim()},o=function(t,n,r){n.split(";").forEach(function(e){var n=e.split(":"),o=n[0].trim(),u=n[1]?n[1].split(",").map(s):[];u.unshift(t),i[r]&&i[r][o]&&i[r][o].apply(i[r],u)})};this.add=function(t,n){var r=this,s="plugins";return typeof t=="string"&&typeof n=="object"&&n?(i[t]=n,n[s]={name:t,apply:function(){return r.apply.apply(r,arguments)}},!0):!1},this.addAll=function(n){return t.loop(n,function(e,t){this.add(t,e)},this)},this.get=function(t){return i[t]},this.del=function(t){return delete i[t]},this.apply=function(r){var i;return n.isAcceptedType(r)?(i=n.getNodes(r),t.loop(t.toArray(i),function(e){t.loop(n.getDataset(e),function(t,n){o(e,t,n)})}),r):!1},this.addAll(r)}}),define("OObject",["StateMachine","Store","Plugins","DomUtils","Tools"],function(t,n,r,i,s){return function(o){var u=function(t){var n=l||document.createElement("div");if(!t.template)throw new Error("UI.template must be set prior to render");typeof t.template=="string"?n.innerHTML=t.template.trim():i.isAcceptedType(t.template)&&n.appendChild(t.template);if(n.childNodes.length>1)throw new Error("UI.template should have only one parent node");t.dom=n.childNodes[0],t.plugins.apply(t.dom)},a=function(t,n,r){n&&(r?n.insertBefore(t.dom,r):n.appendChild(t.dom),l=n)},f=function(t,n){u(t),a.apply(null,s.toArray(arguments))},l=null,c=new t("Init",{Init:[["render",u,this,"Rendered"],["place",f,this,"Rendered"]],Rendered:[["place",a,this],["render",u,this]]});this.model=o instanceof n?o:new n,this.plugins=new r,this.template=null,this.dom=null,this.place=function(t,n){c.event("place",this,t,n)},this.render=function(){c.event("render",this)},this.setTemplateFromDom=function(t){return i.isAcceptedType(t)?(this.template=t,!0):!1},this.alive=function(t){return i.isAcceptedType(t)?(this.setTemplateFromDom(t),this.place(t.parentNode,t.nextElementSibling),!0):!1},this.getCurrentPlace=function(){return l}}}),define("Place.plugin",["OObject","Tools"],function(t,n){return function(r){var i={};this.place=function(n,r){if(!(i[r]instanceof t))throw new Error(r+" is not an OObject UI in place:"+r);i[r].place(n)},this.set=function(n,r){return typeof n=="string"&&r instanceof t?(i[n]=r,!0):!1},this.setAll=function(t){n.loop(t,function(e,t){this.set(t,e)},this)},this.get=function(t){return i[t]},this.setAll(r)}}),define("SocketIOTransport",["Observable","Tools"],function(t,n){return function(t){var n=null;this.setSocket=function(t){return t&&typeof t.emit=="function"?(n=t,!0):!1},this.getSocket=function(){return n},this.on=function(t,r){return n.on(t,r)},this.once=function(t,r){return n.once(t,r)},this.emit=function(t,r,i){return n.emit(t,r,i)},this.removeListener=function(t,r,i){return n.removeListener(t,r,i)},this.request=function(t,n,r,i){if(typeof t=="string"&&typeof n!="undefined"){var s={eventId:Date.now()+Math.floor(Math.random()*1e6),data:n},o=function(){r&&r.apply(i||null,arguments)};return this.once(s.eventId,o),this.emit(t,s),!0}return!1},this.listen=function(t,n,r,i){if(typeof t=="string"&&typeof n!="undefined"&&typeof r=="function"){var s={eventId:Date.now()+Math.floor(Math.random()*1e6),data:n,keepAlive:!0},o=function(){r&&r.apply(i||null,arguments)},u=this;return this.on(s.eventId,o),this.emit(t,s),function(){u.emit("disconnect-"+s.eventId),u.removeListener(s.eventId,o)}}return!1},this.setSocket(t)}}),define("Stack",[],function(){return function(t){var n=document.createDocumentFragment(),r=document.createDocumentFragment(),i=[];this.add=function(t){return!this.has(t)&&t instanceof HTMLElement?(n.appendChild(t),i.push(t),t):!1},this.remove=function(t){var r;return this.has(t)?(r=i.indexOf(t),n.removeChild(t),i.splice(r,1),t):!1},this.place=function(t){return t instanceof HTMLElement?([].slice.call(n.childNodes).forEach(function(e){this.has(e)&&t.appendChild(e)},this),this._setParent(t)):!1},this.up=function(t){if(this.has(t)){var n=this.getPosition(t);return this.move(t,n+2),t}return!1},this.down=function(t){if(this.has(t)){var n=this.getPosition(t);return this.move(t,n-1),t}return!1},this.move=function(t,r){if(this.has(t)){var s=i.indexOf(t);i.splice(s,1),i.splice(r,0,t);var o=i[r+1];return o?n.insertBefore(t,o):n.appendChild(t),t}return!1},this.insert=function(t,r){return!this.has(t)&&t instanceof HTMLElement?(i.splice(r,0,t),n.insertBefore(t,n.childNodes[r]),t):!1},this.getPosition=function(t){return i.indexOf(t)},this.count=function(){return n.childNodes.length},this.has=function(t){return this.getPosition(t)>=0},this.hide=function(t){return this.has(t)?(r.appendChild(t),!0):!1},this.show=function(t){return this.has(t)&&t.parentNode===r?(this.move(t,i.indexOf(t)),!0):!1},this.hideAll=function(){i.forEach(this.hide,this)},this.showAll=function(){i.forEach(this.show,this)},this.getParent=function(){return n},this._setParent=function(t){return t instanceof HTMLElement?(n=t,n):!1},this.getHidePlace=function(){return r},this.setHidePlace=function(t){return t instanceof HTMLElement?(r=t,!0):!1},this._setParent(t)}}),define("LocationRouter",["Router","Tools"],function(t,n){function r(){var e;this.parse=function(t){return t.split("#").pop().split("/")},this.toUrl=function(t){return t.join("/")},this.start=function(){var t=this.parse(window.location.hash);this.navigate.apply(this,t),this.bindOnHashChange(),this.bindOnRouteChange()},this.destroy=function(){this.unwatch(e),window.removeEventListener("hashchange",this.boundOnHashChange,!0)},this.onHashChange=function(t){var n=this.parse(t.newUrl.split("#").pop());this.navigate.apply(this,n)},this.boundOnHashChange=this.onHashChange.bind(this),this.bindOnHashChange=function(){window.addEventListener("hashchange",this.boundOnHashChange,!0)},this.bindOnRouteChange=function(){e=this.watch("route",this.onRouteChange,this)},this.onRouteChange=function(){window.location.hash=this.toUrl(n.toArray(arguments))}}return function(){return r.prototype=new t,new r}});