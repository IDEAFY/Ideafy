/**
 * https://github.com/TAIAUT/Ideafy
 * Proprietary License - All rights reserved
 * Author: Vincent Weyl <vincent.weyl@taiaut.com>
 * Copyright (c) 2012-2013 TAIAUT
 */

define(["OObject","Bind.plugin","Event.plugin","service/config","lib/spin.min"],function(e,t,i,s,n){return function(a,r,c){var o,d=new e,l=!0,u=!1,p=s.get("transport");return d.plugins.addAll({wbmain:new t(a,{displayPost:function(e){var t,i,s,r=this,c=r.getAttribute("data-wbmain_id"),d=a.get(c).content,l=a.get(c).style,u=a.get(c).background;switch(e){case"postit":r.classList.remove("photo"),r.classList.remove("drawing"),r.innerHTML='<div class="inner-postit">'+d.replace(/\n/g,"<br>")+"</div>",r.setAttribute("style","background:url('img/brainstorm/"+l.img+"') no-repeat center center; background-size: contain; color:"+l.marker+";");break;case"import":r.classList.add("photo"),r.classList.remove("drawing"),s=(new n).spin(r),this.innerHTML="",t="sessions/"+o,i={dir:t,filename:d},p.request("GetFile",i,function(e){r.setAttribute("style","background:white; background-image: url('"+e+"'); background-repeat: no-repeat; background-position: center center; background-size:contain;"),s.stop()});break;case"drawing":r.classList.remove("photo"),r.classList.add("drawing"),s=(new n).spin(r),this.innerHTML="",t="sessions/"+o,i={dir:t,filename:d},p.request("GetFile",i,function(e){r.setAttribute("style","background:"+u+"; background-image: url('"+e+"'); background-repeat: no-repeat; background-position: center center; background-size:contain;"),s.stop()})}}}),wbevent:new i(d)}),d.template='<div class="wbmain"><ul class="wblist" data-wbmain="foreach"><li class="wb-item postit" data-wbmain="bind: displayPost, type" data-wbevent="listen: touchend, edit; listen:touchmove, cancelEdit"></li><ul><div>',d.edit=function(e,t){var i=t.getAttribute("data-wbmain_id"),s=a.get(i).type;l?u?"postit"!==a.get(i).type&&(t.classList.contains("enlarge")?t.classList.remove("enlarge"):t.classList.add("enlarge")):(r.set(s,"active"),c(s,i)):l=!0},d.cancelEdit=function(){l=!1},d.setSessionId=function(e){o=e},d.setReadonly=function(e){u=e},d}});