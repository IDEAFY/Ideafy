/**
 * https://github.com/TAIAUT/Ideafy
 * Proprietary License - All rights reserved
 * Author: Vincent Weyl <vincent.weyl@taiaut.com>
 * Copyright (c) 2012-2013 TAIAUT
 */

define(["OObject","service/config","Store","Bind.plugin","Event.plugin","twocents/writetwocent","twocents/twocentlist","service/avatar","service/utils","Place.plugin"],function(e,t,n,r,i,s,o,u,a,f){return function(){var c=new e,h=t.get("labels"),p=t.get("user"),d=new n,v=new s("connect"),m=new o("connect"),g;return c.plugins.addAll({labels:new r(h),tqdetail:new r(d,{setHeader:function(e){e?e===p.get("_id")?this.innerHTML=h.get("mytqdetailheader"):this.innerHTML=h.get("tqheaderprefix")+d.get("username")+h.get("tqheadersuffix"):this.innerHTML=h.get("selecttq")},displayWriteTwocent:function(e){!e||e===p.get("_id")?this.classList.add("invisible"):this.classList.remove("invisible")},displayTwocentList:function(e){e&&e.length&&document.getElementById("connect-writetwocents").classList.add("invisible")},displayTwocentNB:function(e){var t=e.length||0;t?t===1?this.innerHTML=t+" "+h.get("showonetcreply"):this.innerHTML=t+"showtcrepliesafter":this.innerHTML=h.get("noreplyyet")},date:function y(y){y&&(this.innerHTML=a.formatDate(y))},setAuthor:function(e){e===p.get("username")&&d.get("author")===p.get("_id")?this.innerHTML=h.get("youlbl"):this.innerHTML=e},setWrotelbl:function(e){e===p.get("_id")?this.innerHTML=h.get("youwrotelbl"):this.innerHTML=h.get("ideawrotelbl")},setAvatar:function(t){var n=document.createDocumentFragment(),r=new u([t]);r.place(n),this.hasChildNodes()?this.replaceChild(n,this.firstChild):this.appendChild(n)}}),place:new f({TwoQTwocentList:m}),tqevent:new i(c)}),c.template='<div class="twocent-detail"><div class="header blue-dark"><span data-tqdetail="bind: setHeader, author"></span></div><div class = "detail-contents"><div class="detail-header"><div class="avatar" data-tqdetail="bind:setAvatar, author"></div><span class="author" data-tqdetail="bind:setAuthor,username"></span><span class="commentlbl" data-tqdetail="bind: setWrotelbl, author"></span><p data-tqdetail="bind:innerHTML,question"></p><span class="date" data-tqdetail="bind:date, creation_date"></span></div><div class="detail-body"></div><div class="detail-footer"><div class="tcbutton" data-tqevent="listen:touchstart, press; listen: touchend, write"></div><div class="tcreplies" data-tqdetail = "bind: displayTwocentNB, twocents"></div></div><div id="connect-writetwocents" class="invisible" data-tqdetail="bind: displayWriteTwocent, author"></div><div id="connect-twocents" class="twocents" data-tqdetail="bind: displayTwocentList, twocents" data-place="place:TwoQTwocentList"></div></div></div>',c.press=function(e,t){t.classList.add("pressed")},c.write=function(e,t){t.classList.remove("pressed"),document.getElementById("connect-writetwocents").classList.remove("invisible")},c.hide=function(){document.querySelector(".detail-contents").classList.add("invisible"),d.reset({})},c.reset=function(t){d.reset(t.value),v.reset(d.get("_id")),m.reset(d.get("_id")),g=c.dom.querySelector("#connect-writetwocents"),v.place(g)},c.place(document.createDocumentFragment()),c}});