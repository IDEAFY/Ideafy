/**
 * https://github.com/TAIAUT/Ideafy
 * Proprietary License - All rights reserved
 * Author: Vincent Weyl <vincent.weyl@taiaut.com>
 * Copyright (c) 2012-2013 TAIAUT
 */

define(["OObject","Bind.plugin","service/map","Amy/Stack-plugin","./detail-stack/public-idea","./detail-stack/public-edit","./detail-stack/public-sendmail","./detail-stack/public-share","service/config","Store","lib/spin.min"],function(e,t,n,r,i,s,o,u,a,f,l){return function(){var c=new e,h=new e,p,d,v,m,g=new r,y=a.get("labels"),b=a.get("observer"),w=new f,E=0,S=(new l({color:"#808080",lines:10,length:12,width:6,radius:10,top:328})).spin();return c.plugins.addAll({detailstack:g}),c.template='<div class="detail-stack" data-detailstack="destination"></div>',h.template='<div class="msgsplash"><div class="header blue-dark"><span data-labels="bind:innerHTML, noideafound"></span></div><div class="innersplash"><span data-labels="bind: innerHTML, tryotherview"></span></div></div>',h.plugins.add("labels",new t(y)),c.reset=function(t,n){w=t,E=n,w.getNbItems()?(g.getStack().show("#public-ideadetail"),p.hideCache(),S.spin(c.dom),p.reset(t,n).then(function(){S.stop(),cache.classList.add("invisible")})):g.getStack().show("#empty-list")},c.displayEmpty=function(t){g.getStack().show("#empty-list")},c.action=function(t){var n=w.get(E).id;switch(t){case"#public-edit":m.reset(n),g.getStack().show("#public-edit");break;case"#public-favorites":break;case"#public-share":v.reset(n),g.getStack().show("#public-share");break;case"close":g.getStack().show("#public-ideadetail");break;default:g.getStack().show("#public-ideadetail")}},c.edit=function(t){m.reset(t),g.getStack().show("#public-edit")},c.sendMail=function(t){d.reset(t),g.getStack().show("#public-sendmail")},c.share=function(t){v.reset(t._id),g.getStack().show("#public-share")},p=new i(c.action),m=new s(c.action),d=new o(c.action),v=new u(c.action),g.getStack().add("#public-ideadetail",p),g.getStack().add("#public-edit",m),g.getStack().add("#public-sendmail",d),g.getStack().add("#public-share",v),g.getStack().add("#empty-list",h),b.watch("public-viewidea",function(e){c.viewIdea(e)}),b.watch("public-edit",function(e){c.edit(e)}),b.watch("public-sendmail",function(e){c.sendMail(e)}),b.watch("public-share",function(e){c.share(e)}),c}});