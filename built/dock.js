/**
 * https://github.com/TAIAUT/Ideafy
 * Proprietary License - All rights reserved
 * Authors: Vincent Weyl <vincent.weyl@taiaut.com> - Olivier Wietrich <Olivier.Wietrich@taiaut.com
 * Copyright (c) 2012-2013 TAIAUT
 */

define(["OObject","Place.plugin","Amy/Stack-plugin","Amy/Control-plugin","public/public","library/library","brainstorm/brainstorm","connect/connect","dashboard/dashboard","service/map","service/config","./notify","service/newidea","service/help","service/new2q","service/new2c","service/tips"],function(e,t,s,i,n,a,r,c,l,o,d,u,p,g,v,h,b){return function(){var g,h,m,f,w,y,L,k,S=new e,T=new u,M=new i(this),q=d.get("observer"),H=d.get("user"),x=new s;return S.plugins.addAll({dockstack:x,dockcontrol:M,place:new t({notify:T})}),S.template='<div id="wrapper"><nav id="dock" data-dockcontrol="radio:a,selected,touchstart,setCurrentWidget"><a class="dock-item selected" href="#public" data-dockcontrol="init"></a><a class="dock-item" href="#library"></a><a class="dock-item" href="#brainstorm"></a><a class="dock-item" href="#connect"></a><a class="dock-item" href="#dashboard"></a></nav><div class="stack" data-dockstack="destination"></div><div id="notify" data-place="place:notify"></div></div>',S.place(o.get("dock")),S.init=function(){f=new n,w=new a,y=new r,L=new c,k=new l,x.getStack().add("#public",f),x.getStack().add("#library",w),x.getStack().add("#brainstorm",y),x.getStack().add("#connect",L),x.getStack().add("#dashboard",k),T.init(),g=new p,h=new v,m=new b},S.start=function(e){var t=S.dom.querySelector('a[href="#public"]'),s=S.dom.querySelector("a.selected"),i=S.dom.querySelector('a[href="'+H.get("settings").startupScreen+'"]');H.get("settings").startupScreen?(M.radioClass(i,s,"selected"),M.init(i),x.getStack().show(H.get("settings").startupScreen)):(s!==t&&(M.radioClass(t,s,"selected"),M.init(t)),x.getStack().show("#public")),(e||H.get("settings").showTips!==!1)&&m.init(e),H.set("online",!0),H.upload()},S.reset=function(){f.reset(),w.reset(),y.reset(),L.reset(),k.reset(),T.reset()},this.setCurrentWidget=function(e){var t=e.target.getAttribute("href"),s=3e3;t!==x.getStack().getCurrentName()?(x.getStack().getCurrentScreen().hideMenu(),x.getStack().show(t),x.getStack().getCurrentScreen().showMenu(),setTimeout(function(){x.getStack().getCurrentScreen().hideMenu()},s)):x.getStack().getCurrentScreen().showMenu()},q.watch("replay-session",function(){var e=document.querySelector(".dock-item.selected"),t=document.querySelector(".dock-item[href='#brainstorm']");x.getStack().show("#brainstorm"),M.radioClass(t,e,"selected"),M.init(t)}),q.watch("display-doc",function(){var e=document.querySelector(".dock-item.selected"),t=document.querySelector(".dock-item[href='#library']");x.getStack().show("#library"),M.radioClass(t,e,"selected"),M.init(t)}),q.watch("display-message",function(){var e=document.querySelector(".dock-item.selected"),t=document.querySelector(".dock-item[href='#connect']");x.getStack().show("#connect"),M.radioClass(t,e,"selected"),M.init(t)}),q.watch("display-tutorials",function(){var e=document.querySelector(".dock-item.selected"),t=document.querySelector(".dock-item[href='#dashboard']");x.getStack().show("#dashboard"),M.radioClass(t,e,"selected"),M.init(t)}),q.watch("join-musession",function(){var e=document.querySelector(".dock-item.selected"),t=document.querySelector(".dock-item[href='#brainstorm']");"#brainstorm"!==x.getStack().getCurrentName()&&(x.getStack().show("#brainstorm"),M.radioClass(t,e,"selected"),M.init(t))}),q.watch("goto-screen",function(e){var t=document.querySelector(".dock-item.selected"),s=document.querySelector(".dock-item[href='"+e+"']");x.getStack().getCurrentName()!==e&&(x.getStack().show(e),M.radioClass(s,t,"selected"),M.init(s))}),S}});