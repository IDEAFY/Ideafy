/**
 * https://github.com/TAIAUT/Ideafy
 * Proprietary License - All rights reserved
 * Author: Vincent Weyl <vincent.weyl@taiaut.com>
 * Copyright (c) 2012-2013 TAIAUT
 */

define(["Olives/OObject","service/config","Olives/Model-plugin","Olives/Event-plugin","Store","service/avatar","service/utils","CouchDBStore"],function(e,t,n,r,i,s,o,u){return function(){var f=new e,l=new i,c=new i({max:0}),h=new i([]),p=new u,d=t.get("labels");return p.setTransport(t.get("transport")),f.plugins.addAll({labels:new n(d),range:new n(c,{setCursorWidth:function(e){}}),cards:new n(h,{setStyle:function(e){e&&e==="null"?this.classList.add("invisible"):this.classList.remove("invisible")},formatTitle:function(e){var t,n=this;e&&(t=n.getAttribute("data-cards_id"),h.get(t).type&&h.get(t).type!==4?this.innerHTML=e.substring(0,1).toUpperCase()+e.substring(1).toLowerCase():(this.innerHTML=e.toUpperCase(),this.setAttribute("style","font-family:Helvetica;")))},setPic:function(e){e?this.setAttribute("style","background-image:url('"+e+"');"):this.setAttribute("style","background-image: none;")}}),deckdetails:new n(l,{formatDate:function(e){e?this.innerHTML=o.formatDate(e):this.innerHTML=""},setPic:function(e){var t,n,r=this;e==="Taiaut"?this.setAttribute("style","background-image:url('img/logo.png');"):(n=document.createDocumentFragment(),t=new s([e]),t.place(n),r.hasChildNodes()?r.replaceChild(n,r.firstChild):r.appendChild(n))}}),carouselevent:new r(f)}),f.template='<div class="deckdetails"><div class="deckinfo"><div class="deckheader"><div class="decklogo" data-deckdetails="bind: setPic, author"></div><p><h2 data-deckdetails="bind:innerHTML, title"></h2><span data-labels="bind:innerHTML, designedby"></span><span data-deckdetails="bind: innerHTML, created_by"></span></p><span class="date" ></span></div><p class="deckdescription" data-deckdetails="bind: innerHTML, description"></p></div><div class="deckcarousel"><div class="innercarousel"></div><ul data-cards="foreach"><li data-cards="bind: setStyle,style"><div class="card"><div class="cardpicture" data-cards="bind:setPic,picture_file"></div><div class="cardtitle" data-cards="bind: formatTitle, title"></div></div></li></ul><input class="deckslider" type="range" value=0 min=0 data-range="bind: max, max; bind: setCursorWidth, max" data-carouselevent="listen: input, updateCards"></div></div>',f.displayCards=function(t){var n,r=[];h.reset([]);for(n=0;n<5;n++)p.get(t-2+n)?r[n]=p.get(t-2+n).value:r[n]={style:"null"};h.reset(r)},f.updateCards=function(e,t){f.displayCards(t.value)},f.reset=function(n){l.reset(n),c.set("max",0),p.unsync(),p.sync(t.get("db"),"library","_view/cards",{key:'"'+l.get("_id")+'"'}).then(function(){c.set("max",p.getNbItems()-1),f.displayCards(0)})},f}});