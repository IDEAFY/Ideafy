/**
 * https://github.com/TAIAUT/Ideafy
 * Proprietary License - All rights reserved
 * Author: Vincent Weyl <vincent.weyl@taiaut.com>
 * Copyright (c) 2012-2013 TAIAUT
 */

define(["OObject","service/map","Bind.plugin","Event.plugin","service/config","service/help","lib/spin.min","Promise"],function(e,t,n,r,i,s,o,u){return function(f,l,c,h){var p=new e,d=i.get("user"),v=i.get("db"),m=i.get("labels"),g="step",y=(new o({color:"#657B99",lines:10,length:8,width:4,radius:8,top:360,left:545})).spin();return p.plugins.addAll({labels:new n(m),model:new n(f,{setTitle:function(e){var t=new Date;e&&e.username&&this.setAttribute("placeholder",m.get("quickstarttitleplaceholderpre")+e.username+m.get("quickstarttitleplaceholderpost"))}}),quickstartevent:new r(p)}),p.template='<div id = "quickstart"><div class="previousbutton" data-quickstartevent="listen: touchstart, press; listen: touchstart, prev"></div><div class="brainstorm-header header blue-light" data-labels="bind: innerHTML, quickstart" data-quickstartevent="listen:touchstart, toggleProgress"></div><div class="help-brainstorm" data-quickstartevent="listen:touchstart, help"></div><form class="quickstart-form"><label data-labels="bind:innerHTML, quickstarttitle"></label><hr/><textarea class="quickstart-title" autofocus="" name="title" data-model="bind:value, title; bind: setTitle, initiator"></textarea><label data-labels="bind:innerHTML, quickstartdesc"></label><hr/><textarea class="quickstart-desc" name="description" data-model="bind:value, description" data-labels="bind: placeholder, quickstartdescplaceholder"></textarea><div class="next-button" data-labels="bind:innerHTML, nextbutton" data-quickstartevent="listen: touchstart, press; listen:touchend, next"></div></form><div>',p.place(t.get("quickstart")),p.press=function(e,t){t.classList.add("pressed")},p.next=function(e,t){y.spin(t.parentNode),t.classList.add("invisible"),t.classList.remove("pressed"),g==="step"?(g="screen",f.get("title")===""&&f.set("title",m.get("quickstarttitleplaceholderpre")+f.get("initiator").username+m.get("quickstarttitleplaceholderpost")),f.set("lang",d.get("lang")),f.set("_id","S:QUICK:"+f.get("startTime")),f.sync(v,f.get("_id")).then(function(){return d.set("sessionInProgress",{id:f.get("_id"),type:"quick"}),d.upload()}).then(function(){c("quickstart")})):c("quickstart")},p.stopSpinner=function(){y.stop(),p.dom.querySelector(".next-button").classList.remove("invisible")},p.prev=function(e,t){t.classList.remove("pressed"),l("quickstart")},p.toggleProgress=function(e,t){h()},p.reset=function(t){var n=new Date,r=f.get("step"),i=new u;t?(r==="quickstart"?g="step":g="screen",r!=="quickwrapup"&&f.set("resumeTime",n.getTime())):(f.set("startTime",n.getTime()),f.set("date",[n.getFullYear(),n.getMonth(),n.getDate()]),g="step")},p.help=function(e,t){s.setContent("quickstarthelp"),document.getElementById("cache").classList.add("appear"),document.getElementById("help-popup").classList.add("appear")},p}});