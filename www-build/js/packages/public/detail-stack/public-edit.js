/**
 * https://github.com/TAIAUT/Ideafy
 * Proprietary License - All rights reserved
 * Author: Vincent Weyl <vincent.weyl@taiaut.com>
 * Copyright (c) 2012-2013 TAIAUT
 */

define(["Olives/OObject","service/map","CouchDBStore","Olives/Model-plugin","Olives/Event-plugin","service/config","service/confirm"],function(e,t,n,r,i,s,o){return function(a){var f=new e,l=new n,c=s.get("labels"),h=new n({error:""});return l.setTransport(s.get("transport")),f.plugins.addAll({editlabel:new r(c),editidea:new r(l,{setVisibility:function(e){e==="public"?this.innerHTML=c.get("publiclbl"):this.innerHTML=c.get("privatelbl")},hideVisibility:function(e){e==="public"?this.setAttribute("style","display:none"):this.setAttribute("style","display:inline-block")},setVisibleIcon:function(e){e==="public"?this.setAttribute("style","background:url('img/public/publicForList.png') no-repeat left center; background-size: 14px 12px;"):this.setAttribute("style","background-image:url('img/public/privateForList.png');")},setReplay:function(e){console.log("hello anyone there",e),e?this.setAttribute("style","display:inline-block"):this.setAttribute("style","display:none")},setIdeafyStatus:function(e){e?this.innerHTML=c.get("enabledreplaylbl"):this.innerHTML=c.get("disabledreplaylbl")},setSessionReplay:function(e){e?this.innerHTML=c.get("disablereplaylbl"):this.innerHTML=c.get("enablereplaylbl")}}),editevent:new i(f),errormsg:new r(h,{setError:function(e){switch(e){case"notitle":this.innerHTML=c.get("titlefield")+c.get("emptyfielderror");break;case"nodesc":this.innerHTML=c.get("descriptionfield")+c.get("emptyfielderror");break;case"nosol":this.innerHTML=c.get("solutionfield")+c.get("emptyfielderror");break;default:this.innerHTML=""}}})}),f.template='<div class="idea-edit"><div class="header blue-dark"><span data-editlabel="bind:innerHTML, modifyidealbl">Modify your idea</span></div><form class="form"><p><input type="text" class="input" data-editidea="bind: value, title"></p><p><textarea class="description input" data-editidea="bind: value, description"></textarea></p><p><textarea class="solution input" data-editidea="bind: value, solution"></textarea></p><div class="options"><div class="current-visibility" data-editidea="bind:setVisibleIcon, visibility"><span class="label" data-editlabel="bind:innerHTML,ideavisiblelbl"></span><span data-editlabel="bind:innerHTML, privatelbl" data-editidea="bind:setVisibility, visibility"></span></div><div class="edit-visibility" data-editidea="bind:hideVisibility, visibility"><span class="label" data-editlabel="bind:innerHTML,setideavisiblelbl"></span><div class="visibility public" data-editlabel="bind:innerHTML, publiclbl" data-editevent="listen:mousedown, editVisibility"></div></div></div><div class="options invisible" data-editidea="bind:setReplay, sessionId"><div class="current-visibility replay"><span class="label" data-editlabel="bind:innerHTML,ideafyreplaylbl"></span><span data-editlabel="bind:innerHTML, disabledreplaylbl" data-editidea="bind:setIdeafyStatus, sessionReplay"></span></div><div class="edit-visibility replay"><span class="label" data-editlabel="bind:innerHTML, ideafysetreplaylbl"></span><div class="toggle-replay" data-editidea = "bind: setSessionReplay, sessionReplay" data-editevent="listen:mousedown, press; listen:mouseup, enableReplay" data-editlabel="bind:innerHTML, enablereplaylbl"></div></div></div><p class="submit"><label class="publish pressed-btn" data-editevent="listen:mouseup, upload">Publish</label><label class="cancel pressed-btn" data-editevent="listen:mouseup, cancel">Cancel</label><label class="editerror" data-errormsg="bind:setError, error"></label></p></form></div>',f.place(t.get("public-edit")),f.reset=function(t){l.unsync(),l.reset(),l.sync(s.get("db"),t)},f.editVisibility=function(e,t){var n=new o(t,c.get("setpublicquestion"),function(e){e?l.set("visibility","public"):l.set("visibility","private"),n.close()})},f.press=function(e,t){t.classList.add("pressed")},f.enableReplay=function(e,t){setTimeout(function(){l.get("sessionReplay")?l.set("sessionReplay",!1):l.set("sessionReplay",!0),t.classList.remove("pressed")},300)},f.upload=function(e,t){var n=new Date,r=[n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds()];l.get("title")===""?h.set("error","notitle"):l.get("description")===""?h.set("error","nodesc"):l.get("solution")===""?h.set("error","nosol"):(l.set("modification_date",r),l.upload().then(function(){a("close")})),nide.classList.remove("pressed")},f.cancel=function(e,t){t.classList.remove("pressed"),a("close")},f}});