/*
 RequireJS 2.0.2 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 Available via the MIT or new BSD license.
 see: http://github.com/jrburke/requirejs for details
*/

/*! Socket.IO.min.js build:0.9.16, production. Copyright(c) 2011 LearnBoost <dev@learnboost.com> MIT Licensed */

/*
 Emily <VERSION> http://flams.github.com/emily

 The MIT License (MIT)

 Copyright (c) 2012-2013 Olivier Scherrer <pode.fr@gmail.com>
*/

/*
 Olives <VERSION> http://flams.github.com/olives
 The MIT License (MIT)
 Copyright (c) 2012-2013 Olivier Scherrer <pode.fr@gmail.com> - Olivier Wietrich <olivier.wietrich@gmail.com>
*/

/**
 * https://github.com/TAIAUT/Ideafy
 * Proprietary License - All rights reserved
 * Author: Olivier Wietrich <Olivier.Wietrich@taiaut.com>
 * Copyright (c) 2012-2013 TAIAUT
 */

/**
 * https://github.com/TAIAUT/Ideafy
 * Proprietary License - All rights reserved
 * Author: Vincent Weyl <vincent.weyl@taiaut.com>
 * Copyright (c) 2012-2013 TAIAUT
 */

/**
 * https://github.com/TAIAUT/Ideafy
 * Proprietary License - All rights reserved
 * Author: Vincent Weyl <vincent@ideafy.com>
 * Copyright (c) 2014 IDEAFY
 */

/*
 * https://github.com/TAIAUT/Ideafy
 * Proprietary License - All rights reserved
 * Author: Vincent Weyl <vincent.weyl@taiaut.com>
 * Copyright (c) 2012-2013 TAIAUT
 */

/**
 * https://github.com/TAIAUT/Ideafy
 * Proprietary License - All rights reserved
 * Author: Vincent Weyl <vincent.weyl@taiaut.com>
 * Copyright (c) 2014 IDEAFY
 */

/* 
 * https://github.com/TAIAUT/Ideafy
 * Proprietary License - All rights reserved
 * Author: Vincent Weyl <vincent.weyl@taiaut.com>
 * Copyright (c) 2012-2013 TAIAUT
 */

/**
 * https://github.com/TAIAUT/Ideafy
 * Proprietary License - All rights reserved
 * Authors: Vincent Weyl <vincent.weyl@taiaut.com> - Olivier Wietrich <Olivier.Wietrich@taiaut.com
 * Copyright (c) 2012-2013 TAIAUT
 */

var requirejs,require,define;!function(Z){function w(e){return"[object Function]"===J.call(e)}function G(e){return"[object Array]"===J.call(e)}function q(e,t){if(e){var i;for(i=0;i<e.length&&(!e[i]||!t(e[i],i,e));i+=1);}}function N(e,t){if(e){var i;for(i=e.length-1;i>-1&&(!e[i]||!t(e[i],i,e));i-=1);}}function x(e,t){for(var i in e)if(e.hasOwnProperty(i)&&t(e[i],i))break}function K(e,t,i,n){return t&&x(t,function(t,s){(i||!e.hasOwnProperty(s))&&(n&&"string"!=typeof t?(e[s]||(e[s]={}),K(e[s],t,i,n)):e[s]=t)}),e}function s(e,t){return function(){return t.apply(e,arguments)}}function $(e){if(!e)return e;var t=Z;return q(e.split("."),function(e){t=t[e]}),t}function aa(e,t,i){return function(){var n,s=ga.call(arguments,0);return i&&w(n=s[s.length-1])&&(n.__requireJsBuild=!0),s.push(t),e.apply(null,s)}}function ba(e,i,n){q([["toUrl"],["undef"],["defined","requireDefined"],["specified","requireSpecified"]],function(s){var a=s[1]||s[0];e[s[0]]=i?aa(i[a],n):function(){var e=t[O];return e[a].apply(e,arguments)}})}function H(e,t,i,n){return t=Error(t+"\nhttp://requirejs.org/docs/errors.html#"+e),t.requireType=e,t.requireModules=n,i&&(t.originalError=i),t}function ha(){return I&&"interactive"===I.readyState?I:(N(document.getElementsByTagName("script"),function(e){return"interactive"===e.readyState?I=e:void 0}),I)}var ia=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,ja=/require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,ca=/\.js$/,ka=/^\.\//,J=Object.prototype.toString,y=Array.prototype,ga=y.slice,la=y.splice,u=!("undefined"==typeof window||!navigator||!document),da=!u&&"undefined"!=typeof importScripts,ma=u&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,O="_",S="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),t={},p={},P=[],L=!1,k,v,C,z,D,I,E,ea,fa;if("undefined"==typeof define){if("undefined"!=typeof requirejs){if(w(requirejs))return;p=requirejs,requirejs=void 0}"undefined"!=typeof require&&!w(require)&&(p=require,require=void 0),k=requirejs=function(e,i,n,s){var a,o=O;return!G(e)&&"string"!=typeof e&&(a=e,G(i)?(e=i,i=n,n=s):e=[]),a&&a.context&&(o=a.context),(s=t[o])||(s=t[o]=k.s.newContext(o)),a&&s.configure(a),s.require(e,i,n)},k.config=function(e){return k(e)},require||(require=k),k.version="2.0.2",k.jsExtRegExp=/^\/|:|\?|\.js$/,k.isBrowser=u,y=k.s={contexts:t,newContext:function(e){function t(e,t,i){var n,s,a,o,r=t&&t.split("/"),l=_.map,c=l&&l["*"];if(e&&"."===e.charAt(0))if(t){for(r=_.pkgs[t]?[t]:r.slice(0,r.length-1),t=e=r.concat(e.split("/")),n=0;t[n];n+=1)if(s=t[n],"."===s)t.splice(n,1),n-=1;else if(".."===s){if(1===n&&(".."===t[2]||".."===t[0]))break;n>0&&(t.splice(n-1,2),n-=2)}n=_.pkgs[t=e[0]],e=e.join("/"),n&&e===t+"/"+n.main&&(e=t)}else 0===e.indexOf("./")&&(e=e.substring(2));if(i&&(r||c)&&l)for(t=e.split("/"),n=t.length;n>0;n-=1){if(a=t.slice(0,n).join("/"),r)for(s=r.length;s>0;s-=1)if((i=l[r.slice(0,s).join("/")])&&(i=i[a])){o=i;break}if(!o&&c&&c[a]&&(o=c[a]),o){t.splice(0,n,o),e=t.join("/");break}}return e}function i(e){u&&q(document.getElementsByTagName("script"),function(t){return t.getAttribute("data-requiremodule")===e&&t.getAttribute("data-requirecontext")===M.contextName?(t.parentNode.removeChild(t),!0):void 0})}function n(e){var t=_.paths[e];return t&&G(t)&&t.length>1?(i(e),t.shift(),M.undef(e),M.require([e]),!0):void 0}function a(e,i,n,s){var a,o,r=e?e.indexOf("!"):-1,l=null,c=i?i.name:null,d=e,u=!0,p="";return e||(u=!1,e="_@r"+(j+=1)),-1!==r&&(l=e.substring(0,r),e=e.substring(r+1,e.length)),l&&(l=t(l,c,s),o=E[l]),e&&(l?p=o&&o.normalize?o.normalize(e,function(e){return t(e,c,s)}):t(e,c,s):(p=t(e,c,s),a=M.nameToUrl(e,null,i))),e=!l||o||n?"":"_unnormalized"+(R+=1),{prefix:l,name:p,parentMap:i,unnormalized:!!e,url:a,originalName:d,isDefine:u,id:(l?l+"!"+p:p)+e}}function o(e){var t=e.id,i=D[t];return i||(i=D[t]=new M.Module(e)),i}function r(e,t,i){var n=e.id,s=D[n];!E.hasOwnProperty(n)||s&&!s.defineEmitComplete?o(e).on(t,i):"defined"===t&&i(E[n])}function l(e,t){var i=e.requireModules,n=!1;t?t(e):(q(i,function(t){(t=D[t])&&(t.error=e,t.events.error&&(n=!0,t.emit("error",e)))}),n||k.onError(e))}function c(){P.length&&(la.apply(O,[O.length-1,0].concat(P)),P=[])}function d(e,t,i){return e=e&&e.map,t=aa(i||M.require,e,t),ba(t,M,e),t.isBrowser=u,t}function p(e){delete D[e],q(F,function(t,i){return t.map.id===e?(F.splice(i,1),t.defined||(M.waitCount-=1),!0):void 0})}function g(e,t){var i,n=e.map.id,s=e.depMaps;return e.inited?t[n]?e:(t[n]=!0,q(s,function(e){return(e=D[e.id])?e.inited&&e.enabled?i=g(e,K({},t)):(i=null,delete t[n],!0):void 0}),i):void 0}function h(e,t,i){var n=e.map.id,s=e.depMaps;return e.inited&&e.map.isDefine?t[n]?E[n]:(t[n]=e,q(s,function(s){var s=s.id,a=D[s];!A[s]&&a&&(a.inited&&a.enabled?(a=h(a,t,i),i[s]||e.defineDepById(s,a)):i[n]=!0)}),e.check(!0),E[n]):void 0}function m(e){e.check()}function v(){var e,t,s,a=1e3*_.waitSeconds,o=a&&M.startTime+a<(new Date).getTime(),r=[],c=!1,d=!0;if(!y){if(y=!0,x(D,function(a){if(e=a.map,t=e.id,a.enabled&&!a.error)if(!a.inited&&o)n(t)?c=s=!0:(r.push(t),i(t));else if(!a.inited&&a.fetched&&e.isDefine&&(c=!0,!e.prefix))return d=!1}),o&&r.length)return a=H("timeout","Load timeout for modules: "+r,null,r),a.contextName=M.contextName,l(a);d&&(q(F,function(e){if(!e.defined){var e=g(e,{}),t={};e&&(h(e,t,{}),x(t,m))}}),x(D,m)),o&&!s||!c||!u&&!da||C||(C=setTimeout(function(){C=0,v()},50)),y=!1}}function f(e){o(a(e[0],null,!0)).init(e[1],e[2])}function b(e){var e=e.currentTarget||e.srcElement,t=M.onScriptLoad;return e.detachEvent&&!S?e.detachEvent("onreadystatechange",t):e.removeEventListener("load",t,!1),t=M.onScriptError,e.detachEvent&&!S||e.removeEventListener("error",t,!1),{node:e,id:e&&e.getAttribute("data-requiremodule")}}var y,T,M,A,C,_={waitSeconds:7,baseUrl:"./",paths:{},pkgs:{},shim:{}},D={},N={},O=[],E={},B={},j=1,R=1,F=[];return A={require:function(e){return d(e)},exports:function(e){return e.usingExports=!0,e.map.isDefine?e.exports=E[e.map.id]={}:void 0},module:function(e){return e.module={id:e.map.id,uri:e.map.url,config:function(){return _.config&&_.config[e.map.id]||{}},exports:E[e.map.id]}}},T=function(e){this.events=N[e.id]||{},this.map=e,this.shim=_.shim[e.id],this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},T.prototype={init:function(e,t,i,n){n=n||{},this.inited||(this.factory=t,i?this.on("error",i):this.events.error&&(i=s(this,function(e){this.emit("error",e)})),this.depMaps=e&&e.slice(0),this.depMaps.rjsSkipMap=e.rjsSkipMap,this.errback=i,this.inited=!0,this.ignore=n.ignore,n.enabled||this.enabled?this.enable():this.check())},defineDepById:function(e,t){var i;return q(this.depMaps,function(t,n){return t.id===e?(i=n,!0):void 0}),this.defineDep(i,t)},defineDep:function(e,t){this.depMatched[e]||(this.depMatched[e]=!0,this.depCount-=1,this.depExports[e]=t)},fetch:function(){if(!this.fetched){this.fetched=!0,M.startTime=(new Date).getTime();var e=this.map;if(!this.shim)return e.prefix?this.callPlugin():this.load();d(this,!0)(this.shim.deps||[],s(this,function(){return e.prefix?this.callPlugin():this.load()}))}},load:function(){var e=this.map.url;B[e]||(B[e]=!0,M.load(this.map.id,e))},check:function(e){if(this.enabled&&!this.enabling){var t,i=this.map.id,n=this.depExports,s=this.exports,a=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,this.depCount<1&&!this.defined){if(w(a)){if(this.events.error)try{s=M.execCb(i,a,n,s)}catch(o){t=o}else s=M.execCb(i,a,n,s);if(this.map.isDefine&&((n=this.module)&&void 0!==n.exports&&n.exports!==this.exports?s=n.exports:void 0===s&&this.usingExports&&(s=this.exports)),t)return t.requireMap=this.map,t.requireModules=[this.map.id],t.requireType="define",l(this.error=t)}else s=a;this.exports=s,this.map.isDefine&&!this.ignore&&(E[i]=s,k.onResourceLoad)&&k.onResourceLoad(M,this.map,this.depMaps),delete D[i],this.defined=!0,M.waitCount-=1,0===M.waitCount&&(F=[])}this.defining=!1,e||!this.defined||this.defineEmitted||(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else this.fetch()}},callPlugin:function(){var e=this.map,i=e.id,n=a(e.prefix,null,!1,!0);r(n,"defined",s(this,function(n){var c=this.map.name,u=this.map.parentMap?this.map.parentMap.name:null;this.map.unnormalized?(n.normalize&&(c=n.normalize(c,function(e){return t(e,u,!0)})||""),n=a(e.prefix+"!"+c,this.map.parentMap,!1,!0),r(n,"defined",s(this,function(e){this.init([],function(){return e},null,{enabled:!0,ignore:!0})})),(n=D[n.id])&&(this.events.error&&n.on("error",s(this,function(e){this.emit("error",e)})),n.enable())):(c=s(this,function(e){this.init([],function(){return e},null,{enabled:!0})}),c.error=s(this,function(e){this.inited=!0,this.error=e,e.requireModules=[i],x(D,function(e){0===e.map.id.indexOf(i+"_unnormalized")&&p(e.map.id)}),l(e)}),c.fromText=function(e,t){var i=L;i&&(L=!1),o(a(e)),k.exec(t),i&&(L=!0),M.completeLoad(e)},n.load(e.name,d(e.parentMap,!0,function(e,t){return e.rjsSkipMap=!0,M.require(e,t)}),c,_))})),M.enable(n,this),this.pluginMaps[n.id]=n},enable:function(){this.enabled=!0,this.waitPushed||(F.push(this),M.waitCount+=1,this.waitPushed=!0),this.enabling=!0,q(this.depMaps,s(this,function(e,t){var i,n;if("string"==typeof e){if(e=a(e,this.map.isDefine?this.map:this.map.parentMap,!1,!this.depMaps.rjsSkipMap),this.depMaps[t]=e,i=A[e.id])return this.depExports[t]=i(this),void 0;this.depCount+=1,r(e,"defined",s(this,function(e){this.defineDep(t,e),this.check()})),this.errback&&r(e,"error",this.errback)}i=e.id,n=D[i],!A[i]&&n&&!n.enabled&&M.enable(e,this)})),x(this.pluginMaps,s(this,function(e){var t=D[e.id];t&&!t.enabled&&M.enable(e,this)})),this.enabling=!1,this.check()},on:function(e,t){var i=this.events[e];i||(i=this.events[e]=[]),i.push(t)},emit:function(e,t){q(this.events[e],function(e){e(t)}),"error"===e&&delete this.events[e]}},M={config:_,contextName:e,registry:D,defined:E,urlFetched:B,waitCount:0,defQueue:O,Module:T,makeModuleMap:a,configure:function(e){e.baseUrl&&"/"!==e.baseUrl.charAt(e.baseUrl.length-1)&&(e.baseUrl+="/");var t=_.pkgs,i=_.shim,n=_.paths,s=_.map;K(_,e,!0),_.paths=K(n,e.paths,!0),e.map&&(_.map=K(s||{},e.map,!0,!0)),e.shim&&(x(e.shim,function(e,t){G(e)&&(e={deps:e}),e.exports&&!e.exports.__buildReady&&(e.exports=M.makeShimExports(e.exports)),i[t]=e}),_.shim=i),e.packages&&(q(e.packages,function(e){e="string"==typeof e?{name:e}:e,t[e.name]={name:e.name,location:e.location||e.name,main:(e.main||"main").replace(ka,"").replace(ca,"")}}),_.pkgs=t),x(D,function(e,t){e.map=a(t)}),(e.deps||e.callback)&&M.require(e.deps||[],e.callback)},makeShimExports:function(e){var t;return"string"==typeof e?(t=function(){return $(e)},t.exports=e,t):function(){return e.apply(Z,arguments)}},requireDefined:function(e,t){var i=a(e,t,!1,!0).id;return E.hasOwnProperty(i)},requireSpecified:function(e,t){return e=a(e,t,!1,!0).id,E.hasOwnProperty(e)||D.hasOwnProperty(e)},require:function(t,i,n,s){var r;if("string"==typeof t)return w(i)?l(H("requireargs","Invalid require call"),n):k.get?k.get(M,t,i):(t=a(t,i,!1,!0),t=t.id,E.hasOwnProperty(t)?E[t]:l(H("notloaded",'Module name "'+t+'" has not been loaded yet for context: '+e)));for(n&&!w(n)&&(s=n,n=void 0),i&&!w(i)&&(s=i,i=void 0),c();O.length;){if(r=O.shift(),null===r[0])return l(H("mismatch","Mismatched anonymous define() module: "+r[r.length-1]));f(r)}return o(a(null,s)).init(t,i,n,{enabled:!0}),v(),M.require},undef:function(e){var t=a(e,null,!0),i=D[e];delete E[e],delete B[t.url],delete N[e],i&&(i.events.defined&&(N[e]=i.events),p(e))},enable:function(e){D[e.id]&&o(e).enable()},completeLoad:function(e){var t,i,s=_.shim[e]||{},a=s.exports&&s.exports.exports;for(c();O.length;){if(i=O.shift(),null===i[0]){if(i[0]=e,t)break;t=!0}else i[0]===e&&(t=!0);f(i)}if(i=D[e],!t&&!E[e]&&i&&!i.inited){if(!(!_.enforceDefine||a&&$(a)))return n(e)?void 0:l(H("nodefine","No define call for "+e,null,[e]));f([e,s.deps||[],s.exports])}v()},toUrl:function(e,t){var i=e.lastIndexOf("."),n=null;return-1!==i&&(n=e.substring(i,e.length),e=e.substring(0,i)),M.nameToUrl(e,n,t)},nameToUrl:function(e,i,n){var s,a,o,r,l,e=t(e,n&&n.id,!0);if(k.jsExtRegExp.test(e))i=e+(i||"");else{for(s=_.paths,a=_.pkgs,n=e.split("/"),r=n.length;r>0;r-=1){if(l=n.slice(0,r).join("/"),o=a[l],l=s[l]){G(l)&&(l=l[0]),n.splice(0,r,l);break}if(o){e=e===o.name?o.location+"/"+o.main:o.location,n.splice(0,r,e);break}}i=n.join("/")+(i||".js"),i=("/"===i.charAt(0)||i.match(/^[\w\+\.\-]+:/)?"":_.baseUrl)+i}return _.urlArgs?i+((-1===i.indexOf("?")?"?":"&")+_.urlArgs):i},load:function(e,t){k.load(M,e,t)},execCb:function(e,t,i,n){return t.apply(n,i)},onScriptLoad:function(e){("load"===e.type||ma.test((e.currentTarget||e.srcElement).readyState))&&(I=null,e=b(e),M.completeLoad(e.id))},onScriptError:function(e){var t=b(e);return n(t.id)?void 0:l(H("scripterror","Script error",e,[t.id]))}}}},k({}),ba(k),u&&(v=y.head=document.getElementsByTagName("head")[0],C=document.getElementsByTagName("base")[0])&&(v=y.head=C.parentNode),k.onError=function(e){throw e},k.load=function(e,t,i){var n,s=e&&e.config||{};return u?(n=s.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script"),n.type=s.scriptType||"text/javascript",n.charset="utf-8",n.setAttribute("data-requirecontext",e.contextName),n.setAttribute("data-requiremodule",t),!n.attachEvent||n.attachEvent.toString&&n.attachEvent.toString().indexOf("[native code")<0||S?(n.addEventListener("load",e.onScriptLoad,!1),n.addEventListener("error",e.onScriptError,!1)):(L=!0,n.attachEvent("onreadystatechange",e.onScriptLoad)),n.src=i,E=n,C?v.insertBefore(n,C):v.appendChild(n),E=null,n):(da&&(importScripts(i),e.completeLoad(t)),void 0)},u&&N(document.getElementsByTagName("script"),function(e){return v||(v=e.parentNode),(z=e.getAttribute("data-main"))?(D=z.split("/"),ea=D.pop(),fa=D.length?D.join("/")+"/":"./",p.baseUrl||(p.baseUrl=fa),z=ea.replace(ca,""),p.deps=p.deps?p.deps.concat(z):[z],!0):void 0}),define=function(e,i,n){var s,a;"string"!=typeof e&&(n=i,i=e,e=null),G(i)||(n=i,i=[]),!i.length&&w(n)&&n.length&&(n.toString().replace(ia,"").replace(ja,function(e,t){i.push(t)}),i=(1===n.length?["require"]:["require","exports","module"]).concat(i)),L&&(s=E||ha())&&(e||(e=s.getAttribute("data-requiremodule")),a=t[s.getAttribute("data-requirecontext")]),(a?a.defQueue:P).push([e,i,n])},define.amd={jQuery:!0},k.exec=function(b){return eval(b)},k(p)}}(this),define("requireLib",function(){});var io="undefined"==typeof module?{}:module.exports;!function(){if(function(e,t){var i=e;i.version="0.9.16",i.protocol=1,i.transports=[],i.j=[],i.sockets={},i.connect=function(e,n){var s,a,o=i.util.parseUri(e);t&&t.location&&(o.protocol=o.protocol||t.location.protocol.slice(0,-1),o.host=o.host||(t.document?t.document.domain:t.location.hostname),o.port=o.port||t.location.port),s=i.util.uniqueUri(o);var r={host:o.host,secure:"https"==o.protocol,port:o.port||("https"==o.protocol?443:80),query:o.query||""};return i.util.merge(r,n),(r["force new connection"]||!i.sockets[s])&&(a=new i.Socket(r)),!r["force new connection"]&&a&&(i.sockets[s]=a),a=a||i.sockets[s],a.of(o.path.length>1?o.path:"")}}("object"==typeof module?module.exports:this.io={},this),function(e,t){var i=e.util={},n=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,s=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];i.parseUri=function(e){for(var t=n.exec(e||""),i={},a=14;a--;)i[s[a]]=t[a]||"";return i},i.uniqueUri=function(e){var i=e.protocol,n=e.host,s=e.port;return"document"in t?(n=n||document.domain,s=s||("https"==i&&"https:"!==document.location.protocol?443:document.location.port)):(n=n||"localhost",!s&&"https"==i&&(s=443)),(i||"http")+"://"+n+":"+(s||80)},i.query=function(e,t){var n=i.chunkQuery(e||""),s=[];i.merge(n,i.chunkQuery(t||""));for(var a in n)n.hasOwnProperty(a)&&s.push(a+"="+n[a]);return s.length?"?"+s.join("&"):""},i.chunkQuery=function(e){for(var t,i={},n=e.split("&"),s=0,a=n.length;a>s;++s)t=n[s].split("="),t[0]&&(i[t[0]]=t[1]);return i};var a=!1;i.load=function(e){return"document"in t&&"complete"===document.readyState||a?e():(i.on(t,"load",e,!1),void 0)},i.on=function(e,t,i,n){e.attachEvent?e.attachEvent("on"+t,i):e.addEventListener&&e.addEventListener(t,i,n)},i.request=function(e){if(e&&"undefined"!=typeof XDomainRequest&&!i.ua.hasCORS)return new XDomainRequest;if("undefined"!=typeof XMLHttpRequest&&(!e||i.ua.hasCORS))return new XMLHttpRequest;if(!e)try{return new(window[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(t){}return null},"undefined"!=typeof window&&i.load(function(){a=!0}),i.defer=function(e){return i.ua.webkit&&"undefined"==typeof importScripts?(i.load(function(){setTimeout(e,100)}),void 0):e()},i.merge=function(e,t,n,s){var a,o=s||[],r="undefined"==typeof n?2:n;for(a in t)t.hasOwnProperty(a)&&i.indexOf(o,a)<0&&("object"==typeof e[a]&&r?i.merge(e[a],t[a],r-1,o):(e[a]=t[a],o.push(t[a])));return e},i.mixin=function(e,t){i.merge(e.prototype,t.prototype)},i.inherit=function(e,t){function i(){}i.prototype=t.prototype,e.prototype=new i},i.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},i.intersect=function(e,t){for(var n=[],s=e.length>t.length?e:t,a=e.length>t.length?t:e,o=0,r=a.length;r>o;o++)~i.indexOf(s,a[o])&&n.push(a[o]);return n},i.indexOf=function(e,t,i){for(var n=e.length,i=0>i?0>i+n?0:i+n:i||0;n>i&&e[i]!==t;i++);return i>=n?-1:i},i.toArray=function(e){for(var t=[],i=0,n=e.length;n>i;i++)t.push(e[i]);return t},i.ua={},i.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var e=new XMLHttpRequest}catch(t){return!1}return void 0!=e.withCredentials}(),i.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent),i.ua.iDevice="undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)}("undefined"!=typeof io?io:module.exports,this),function(e,t){function i(){}e.EventEmitter=i,i.prototype.on=function(e,i){return this.$events||(this.$events={}),this.$events[e]?t.util.isArray(this.$events[e])?this.$events[e].push(i):this.$events[e]=[this.$events[e],i]:this.$events[e]=i,this},i.prototype.addListener=i.prototype.on,i.prototype.once=function(e,t){function i(){n.removeListener(e,i),t.apply(this,arguments)}var n=this;return i.listener=t,this.on(e,i),this},i.prototype.removeListener=function(e,i){if(this.$events&&this.$events[e]){var n=this.$events[e];if(t.util.isArray(n)){for(var s=-1,a=0,o=n.length;o>a;a++)if(n[a]===i||n[a].listener&&n[a].listener===i){s=a;break}if(0>s)return this;n.splice(s,1),n.length||delete this.$events[e]}else(n===i||n.listener&&n.listener===i)&&delete this.$events[e]}return this},i.prototype.removeAllListeners=function(e){return void 0===e?(this.$events={},this):(this.$events&&this.$events[e]&&(this.$events[e]=null),this)},i.prototype.listeners=function(e){return this.$events||(this.$events={}),this.$events[e]||(this.$events[e]=[]),t.util.isArray(this.$events[e])||(this.$events[e]=[this.$events[e]]),this.$events[e]},i.prototype.emit=function(e){if(!this.$events)return!1;var i=this.$events[e];if(!i)return!1;var n=Array.prototype.slice.call(arguments,1);if("function"==typeof i)i.apply(this,n);else{if(!t.util.isArray(i))return!1;for(var s=i.slice(),a=0,o=s.length;o>a;a++)s[a].apply(this,n)}return!0}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(exports,nativeJSON){function f(e){return 10>e?"0"+e:e}function date(e){return isFinite(e.valueOf())?e.getUTCFullYear()+"-"+f(e.getUTCMonth()+1)+"-"+f(e.getUTCDate())+"T"+f(e.getUTCHours())+":"+f(e.getUTCMinutes())+":"+f(e.getUTCSeconds())+"Z":null}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var i,n,s,a,o,r=gap,l=t[e];switch(l instanceof Date&&(l=date(e)),"function"==typeof rep&&(l=rep.call(t,e,l)),typeof l){case"string":return quote(l);case"number":return isFinite(l)?String(l):"null";case"boolean":case"null":return String(l);case"object":if(!l)return"null";if(gap+=indent,o=[],"[object Array]"===Object.prototype.toString.apply(l)){for(a=l.length,i=0;a>i;i+=1)o[i]=str(i,l)||"null";return s=0===o.length?"[]":gap?"[\n"+gap+o.join(",\n"+gap)+"\n"+r+"]":"["+o.join(",")+"]",gap=r,s}if(rep&&"object"==typeof rep)for(a=rep.length,i=0;a>i;i+=1)"string"==typeof rep[i]&&(n=rep[i],s=str(n,l),s&&o.push(quote(n)+(gap?": ":":")+s));else for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(s=str(n,l),s&&o.push(quote(n)+(gap?": ":":")+s));return s=0===o.length?"{}":gap?"{\n"+gap+o.join(",\n"+gap)+"\n"+r+"}":"{"+o.join(",")+"}",gap=r,s}}if(nativeJSON&&nativeJSON.parse)return exports.JSON={parse:nativeJSON.parse,stringify:nativeJSON.stringify};var JSON=exports.JSON={},cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;JSON.stringify=function(e,t,i){var n;if(gap="",indent="","number"==typeof i)for(n=0;i>n;n+=1)indent+=" ";else"string"==typeof i&&(indent=i);if(rep=t,!t||"function"==typeof t||"object"==typeof t&&"number"==typeof t.length)return str("",{"":e});throw new Error("JSON.stringify")},JSON.parse=function(text,reviver){function walk(e,t){var i,n,s=e[t];if(s&&"object"==typeof s)for(i in s)Object.prototype.hasOwnProperty.call(s,i)&&(n=walk(s,i),void 0!==n?s[i]=n:delete s[i]);return reviver.call(e,t,s)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof JSON?JSON:void 0),function(e,t){var i=e.parser={},n=i.packets=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],s=i.reasons=["transport not supported","client not handshaken","unauthorized"],a=i.advice=["reconnect"],o=t.JSON,r=t.util.indexOf;i.encodePacket=function(e){var t=r(n,e.type),i=e.id||"",l=e.endpoint||"",c=e.ack,d=null;switch(e.type){case"error":var u=e.reason?r(s,e.reason):"",p=e.advice?r(a,e.advice):"";(""!==u||""!==p)&&(d=u+(""!==p?"+"+p:""));break;case"message":""!==e.data&&(d=e.data);break;case"event":var g={name:e.name};e.args&&e.args.length&&(g.args=e.args),d=o.stringify(g);break;case"json":d=o.stringify(e.data);break;case"connect":e.qs&&(d=e.qs);break;case"ack":d=e.ackId+(e.args&&e.args.length?"+"+o.stringify(e.args):"")}var h=[t,i+("data"==c?"+":""),l];return null!==d&&void 0!==d&&h.push(d),h.join(":")},i.encodePayload=function(e){var t="";if(1==e.length)return e[0];for(var i=0,n=e.length;n>i;i++){var s=e[i];t+="�"+s.length+"�"+e[i]}return t};var l=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;i.decodePacket=function(e){var t=e.match(l);if(!t)return{};var i=t[2]||"",e=t[5]||"",r={type:n[t[1]],endpoint:t[4]||""};switch(i&&(r.id=i,r.ack=t[3]?"data":!0),r.type){case"error":var t=e.split("+");r.reason=s[t[0]]||"",r.advice=a[t[1]]||"";break;case"message":r.data=e||"";break;case"event":try{var c=o.parse(e);r.name=c.name,r.args=c.args}catch(d){}r.args=r.args||[];break;case"json":try{r.data=o.parse(e)}catch(d){}break;case"connect":r.qs=e||"";break;case"ack":var t=e.match(/^([0-9]+)(\+)?(.*)/);if(t&&(r.ackId=t[1],r.args=[],t[3]))try{r.args=t[3]?o.parse(t[3]):[]}catch(d){}break;case"disconnect":case"heartbeat":}return r},i.decodePayload=function(e){if("�"==e.charAt(0)){for(var t=[],n=1,s="";n<e.length;n++)"�"==e.charAt(n)?(t.push(i.decodePacket(e.substr(n+1).substr(0,s))),n+=Number(s)+1,s=""):s+=e.charAt(n);return t}return[i.decodePacket(e)]}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(e,t){function i(e,t){this.socket=e,this.sessid=t}e.Transport=i,t.util.mixin(i,t.EventEmitter),i.prototype.heartbeats=function(){return!0},i.prototype.onData=function(e){if(this.clearCloseTimeout(),(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout(),""!==e){var i=t.parser.decodePayload(e);if(i&&i.length)for(var n=0,s=i.length;s>n;n++)this.onPacket(i[n])}return this},i.prototype.onPacket=function(e){return this.socket.setHeartbeatTimeout(),"heartbeat"==e.type?this.onHeartbeat():("connect"==e.type&&""==e.endpoint&&this.onConnect(),"error"==e.type&&"reconnect"==e.advice&&(this.isOpen=!1),this.socket.onPacket(e),this)},i.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var e=this;this.closeTimeout=setTimeout(function(){e.onDisconnect()},this.socket.closeTimeout)}},i.prototype.onDisconnect=function(){return this.isOpen&&this.close(),this.clearTimeouts(),this.socket.onDisconnect(),this},i.prototype.onConnect=function(){return this.socket.onConnect(),this},i.prototype.clearCloseTimeout=function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)},i.prototype.clearTimeouts=function(){this.clearCloseTimeout(),this.reopenTimeout&&clearTimeout(this.reopenTimeout)},i.prototype.packet=function(e){this.send(t.parser.encodePacket(e))},i.prototype.onHeartbeat=function(){this.packet({type:"heartbeat"})},i.prototype.onOpen=function(){this.isOpen=!0,this.clearCloseTimeout(),this.socket.onOpen()},i.prototype.onClose=function(){this.isOpen=!1,this.socket.onClose(),this.onDisconnect()},i.prototype.prepareUrl=function(){var e=this.socket.options;return this.scheme()+"://"+e.host+":"+e.port+"/"+e.resource+"/"+t.protocol+"/"+this.name+"/"+this.sessid},i.prototype.ready=function(e,t){t.call(this)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(e,t,i){function n(e){if(this.options={port:80,secure:!1,document:"document"in i?document:!1,resource:"socket.io",transports:t.transports,"connect timeout":1e4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":1/0,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":!1,"auto connect":!0,"flash policy port":10843,manualFlush:!1},t.util.merge(this.options,e),this.connected=!1,this.open=!1,this.connecting=!1,this.reconnecting=!1,this.namespaces={},this.buffer=[],this.doBuffer=!1,this.options["sync disconnect on unload"]&&(!this.isXDomain()||t.util.ua.hasCORS)){var n=this;t.util.on(i,"beforeunload",function(){n.disconnectSync()},!1)}this.options["auto connect"]&&this.connect()}function s(){}e.Socket=n,t.util.mixin(n,t.EventEmitter),n.prototype.of=function(e){return this.namespaces[e]||(this.namespaces[e]=new t.SocketNamespace(this,e),""!==e&&this.namespaces[e].packet({type:"connect"})),this.namespaces[e]},n.prototype.publish=function(){this.emit.apply(this,arguments);var e;for(var t in this.namespaces)this.namespaces.hasOwnProperty(t)&&(e=this.of(t),e.$emit.apply(e,arguments))},n.prototype.handshake=function(e){function i(t){t instanceof Error?(n.connecting=!1,n.onError(t.message)):e.apply(null,t.split(":"))}var n=this,a=this.options,o=["http"+(a.secure?"s":"")+":/",a.host+":"+a.port,a.resource,t.protocol,t.util.query(this.options.query,"t="+ +new Date)].join("/");if(this.isXDomain()&&!t.util.ua.hasCORS){var r=document.getElementsByTagName("script")[0],l=document.createElement("script");l.src=o+"&jsonp="+t.j.length,r.parentNode.insertBefore(l,r),t.j.push(function(e){i(e),l.parentNode.removeChild(l)})}else{var c=t.util.request();c.open("GET",o,!0),this.isXDomain()&&(c.withCredentials=!0),c.onreadystatechange=function(){4==c.readyState&&(c.onreadystatechange=s,200==c.status?i(c.responseText):403==c.status?n.onError(c.responseText):(n.connecting=!1,!n.reconnecting&&n.onError(c.responseText)))},c.send(null)}},n.prototype.getTransport=function(e){for(var i,n=e||this.transports,s=0;i=n[s];s++)if(t.Transport[i]&&t.Transport[i].check(this)&&(!this.isXDomain()||t.Transport[i].xdomainCheck(this)))return new t.Transport[i](this,this.sessionid);return null},n.prototype.connect=function(e){if(this.connecting)return this;var i=this;return i.connecting=!0,this.handshake(function(n,s,a,o){function r(e){return i.transport&&i.transport.clearTimeouts(),i.transport=i.getTransport(e),i.transport?(i.transport.ready(i,function(){i.connecting=!0,i.publish("connecting",i.transport.name),i.transport.open(),i.options["connect timeout"]&&(i.connectTimeoutTimer=setTimeout(function(){if(!i.connected&&(i.connecting=!1,i.options["try multiple transports"])){for(var e=i.transports;e.length>0&&e.splice(0,1)[0]!=i.transport.name;);e.length?r(e):i.publish("connect_failed")}},i.options["connect timeout"]))}),void 0):i.publish("connect_failed")}i.sessionid=n,i.closeTimeout=1e3*a,i.heartbeatTimeout=1e3*s,i.transports||(i.transports=i.origTransports=o?t.util.intersect(o.split(","),i.options.transports):i.options.transports),i.setHeartbeatTimeout(),r(i.transports),i.once("connect",function(){clearTimeout(i.connectTimeoutTimer),e&&"function"==typeof e&&e()})}),this},n.prototype.setHeartbeatTimeout=function(){if(clearTimeout(this.heartbeatTimeoutTimer),!this.transport||this.transport.heartbeats()){var e=this;this.heartbeatTimeoutTimer=setTimeout(function(){e.transport.onClose()},this.heartbeatTimeout)}},n.prototype.packet=function(e){return this.connected&&!this.doBuffer?this.transport.packet(e):this.buffer.push(e),this},n.prototype.setBuffer=function(e){this.doBuffer=e,!e&&this.connected&&this.buffer.length&&(this.options.manualFlush||this.flushBuffer())},n.prototype.flushBuffer=function(){this.transport.payload(this.buffer),this.buffer=[]},n.prototype.disconnect=function(){return(this.connected||this.connecting)&&(this.open&&this.of("").packet({type:"disconnect"}),this.onDisconnect("booted")),this},n.prototype.disconnectSync=function(){var e=t.util.request(),i=["http"+(this.options.secure?"s":"")+":/",this.options.host+":"+this.options.port,this.options.resource,t.protocol,"",this.sessionid].join("/")+"/?disconnect=1";e.open("GET",i,!1),e.send(null),this.onDisconnect("booted")},n.prototype.isXDomain=function(){var e=i.location.port||("https:"==i.location.protocol?443:80);return this.options.host!==i.location.hostname||this.options.port!=e},n.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=!1,this.doBuffer||this.setBuffer(!1),this.emit("connect"))},n.prototype.onOpen=function(){this.open=!0},n.prototype.onClose=function(){this.open=!1,clearTimeout(this.heartbeatTimeoutTimer)},n.prototype.onPacket=function(e){this.of(e.endpoint).onPacket(e)},n.prototype.onError=function(e){e&&e.advice&&"reconnect"===e.advice&&(this.connected||this.connecting)&&(this.disconnect(),this.options.reconnect&&this.reconnect()),this.publish("error",e&&e.reason?e.reason:e)},n.prototype.onDisconnect=function(e){var t=this.connected,i=this.connecting;this.connected=!1,this.connecting=!1,this.open=!1,(t||i)&&(this.transport.close(),this.transport.clearTimeouts(),t&&(this.publish("disconnect",e),"booted"!=e&&this.options.reconnect&&!this.reconnecting&&this.reconnect()))},n.prototype.reconnect=function(){function e(){if(i.connected){for(var e in i.namespaces)i.namespaces.hasOwnProperty(e)&&""!==e&&i.namespaces[e].packet({type:"connect"});i.publish("reconnect",i.transport.name,i.reconnectionAttempts)}clearTimeout(i.reconnectionTimer),i.removeListener("connect_failed",t),i.removeListener("connect",t),i.reconnecting=!1,delete i.reconnectionAttempts,delete i.reconnectionDelay,delete i.reconnectionTimer,delete i.redoTransports,i.options["try multiple transports"]=s
}function t(){return i.reconnecting?i.connected?e():i.connecting&&i.reconnecting?i.reconnectionTimer=setTimeout(t,1e3):(i.reconnectionAttempts++>=n?i.redoTransports?(i.publish("reconnect_failed"),e()):(i.on("connect_failed",t),i.options["try multiple transports"]=!0,i.transports=i.origTransports,i.transport=i.getTransport(),i.redoTransports=!0,i.connect()):(i.reconnectionDelay<a&&(i.reconnectionDelay*=2),i.connect(),i.publish("reconnecting",i.reconnectionDelay,i.reconnectionAttempts),i.reconnectionTimer=setTimeout(t,i.reconnectionDelay)),void 0):void 0}this.reconnecting=!0,this.reconnectionAttempts=0,this.reconnectionDelay=this.options["reconnection delay"];var i=this,n=this.options["max reconnection attempts"],s=this.options["try multiple transports"],a=this.options["reconnection limit"];this.options["try multiple transports"]=!1,this.reconnectionTimer=setTimeout(t,this.reconnectionDelay),this.on("connect",t)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(e,t){function i(e,t){this.socket=e,this.name=t||"",this.flags={},this.json=new n(this,"json"),this.ackPackets=0,this.acks={}}function n(e,t){this.namespace=e,this.name=t}e.SocketNamespace=i,t.util.mixin(i,t.EventEmitter),i.prototype.$emit=t.EventEmitter.prototype.emit,i.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)},i.prototype.packet=function(e){return e.endpoint=this.name,this.socket.packet(e),this.flags={},this},i.prototype.send=function(e,t){var i={type:this.flags.json?"json":"message",data:e};return"function"==typeof t&&(i.id=++this.ackPackets,i.ack=!0,this.acks[i.id]=t),this.packet(i)},i.prototype.emit=function(e){var t=Array.prototype.slice.call(arguments,1),i=t[t.length-1],n={type:"event",name:e};return"function"==typeof i&&(n.id=++this.ackPackets,n.ack="data",this.acks[n.id]=i,t=t.slice(0,t.length-1)),n.args=t,this.packet(n)},i.prototype.disconnect=function(){return""===this.name?this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect")),this},i.prototype.onPacket=function(e){function i(){n.packet({type:"ack",args:t.util.toArray(arguments),ackId:e.id})}var n=this;switch(e.type){case"connect":this.$emit("connect");break;case"disconnect":""===this.name?this.socket.onDisconnect(e.reason||"booted"):this.$emit("disconnect",e.reason);break;case"message":case"json":var s=["message",e.data];"data"==e.ack?s.push(i):e.ack&&this.packet({type:"ack",ackId:e.id}),this.$emit.apply(this,s);break;case"event":var s=[e.name].concat(e.args);"data"==e.ack&&s.push(i),this.$emit.apply(this,s);break;case"ack":this.acks[e.ackId]&&(this.acks[e.ackId].apply(this,e.args),delete this.acks[e.ackId]);break;case"error":e.advice?this.socket.onError(e):"unauthorized"==e.reason?this.$emit("connect_failed",e.reason):this.$emit("error",e.reason)}},n.prototype.send=function(){this.namespace.flags[this.name]=!0,this.namespace.send.apply(this.namespace,arguments)},n.prototype.emit=function(){this.namespace.flags[this.name]=!0,this.namespace.emit.apply(this.namespace,arguments)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(e,t,i){function n(){t.Transport.apply(this,arguments)}e.websocket=n,t.util.inherit(n,t.Transport),n.prototype.name="websocket",n.prototype.open=function(){var e,n=t.util.query(this.socket.options.query),s=this;return e||(e=i.MozWebSocket||i.WebSocket),this.websocket=new e(this.prepareUrl()+n),this.websocket.onopen=function(){s.onOpen(),s.socket.setBuffer(!1)},this.websocket.onmessage=function(e){s.onData(e.data)},this.websocket.onclose=function(){s.onClose(),s.socket.setBuffer(!0)},this.websocket.onerror=function(e){s.onError(e)},this},n.prototype.send=t.util.ua.iDevice?function(e){var t=this;return setTimeout(function(){t.websocket.send(e)},0),this}:function(e){return this.websocket.send(e),this},n.prototype.payload=function(e){for(var t=0,i=e.length;i>t;t++)this.packet(e[t]);return this},n.prototype.close=function(){return this.websocket.close(),this},n.prototype.onError=function(e){this.socket.onError(e)},n.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"},n.check=function(){return"WebSocket"in i&&!("__addTask"in WebSocket)||"MozWebSocket"in i},n.xdomainCheck=function(){return!0},t.transports.push("websocket")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(e,t){function i(){t.Transport.websocket.apply(this,arguments)}e.flashsocket=i,t.util.inherit(i,t.Transport.websocket),i.prototype.name="flashsocket",i.prototype.open=function(){var e=this,i=arguments;return WebSocket.__addTask(function(){t.Transport.websocket.prototype.open.apply(e,i)}),this},i.prototype.send=function(){var e=this,i=arguments;return WebSocket.__addTask(function(){t.Transport.websocket.prototype.send.apply(e,i)}),this},i.prototype.close=function(){return WebSocket.__tasks.length=0,t.Transport.websocket.prototype.close.call(this),this},i.prototype.ready=function(e,n){function s(){var t=e.options,s=t["flash policy port"],o=["http"+(t.secure?"s":"")+":/",t.host+":"+t.port,t.resource,"static/flashsocket","WebSocketMain"+(e.isXDomain()?"Insecure":"")+".swf"];i.loaded||("undefined"==typeof WEB_SOCKET_SWF_LOCATION&&(WEB_SOCKET_SWF_LOCATION=o.join("/")),843!==s&&WebSocket.loadFlashPolicyFile("xmlsocket://"+t.host+":"+s),WebSocket.__initialize(),i.loaded=!0),n.call(a)}var a=this;return document.body?s():(t.util.load(s),void 0)},i.check=function(){return"undefined"!=typeof WebSocket&&"__initialize"in WebSocket&&swfobject?swfobject.getFlashPlayerVersion().major>=10:!1},i.xdomainCheck=function(){return!0},"undefined"!=typeof window&&(WEB_SOCKET_DISABLE_AUTO_INITIALIZATION=!0),t.transports.push("flashsocket")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports),"undefined"!=typeof window)var swfobject=function(){function e(){if(!J){try{var e=E.getElementsByTagName("body")[0].appendChild(v("span"));e.parentNode.removeChild(e)}catch(t){return}J=!0;for(var i=j.length,n=0;i>n;n++)j[n]()}}function t(e){J?e():j[j.length]=e}function i(e){if(typeof O.addEventListener!=x)O.addEventListener("load",e,!1);else if(typeof E.addEventListener!=x)E.addEventListener("load",e,!1);else if(typeof O.attachEvent!=x)f(O,"onload",e);else if("function"==typeof O.onload){var t=O.onload;O.onload=function(){t(),e()}}else O.onload=e}function n(){P?s():a()}function s(){var e=E.getElementsByTagName("body")[0],t=v(q);t.setAttribute("type",I);var i=e.appendChild(t);if(i){var n=0;!function(){if(typeof i.GetVariable!=x){var s=i.GetVariable("$version");s&&(s=s.split(" ")[1].split(","),W.pv=[parseInt(s[0],10),parseInt(s[1],10),parseInt(s[2],10)])}else if(10>n)return n++,setTimeout(arguments.callee,10),void 0;e.removeChild(t),i=null,a()}()}else a()}function a(){var e=R.length;if(e>0)for(var t=0;e>t;t++){var i=R[t].id,n=R[t].callbackFn,s={success:!1,id:i};if(W.pv[0]>0){var a=m(i);if(a)if(!b(R[t].swfVersion)||W.wk&&W.wk<312)if(R[t].expressInstall&&r()){var d={};d.data=R[t].expressInstall,d.width=a.getAttribute("width")||"0",d.height=a.getAttribute("height")||"0",a.getAttribute("class")&&(d.styleclass=a.getAttribute("class")),a.getAttribute("align")&&(d.align=a.getAttribute("align"));for(var u={},p=a.getElementsByTagName("param"),g=p.length,h=0;g>h;h++)"movie"!=p[h].getAttribute("name").toLowerCase()&&(u[p[h].getAttribute("name")]=p[h].getAttribute("value"));l(d,u,i,n)}else c(a),n&&n(s);else y(i,!0),n&&(s.success=!0,s.ref=o(i),n(s))}else if(y(i,!0),n){var v=o(i);v&&typeof v.SetVariable!=x&&(s.success=!0,s.ref=v),n(s)}}}function o(e){var t=null,i=m(e);if(i&&"OBJECT"==i.nodeName)if(typeof i.SetVariable!=x)t=i;else{var n=i.getElementsByTagName(q)[0];n&&(t=n)}return t}function r(){return!U&&b("6.0.65")&&(W.win||W.mac)&&!(W.wk&&W.wk<312)}function l(e,t,i,n){U=!0,T=n||null,M={success:!1,id:i};var s=m(i);if(s){"OBJECT"==s.nodeName?(k=d(s),S=null):(k=s,S=i),e.id=D,(typeof e.width==x||!/%$/.test(e.width)&&parseInt(e.width,10)<310)&&(e.width="310"),(typeof e.height==x||!/%$/.test(e.height)&&parseInt(e.height,10)<137)&&(e.height="137"),E.title=E.title.slice(0,47)+" - Flash Player Installation";var a=W.ie&&W.win?["Active"].concat("").join("X"):"PlugIn",o="MMredirectURL="+O.location.toString().replace(/&/g,"%26")+"&MMplayerType="+a+"&MMdoctitle="+E.title;if(typeof t.flashvars!=x?t.flashvars+="&"+o:t.flashvars=o,W.ie&&W.win&&4!=s.readyState){var r=v("div");i+="SWFObjectNew",r.setAttribute("id",i),s.parentNode.insertBefore(r,s),s.style.display="none",function(){4==s.readyState?s.parentNode.removeChild(s):setTimeout(arguments.callee,10)}()}u(e,t,i)}}function c(e){if(W.ie&&W.win&&4!=e.readyState){var t=v("div");e.parentNode.insertBefore(t,e),t.parentNode.replaceChild(d(e),t),e.style.display="none",function(){4==e.readyState?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)}()}else e.parentNode.replaceChild(d(e),e)}function d(e){var t=v("div");if(W.win&&W.ie)t.innerHTML=e.innerHTML;else{var i=e.getElementsByTagName(q)[0];if(i){var n=i.childNodes;if(n)for(var s=n.length,a=0;s>a;a++)(1!=n[a].nodeType||"PARAM"!=n[a].nodeName)&&8!=n[a].nodeType&&t.appendChild(n[a].cloneNode(!0))}}return t}function u(e,t,i){var n,s=m(i);if(W.wk&&W.wk<312)return n;if(s)if(typeof e.id==x&&(e.id=i),W.ie&&W.win){var a="";for(var o in e)e[o]!=Object.prototype[o]&&("data"==o.toLowerCase()?t.movie=e[o]:"styleclass"==o.toLowerCase()?a+=' class="'+e[o]+'"':"classid"!=o.toLowerCase()&&(a+=" "+o+'="'+e[o]+'"'));var r="";for(var l in t)t[l]!=Object.prototype[l]&&(r+='<param name="'+l+'" value="'+t[l]+'" />');s.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+a+">"+r+"</object>",F[F.length]=e.id,n=m(e.id)}else{var c=v(q);c.setAttribute("type",I);for(var d in e)e[d]!=Object.prototype[d]&&("styleclass"==d.toLowerCase()?c.setAttribute("class",e[d]):"classid"!=d.toLowerCase()&&c.setAttribute(d,e[d]));for(var u in t)t[u]!=Object.prototype[u]&&"movie"!=u.toLowerCase()&&p(c,u,t[u]);s.parentNode.replaceChild(c,s),n=c}return n}function p(e,t,i){var n=v("param");n.setAttribute("name",t),n.setAttribute("value",i),e.appendChild(n)}function g(e){var t=m(e);t&&"OBJECT"==t.nodeName&&(W.ie&&W.win?(t.style.display="none",function(){4==t.readyState?h(e):setTimeout(arguments.callee,10)}()):t.parentNode.removeChild(t))}function h(e){var t=m(e);if(t){for(var i in t)"function"==typeof t[i]&&(t[i]=null);t.parentNode.removeChild(t)}}function m(e){var t=null;try{t=E.getElementById(e)}catch(i){}return t}function v(e){return E.createElement(e)}function f(e,t,i){e.attachEvent(t,i),V[V.length]=[e,t,i]}function b(e){var t=W.pv,i=e.split(".");return i[0]=parseInt(i[0],10),i[1]=parseInt(i[1],10)||0,i[2]=parseInt(i[2],10)||0,t[0]>i[0]||t[0]==i[0]&&t[1]>i[1]||t[0]==i[0]&&t[1]==i[1]&&t[2]>=i[2]?!0:!1}function w(e,t,i,n){if(!W.ie||!W.mac){var s=E.getElementsByTagName("head")[0];if(s){var a=i&&"string"==typeof i?i:"screen";if(n&&(A=null,C=null),!A||C!=a){var o=v("style");o.setAttribute("type","text/css"),o.setAttribute("media",a),A=s.appendChild(o),W.ie&&W.win&&typeof E.styleSheets!=x&&E.styleSheets.length>0&&(A=E.styleSheets[E.styleSheets.length-1]),C=a}W.ie&&W.win?A&&typeof A.addRule==q&&A.addRule(e,t):A&&typeof E.createTextNode!=x&&A.appendChild(E.createTextNode(e+" {"+t+"}"))}}}function y(e,t){if(z){var i=t?"visible":"hidden";J&&m(e)?m(e).style.visibility=i:w("#"+e,"visibility:"+i)}}function L(e){var t=/[\\\"<>\.;]/,i=null!=t.exec(e);return i&&typeof encodeURIComponent!=x?encodeURIComponent(e):e}var k,S,T,M,A,C,x="undefined",q="object",H="Shockwave Flash",_="ShockwaveFlash.ShockwaveFlash",I="application/x-shockwave-flash",D="SWFObjectExprInst",N="onreadystatechange",O=window,E=document,B=navigator,P=!1,j=[n],R=[],F=[],V=[],J=!1,U=!1,z=!0,W=function(){var e=typeof E.getElementById!=x&&typeof E.getElementsByTagName!=x&&typeof E.createElement!=x,t=B.userAgent.toLowerCase(),i=B.platform.toLowerCase(),n=i?/win/.test(i):/win/.test(t),s=i?/mac/.test(i):/mac/.test(t),a=/webkit/.test(t)?parseFloat(t.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,o=!1,r=[0,0,0],l=null;if(typeof B.plugins!=x&&typeof B.plugins[H]==q)l=B.plugins[H].description,l&&(typeof B.mimeTypes==x||!B.mimeTypes[I]||!!B.mimeTypes[I].enabledPlugin)&&(P=!0,o=!1,l=l.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),r[0]=parseInt(l.replace(/^(.*)\..*$/,"$1"),10),r[1]=parseInt(l.replace(/^.*\.(.*)\s.*$/,"$1"),10),r[2]=/[a-zA-Z]/.test(l)?parseInt(l.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof O[["Active"].concat("Object").join("X")]!=x)try{var c=new(window[["Active"].concat("Object").join("X")])(_);c&&(l=c.GetVariable("$version"),l&&(o=!0,l=l.split(" ")[1].split(","),r=[parseInt(l[0],10),parseInt(l[1],10),parseInt(l[2],10)]))}catch(d){}return{w3:e,pv:r,wk:a,ie:o,win:n,mac:s}}();return function(){W.w3&&((typeof E.readyState!=x&&"complete"==E.readyState||typeof E.readyState==x&&(E.getElementsByTagName("body")[0]||E.body))&&e(),J||(typeof E.addEventListener!=x&&E.addEventListener("DOMContentLoaded",e,!1),W.ie&&W.win&&(E.attachEvent(N,function(){"complete"==E.readyState&&(E.detachEvent(N,arguments.callee),e())}),O==top&&function(){if(!J){try{E.documentElement.doScroll("left")}catch(t){return setTimeout(arguments.callee,0),void 0}e()}}()),W.wk&&function(){return J?void 0:/loaded|complete/.test(E.readyState)?(e(),void 0):(setTimeout(arguments.callee,0),void 0)}(),i(e)))}(),function(){W.ie&&W.win&&window.attachEvent("onunload",function(){for(var e=V.length,t=0;e>t;t++)V[t][0].detachEvent(V[t][1],V[t][2]);for(var i=F.length,n=0;i>n;n++)g(F[n]);for(var s in W)W[s]=null;W=null;for(var a in swfobject)swfobject[a]=null;swfobject=null})}(),{registerObject:function(e,t,i,n){if(W.w3&&e&&t){var s={};s.id=e,s.swfVersion=t,s.expressInstall=i,s.callbackFn=n,R[R.length]=s,y(e,!1)}else n&&n({success:!1,id:e})},getObjectById:function(e){return W.w3?o(e):void 0},embedSWF:function(e,i,n,s,a,o,c,d,p,g){var h={success:!1,id:i};W.w3&&!(W.wk&&W.wk<312)&&e&&i&&n&&s&&a?(y(i,!1),t(function(){n+="",s+="";var t={};if(p&&typeof p===q)for(var m in p)t[m]=p[m];t.data=e,t.width=n,t.height=s;var v={};if(d&&typeof d===q)for(var f in d)v[f]=d[f];if(c&&typeof c===q)for(var w in c)typeof v.flashvars!=x?v.flashvars+="&"+w+"="+c[w]:v.flashvars=w+"="+c[w];if(b(a)){var L=u(t,v,i);t.id==i&&y(i,!0),h.success=!0,h.ref=L}else{if(o&&r())return t.data=o,l(t,v,i,g),void 0;y(i,!0)}g&&g(h)})):g&&g(h)},switchOffAutoHideShow:function(){z=!1},ua:W,getFlashPlayerVersion:function(){return{major:W.pv[0],minor:W.pv[1],release:W.pv[2]}},hasFlashPlayerVersion:b,createSWF:function(e,t,i){return W.w3?u(e,t,i):void 0},showExpressInstall:function(e,t,i,n){W.w3&&r()&&l(e,t,i,n)},removeSWF:function(e){W.w3&&g(e)},createCSS:function(e,t,i,n){W.w3&&w(e,t,i,n)},addDomLoadEvent:t,addLoadEvent:i,getQueryParamValue:function(e){var t=E.location.search||E.location.hash;if(t){if(/\?/.test(t)&&(t=t.split("?")[1]),null==e)return L(t);for(var i=t.split("&"),n=0;n<i.length;n++)if(i[n].substring(0,i[n].indexOf("="))==e)return L(i[n].substring(i[n].indexOf("=")+1))}return""},expressInstallCallback:function(){if(U){var e=m(D);e&&k&&(e.parentNode.replaceChild(k,e),S&&(y(S,!0),W.ie&&W.win&&(k.style.display="block")),T&&T(M)),U=!1}}}}();!function(){if("undefined"!=typeof window&&!window.WebSocket){var e=window.console;return e&&e.log&&e.error||(e={log:function(){},error:function(){}}),swfobject.hasFlashPlayerVersion("10.0.0")?("file:"==location.protocol&&e.error("WARNING: web-socket-js doesn't work in file:///... URL unless you set Flash Security Settings properly. Open the page via Web server i.e. http://..."),WebSocket=function(e,t,i,n,s){var a=this;a.__id=WebSocket.__nextId++,WebSocket.__instances[a.__id]=a,a.readyState=WebSocket.CONNECTING,a.bufferedAmount=0,a.__events={},t?"string"==typeof t&&(t=[t]):t=[],setTimeout(function(){WebSocket.__addTask(function(){WebSocket.__flash.create(a.__id,e,t,i||null,n||0,s||null)})},0)},WebSocket.prototype.send=function(e){if(this.readyState==WebSocket.CONNECTING)throw"INVALID_STATE_ERR: Web Socket connection has not been established";var t=WebSocket.__flash.send(this.__id,encodeURIComponent(e));return 0>t?!0:(this.bufferedAmount+=t,!1)},WebSocket.prototype.close=function(){this.readyState!=WebSocket.CLOSED&&this.readyState!=WebSocket.CLOSING&&(this.readyState=WebSocket.CLOSING,WebSocket.__flash.close(this.__id))},WebSocket.prototype.addEventListener=function(e,t){e in this.__events||(this.__events[e]=[]),this.__events[e].push(t)},WebSocket.prototype.removeEventListener=function(e,t){if(e in this.__events)for(var i=this.__events[e],n=i.length-1;n>=0;--n)if(i[n]===t){i.splice(n,1);break}},WebSocket.prototype.dispatchEvent=function(e){for(var t=this.__events[e.type]||[],i=0;i<t.length;++i)t[i](e);var n=this["on"+e.type];n&&n(e)},WebSocket.prototype.__handleEvent=function(e){"readyState"in e&&(this.readyState=e.readyState),"protocol"in e&&(this.protocol=e.protocol);var t;if("open"==e.type||"error"==e.type)t=this.__createSimpleEvent(e.type);else if("close"==e.type)t=this.__createSimpleEvent("close");else{if("message"!=e.type)throw"unknown event type: "+e.type;var i=decodeURIComponent(e.message);t=this.__createMessageEvent("message",i)}this.dispatchEvent(t)},WebSocket.prototype.__createSimpleEvent=function(e){if(document.createEvent&&window.Event){var t=document.createEvent("Event");return t.initEvent(e,!1,!1),t}return{type:e,bubbles:!1,cancelable:!1}},WebSocket.prototype.__createMessageEvent=function(e,t){if(document.createEvent&&window.MessageEvent&&!window.opera){var i=document.createEvent("MessageEvent");return i.initMessageEvent("message",!1,!1,t,null,null,window,null),i}return{type:e,data:t,bubbles:!1,cancelable:!1}},WebSocket.CONNECTING=0,WebSocket.OPEN=1,WebSocket.CLOSING=2,WebSocket.CLOSED=3,WebSocket.__flash=null,WebSocket.__instances={},WebSocket.__tasks=[],WebSocket.__nextId=0,WebSocket.loadFlashPolicyFile=function(e){WebSocket.__addTask(function(){WebSocket.__flash.loadManualPolicyFile(e)})},WebSocket.__initialize=function(){if(!WebSocket.__flash){if(WebSocket.__swfLocation&&(window.WEB_SOCKET_SWF_LOCATION=WebSocket.__swfLocation),!window.WEB_SOCKET_SWF_LOCATION)return e.error("[WebSocket] set WEB_SOCKET_SWF_LOCATION to location of WebSocketMain.swf"),void 0;var t=document.createElement("div");t.id="webSocketContainer",t.style.position="absolute",WebSocket.__isFlashLite()?(t.style.left="0px",t.style.top="0px"):(t.style.left="-100px",t.style.top="-100px");var i=document.createElement("div");i.id="webSocketFlash",t.appendChild(i),document.body.appendChild(t),swfobject.embedSWF(WEB_SOCKET_SWF_LOCATION,"webSocketFlash","1","1","10.0.0",null,null,{hasPriority:!0,swliveconnect:!0,allowScriptAccess:"always"},null,function(t){t.success||e.error("[WebSocket] swfobject.embedSWF failed")})}},WebSocket.__onFlashInitialized=function(){setTimeout(function(){WebSocket.__flash=document.getElementById("webSocketFlash"),WebSocket.__flash.setCallerUrl(location.href),WebSocket.__flash.setDebug(!!window.WEB_SOCKET_DEBUG);for(var e=0;e<WebSocket.__tasks.length;++e)WebSocket.__tasks[e]();WebSocket.__tasks=[]},0)},WebSocket.__onFlashEvent=function(){return setTimeout(function(){try{for(var t=WebSocket.__flash.receiveEvents(),i=0;i<t.length;++i)WebSocket.__instances[t[i].webSocketId].__handleEvent(t[i])}catch(n){e.error(n)}},0),!0},WebSocket.__log=function(t){e.log(decodeURIComponent(t))},WebSocket.__error=function(t){e.error(decodeURIComponent(t))},WebSocket.__addTask=function(e){WebSocket.__flash?e():WebSocket.__tasks.push(e)},WebSocket.__isFlashLite=function(){if(!window.navigator||!window.navigator.mimeTypes)return!1;var e=window.navigator.mimeTypes["application/x-shockwave-flash"];return e&&e.enabledPlugin&&e.enabledPlugin.filename?e.enabledPlugin.filename.match(/flashlite/i)?!0:!1:!1},window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION||(window.addEventListener?window.addEventListener("load",function(){WebSocket.__initialize()},!1):window.attachEvent("onload",function(){WebSocket.__initialize()})),void 0):(e.error("Flash Player >= 10.0.0 is required."),void 0)}}(),function(e,t,i){function n(e){e&&(t.Transport.apply(this,arguments),this.sendBuffer=[])}function s(){}e.XHR=n,t.util.inherit(n,t.Transport),n.prototype.open=function(){return this.socket.setBuffer(!1),this.onOpen(),this.get(),this.setCloseTimeout(),this},n.prototype.payload=function(e){for(var i=[],n=0,s=e.length;s>n;n++)i.push(t.parser.encodePacket(e[n]));this.send(t.parser.encodePayload(i))},n.prototype.send=function(e){return this.post(e),this},n.prototype.post=function(e){function t(){4==this.readyState&&(this.onreadystatechange=s,a.posting=!1,200==this.status?a.socket.setBuffer(!1):a.onClose())}function n(){this.onload=s,a.socket.setBuffer(!1)}var a=this;this.socket.setBuffer(!0),this.sendXHR=this.request("POST"),i.XDomainRequest&&this.sendXHR instanceof XDomainRequest?this.sendXHR.onload=this.sendXHR.onerror=n:this.sendXHR.onreadystatechange=t,this.sendXHR.send(e)},n.prototype.close=function(){return this.onClose(),this},n.prototype.request=function(e){var i=t.util.request(this.socket.isXDomain()),n=t.util.query(this.socket.options.query,"t="+ +new Date);if(i.open(e||"GET",this.prepareUrl()+n,!0),"POST"==e)try{i.setRequestHeader?i.setRequestHeader("Content-type","text/plain;charset=UTF-8"):i.contentType="text/plain"}catch(s){}return i},n.prototype.scheme=function(){return this.socket.options.secure?"https":"http"},n.check=function(e,n){try{var s=t.util.request(n),a=i.XDomainRequest&&s instanceof XDomainRequest,o=e&&e.options&&e.options.secure?"https:":"http:",r=i.location&&o!=i.location.protocol;if(s&&(!a||!r))return!0}catch(l){}return!1},n.xdomainCheck=function(e){return n.check(e,!0)}}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(e,t){function i(){t.Transport.XHR.apply(this,arguments)}e.htmlfile=i,t.util.inherit(i,t.Transport.XHR),i.prototype.name="htmlfile",i.prototype.get=function(){this.doc=new(window[["Active"].concat("Object").join("X")])("htmlfile"),this.doc.open(),this.doc.write("<html></html>"),this.doc.close(),this.doc.parentWindow.s=this;var e=this.doc.createElement("div");e.className="socketio",this.doc.body.appendChild(e),this.iframe=this.doc.createElement("iframe"),e.appendChild(this.iframe);var i=this,n=t.util.query(this.socket.options.query,"t="+ +new Date);this.iframe.src=this.prepareUrl()+n,t.util.on(window,"unload",function(){i.destroy()})},i.prototype._=function(e,t){e=e.replace(/\\\//g,"/"),this.onData(e);try{var i=t.getElementsByTagName("script")[0];i.parentNode.removeChild(i)}catch(n){}},i.prototype.destroy=function(){if(this.iframe){try{this.iframe.src="about:blank"}catch(e){}this.doc=null,this.iframe.parentNode.removeChild(this.iframe),this.iframe=null,CollectGarbage()}},i.prototype.close=function(){return this.destroy(),t.Transport.XHR.prototype.close.call(this)},i.check=function(e){if("undefined"!=typeof window&&["Active"].concat("Object").join("X")in window)try{var i=new(window[["Active"].concat("Object").join("X")])("htmlfile");return i&&t.Transport.XHR.check(e)}catch(n){}return!1},i.xdomainCheck=function(){return!1},t.transports.push("htmlfile")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(e,t,i){function n(){t.Transport.XHR.apply(this,arguments)}function s(){}e["xhr-polling"]=n,t.util.inherit(n,t.Transport.XHR),t.util.merge(n,t.Transport.XHR),n.prototype.name="xhr-polling",n.prototype.heartbeats=function(){return!1},n.prototype.open=function(){var e=this;return t.Transport.XHR.prototype.open.call(e),!1},n.prototype.get=function(){function e(){4==this.readyState&&(this.onreadystatechange=s,200==this.status?(a.onData(this.responseText),a.get()):a.onClose())}function t(){this.onload=s,this.onerror=s,a.retryCounter=1,a.onData(this.responseText),a.get()}function n(){a.retryCounter++,!a.retryCounter||a.retryCounter>3?a.onClose():a.get()}if(this.isOpen){var a=this;this.xhr=this.request(),i.XDomainRequest&&this.xhr instanceof XDomainRequest?(this.xhr.onload=t,this.xhr.onerror=n):this.xhr.onreadystatechange=e,this.xhr.send(null)}},n.prototype.onClose=function(){if(t.Transport.XHR.prototype.onClose.call(this),this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=s;try{this.xhr.abort()}catch(e){}this.xhr=null}},n.prototype.ready=function(e,i){var n=this;t.util.defer(function(){i.call(n)})},t.transports.push("xhr-polling")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(e,t,i){function n(){t.Transport["xhr-polling"].apply(this,arguments),this.index=t.j.length;var e=this;t.j.push(function(t){e._(t)})}var s=i.document&&"MozAppearance"in i.document.documentElement.style;e["jsonp-polling"]=n,t.util.inherit(n,t.Transport["xhr-polling"]),n.prototype.name="jsonp-polling",n.prototype.post=function(e){function i(){n(),s.socket.setBuffer(!1)}function n(){s.iframe&&s.form.removeChild(s.iframe);try{o=document.createElement('<iframe name="'+s.iframeId+'">')}catch(e){o=document.createElement("iframe"),o.name=s.iframeId}o.id=s.iframeId,s.form.appendChild(o),s.iframe=o}var s=this,a=t.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);if(!this.form){var o,r=document.createElement("form"),l=document.createElement("textarea"),c=this.iframeId="socketio_iframe_"+this.index;r.className="socketio",r.style.position="absolute",r.style.top="0px",r.style.left="0px",r.style.display="none",r.target=c,r.method="POST",r.setAttribute("accept-charset","utf-8"),l.name="d",r.appendChild(l),document.body.appendChild(r),this.form=r,this.area=l}this.form.action=this.prepareUrl()+a,n(),this.area.value=t.JSON.stringify(e);try{this.form.submit()}catch(d){}this.iframe.attachEvent?o.onreadystatechange=function(){"complete"==s.iframe.readyState&&i()}:this.iframe.onload=i,this.socket.setBuffer(!0)},n.prototype.get=function(){var e=this,i=document.createElement("script"),n=t.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),i.async=!0,i.src=this.prepareUrl()+n,i.onerror=function(){e.onClose()};var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(i,a),this.script=i,s&&setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)},100)},n.prototype._=function(e){return this.onData(e),this.isOpen&&this.get(),this},n.prototype.ready=function(e,i){var n=this;return s?(t.util.load(function(){i.call(n)}),void 0):i.call(this)},n.check=function(){return"document"in i},n.xdomainCheck=function(){return!0},t.transports.push("jsonp-polling")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),"function"==typeof define&&define.amd&&define("lib/socket.io.min",[],function(){return io})}(),define("CouchDBBase",["Store","Tools","Promise"],function(e,t,i){function n(){var e,t=null,n="CouchDB",s=null,a=new i;this.setPromise=function(e){return"object"==typeof e&&"function"==typeof e.fulfill&&"function"==typeof e.reject&&"function"==typeof e.then?(a=e,!0):!1},this.getPromise=function(){return a},this.getStateMachine=function(){return t},this.setStateMachine=function(e){return"object"==typeof e&&"function"==typeof e.event?(t=e,!0):!1},this.getTransport=function(){return s},this.setTransport=function(e){return"object"==typeof e&&"function"==typeof e.request&&"function"==typeof e.listen?(s=e,!0):!1},this.getHandlerName=function(){return n},this.setHandlerName=function(e){return"string"==typeof e?(n=e,!0):!1},this.sync=function(){return a=new i,(e=this.setSyncInfo.apply(this,arguments))?(t.event("sync"),a):!1},this.unsync=function(){return t.event("unsync")},this.getSyncInfo=function(){return e},this.onSync=function(){},this.onListen=function(){},this.onUnsync=function(){this.stopListening&&this.stopListening(),delete this.stopListening},this.unsync=function(){t.event("unsync")},this.onChange=function(){},this.onAdd=function(){},this.onRemove=function(){},this.setSyncInfo=function(t){return e=t}}return function(t){return n.prototype=new e(t),new n}}),define("CouchDBDocument",["Store","CouchDBBase","Tools","Promise","StateMachine"],function(e,t,i,n,s){function a(){this.setSyncInfo=function(e,t,i){return"string"==typeof e&&"string"==typeof t?i&&"object"!=typeof i?!1:{database:e,document:t,query:i||{}}:!1},this.onSync=function(){var e=this.getSyncInfo();this.getTransport().request(this.getHandlerName(),{method:"GET",path:"/"+e.database+"/"+e.document,query:e.query},function(e){e=JSON.parse(e),e._id&&(this.reset(e),this.getStateMachine().event("listen")),this.getPromise().fulfill(e)},this)},this.onListen=function(){var e=this.getSyncInfo();this.stopListening=this.getTransport().listen(this.getHandlerName(),{path:"/"+e.database+"/_changes",query:{feed:"continuous",heartbeat:2e4,descending:!0}},function(t){return"\n"==t?!1:(t=JSON.parse(t),t.id==e.document&&t.changes.pop().rev!=this.get("_rev")&&(t.deleted?this.getStateMachine().event("remove"):this.getStateMachine().event("change")),void 0)},this)},this.onChange=function(){var e=this.getSyncInfo();this.getTransport().request(this.getHandlerName(),{method:"GET",path:"/"+e.database+"/"+e.document},function(e){this.reset(JSON.parse(e))},this)},this.onRemove=function(){this.reset({})},this.upload=function(){var e=new n;return this.getSyncInfo().document?(this.getStateMachine().event("upload",e),e):!1},this.remove=function(){this.getSyncInfo();var e=new n;return this.getStateMachine().event("removeFromDatabase",e),e},this.databaseCreate=function(e){var t=this.getSyncInfo();this.getTransport().request(this.getHandlerName(),{method:"PUT",path:"/"+t.database+"/"+t.document,headers:{"Content-Type":"application/json"},data:this.toJSON()},function(t){t=JSON.parse(t),t.ok?(this.set("_rev",t.rev),this.set("_id",t.id),this.getStateMachine().event("listen"),e.fulfill(t)):e.reject(t)},this)},this.databaseUpdate=function(e){var t=this.getSyncInfo();this.getTransport().request(this.getHandlerName(),{method:"PUT",path:"/"+t.database+"/"+t.document,headers:{"Content-Type":"application/json"},data:this.toJSON()},function(t){t=JSON.parse(t),t.ok?(this.set("_rev",t.rev),e.fulfill(t)):e.reject(t)},this)},this.databaseRemove=function(e){var t=this.getSyncInfo();this.getTransport().request(this.getHandlerName(),{method:"DELETE",path:"/"+t.database+"/"+t.document,query:{rev:this.get("_rev")}},function(t){t=JSON.parse(t),t.ok?e.fulfill(t):e.reject(t)})},this.setStateMachine(new s("Unsynched",{Unsynched:[["sync",this.onSync,this,"Synched"]],Synched:[["listen",this.onListen,this,"Listening"],["unsync",function(){},"Unsynched"],["upload",this.databaseCreate,this]],Listening:[["unsync",this.onUnsync,this,"Unsynched"],["change",this.onChange,this],["add",this.onAdd,this],["remove",this.onRemove,this],["upload",this.databaseUpdate,this],["removeFromDatabase",this.databaseRemove,this]]}))}return function(e){return a.prototype=new t(e),new a}}),define("CouchDBView",["Store","CouchDBBase","Tools","StateMachine"],function(e,t,i,n){function s(){this.setSyncInfo=function(e,t,i,n){return"string"==typeof e&&"string"==typeof t&&"string"==typeof i?n&&"object"!=typeof n?!1:{database:e,design:t,view:i,query:n||{}}:!1},this.onSync=function(){var e=this.getSyncInfo();this.getTransport().request(this.getHandlerName(),{method:"GET",path:"/"+e.database+"/_design/"+e.design+"/"+e.view,query:e.query},function(t){var i=JSON.parse(t);if(!i.rows)throw Error("CouchDBStore ["+e.database+", "+e.design+", "+e.view+"].sync() failed: "+t);this.reset(i.rows),"undefined"==typeof i.total_rows&&(e.reducedView=!0),this.getStateMachine().event("listen"),this.getPromise().fulfill(i)},this)},this.onListen=function(){var e=this.getSyncInfo();i.mixin({feed:"continuous",heartbeat:2e4,descending:!0},e.query),this.stopListening=this.getTransport().listen(this.getHandlerName(),{path:"/"+e.database+"/_changes",query:e.query},function(t){if("\n"==t)return!1;
var i,t=JSON.parse(t);i=e.reducedView?"updateReduced":t.deleted?"remove":t.changes&&0==t.changes[0].rev.search("1-")?"add":"change",this.getStateMachine().event(i,t.id)},this)},this.onChange=function(e){var t=this.getSyncInfo();this.getTransport().request(this.getHandlerName(),{method:"GET",path:"/"+t.database+"/_design/"+t.design+"/"+t.view,query:t.query},function(t){t=JSON.parse(t),t.rows.length==this.getNbItems()?t.rows.some(function(t,i){t.id==e&&this.set(i,t)},this):this.evenDocsInStore.call(this,t.rows,e)},this)},this.evenDocsInStore=function(e,t){var i=this.getNbItems();e.length<i?this.loop(function(e,i){e.id==t&&this.del(i)},this):e.length>i&&e.some(function(e,i){return e.id==t?this.alter("splice",i,0,e):void 0},this)},this.onAdd=function(e){var t=this.getSyncInfo();this.getTransport().request(this.getHandlerName(),{method:"GET",path:"/"+t.database+"/_design/"+t.design+"/"+t.view,query:t.query},function(t){JSON.parse(t).rows.some(function(t,i){t.id==e&&this.alter("splice",i,0,t)},this)},this)},this.onRemove=function(e){this.loop(function(t,i){t.id==e&&this.del(i)},this)},this.updateReduced=function(){var e=this.getSyncInfo();this.getTransport().request(this.getHandlerName(),{method:"GET",path:"/"+e.database+"/_design/"+e.design+"/"+e.view,query:e.query},function(e){this.set(0,JSON.parse(e).rows[0])},this)},this.setStateMachine(new n("Unsynched",{Unsynched:[["sync",this.onSync,this,"Synched"]],Synched:[["listen",this.onListen,this,"Listening"],["unsync",function(){},"Unsynched"]],Listening:[["unsync",this.onUnsync,this,"Unsynched"],["change",this.onChange,this],["add",this.onAdd,this],["remove",this.onRemove,this],["updateReduced",this.updateReduced,this]]}))}return function(e){return s.prototype=new t(e),new s}}),define("CouchDBBulkDocuments",["Store","CouchDBBase","Tools","Promise","StateMachine"],function(e,t,i,n,s){function a(){this.setSyncInfo=function(e,t){if("string"==typeof e&&"object"==typeof t){var i={database:e,query:t||{}};return Array.isArray(i.query.keys)&&(i.keys=i.query.keys,delete i.query.keys),i}return!1},this.onSync=function(){var e,t=this.getSyncInfo(),i={path:"/"+t.database+"/_all_docs",query:t.query};Array.isArray(t.keys)?(i.method="POST",i.data=JSON.stringify({keys:t.keys}),i.headers={"Content-Type":"application/json"},e=i.data):(i.method="GET",e=JSON.stringify(t.query)),t.query.include_docs=!0,this.getTransport().request(this.getHandlerName(),i,function(i){var n=JSON.parse(i);if(!n.rows)throw Error('CouchDBBulkDocuments.sync("'+t.database+'", '+e+") failed: "+i);this.reset(n.rows),this.getStateMachine().event("listen"),this.getPromise().fulfill(this)},this)},this.onListen=function(){var e=this.getSyncInfo();i.mixin({feed:"continuous",heartbeat:2e4,descending:!0,include_docs:!0},e.query),this.stopListening=this.getTransport().listen(this.getHandlerName(),{path:"/"+e.database+"/_changes",query:e.query},function(e){if("\n"==e)return!1;var t,e=JSON.parse(e);t=0==e.changes[0].rev.search("1-")?"add":e.deleted?"remove":"change",this.getStateMachine().event(t,e.id,e.doc)},this)},this.onAdd=function(e){var t=this.getSyncInfo();return t.query.startkey||t.query.endkey?(t.query.include_docs=!0,t.query.update_seq=!0,this.getTransport().request(this.getHandlerName(),{method:"GET",path:"/"+t.database+"/_all_docs",query:t.query},function(t){JSON.parse(t).rows.forEach(function(t,i){t.id==e&&this.alter("splice",i,0,t.doc)},this)},this),void 0):!1},this.onChange=function(e,t){this.loop(function(i,n){i.id==e&&this.set(n,t)},this)},this.onRemove=function(e){this.loop(function(t,i){t.id==e&&this.del(i)},this)},this.databaseUpdate=function(e){var t=[],i=this.getSyncInfo();this.loop(function(e){t.push(e.doc)}),this.getTransport().request(this.getHandlerName(),{method:"POST",path:"/"+i.database+"/_bulk_docs",headers:{"Content-Type":"application/json"},data:JSON.stringify({docs:t})},function(t){var i=JSON.parse(t);this.loop(function(e,t){i[t].ok&&(e.doc._rev=i[t].rev)}),e.fulfill(i)},this)},this.upload=function(){var e=new n;return this.getStateMachine().event("upload",e),e},this.setStateMachine(new s("Unsynched",{Unsynched:[["sync",this.onSync,this,"Synched"]],Synched:[["listen",this.onListen,this,"Listening"],["unsync",function(){},"Unsynched"]],Listening:[["unsync",this.onUnsync,this,"Unsynched"],["change",this.onChange,this],["add",this.onAdd,this],["remove",this.onRemove,this],["upload",this.databaseUpdate,this]]}))}return function(e){return a.prototype=new t(e),new a}}),define("CouchDBUser",["CouchDBDocument","Promise"],function(e,t){function i(){var e="_users",i="org.couchdb.user:";this.getUserDB=function(){return e},this.setUserDB=function(t){return t?(e=t,!0):!1},this.getIdPrefix=function(){return i},this.setIdPrefix=function(e){return e?(i=e,!0):!1},this.setId=function(e){return e?(this.set("_id",i+e),!0):!1},this.getId=function(){return this.get("_id")},this.load=function(t){return this.sync(e,i+t)},this.login=function(){var e=new t,i=this.get("name"),n=this.get("password");return i&&"string"==typeof i&&"string"==typeof n?this.getTransport().request("CouchDB",{method:"GET",path:"/_users/org.couchdb.user:"+i,auth:i+":"+n},e.fulfill,e):e.reject({error:"name & password must be strings"}),e},this.create=function(){var e=new t;return this.get("type")||this.set("type","user"),this.get("roles")||this.set("roles",[]),this.load(this.get("name")).then(function(){e.reject({error:"Failed to create user. The user already exists"})},function(){this.upload().then(function(t){e.fulfill(t)},function(t){e.reject(t)})},this),e}}return function(){return i.prototype=new e,new i}}),define("CouchDBSecurity",["CouchDBDocument"],function(e){function t(){var e="_security";this.setName=function(t){return t?(e=t,!0):!1},this.getName=function(){return e},this.load=function(t){return this.sync(t,e)}}return function(){return t.prototype=new e,new t}}),define("lib/CouchDBTools.min",function(){}),define("Tools",[],function(){function e(e,t,i){var n,s;return t?(t.forEach(function(t,a){var o=i(t,e);o>=0&&("undefined"==typeof s||s>o)&&(s=o,n=a)}),n):void 0}return{getGlobal:function(){return function(){return this}.call(null)},mixin:function(e,t,i){return this.loop(e,function(n,s){t[s]&&i||(t[s]=e[s])}),t},count:function(e){var t=0;return this.loop(e,function(){t++}),t},compareObjects:function(e,t){return Object.getOwnPropertyNames(e).sort().join("")==Object.getOwnPropertyNames(t).sort().join("")},compareNumbers:function(e,t){return e>t?1:t>e?-1:0},toArray:function(e){return[].slice.call(e)},loop:function(e,t,i){var n;if(e instanceof Object&&t instanceof Function){if(e instanceof Array)for(n=0;n<e.length;n++)t.call(i,e[n],n,e);else for(n in e)e.hasOwnProperty(n)&&t.call(i,e[n],n,e);return!0}return!1},objectsDiffs:function(e,t){if(e instanceof Object&&t instanceof Object){var i=[],n=[],s=[],a=[];return this.loop(t,function(t,s){"undefined"==typeof e[s]?a.push(s):t!==e[s]?n.push(s):t===e[s]&&i.push(s)}),this.loop(e,function(e,i){"undefined"==typeof t[i]&&s.push(i)}),{updated:n,unchanged:i,added:a,deleted:s}}return!1},jsonify:function(e){return e instanceof Object?JSON.parse(JSON.stringify(e)):!1},clone:function(e){return e instanceof Array?e.slice(0):"object"!=typeof e||null===e||e instanceof RegExp?!1:this.mixin(e,{})},getNestedProperty:function(e,t){return e&&e instanceof Object?"string"==typeof t&&""!==t?t.split(".").reduce(function(e,t){return e&&e[t]},e):"number"==typeof t?e[t]:e:e},setNestedProperty:function(e,t,i){if(e&&e instanceof Object){if("string"==typeof t&&""!==t){var n=t.split(".");return n.reduce(function(e,t,s){return e[t]=e[t]||{},n.length==s+1&&(e[t]=i),e[t]},e)}return"number"==typeof t?(e[t]=i,e[t]):e}return e},closest:function(t,i){return e(t,i,function(e,t){return Math.abs(e-t)})},closestGreater:function(t,i){return e(t,i,function(e,t){return e-t})},closestLower:function(t,i){return e(t,i,function(e,t){return t-e})}}}),define("Observable",["Tools"],function(e){return function(){var t={};this.watch=function(e,i,n){if("function"==typeof i){var s=t[e]=t[e]||[],i=[i,n];return s.push(i),[e,s.indexOf(i)]}return!1},this.unwatch=function(e){var i=e[0],e=e[1];return t[i]&&t[i][e]?(delete t[i][e],t[i].some(function(e){return!!e})||delete t[i],!0):!1},this.notify=function(i){var n=t[i],s=e.toArray(arguments).slice(1);return n?(e.loop(n,function(e){try{e&&e[0].apply(e[1]||null,s)}catch(t){}}),!0):!1},this.hasObserver=function(e){return!(!e||!t[e[0]]||!t[e[0]][e[1]])},this.hasTopic=function(e){return!!t[e]},this.unwatchAll=function(e){return t[e]?delete t[e]:t={},!0}}}),define("StateMachine",["Tools"],function(e){function t(){var t={};this.add=function(e,i,n,s){var a=[];return t[e]?!1:"string"==typeof e&&"function"==typeof i?(a[0]=i,"object"==typeof n&&(a[1]=n),"string"==typeof n&&(a[2]=n),"string"==typeof s&&(a[2]=s),t[e]=a,!0):!1},this.has=function(e){return!!t[e]},this.get=function(e){return t[e]||!1},this.event=function(i){var n=t[i];return n?(n[0].apply(n[1],e.toArray(arguments).slice(1)),n[2]):!1}}return function(i,n){var s={},a="";this.init=function(e){return s[e]?(a=e,!0):!1},this.add=function(e){return s[e]?s[e]:s[e]=new t},this.get=function(e){return s[e]},this.getCurrent=function(){return a},this.has=function(e){return s.hasOwnProperty(e)},this.advance=function(e){return this.has(e)?(a=e,!0):!1},this.event=function(){var t;return t=s[a].event.apply(s[a].event,e.toArray(arguments)),t===!1?!1:(t&&(s[a].event("exit"),a=t,s[a].event("entry")),!0)},e.loop(n,function(e,t){var i=this.add(t);e.forEach(function(e){i.add.apply(null,e)})},this),this.init(i)}}),define("Promise",["Observable","StateMachine"],function(e,t){return function i(){var n=null,s=null,a=new e,o={Pending:[["fulfill",function(e){n=e,a.notify("fulfill",e)},"Fulfilled"],["reject",function(e){s=e,a.notify("reject",e)},"Rejected"],["toFulfill",function(e){a.watch("fulfill",e)}],["toReject",function(e){a.watch("reject",e)}]],Fulfilled:[["toFulfill",function(e){setTimeout(function(){e(n)},0)}]],Rejected:[["toReject",function(e){setTimeout(function(){e(s)},0)}]]},r=new t("Pending",o);this.fulfill=function(e){return r.event("fulfill",e),this},this.reject=function(e){return r.event("reject",e),this},this.then=function(e,t,a,o){var l=new i;return e instanceof Function?t instanceof Function?r.event("toFulfill",this.makeResolver(l,e)):r.event("toFulfill",this.makeResolver(l,e,t)):r.event("toFulfill",this.makeResolver(l,function(){l.fulfill(n)})),t instanceof Function&&r.event("toReject",this.makeResolver(l,t,a)),a instanceof Function&&r.event("toReject",this.makeResolver(l,a,o)),!(t instanceof Function||a instanceof Function||!r.event("toReject",this.makeResolver(l,function(){l.reject(s)}))),l},this.sync=function(e){return e instanceof Object&&e.then?(e.then(function(e){this.fulfill(e)}.bind(this),function(e){this.reject(e)}.bind(this)),!0):!1},this.makeResolver=function(e,t,i){return function(n){var s;try{s=t.call(i,n),e.sync(s)||e.fulfill(s)}catch(a){e.reject(a)}}},this.getReason=function(){return s},this.getValue=function(){return n},this.getObservable=function(){return a},this.getStateMachine=function(){return r},this.getStates=function(){return o}}}),define("Store",["Observable","Tools"],function(e,t){return function(i){var n=t.clone(i)||{},s=new e,a=new e,o=[],r=function(e){var i=t.objectsDiffs(e,n);["updated","deleted","added"].forEach(function(e){i[e].forEach(function(t){s.notify(e,t,n[t]),a.notify(t,n[t],e)})})};this.count=this.getNbItems=function(){return n instanceof Array?n.length:t.count(n)},this.get=function(e){return n[e]},this.has=function(e){return n.hasOwnProperty(e)},this.set=function(e,t){var i,o;return"undefined"!=typeof e?(i=this.has(e),o=this.get(e),n[e]=t,i=i?"updated":"added",s.notify(i,e,n[e],o),a.notify(e,n[e],i,o),!0):!1},this.update=function(e,i,n){var o;return this.has(e)?(o=this.get(e),t.setNestedProperty(o,i,n),s.notify("updated",i,n),a.notify(e,o,"updated"),!0):!1},this.del=function(e){return this.has(e)?(this.alter("splice",e,1)||(delete n[e],s.notify("deleted",e),a.notify(e,n[e],"deleted")),!0):!1},this.delAll=function(e){return e instanceof Array?(e.sort(t.compareNumbers).reverse().forEach(this.del,this),!0):!1},this.alter=function(e){var i,s;return n[e]?(s=t.clone(n),i=this.proxy.apply(this,arguments),r(s),i):!1},this.proxy=function(e){return n[e]?n[e].apply(n,Array.prototype.slice.call(arguments,1)):!1},this.watch=function(e,t,i){return s.watch(e,t,i)},this.unwatch=function(e){return s.unwatch(e)},this.getStoreObservable=function(){return s},this.watchValue=function(e,t,i){return a.watch(e,t,i)},this.unwatchValue=function(e){return a.unwatch(e)},this.getValueObservable=function(){return a},this.loop=function(e,i){t.loop(n,e,i)},this.reset=function(e){if(e instanceof Object){var i=t.clone(n);return n=t.clone(e)||{},r(i),!0}return!1},this.compute=function(e,i,n,s){return"string"!=typeof e||"object"!=typeof i||"function"!=typeof n||this.isCompute(e)?!1:(o[e]=[],t.loop(i,function(t){o[e].push(this.watchValue(t,function(){this.set(e,n.call(s))},this))},this),this.set(e,n.call(s)),!0)},this.removeCompute=function(e){return this.isCompute(e)?(t.loop(o[e],function(e){this.unwatchValue(e)},this),this.del(e),!0):!1},this.isCompute=function(e){return!!o[e]},this.toJSON=function(){return JSON.stringify(n)},this.dump=function(){return n}}}),define("Transport",[],function(){return function(e){var t=null;this.setReqHandlers=function(e){return e instanceof Object?(t=e,!0):!1},this.getReqHandlers=function(){return t},this.request=function(e,i,n,s){return t.has(e)&&"undefined"!=typeof i?(t.get(e)(i,function(){n&&n.apply(s,arguments)}),!0):!1},this.listen=function(e,i,n,s){if(t.has(e)&&"undefined"!=typeof i&&"function"==typeof n){var a,o=function(){n.apply(s,arguments)};return a=t.get(e)(i,o,o),function(){"function"==typeof a?a():"object"==typeof a&&"function"==typeof a.func&&a.func.call(a.scope)}}return!1},this.setReqHandlers(e)}}),define("lib/Emily.min",function(){}),define("DomUtils",["Tools"],function(e){return{getNodes:function(e,t){return this.isAcceptedType(e)?(e.parentNode||document.createDocumentFragment().appendChild(e),e.parentNode.querySelectorAll(t||"*")):!1},getDataset:function(e){var t,i,n,s=0,a={};if(this.isAcceptedType(e)){if(e.hasOwnProperty("dataset"))return e.dataset;for(t=e.attributes.length;t>s;s++)i=e.attributes[s].name.split("-"),"data"==i.shift()&&(a[n=i.join("-")]=e.getAttribute("data-"+n));return a}return!1},isAcceptedType:function(e){return e instanceof HTMLElement||e instanceof SVGElement?!0:!1},setAttribute:function(e,t,i){return e instanceof HTMLElement?(e[t]=i,!0):e instanceof SVGElement?(e.setAttribute(t,i),!0):!1},matches:function(t,i,n){return e.toArray(this.getNodes(t,i)).indexOf(n)>-1}}}),define("Bind.plugin",["Store","Observable","Tools","DomUtils"],function(e,t,i,n){return function(t,s){function a(e){c[e]&&(c[e].forEach(function(e){o.unwatchValue(e)}),delete c[e])}var o=null,r={},l={},c={};this.observers=c,this.setModel=function(t){return t instanceof e?(o=t,!0):!1},this.getModel=function(){return o},this.ItemRenderer=function(e,t){var s=null,r=null,l=null,c=null,d=null;this.setRenderer=function(e){return s=e,!0},this.getRenderer=function(){return s},this.setRootNode=function(e){return n.isAcceptedType(e)?(l=e,e=l.querySelector("*"),this.setRenderer(e),e&&l.removeChild(e),!0):!1},this.getRootNode=function(){return l},this.setPlugins=function(e){return r=e,!0},this.getPlugins=function(){return r},this.items={},this.setStart=function(e){return c=parseInt(e,10)},this.getStart=function(){return c},this.setNb=function(e){return d="*"==e?e:parseInt(e,10)},this.getNb=function(){return d},this.addItem=function(e){var t;return"number"!=typeof e||this.items[e]?!1:(t=this.getNextItem(e),(e=this.create(e))?(t?l.insertBefore(e,t):l.appendChild(e),!0):!1)},this.getNextItem=function(e){var t=Object.keys(this.items).map(function(e){return Number(e)}),n=i.closestGreater(e,t),t=t[n];return t!=e?this.items[t]:void 0},this.removeItem=function(e){var t=this.items[e];return t?(l.removeChild(t),delete this.items[e],a(e),!0):!1},this.create=function(e){if(o.has(e)){var t=s.cloneNode(!0),a=n.getNodes(t);return i.toArray(a).forEach(function(t){t.setAttribute("data-"+r.name+"_id",e)}),this.items[e]=t,r.apply(t),t}},this.render=function(){var e="*"==d?o.getNbItems():d,t=[];if(null!==d&&null!==c){i.loop(this.items,function(i,n){n=Number(n),(c>n||n>=c+e||!o.has(n))&&t.push(n)},this),t.sort(i.compareNumbers).reverse().forEach(this.removeItem,this);for(var n=c,s=e+c;s>n;n++)this.addItem(n);return!0}return!1},this.setPlugins(e),this.setRootNode(t)},this.setItemRenderer=function(e,t){l[e||"default"]=t},this.getItemRenderer=function(e){return l[e]},this.foreach=function(e,t,i,n){var s=new this.ItemRenderer(this.plugins,e);s.setStart(i||0),s.setNb(n||"*"),s.render(),o.watch("added",s.render,s),o.watch("deleted",function(e){s.render(),a(e)},this),this.setItemRenderer(t,s)},this.updateStart=function(e,t){var i=this.getItemRenderer(e);return i?(i.setStart(t),!0):!1},this.updateNb=function(e,t){var i=this.getItemRenderer(e);return i?(i.setNb(t),!0):!1},this.refresh=function(e){return(e=this.getItemRenderer(e))?(e.render(),!0):!1},this.bind=function(e,t,s){var s=s||"",a=e.getAttribute("data-"+this.plugins.name+"_id"),r=s.split("."),l=a||r.shift(),c=a?s:r.join("."),a=i.getNestedProperty(o.get(l),c),d=i.toArray(arguments).slice(3);(a||0===a||a===!1)&&(this.execBinding.apply(this,[e,t,a].concat(d))||n.setAttribute(e,t,a)),this.hasBinding(t)||e.addEventListener("change",function(){o.has(l)&&(c?o.update(l,s,e[t]):o.set(l,e[t]))},!0),this.observers[l]=this.observers[l]||[],this.observers[l].push(o.watchValue(l,function(s){this.execBinding.apply(this,[e,t,i.getNestedProperty(s,c)].concat(d))||n.setAttribute(e,t,i.getNestedProperty(s,c))},this))},this.set=function(e){return n.isAcceptedType(e)&&e.name?(o.set(e.name,e.value),!0):!1},this.getItemIndex=function(e){return(e=n.getDataset(e))&&"undefined"!=typeof e[this.plugins.name+"_id"]?+e[this.plugins.name+"_id"]:!1},this.form=function(e){if(e&&"FORM"==e.nodeName){var t=this;return e.addEventListener("submit",function(n){i.toArray(e.querySelectorAll("[name]")).forEach(t.set,t),n.preventDefault()},!0),!0}return!1},this.addBinding=function(e,t){return e&&"string"==typeof e&&"function"==typeof t?(r[e]=t,!0):!1},this.execBinding=function(e,t){return this.hasBinding(t)?(r[t].apply(e,Array.prototype.slice.call(arguments,2)),!0):!1},this.hasBinding=function(e){return r.hasOwnProperty(e)},this.getBinding=function(e){return r[e]},this.addBindings=function(e){return i.loop(e,function(e,t){this.addBinding(t,e)},this)},this.setModel(t),this.addBindings(s)}}),define("Event.plugin",["DomUtils"],function(e){return function(t,i){var n=null,s={mousedown:"touchstart",mouseup:"touchend",mousemove:"touchmove"},a=!!i;this.addEventListener=function(e,t,i,n){e.addEventListener(this.map(t),i,!!n)},this.listen=function(e,t,i,s){this.addEventListener(e,t,function(t){n[i].call(n,t,e)},!!s)},this.delegate=function(t,i,s,a,o){this.addEventListener(t,s,function(s){e.matches(t,i,s.target)&&n[a].call(n,s,t)},!!o)},this.getParent=function(){return n},this.setParent=function(e){return e instanceof Object?(n=e,!0):!1},this.map=function(e){return a?s[e]||e:e},this.setMap=function(e,t){return"string"==typeof e&&"string"==typeof t?(s[e]=t,!0):!1},this.setParent(t)}}),define("LocalStore",["Store","Tools"],function(e,t){function i(){var e=null,i=localStorage,n=function(){i.setItem(e,this.toJSON())};this.setLocalStorage=function(e){return e&&e.setItem instanceof Function?(i=e,!0):!1},this.getLocalStorage=function(){return i},this.sync=function(s){return"string"==typeof s?(e=s,s=JSON.parse(i.getItem(s)),t.loop(s,function(e,t){this.has(t)||this.set(t,e)},this),n.call(this),this.watch("added",n,this),this.watch("updated",n,this),this.watch("deleted",n,this),!0):!1}}return function(t){return i.prototype=new e(t),new i}}),define("Plugins",["Tools","DomUtils"],function(e,t){return function(i){var n={},s=function(e){return e.trim()},a=function(e,t,i){t.split(";").forEach(function(t){var a=t.split(":"),t=a[0].trim(),a=a[1]?a[1].split(",").map(s):[];a.unshift(e),n[i]&&n[i][t]&&n[i][t].apply(n[i],a)})};this.add=function(e,t){var i=this;return"string"==typeof e&&"object"==typeof t&&t?(n[e]=t,t.plugins={name:e,apply:function(){return i.apply.apply(i,arguments)}},!0):!1},this.addAll=function(t){return e.loop(t,function(e,t){this.add(t,e)},this)},this.get=function(e){return n[e]},this.del=function(e){return delete n[e]},this.apply=function(i){var n;return t.isAcceptedType(i)?(n=t.getNodes(i),e.loop(e.toArray(n),function(i){e.loop(t.getDataset(i),function(e,t){a(i,e,t)})}),i):!1},this.addAll(i)}}),define("OObject",["StateMachine","Store","Plugins","DomUtils","Tools"],function(e,t,i,n,s){return function(a){var o=function(e){var t=l||document.createElement("div");if(!e.template)throw Error("UI.template must be set prior to render");if("string"==typeof e.template?t.innerHTML=e.template.trim():n.isAcceptedType(e.template)&&t.appendChild(e.template),t.childNodes.length>1)throw Error("UI.template should have only one parent node");e.dom=t.childNodes[0],e.plugins.apply(e.dom)},r=function(e,t,i){t&&(i?t.insertBefore(e.dom,i):t.appendChild(e.dom),l=t)},l=null,c=new e("Init",{Init:[["render",o,this,"Rendered"],["place",function(e){o(e),r.apply(null,s.toArray(arguments))},this,"Rendered"]],Rendered:[["place",r,this],["render",o,this]]});this.model=a instanceof t?a:new t,this.plugins=new i,this.dom=this.template=null,this.place=function(e,t){c.event("place",this,e,t)},this.render=function(){c.event("render",this)},this.setTemplateFromDom=function(e){return n.isAcceptedType(e)?(this.template=e,!0):!1},this.alive=function(e){return n.isAcceptedType(e)?(this.setTemplateFromDom(e),this.place(e.parentNode,e.nextElementSibling),!0):!1},this.getCurrentPlace=function(){return l}}}),define("Place.plugin",["OObject","Tools"],function(e,t){return function(i){var n={};this.place=function(t,i){if(!(n[i]instanceof e))throw Error(i+" is not an OObject UI in place:"+i);n[i].place(t)},this.set=function(t,i){return"string"==typeof t&&i instanceof e?(n[t]=i,!0):!1},this.setAll=function(e){t.loop(e,function(e,t){this.set(t,e)},this)},this.get=function(e){return n[e]},this.setAll(i)}}),define("SocketIOTransport",["Observable","Tools"],function(){return function(e){var t=null;this.setSocket=function(e){return e&&"function"==typeof e.emit?(t=e,!0):!1},this.getSocket=function(){return t},this.on=function(e,i){return t.on(e,i)},this.once=function(e,i){return t.once(e,i)},this.emit=function(e,i,n){return t.emit(e,i,n)},this.removeListener=function(e,i,n){return t.removeListener(e,i,n)},this.request=function(e,t,i,n){return"string"==typeof e&&"undefined"!=typeof t?(t={eventId:Date.now()+Math.floor(1e6*Math.random()),data:t},this.once(t.eventId,function(){i&&i.apply(n||null,arguments)}),this.emit(e,t),!0):!1},this.listen=function(e,t,i,n){if("string"==typeof e&&"undefined"!=typeof t&&"function"==typeof i){var s={eventId:Date.now()+Math.floor(1e6*Math.random()),data:t,keepAlive:!0},a=function(){i&&i.apply(n||null,arguments)},o=this;return this.on(s.eventId,a),this.emit(e,s),function(){o.emit("disconnect-"+s.eventId),o.removeListener(s.eventId,a)}}return!1},this.setSocket(e)}}),define("Stack",["Tools"],function(){var e=require("Tools");return function(t){function i(t){if(!(t>=a.length)){var s=a[t];return-1==e.toArray(n.childNodes).indexOf(s)?i(t+1):s}}var n=document.createDocumentFragment(),s=document.createElement("div"),a=[],o=null;this.add=function(e){return!this.has(e)&&e instanceof HTMLElement?(n.appendChild(e),a.push(e),e):!1},this.remove=function(e){var t;return this.has(e)?(t=a.indexOf(e),n.removeChild(e),a.splice(t,1),e):!1},this.place=function(e){return e instanceof HTMLElement?([].slice.call(n.childNodes).forEach(function(t){this.has(t)&&e.appendChild(t)},this),this._setParent(e)):!1},this.up=function(e){if(this.has(e)){var t=this.getPosition(e);return this.move(e,t+1),e}return!1},this.down=function(e){if(this.has(e)){var t=this.getPosition(e);return this.move(e,t-1),e}return!1},this.move=function(e,t){if(this.has(e)){var s=a.indexOf(e);return a.splice(s,1),(s=i(t))?n.insertBefore(e,s):n.appendChild(e),a.splice(t,0,e),e}return!1},this.insert=function(e,t){return!this.has(e)&&e instanceof HTMLElement?(a.splice(t,0,e),n.insertBefore(e,n.childNodes[t]),e):!1},this.getPosition=function(e){return a.indexOf(e)},this.count=function(){return n.childNodes.length},this.has=function(e){return this.getPosition(e)>=0},this.hide=function(e){return this.has(e)?(s.appendChild(e),!0):!1},this.show=function(e){return this.has(e)&&e.parentNode===s?(this.move(e,a.indexOf(e)),!0):!1},this.hideAll=function(){a.forEach(this.hide,this)},this.showAll=function(){a.forEach(this.show,this)},this.getParent=function(){return n},this._setParent=function(e){return e instanceof HTMLElement?n=e:!1},this.getHidePlace=function(){return s},this.setHidePlace=function(e){return e instanceof HTMLElement?(s=e,!0):!1},this.getLastTransit=function(){return o},this.transit=function(e){return o&&this.hide(o),this.show(e)?(o=e,!0):!1},this._setParent(t)}}),define("LocationRouter",["Router","Tools"],function(e,t){function i(){function e(){window.location.hash?this.navigate.apply(this,this.parse(window.location.hash)):this.navigate(n)}var i,n="",s=window.location.hash;this.setDefaultRoute=function(e){return e&&"string"==typeof e?(n=e,!0):!1},this.getDefaultRoute=function(){return n},this.parse=function(e){return e.split("#").pop().split("/")},this.toUrl=function(e){return e.join("/")},this.start=function(t){this.setDefaultRoute(t),e.call(this),this.bindOnHashChange(),this.bindOnRouteChange()},this.destroy=function(){this.unwatch(i),window.removeEventListener("hashchange",this.boundOnHashChange,!0)},this.onHashChange=function(){window.location.hash!=s&&e.call(this)},this.boundOnHashChange=this.onHashChange.bind(this),this.bindOnHashChange=function(){window.addEventListener("hashchange",this.boundOnHashChange,!0)},this.bindOnRouteChange=function(){i=this.watch(this.onRouteChange,this)},this.onRouteChange=function(){window.location.hash=this.toUrl(t.toArray(arguments)),s=window.location.hash},this.getLastRoute=function(){return s}}return function(){return i.prototype=new e,new i}}),define("lib/Olives.min",function(){}),define("Amy/DomUtils",["DomUtils","Tools"],function(e,t){return{hasQuerySelector:function(i,n,s){return t.toArray(e.getNodes(i,s)).indexOf(n)>-1}}}),define("Amy/TestUtils",[],function(){var e=function(e){return"string"==typeof e},t=function(t,i){throw new Error(e(i)?i:t)};return{assertIsObject:function(e,i){return e instanceof Object||t("Is not Object",i),!0},assertIsObservable:function(e,i){return e&&"function"==typeof e.watch&&"function"==typeof e.notify||t("Is not Observable",i),!0},assertIsString:function(i,n){return e(i)||t("Is not String",n),!0}}}),define("Amy/Stack-plugin",["Amy/Stack-service"],function(e){return function(t,i){var n=new e(t,i);this.getStack=function(){return n},this.destination=function(e){n.setDestination(e)},this.hide=function(){n.hide()},this.show=function(e,t,i,s){e.addEventListener(t,function(e){n.show(e.target.getAttribute(i))},"true"==s)}}}),define("Amy/Event-controller",["Amy/TestUtils","Tools"],function(e,t){return function(e,i){var n=e instanceof Object?e:null,s=function(e){return"boolean"==typeof e?e:!1},a=function(){var e,t=!0;for(e=arguments.length;e>=0;e--)t=t&&"string"==typeof arguments[e];return t},o=s(i),r={mousedown:"touchstart",mouseup:"touchend",mousemove:"touchmove"};this.addListener=function(e,t,i,n){e.addEventListener(this.map(t),i,n)},this.call=function(e){n[e].apply(n,t.toArray(arguments).slice(1))},this.isTouch=function(){return o},this.setTouch=function(e){return s(e)?(o=e,!0):!1},this.setMap=function(e,t){return a(e,t)?(r[e]=t,!0):!1},this.map=function(e){var t=r[e];return t&&o?t:e},this.setScope=function(e){return n=e,!0},this.scope=function(){return n}}}),define("Amy/Delegate-plugin",["Amy/Event-controller","Amy/DomUtils"],function(e,t){function i(){this.listen=function(e,t,i,n){var s=this;this.addListener(e,t,function(t){s.call(i,t,e)},"true"==n)},this.selector=function(e,i,n,s,a){var o=this;this.addListener(e,n,function(n){t.hasQuerySelector(e,n.target,i)&&o.call(s,n,e)},"true"==a)}}return function(t,n){return i.prototype=new e(t,n),new i}}),define("Amy/Control-plugin",["Amy/Event-controller","Amy/DomUtils"],function(e,t){function i(){var e=null;this.init=function(t){e=t},this.radio=function(i,n,s,a,o,r){var l=this;this.addListener(i,a,function(a){var r=a.target;t.hasQuerySelector(i,r,n)&&(l.radioClass(r,e,s),e=r,l.call(o,a))},"true"==r)},this.radioClass=function(e,t,i){e.classList.add(i),t&&t!=e&&t.classList.remove(i)},this.toggleClass=function(e,t){return e.classList.toggle(t)},this.toggle=function(e,i,n,s,a,o){var r=this;this.addListener(e,s,function(s){var o=s.target;t.hasQuerySelector(e,o,i)&&(r.toggleClass(o,n),r.call(a,s))},"true"==o)}}return function(t,n){return i.prototype=new e(t,n),new i}}),define("Amy/Stack-service",["Store","OObject","DomUtils","Tools","Observable"],function(e,t,i,n,s){return function(n,a){var o=new e(n),r=new s,l=a,c="",d=null;this.setDestination=function(e){return i.isAcceptedType(e)?(l=e,!0):!1},this.getDestination=function(){return l},this.setCurrentScreen=function(e){d=e,r.notify("StackChange",e)},this.getCurrentScreen=function(){return d},this.add=function(e,i){return"string"==typeof e&&i instanceof t?(o.set(e,i),this.hide(i),!0):!1},this.get=function(e){return o.get(e)},this.del=function(e){return o.del(e)},this.reset=function(e){return o.reset(e)},this.getCurrentName=function(){return c},this.show=function(e){var t=this.get(e);return t&&e!==c?(t.place(l),d&&this.hide(d),this.setCurrentScreen(t),c=e,!0):!1},this.hide=function(e){e.place(document.createDocumentFragment())},this.getObserver=function(){return r}}}),define("lib/amy2",function(){}),function(e,t){"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define("lib/spin.min",t):e.Spinner=t()}(this,function(){function e(e,t){var i,n=document.createElement(e||"div");for(i in t)n[i]=t[i];return n}function t(e){for(var t=1,i=arguments.length;i>t;t++)e.appendChild(arguments[t]);return e}function i(e,t,i,n){var s=["opacity",t,~~(100*e),i,n].join("-"),a=.01+100*(i/n),o=Math.max(1-(1-e)/t*(100-a),e),r=c.substring(0,c.indexOf("Animation")).toLowerCase(),l=r&&"-"+r+"-"||"";return u[s]||(p.insertRule("@"+l+"keyframes "+s+"{"+"0%{opacity:"+o+"}"+a+"%{opacity:"+e+"}"+(a+.01)+"%{opacity:1}"+(a+t)%100+"%{opacity:"+e+"}"+"100%{opacity:"+o+"}"+"}",p.cssRules.length),u[s]=1),s}function n(e,t){var i,n,s=e.style;if(void 0!==s[t])return t;for(t=t.charAt(0).toUpperCase()+t.slice(1),n=0;n<d.length;n++)if(i=d[n]+t,void 0!==s[i])return i}function s(e,t){for(var i in t)e.style[n(e,i)||i]=t[i];return e}function a(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)void 0===e[n]&&(e[n]=i[n])}return e}function o(e){for(var t={x:e.offsetLeft,y:e.offsetTop};e=e.offsetParent;)t.x+=e.offsetLeft,t.y+=e.offsetTop;return t}function r(e){return"undefined"==typeof this?new r(e):(this.opts=a(e||{},r.defaults,g),void 0)}function l(){function i(t,i){return e("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',i)}p.addRule(".spin-vml","behavior:url(#default#VML)"),r.prototype.lines=function(e,n){function a(){return s(i("group",{coordsize:c+" "+c,coordorigin:-l+" "+-l}),{width:c,height:c})}function o(e,o,r){t(u,t(s(a(),{rotation:360/n.lines*e+"deg",left:~~o}),t(s(i("roundrect",{arcsize:n.corners}),{width:l,height:n.width,left:n.radius,top:-n.width>>1,filter:r}),i("fill",{color:n.color,opacity:n.opacity}),i("stroke",{opacity:0}))))}var r,l=n.length+n.width,c=2*l,d=2*-(n.width+n.length)+"px",u=s(a(),{position:"absolute",top:d,left:d});if(n.shadow)for(r=1;r<=n.lines;r++)o(r,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(r=1;r<=n.lines;r++)o(r);return t(e,u)},r.prototype.opacity=function(e,t,i,n){var s=e.firstChild;
n=n.shadow&&n.lines||0,s&&t+n<s.childNodes.length&&(s=s.childNodes[t+n],s=s&&s.firstChild,s=s&&s.firstChild,s&&(s.opacity=i))}}var c,d=["webkit","Moz","ms","O"],u={},p=function(){var i=e("style",{type:"text/css"});return t(document.getElementsByTagName("head")[0],i),i.sheet||i.styleSheet}(),g={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",direction:1,speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"auto",left:"auto",position:"relative"};r.defaults={},a(r.prototype,{spin:function(t){this.stop();var i,n,a=this,r=a.opts,l=a.el=s(e(0,{className:r.className}),{position:r.position,width:0,zIndex:r.zIndex}),d=r.radius+r.length+r.width;if(t&&(t.insertBefore(l,t.firstChild||null),n=o(t),i=o(l),s(l,{left:("auto"==r.left?n.x-i.x+(t.offsetWidth>>1):parseInt(r.left,10)+d)+"px",top:("auto"==r.top?n.y-i.y+(t.offsetHeight>>1):parseInt(r.top,10)+d)+"px"})),l.setAttribute("role","progressbar"),a.lines(l,a.opts),!c){var u,p=0,g=(r.lines-1)*(1-r.direction)/2,h=r.fps,m=h/r.speed,v=(1-r.opacity)/(m*r.trail/100),f=m/r.lines;!function b(){p++;for(var e=0;e<r.lines;e++)u=Math.max(1-(p+(r.lines-e)*f)%m*v,r.opacity),a.opacity(l,e*r.direction+g,u,r);a.timeout=a.el&&setTimeout(b,~~(1e3/h))}()}return a},stop:function(){var e=this.el;return e&&(clearTimeout(this.timeout),e.parentNode&&e.parentNode.removeChild(e),this.el=void 0),this},lines:function(n,a){function o(t,i){return s(e(),{position:"absolute",width:a.length+a.width+"px",height:a.width+"px",background:t,boxShadow:i,transformOrigin:"left",transform:"rotate("+~~(360/a.lines*l+a.rotate)+"deg) translate("+a.radius+"px"+",0)",borderRadius:(a.corners*a.width>>1)+"px"})}for(var r,l=0,d=(a.lines-1)*(1-a.direction)/2;l<a.lines;l++)r=s(e(),{position:"absolute",top:1+~(a.width/2)+"px",transform:a.hwaccel?"translate3d(0,0,0)":"",opacity:a.opacity,animation:c&&i(a.opacity,a.trail,d+l*a.direction,a.lines)+" "+1/a.speed+"s linear infinite"}),a.shadow&&t(r,s(o("#000","0 0 4px #000"),{top:"2px"})),t(n,t(r,o(a.color,"0 0 1px rgba(0,0,0,.1)")));return n},opacity:function(e,t,i){t<e.childNodes.length&&(e.childNodes[t].style.opacity=i)}});var h=s(e("group"),{behavior:"url(#default#VML)"});return!n(h,"transform")&&h.adj?l():c=n(h,"animation"),r}),define("service/map",["Store"],function(e){return new e({body:document.body,login:document.getElementById("login"),"login-form":document.getElementById("login-form"),"signup-form":document.getElementById("signup-form"),loading:document.getElementById("loading"),serverdown:document.getElementById("serverdown"),nointernet:document.getElementById("nointernet"),dock:document.getElementById("wrapper"),notify:document.getElementById("notify"),"notify-popup":document.getElementById("notify-popup"),"newidea-popup":document.getElementById("newidea-popup"),"new2q-popup":document.getElementById("new2q-popup"),"new2c-popup":document.getElementById("new2c-popup"),"help-popup":document.getElementById("help-popup"),"tip-popup":document.getElementById("tip-popup"),cache:document.getElementById("cache"),"public":document.getElementById("public"),"public-menu":document.getElementById("public-menu"),"public-detail":document.getElementById("public-detail"),"public-writetwocents":document.getElementById("public-writetwocents"),"public-twocents":document.getElementById("public-twocents"),"public-edit":document.querySelector("#public-detail .idea-edit"),"public-sendmail":document.querySelector("#public-detail .idea-sendmail"),"public-share":document.querySelector("#public-detail .idea-share"),brainstorm:document.getElementById("brainstorm"),"brainstorm-menu":document.getElementById("brainstorm-menu"),"ideafy-menu":document.getElementById("ideafy-menu"),"ideafy-quick":document.getElementById("ideafy-quick"),"ideafy-multi":document.getElementById("ideafy-multi"),quickstart:document.getElementById("quickstart"),mustart:document.getElementById("mustart"),quicksetup:document.getElementById("quicksetup"),quickscenario:document.getElementById("quickscenario"),"scenario-whiteboard":document.getElementById("scenario-whiteboard"),quicktech:document.getElementById("quicktech"),quickidea:document.getElementById("quickidea"),quickwrapup:document.getElementById("quickwrapup"),library:document.getElementById("library"),"library-menu":document.getElementById("library-menu"),ideas:document.getElementById("ideas"),"ideas-detail":document.getElementById("ideas-detail"),"library-idea":document.querySelector("library-idea"),"library-writetwocents":document.getElementById("library-writetwocents"),"library-twocents":document.getElementById("library-twocents"),"library-edit":document.querySelector("#ideas-detail .idea-edit"),"library-sendmail":document.querySelector("#ideas-detail .idea-sendmail"),"library-share":document.querySelector("#ideas-detail .idea-share"),sessions:document.getElementById("sessions"),decks:document.getElementById("decks"),decklist:document.getElementById("decklist"),deckview:document.getElementById("deckview"),connect:document.getElementById("connect"),"connect-menu":document.getElementById("connect-menu"),"connect-messages":document.getElementById("connect-messages"),msgdetail:document.getElementById("msgdetail"),"connect-contacts":document.getElementById("connect-contacts"),contactdetails:document.getElementById("contactdetails"),"connect-twocents":document.getElementById("connect-twocents"),dashboard:document.getElementById("dashboard"),"dashboard-menu":document.getElementById("dashboard-menu"),"dashboard-profile":document.getElementById("dashboard-profile"),leaderboard:document.getElementById("leaderboard"),"dashboard-settings":document.getElementById("dashboard-settings"),"dashboard-about":document.getElementById("dashboard-about")})}),define("service/config",["Store","SocketIOTransport","CouchDBDocument","Observable"],function(e,t,i,n){var s,a,o,r,l,c=new e,d="",u=[];return this.reset=function(){s="http://app.ideafy.com:1664",d="1.2.2",l=io.connect(s),a=new t(l),o=new i,r=new n,u=["bus","mkt","notes","arch","spec","planning"],_catColors=["#9ac9cd","#f27b3d","#bd262c","#5f8f28","#657b99","#a000a1"],o.setTransport(a),c.reset({location:s,version:d,socket:l,transport:a,db:"ideafy",user:o,observer:r,cat:u,catColors:_catColors,polling_interval:6e4,userTemplate:{lastname:"",firstname:"",address:{street1:"",street2:"",zip:null,state:"",city:"",country:""},gender:1,lang:"en-us",birthdate:[],connections:[],taiaut_decks:["INT"],custom_decks:[],categories:[],active_deck:"INT",occupation:{situation:"",job:"",organization:""},family:{couple:null,children:null},leisure_activities:[{name:"",comment:""},{name:"",comment:""},{name:"",comment:""}],interests:[{name:"",comment:""},{name:"",comment:""},{name:"",comment:""}],type:7,notifications:[],sentMessages:[],facebook:"",twitter:"",gplus:"",linkedin:"",username:"",sessionInProgress:{},organization:"",rated:[],rated_ideas:[],favorites:[],ip:0,picture_file:"img/avatars/deedee0.png",intro:"Ideafyer",title:null,achievements:[],ideas_count:0,su_sessions_count:0,mu_sessions_count:0,twocents_count:0,twoquestions_count:0,tutorial_complete:!1,profile_complete:!1,news:[],twocents:[],twoquestions:[],"public-favorites":[],"library-favorites":[],settings:{notifyPopup:!0,useascharacter:!1,ccme:!1,privacy_lvl:0,showTips:!0,startupScreen:"#public",listSize:null,polling_interval:6e4,contentLang:""},online:!1},ideaTemplate:{title:"",sessionId:"",sessionReplay:!1,authors:[],description:"",solution:"",creation_date:[],character:"",problem:"",lang:"en-us",context:"",techno:[],type:6,sharedwith:[],modification_date:[],inspired_by:"",visibility:"private",votes:[],rating:"",authornames:"",twocents:[],attachments:[]},TQTemplate:{author:[],question:"",creation_date:[],lang:"en-us",type:10,modification_date:[],votes:[],rating:"",username:"",twocents:[]},sessionTemplate:{title:"",description:"",initiator:{id:"",username:"",picture_file:""},participants:[],date:[],startTime:null,resumeTime:null,duration:null,elapsedTime:0,elapsedTimers:{},mode:"",type:8,deck:"",status:"in progress",step:"",lang:"en-us",characters:[],contexts:[],problems:[],scenarioWB:[],scenario:[],techno:[[]],ideaWB:[],idea:[],score:0,sessionReplay:!1},avatars:new e({}),avatar:null,defaultLabels:{language:"en-us",outdated:"Your version is outdated and some features may not work properly. Please update Ideafy",emailplaceholder:"Email",passwordplaceholder:"Password",repeatpasswordplaceholder:"Confirm password",loginbutton:"Log in",newuserbutton:"New user",invalidlogin:"Invalid username or password",missingloginparam:"Please enter both username and password or register",signupmissingemail:"Please enter your email address in the field above",signupmissingpwd:"A password is required",signupmissingpwdok:"Please confirm your password",signupmissingfn:"Please enter your first name",signupmisingln:"Please enter your last name",signupinvalidemail:"Invalid email address",signuppwdnomatch:"Passwords do not match",signupwelcomeobject:"Welcome to Ideady",signupwelcomebody:"Thank you for trying Ideafy. We hope you'll enjoy it. We designed it so you can manage ideas that matter to you or just play around. But don't keep what you're doing to yourself.",signupbutton:"Sign up",Initialization:"Initializing user data. Please wait ...",firstnameplaceholder:"First name",lastnameplaceholder:"Last name",createidealbl:"Enter a new idea",createdecklbl:"Create a new deck",ideatitleplaceholder:"Enter a title for your idea",ideadescplaceholder:"Enter a description of your idea in non technical terms",decktitleplaceholder:"Enter a title for your deck",deckdescplaceholder:"Enter a description of your deck",ideasolplaceholder:"Describe how your idea would work, what components, products, services or technologies you would  use",privatelbl:"Private",publiclbl:"Public",ideavisiblelbl:"Your idea is :",setideavisiblelbl:"Change status :",ideafyreplaylbl:"Ideafy Replay is :",ideafysetreplaylbl:"Change Ideafy Replay status :",enabledreplaylbl:"Enabled",disabledreplaylbl:"Disabled",enablereplaylbl:"Enable",disablereplaylbl:"Disable",oklbl:"Ok",continuelbl:"Continue",setpublicquestion:"Warning, every Ideafy user will be able to view your idea. This operation is irreversible. Do you want to proceed?",publicideasheadertitle:"Public Ideas",publicdetailsheadertitle:"Idea overview",searchpublicplaceholder:"Search public ideas...",ideadetailsheadertitle:"Idea Overview",idealistheadertitle:"My Ideas",searchprivateplaceholder:"Search your ideas...",modifyidealbl:"Modify your idea",sendidealbl:"Email your idea",sharedwith:"Shared with ",ideafyer:" Ideafyer",ideafyers:" Ideafyers",votebuttonlbl:"Vote",novotesyet:"No vote yet",onevote:"1 vote",votes:"votes",ideawrotelbl:" wrote : ",twocentcommentlbl:"commented :",youwrotelbl:"wrote :",theywrotelbl:"wrote :",youcommentedlbl:"commented :",youlbl:"You",hidetwocentreplies:"Hide replies",showonetcreply:"Reply",showtcrepliesbefore:"",showtcrepliesafter:" Replies",twocentreplycommentlbl:"replied :",yourepliedlbl:"replied :",addtwocentplaceholder:"Add your two cents",addtwocentreplyplaceholder:"Respond to this comment",twocentcreationdate:"Creation date: ",twocentmodificationdate:"Last modified: ",cancellbl:"Cancel",publishlbl:"Publish",savelbl:"Save",titlefield:"Title field",descriptionfield:"Description field",solutionfield:"Solution field",emptyfielderror:" cannot be left empty",somethingwrong:"Something went wrong, please try again later",thankyou:"Thank you",loadingmessage:"Application loading, please wait...",maintenancemessage:"We're sorry. The server is currently unavailable. Please come back later.","library-ideas":"My Ideas","library-sessions":"My Ideafy Sessions",sbytitle:"Session title",sbydate:"Date",sbyidea:"Idea title",sbyscore:"Score",searchsessions:"Search previous sessions...",foundlbl:"Found",matchingsessions:"matching session(s)",noideayet:"---",completed:"completed",inprogress:"in progress",noscore:"no score yet",deletereplay:"This session has the Ideafy replay feature enabled. Are you sure you want to delete it?","library-decks":"My Ideafy decks",brainstormheadertitle:"Brainstorm",brainstormchoosemode:"Choose your Ideafy mode",continuesession:"Continue last session",quickbmode:"Quick mode session",quickstart:"Describe your session",quickstarthelp:"<h2>Why is this step important?</h2><p>Giving your session a name and other background information will make it easier to retrieve later on from your library. Besides, it's always interesting to keep track of the particular context in which ideas or other contents were generated. If you are setting up a multi-user session, this will provide important context information to invitees and may persuade them to join.</p>",mustarthelp:"<h2>Multi-user housekeeping rules</h2><p>The session leader sets the objectives of a session and facilitates the session. He/she needs to set the pace of the brainstorming and be a good coach, listening to participant inputs and not imposing his/her views. Fostering good teamwork and having fun is as important for the leader as being creative.</p><p>Remember : if the session leader exits or if all participants leave the session before it is over (in the summary step) the session will end and all the current work will be lost.</p>",quickstarttitle:"Name your session",quickstarttitleplaceholderpre:"",quickstarttitleplaceholderpost:"'s session",quickstartdesc:"Enter a description of your session",quickstartdescplaceholder:"Date, context, purpose, ...",nextbutton:"Next",finishbutton:"Ready",quicksetup:"Set up a situation",quicksetuphelp:"<h2>Setting the stage</h2><p>This step lets you setup a random situation. Draw and select one card of each of the following categories: character, context, problem. They will be the starting point of your session. You can zoom in on each card to get additional information, select a different one by clicking on the deck icon at the top or accept it (thumbs-up button).</p><p>Which is it going to be ? Will you let fortune decide what situation you are going to deal with or will you work the stacks until you get one you are comfortable with? Ideafy encourages you to pick random situations because they force you to think outside the box.</p><p>Note that when you start a <i>Custom session</i> you can specify one or more of your starting cards to address specific situations.</p>",musetuphelp:"<h2>Setting the stage</h2><p>It is up to the session leader to draw cards of each type and to validate the selected cards by pushing the thumbs-up button.</p><p>Participants are able to view each card that is drawn and use the chat interface to provide feedback.</p><p>Select cards that are inspiring or that you can tie to the objectives of your session. Remember these cards can set your thoughts in the right direction to formulate problems or use cases and ultimately come up with an original idea.</p>",credits:"Credits : ",source:"Source : ",dyknow:"Did you know ?",agelbl:" years old",hobbieslbl:"Leisure activities",interestslbl:"Centers of interest",commentslbl:"Comments",singlelbl:"single",marriedlbl:"married",divorcedlbl:"divorced",widowlbl:"widow",nochildlbl:"no children",onechildlbl:" child",childrenlbl:" children",siblingslbl:" siblings",onesiblinglbl:" sibling",quickscenario:"Write your story",quickscenariohelp:"<p>This is your <strong>whiteboard.</strong></p><p>Now is the time to show your creativity and imagination. The cards you just picked give you a scope, a set of directions to project your thoughts. Use them as hints but do not feel overly constrained: they are here to help you <strong>write your own story and describe your own use case</strong>.</p><p>Finding the problem to solve is often the most important step of an innovation. So get started and use the tools below to <strong>post any thought, drawing or picture that will help you focus on a story.</strong></p><br><p>When you are done, click on the <strong>ready</strong> button at the bottom to write up your story.</p>",muscenariohelp:"<p>This is your shared whiteboard. Each participant may add new notes, pictures or drawing in relation to the scope defined by the cards drawn during the previous phase.</p><p>Once the leader feels there is enough material to start writing up a story, he/she may push the finish button only he/she can see at the bottom of the toolbar. Only the leader can fill the scenario template. Other participants will be able to see what the leader types and to help out by making suggestions in the chat window. Once the scenario is complete the leader can press net to proceed to the next step.</p>",choosecolorlbl:"Choose a color",importlbl:"Choose a picture",importpiclbl:"Choose a picture",importcameralbl:"Take a picture",pencilsizelbl:"Size",pencilcolorlbl:"Color",drawbgcolorlbl:"Background",cleardrawinglbl:"Clear",storytitleplaceholder:"Enter the title of your story",storydescplaceholder:"Tell your story, describe the problem your character is facing",storysolplaceholder:"How would you plan to fix this problem ?",quicktech:"Assign technologies",quicktechhelp:"<h2>Draw technologies</h2><p>The next phase of your session consists in finding a way to implement your solution using state of the art technologies. In this step you will draw three technology cards that you will try to include in your design.</p>",mutechhelp:"<h2>Draw technologies</h2><p>As in the setup phase it is up to the leader to draw technology cards and validate those selected by the team for this session. Remember :  finding a way to integrate random technologies in your solution forces you to think outside the box and come up with original and innovative designs.</p>",tech1lbl:"Techno 1",tech2lbl:"Techno 2",tech3lbl:"Techno 3",scenariolbl:"Scenario",storytitlelbl:"Your Story",cdtitlelbl:"Title : &nbsp",scenariodesclbl:"Scenario description",soldesclbl:"Solution description",quickidea:"Describe your idea",quickideahelp:"<p>Welcome back to your <strong>whiteboard.</strong></p><p>Your goal now is to try to apply the technologies that you just picked to design a solution to the use case described in your scenario.</p><p>Again do not feel too constrained: at this stage you can either alter your scenario to accomodate a technology, add additional technologies to the ones you have drawn to complete your solution or skip some of these if they do not fit in your design.</p><p>You are almost done: at the end of this step you will be able to refine your use case and turn it into an <strong>idea</strong>. You will be asked to provide a description in layman terms and also to describe how you would implement it with your chosen technologies.</p><br><p>When you are done, clik on the <strong>ready</strong> button at the bottom to write up your story.</p>",muideahelp:"<p>Welcome back to your <strong>whiteboard.</strong></p><p>Your goal now is to try to apply the technologies that you just picked to design a solution to the use case described in your scenario.</p><p>Do not feel too constrained: at this stage you can either alter your scenario to accomodate a technology, add additional technologies to the ones you have drawn to complete your solution or skip some of these if they do not fit in your design.</p><p>You are almost done: at the end of this step you will be able to refine your use case and turn it into an <strong>idea</strong>. As in the scenario phase it is up to the leader to display and complete the idea template.</p><br><p>When the leader clicks on the next button he can have the team vote on making the idea public and/or on enabling viewers (other than the participants) to view the session details via Ideafy replay. In both cases all of the participants need to agree. One negative vote and the proposal is rejected.</p>",quickwrapup:"Summary",quickstepstart:"Session description",quickstepsetup:"Setup",quickstepscenario:"Scenario",quicksteptech:"Technologies",quickstepidea:"Solution",quickstepwrapup:"Summary",congratulations:"Congratulations !",sessioncompleted:"You successfully completed your Ideafy session",ideatitlelbl:"Your Idea",scenarioheader:"Scenario",scenariosolution:"Solution",ideadescription:"Idea description",ideaimplementation:"Technical implementation",yourtime:"Your time",yourscore:"Your score",musession:"Multi-user session",customsession:"Custom session",ideafytutorial:"ideafy tutorial","connect-contacts":"Contacts","connect-messages":"Messages","connect-twocents":"Two cents","dashboard-profile":"My profile","dashboard-settings":"Settings","dashboard-about":"About Ideafy",tolbl:"To : ",subjectlbl:"Subject : ",yourmessage:"Your message to ",sentok:" has been sent.",sentdocmsg:" sent you an Ideafy document",notavalidaddress:" is not a valid email address",norecipient:"No email address specified",sendlbl:"Send",sharelbl:"Share",msglistheadertitle:"My Messages",notificationlbl:"Notifications",allbtn:"View all",msgbtn:"Messages",notifbtn:"Notifications",unreadbtn:"Unread",searchmsgplaceholder:"Search ...",messageview:"Message panel",replyalllbl:"Reply all",forwardlbl:"Forward",deletelbl:"Delete",newmsg:"New message",cclbl:"Cc :",tocontactlbl:"Contact :",entersubjectlbl:"Please enter a subject",notavalidcontact:" is not a contact",messagesentok:"Your message has been sent",on:"On ",contactview:"Contact panel",contactlistheadertitle:"My Contacts",usrbtn:"Users",grpbtn:"Groups",newcontactlbl:"New contact",addcontactnow:"Add your contact now",lookup:"Or look up the Ideafy database",beforecount:"The <strong>Ideafy community</strong> now counts <strong>",aftercount:" <strong>users </strong> merrily crafting and exchanging ideas.<br>Look up your acquaintances and friends in the community and connect.",addcontactrightintro:"Building up your address book is the best and fastest way to increase exposure of your ideas and thoughts, but also to get access to a much broader content.",searchcontactplaceholder:"Enter email address of the person you wish to connect with ...",clearemailfirst:"Please clear the email field first",needbothfnln:"Both first and last names are required",selectcontact:"Select contact and press + to invite",noentryfound:"No matching entry in the database",cannotaddself:"You cannot add a connection to yourself",alreadyconnected:" is already a contact",alreadysentCXR:"You already sent a connection request to ",CXRobject:" wants to be a connection",CXRsent:"Your connection request has been sent",addamessage:"Add a message",accept:"Accept",reject:"Reject",acceptedCXR:" has accepted your connection request",rejectedCXR:" has declined your connection request",CXRaccepted:"Request accepted, ",CXRrejected:"Contact request rejected",isnowacontact:" is now a contact",isnolongeracontact:" is no longer a contact",canceledCX:" has canceled your connection",newfolderlbl:"New group",groupnamelbl:"Group name",groupdesclbl:"Group description",colortouch:"A colorful touch is always nice","char":"Character",context:"Context",problem:"Problem",techno:"Technology",grpcontacts:"Group contacts",addgrpcontacts:"Add contacts",nogrpname:"Please enter a group name",nogrpintro:"Please provide a group description",grpnameexists:"A group with this name already exists",nocontactselected:"Please add at least one contact to your group",profilelbl:"My Profile",aboutlbl:"About Ideafy",settingslbl:"Application parameters",completionprefix:"Your profile is ",completionsuffix:"% complete",info:"information",leaderboard:"leaderboard",enterbirthdate:"Provide your date of birth",entergender:"Indicate your gender",enterfamily:"Complete your family status",enteraddress:"Specify your address",enterintro:"Change your introduction",enteroccupation:"Describe your occupation",enterleisure:"Provide at least two leisure activities",enterinterest:"Provide at least two areas of interest",entersocialnw:"Add a social network",enterownpic:"Customize your avatar",completeprofile:"<i>Complete your profile</i>",mystatslbl:"My Stats",ideaslbl:"Public Ideas",sessionslbl:"Sessions",contactslbl:"Contacts",toquestionslbl:"Twoquestions",recentactivitylbl:"Recent Activity",enterednewidea:"You entered a new idea: ",reachedrank:"Congratulations ! You made a new rank :",gotaward:"You received an award : ",posted2q:"You posted a TwoQuestion :",commentedon:"You commented on : ",by:" by ",profileintro:"Profile introduction",shortprofiledesc:"Short profile description",day:"Day",dob:"Date of birth",jan:"January",feb:"February",mar:"March",apr:"April",may:"May",jun:"June",jul:"July",aug:"August",sep:"September",oct:"October",nov:"November",dec:"December",year:"Year",mailaddress:"My Address",street:"Street",city:"City",state:"State",zip:"ZIP code",country:"Country",myfamily:"My Family",single:"Single",married:"Married",divorced:"Divorced",widow:"Widow",relation:"In a couple",children:"Children",myoccupation:"My Occupation",student:"Student",active:"Active",retired:"Retired",unemployed:"Unemployed",stayathome:"Stay at home parent",jobtitle:"Job title",organization:"Organization",name:"Name",comment:"Comment",field:"Field",updatelbl:"Update",selectavatar:"Or select an avatar",uploadcomplete:"Upload complete",mynotes:"My Notes",writesomething:"Write something",stats:"Stats",achievements:"Achievements",decklistheadertitle:"My Decks",ideafypoints:" Ideafy Points",version:"Version : ",groupupdated:"Group updated",socialnwlbl:"Social networks",designedby:"Designed by : ",mtcheadertitle:"My Two Cents Wall",userpref:"User Preferences",brainstormsettings:"Brainstorm Settings",aboutIdeafy:"About Ideafy",faq:"FAQ",tutorials:"Tutorials",userguide:"User Guide",support:"Support",eula:"View License Agreement",page:"Page ",supportlegend:"A question or an issue?",supportplaceholder:"Enter your text and send",requestsent:"Thank you ! Your request has been sent",createquestion:"New TwoQuestion",questionplaceholder:"Enter your question",noquestion:"Please enter a question",lengthexceeded:"Maximum question length reached",characters:" characters",publicidealbl:"Public Idea",privateidealbl:"Private Idea",publicwarning:"<b>WARNING :</b> publishing your idea as a public one is irreversible. Visit Ideafy's dashboard to learn more.",uploadinprogress:"Upload in progress",notifyingcontacts:" Notifying contacts",askednew:" has asked a new TwoQuestion",melbl:"Me",nowconnected:" are now connected with ",noreplyyet:"No reply yet",mytwoquestions:"My TwoQuestions",mytwocents:"My Twocents",twoqprefix:"",twoqsuffix:"'s TwoQuestions",notwoqyet:"This Ideafyer has not posted any TwoQuestion yet",mytqdetailheader:"My TwoQuestion",tqheaderprefix:"",tqheadersuffix:"'s TwoQuestion",selecttq:"Select a contact to diplay TwoQuestions",mytwocentwall:"My Twocent Wall",sendtcprefix:"Send a Twocent to ",sendtcsuffix:"",twocentplaceholder:"Write your two cents",nomessage:"Please enter a message",sendinginprogress:"Sending in progress",senttc:" wrote you a new Twocent",selectall:"Select all",shareok:"Document shared successfully",signaturelbl:"Signature",sharing:"Sharing : ",messagecenter:"Message Center",twocentview:"Twocent Center",twocentcenter:"TwoQuestions & Twocents","about-taiaut":"About Taiaut",ideafydesc:"Look at Ideafy as your personal accelerator of ideas. You need ideas? Browse the database of ideas shared by other Ideafyers, ask your network or craft new ones using the embedded brainstorming engine. You have creative ideas? Ideafy makes it easy to share them with your network or to expose them to a community of innovative minds. Start discussions, ask questions or just give your two cents. Your Ideafyer friends want to find out what is on your mind. Ideation is fun. Get started and earn as many Ideafy Points and achievements as you can. Will you be the King of Ideas?",taiautdesc:"Taiaut was founded in May 2012 by three partners passionate about innovation and new technology. The aim of the company is to take advantage of leading edge communication technologies to advance creative ideas and best innovation practices globally. The company is headquartered in Boersch, France",solene:"Solène Troussé",oliviers:"Olivier Scherrer",olivierw:"Olivier Wietrich",vincent:"Vincent Weyl",contribsolene:"User interface design",contribscherrer:"Framework design and development",contribwietrich:"User Interface development and software packaging",contribvincent:"Application conception & lead developer","public":"Public wall",library:"My Library",brainstorm:"Brainstorming center",connect:"Communication Center",dashboard:"Dashboard",notips:"Do not show tips at startup",showtips:"Show tips at startup",shownotif:"Show notification popup",setlang:"Choose your language",choosestartup:"Choose your startup screen",usechar:"Allow my profile to be used as an Ideafy character (my name will not be shown)",changepwd:"Change password",changelbl:"Change",brainstormtutorial:"Brainstorming tutorial",twoway:"Support is a two-way street",supportusintro:"Ideafy is a free application and we intend to keep it that way. We are committed to bringing you the best experience. Here are a few things you can do to help us support you better:",asanideafyer:"As an Ideafyer",asanexec:"As a business executive",asadev:"As a developer",asaninvest:"As an investor",ideafyerhelp:"Tell us how you feel by rating the application. If you encounter an issue please use the form above and we will try to fix it speedily. All your feedback is welcome and really helps us improve Ideafy.",exechelp:'If you feel like your business could become even more innovative by using such a platform internally or with your partners, we do propose standalone deployments or dedicated instances. This will not be free but we offer ultra competitive conditions. Contact us with the form above or via our <a onclick=\'window.open("http://www.taiaut.com", "_system");\'>website</a>',devhelp:'Ideafy exists thanks to three javascript libraries written by the company partners. They are released under MIT licenses and are available here : <a onclick=\'window.open("http://github.com/flams/emily", "_system");\'>emily</a>, <a onclick=\'window.open("http://github.com/flams/olives", "_system");\'>olives</a> and <a onclick=\'window.open("http://http://github.com/flams/CouchDB-emily-tools", "_system");\'>couchdb-emily-tools</a>. Check them out and if you are up for it help us make them even better.',investhelp:"We have plenty of ideas to expand the Ideafy service and we are constantly looking for funding opportunities. If you are interested, want to find out about our future and be part of it please contact us.",toc:"Table of contents",backtotop:"Back to top",choosepolling:"Poll new public ideas",everymin:"Every minute",everyfive:"Every 5 minutes",everyfifteen:"Every 15 minutes",never:"Disabled",nointernet:"Your device is not connected: please check your Internet access and try again.",schedmaintenance:"Scheduled maintenance",nextmaintenance:"The next maintenance will take place on : ",startnewmub:"Start a new session",joinmub:"Join a session",selectmode:"Select mode",roulette:"Roulette",campfire:"Campfire",boardroom:"Boardroom",rouletteinfo:"Any other Ideafyer may join this session",campfireinfo:"Anyone from your contact list may join this session (no notification)",boardroominfo:"Invitation only: invited contacts are notified and may join this session",clear:"Clear",create:"Create",nofriendtoinvite:"No contact to invite: please add contacts to your list or select an other mode",inviteatleastone:"You must select at least one contact to invite",providesessioninfo:"You must enter a meaningful title and description",sendinginvites:"Sending invitations...",invitesent:"Invitations sent",INVObject:" invited you to an Ideafy session",nolongerjoin:"You can no longer join this session : it is already underway or completed.",clicktojoin:"Push the button below to join session.",selectsession:"Select a session",participantleave:"Are you sure you want to leave? You will not be able to re-join nor will you get credited for any outcome  of the session",leaderleave:"Are you sure you want to cancel this session? This will end it for all participants.",canceledbyleader:"Session canceled by leader: ending now",participantsleft:"All participants have left: the session is canceled",waitingroomlbl:"Waiting room",joinedsession:"<i>You joined this session.</i>",deletingsession:"Deleting session : ",participants:"Participants",startbutton:"Start",joinbutton:"Join",nosessionfound:"No session found",allmodes:"All modes",all:"All",mode:"Mode",lang:"Lang",title:"Title",leader:"Session leader",sessionfull:"The session is full",sessionstarted:"This session is already started",sessiondeleted:"This session has been canceled",chatmsg0:" has initiated the session",chatmsg1:" has joined the session",chatmsg2:" has left the session",chatmsg3:" has canceled the session",chatmsg4:"Your session is starting now",chatmsg5:"Beginning new step : ",chatmsg6:"This concludes the current step. Moving on to the next screen...",typemsg:"Enter your text",said:" said :",noresult:"No result found",clicktoview:"Press the button below or visit your library to view",skiplbl:"Skip",submitlbl:"Submit",decidemsg:"Decide how you want to share your work",unanimity:"(unanimity is required)",setpublic:"Make the idea public",enablereplay:"Enable session replay",yeslbl:"Yes",nolbl:"No",accepted:"ACCEPTED",rejected:"REJECTED",post:"Post","import":"Import",draw:"Draw",invitesyou:" invites you to join the Ideafy community",invitebody:"<p style='background: whitesmoke; font-family=helvetica; font-size=24px; text-align=justify;'><b>Take advantage of this invitation! Get Ideafy now and join the fast growing online community of Ideafyers. Compete for best idea, most creative mind and many other exciting challenges. Give your imagination and your ideas a new life.</b><br><br>Available now on the Apple iPad in U.S. and France.</p><p><a href='https://itunes.apple.com/us/app/ideafy/id605681593?mt=8&uo=4' target='itunes_store'style='display:inline-block;overflow:hidden;background:url(http://linkmaker.itunes.apple.com/htmlResources/assets/images/web/linkmaker/badge_appstore-lrg.png) no-repeat;width:135px;height:40px;@media only screen{background-image:url(http://linkmaker.itunes.apple.com/htmlResources/assets/images/web/linkmaker/badge_appstore-lrg.svg);}'></p>",joinedideafy:" has joined Ideafy",referral:"You earned 200 Ideafy Points for referring this person. You can now add him/her to your contacts.",invitationsent:"Your invitation has been sent",alreadyinvited:"You already invited this person",cardeditor:"Card editor",createnew:"Add a new card",importcard:"Import ...",orlbl:"or",cardtitle:"Choose a title",picturecredit:"Picture origin",enterdyknow:"Add explanations, facts and figures",dyknowsources:"Provide sources if applicable",age:"Age",countrystate:"Country or state",desc:"Description",titlerequired:"A title is required",addcomment:"Additional information",setdeck:"Set brainstorming deck",setdecklogo:"Select an icon",importfrom:"Select deck to import from",remsel:"Remove selection<br><<<",impsel:"Import selection<br>>>>",seldeck:"Selected deck",workdeck:"Working deck",selall:"Select all",clearsel:"Clear selection",delcardwarning:"Removing the following cards from your deck will delete them from the database :<br>",deldeckwarning:"Deleting this deck will definitively remove it from your library. If you are its author, it will also be removed from the database as well as any card you created that is only attached to this deck. Are you sure you want to proceed ?",cannotdelactivedeck:"You cannot remove your active deck.  Please review your settings.",cannotremovecard:"You cannot remove this card from your active deck.  An active deck requires at leat one character card, one context card, one problem card and three technology cards.",alreadyshared:"This has already been shared with intended recipients",addedfav:"This idea has been added to your favorites",removedfav:"This idea has been removed from your favorites",maxfavsize:"Your list of favorites has reached the maximum size. Remove some ideas before trying to add this one."},lang:"en-us",userLanguages:[{name:"en"},{name:"zh"},{name:"es"},{name:"ja"},{name:"pt"},{name:"de"},{name:"ar"},{name:"fr"},{name:"ru"}],labels:new e({})})
},this.reset(),c}),define("service/utils",["service/config","Observable","Promise","LocalStore","SocketIOTransport","CouchDBDocument"],function(e,t,i,n,s,a){var o={},r=e.get("user"),c=e.get("transport");return o.formatDate=function(e){var t=e[1]+1;return 0===r.get("lang").search("en")?t+"/"+e[2]+"/"+e[0]:(10>t&&(t="0"+t),e[2]+"/"+t+"/"+e[0])},o.formatDateStamp=function(e){var t=new Date(e),i=[t.getFullYear(),t.getMonth()+1,t.getDate()];return o.formatDate(i)},o.formatDuration=function(e){var t,i,n,s,a,o;return e?(t=Math.round(e/1e3),i=Math.floor(t/86400),n=Math.floor(t%86400/3600),s=Math.floor(t%86400%3600/60),a=Math.floor(t%86400%3600%60),o=i>0?i+"d ":"",o+=n>0?n+":":"",o+=s>0?(n>0&&10>s?"0":"")+s+":":"0:",o+=10>a?"0"+a:a):o="",o},o.formatTime=function(e){var t=new Date(e),i=t.getHours(),n=t.getMinutes(),s=t.getSeconds(),a="";return a+=i+":",a+=n>0?(i>0&&10>n?"0":"")+n+":":"00:",a+=10>s?"0"+s:s},o.displayFirstSentence=function(e,t){var i=[];return i=t.split("."[0],1),i[0].length>140&&(e.innerHTML=i[0].substr(0,139).replace(/\w*\s(\S)*$/," ...")),e.innerHTML},o.truncate=function(e,t){for(e.innerHTML=t;e.scrollHeight>e.offsetHeight;){var i=e.innerHTML;e.innerHTML=i.replace(/\W*\s(\S)*$/,"...")}return e.innerHTML},o.setRating=function(e,t){var i,n="<img src = 'img/wall/disableIdeaVote.png'>",s="<img src = 'img/wall/semi-activeIdeaVote.png'>",a="<img src = 'img/wall/activeIdeaVote.png'>",o="";if(t){for(i=0;i<Math.floor(t);)o+=a,i++;for(5>i&&(o+=Math.round(t-Math.floor(t))?s:n,i++);5>i;)o+=n,i++}else for(i=0;5>i;i++)o+=n;e.innerHTML=o},o.searchArray=function(e,t){var i,n,s,a,o=t.toLowerCase().split(" "),r=[];for(i=0,l=e.length;l>i;i++){for(s=JSON.stringify(e[i]).toLowerCase(),a=0,n=0;n<o.length&&s.search(o[n])>-1;n++)a++;a===o.length&&r.push(e[i])}return r},o.sortByProperty=function(e,t,i){switch(t){case"idea":e.sort(function(e,n){var s,a,r=e[t],l=n[t];return i?(r&&r instanceof Array&&r.length?(o.sortByProperty(r,"title",!0),s=r[0].title):s="",l&&l instanceof Array&&l.length?(o.sortByProperty(l,"title",!0),a=l[0].title):a="",a>s?1:s>a?-1:0):(r&&r instanceof Array&&r.length?(o.sortByProperty(r,"title",!1),s=r[0].title):s="",l&&l instanceof Array&&l.length?(o.sortByProperty(l,"title",!1),a=l[0].title):a="",a>s?-1:s>a?1:0)});break;case"date":e.sort(function(e,n){var s=e[t],a=n[t],o=new Date(s[0],s[1],s[2]),r=new Date(a[0],a[1],a[2]);return i?r>o?1:o>r?-1:0:r>o?-1:o>r?1:0});break;default:e.sort(function(e,n){var s=e[t],a=n[t];return"string"==typeof s||"string"==typeof a?(s&&s.toLowerCase&&(s=s.toLowerCase()),a&&a.toLowerCase&&(a=a.toLowerCase()),i?a>s?1:s>a?-1:0:a>s?-1:s>a?1:0):i?a>s?1:s>a?-1:0:a>s?-1:s>a?1:0})}},o.uploadFile=function(t,i,n,s){var a=new XMLHttpRequest;return a.open("POST",e.get("location")+t),a.onreadystatechange=function(){4===a.readyState&&s&&s(a)},a.upload.onprogress=function(e){e.lengthComputable&&n&&n.set("status",Math.round(100*(e.loaded/e.total)))},"afile"===i.type?(a.setRequestHeader("content-type",'multipart/form-data; boundary="--=====Ideafy=====--"'),a.sendAsBinary(i)):a.send(i),a},o.checkServerStatus=function(){var t=new i,n=new XMLHttpRequest;return n.open("GET",e.get("location")),n.onreadystatechange=function(){4===n.readyState&&(200===n.status?t.fulfill():t.reject())},n.send(),t},o.checkSocketStatus=function(){var t=e.get("socket"),i=e.get("observer");t.socket.connected?r.get("online")||i.notify("reconnect","user"):(t.socket.reconnect(),i.notify("reconnect","all"))},o.disconnectSocket=function(){r.set("online",!1),r.upload().then(function(){e.get("socket").socket.disconnect(),e.get("observer").notify("disconnect")})},o.updateLabels=function(t){var s={lang:t},a=new n,o=e.get("labels"),r=new i;return a.sync("ideafy-data"),c.request("Lang",s,function(t){"nok"===t?(a.set("labels",e.get("defaultLabels")),e.set("lang","en-us")):(a.set("labels",t),e.set("lang",t.language)),a.sync("ideafy-data"),o.reset(a.get("labels")),r.fulfill()}),r},o.getAvatarById=function(t){var s=new i,a=(new n,e.get("avatars"));return a.get(t)&&"in progress"!==a.get(t)?s.fulfill(a.get(t)):"in progress"===a.get(t)?a.watchValue(t,function(e){e&&"in progress"!==e&&(a.unwatch(t),s.fulfill(e))}):(a.set(t,"in progress"),c.request("GetAvatar",{id:t},function(e){if(e.error)s.reject();else{if(a.getNbItems()<100)a.set(t,e);else{var i=a.toJSON(),n=i.keys();a.del(n[0]),a.set(t,e)}s.fulfill(e)}})),s},o.getAvatarByFileName=function(e,t){c.request("GetAvatar",{file:e},function(e){t(e)})},o.getGrade=function(e,t){c.request("GetGrade",{ip:e,lang:r.get("lang")},function(e){t(e)})},o.getAchievements=function(e,t){c.request("GetAchievements",{userid:e,lang:r.get("lang")},function(e){t(e)})},o.getUserDetails=function(e,t){c.request("GetUserDetails",{userid:e},function(e){t(e)})},o.getUserContactIds=function(){var e=[],t=r.get("connections").concat();return t.forEach(function(t){"user"===t.type&&e.push(t.userid)}),e},o.checkProfileCompletion=function(){var t=e.get("labels"),i={percentage:0,missing:[]};return r.get("firstname")&&r.get("lastname")&&(i.percentage+=10),3===r.get("birthdate").length?i.percentage+=10:i.missing.push(t.get("enterbirthdate")),null!==r.get("family").couple&&null!==r.get("family").children?i.percentage+=10:i.missing.push(t.get("enterfamily")),r.get("address").city&&r.get("address").country?i.percentage+=10:i.missing.push(t.get("enteraddress")),r.get("intro")&&"Ideafyer"!==r.get("intro")?i.percentage+=10:i.missing.push(t.get("enterintro")),r.get("occupation").situation>=0&&r.get("occupation").job&&r.get("occupation").organization?i.percentage+=10:i.missing.push(t.get("enteroccupation")),r.get("leisure_activities")[0].name&&r.get("leisure_activities")[1].name?i.percentage+=10:i.missing.push(t.get("enterleisure")),r.get("interests")[0].name&&r.get("interests")[1].name?i.percentage+=10:i.missing.push(t.get("enterinterest")),r.get("twitter")||r.get("facebook")||r.get("gplus")||r.get("linkedin")?i.percentage+=10:i.missing.push(t.get("entersocialnw")),r.get("picture_file").search("img/avatars/deedee")<0?i.percentage+=10:i.missing.push(t.get("enterownpic")),i},o.stringToBytes=function(e){var t,i,n,s,a=[],o=0;for(n=0;n<e.length;n++)if(t=e.charCodeAt(n),127>t)a[o++]=255&t;else{i=[];do i.unshift(255&t),t>>=8;while(t);for(s=0;s<i.length;s++)a[o++]=i[s]}return a},o.changeStyle=function(e){var t=document.querySelector(".currentStyle"),i=t.getAttribute("href");i!=="css/"+e&&t.setAttribute("href","css/"+e)},o.exitListener=function(e,t){var i=function(i){var n;for(n=i.target;n;n=n.parentNode)if(n.id===e)return;i.target.classList.contains("deedee")||i.target.classList.contains("notify-header")||"dock"===i.target.id||i.target.classList.contains("close-help")||(i.stopPropagation(),t(i.target))};return document.addEventListener("mousedown",i,!0),i},o.deleteAttachmentFile=function(e,t){var n={},s=new i;return 0===e.search("I:")&&(n.type="idea"),n.docId=e,n.file=t,c.request("DeleteAttachment",n,function(e){"ok"===e?s.fulfill():s.reject()}),s},o.deleteAttachmentDoc=function(t){var n=new i,s=new a;return s.setTransport(c),s.sync(e.get("db"),t).then(function(){var e="",t=s.get("docId");return 0===t.search("I:")&&(e="idea"),o.deleteAttachmentFile(e,t,s.get("fileName"))}).then(function(){return s.remove()}).then(function(){n.fulfill()}),n},o}),define("service/avatar",["OObject","Bind.plugin","Event.plugin","service/config","Store","service/utils","CouchDBView"],function(e,t,i,n,s,a,o){function r(e){var r=new s({img:"",online:!1}),l=n.get("avatars"),c=new o([]),d=e[0];c.setTransport(n.get("transport")),this.plugins.addAll({avatar:new t(r,{setStyle:function(e){e&&"in progress"!==e&&this.setAttribute("style","background-image: url('"+e+"');")},setStatus:function(e){e?this.classList.add("online"):this.classList.remove("online")}}),event:new i(this)}),this.template='<div class="avatar" data-avatar="bind: setStyle, img; bind: setStatus, online"></div>',c.sync(n.get("db"),"users","_view/online",{key:'"'+d+'"'}).then(function(){c.get(0)?r.set("online",!0):r.set("online",!1)}),["added","deleted","updated"].forEach(function(e){c.watch(e,function(){c.get(0)?r.set("online",!0):r.set("online",!1)})}),e.length>1?r.set("img","img/avatars/deedee6.png"):d===n.get("user").get("_id")?(r.set("img",n.get("avatar")),n.watchValue("avatar",function(){r.set("img",n.get("avatar"))})):"ideafy@taiaut.com"===d||"IDEAFY"===d?r.set("img","img/avatars/doctordeedee.png"):l.get(d)?"in progress"===l.get(d)?l.watchValue(d,function(e){e&&"in progress"!==e&&r.set("img",e)}):r.set("img",l.get(d)):a.getAvatarById(d).then(function(){r.set("img",l.get(d))})}return function(t){return r.prototype=new e,new r(t)}}),define("twocents/writetwocent",["OObject","service/config","Bind.plugin","Event.plugin","Store","service/utils","lib/spin.min"],function(e,t,i,n,s,a,o){return function(r){var l,c,d=new e,u=t.get("user"),p=t.get("transport"),g=new Date,h=new s({author:u.get("_id"),message:"",firstname:u.get("firstname"),date:[g.getFullYear(),g.getMonth(),g.getDate()],datemod:"",plusones:0,replies:[]}),m=new o({color:"#8cab68",lines:10,length:8,width:4,radius:8,top:-8,left:24}),v=r||"public",f="new",b=0;return d.plugins.addAll({twocent:new i(h,{date:function(e){e&&(this.innerHTML=a.formatDate(e))},setVisible:function(e){e?this.classList.remove("invisible"):this.classList.add("invisible")}}),config:new i(t,{setAvatar:function(e){this.setAttribute("style","background: url('"+e+"') no-repeat center center;background-size:cover;")}}),labels:new i(t.get("labels")),twocentevent:new n(d)}),d.template='<div class = "writeTwocent"><div class="userAvatar twocentAvatar" data-config="bind: setAvatar, avatar"></div><textarea class="twocentText" data-labels="bind: placeholder, addtwocentplaceholder" data-twocent="bind: value, message"></textarea><div class="writeFooter"><ul class="twocentContext"><li class="creadate"><span class="creadatelbl" data-labels="bind:innerHTML, twocentcreationdate"></span><span class="date" data-twocent="bind: date, date"></span></li><li class="moddate invisible" data-twocent="bind: setVisible, datemod"><span class="moddatelbl" data-labels="bind: innerHTML, twocentmodificationdate"></span><span class="date" data-twocent="bind: date, datemod"></span></li></ul><div class="twocentCancel" data-labels="bind: innerHTML, cancellbl" data-twocentevent="listen: mousedown, press; listen: mouseup, cancel">Cancel</div><div class="twocentPublish" data-labels="bind: innerHTML, publishlbl" data-twocentevent="listen: mousedown, press; listen: mouseup, publish">Publish</div></div></div>',d.reset=function(e,t,i,n){var s=new Date;e&&(l=e),t?(h.reset(t),f=t,b=i,h.set("datemod",[s.getFullYear(),s.getMonth(),s.getDate()])):(h.reset({author:u.get("_id"),message:"",firstname:u.get("firstname"),date:"",datemod:"",plusones:0,replies:[]}),h.set("date",[s.getFullYear(),s.getMonth(),s.getDate()]),f="new"),n&&(c=n)},d.cancel=function(e,t){t.setAttribute("style","-webkit-box-shadow: none; background: #e69b73;"),c?c():document.getElementById(v+"-writetwocents").classList.add("invisible")},d.publish=function(e,i){if(i.setAttribute("style","-webkit-box-shadow: none; background: none;"),h.get("message")){var n,s,a=JSON.parse(h.toJSON());m.spin(i),s="new"===f?"new":"edit",n={docId:l,type:s,position:b,twocent:a},p.request("WriteTwocent",n,function(e){"ok"!==e?alert(t.get("labels").get("somethingwrong")):"new"===f?document.getElementById(v+"-writetwocents").classList.add("invisible"):c(),i.setAttribute("style","background: #8cab68;"),m.stop()},d)}},d.press=function(e,t){t.setAttribute("style","-webkit-box-shadow: inset 0 0 5px 1px rgba(0,0,0,0.6); background: #666666;")},d}}),define("twocents/writetwocentreply",["OObject","Store","Bind.plugin","Event.plugin","service/config","service/utils","lib/spin.min"],function(e,t,i,n,s,a,o){function r(e){var r,l,c,d,u,p=s.get("user"),g=s.get("transport"),h=(new Date,new o({color:"#8cab68",lines:10,length:8,width:4,radius:8,top:-8,left:24})),m={author:p.get("_id"),message:"",firstname:p.get("firstname"),date:"",datemod:"",plusones:0},v=new t(m);this.plugins.addAll({model:new i(v,{date:function f(f){this.innerHTML=a.formatDate(f)}}),config:new i(s,{setAvatar:function(e){this.setAttribute("style","background: url('"+e+"') no-repeat center center;background-size:cover;")}}),writereplyevent:new n(this),labels:new i(s.get("labels"))}),this.template='<div class="writeTwocent writeTwocentReply"><div class="replyAvatar" data-config="bind: setAvatar, avatar"></div><textarea class="twocentText replyMessage" data-labels="bind: placeholder, addtwocentreplyplaceholder" data-model="bind: value, message"></textarea><div class="writeFooter"><ul class="twocentContext"><li class="creadate"><span class="creadatelbl" data-labels="bind:innerHTML, twocentcreationdate"></span><span class="date" data-model="bind: date, date"></span></li></ul><div class="twocentCancel" data-labels="bind: innerHTML, cancellbl" data-writereplyevent="listen: mousedown, press; listen: mouseup, cancel">Cancel</div><div class="twocentPublish" data-labels="bind: innerHTML, publishlbl" data-writereplyevent="listen: mousedown, press; listen: mouseup, publish;">Publish</div></div></div>',this.reset=function(e,t,i,n,s,a){var o=new Date;e&&t&&(r=e,l=t),d=s?s:"",i?(v.reset(i),editTCR=i,c=n,v.set("datemod",[o.getFullYear(),o.getMonth(),o.getDate()])):(v.reset({author:p.get("_id"),message:"",firstname:p.get("firstname"),date:"",datemod:"",plusones:0}),v.set("date",[o.getFullYear(),o.getMonth(),o.getDate()]),editTCR="newreply"),u=a},this.cancel=function(t,i){i.setAttribute("style","-webkit-box-shadow: none; background: #e69b73;"),u?u():e.classList.add("invisible"),v.reset({author:p.get("_id"),message:"",firstname:p.get("firstname"),date:"",datemod:"",plusones:0})},this.publish=function(t,i){if(i.setAttribute("style","-webkit-box-shadow: none; background: none;"),v.get("message")){var n,a,o=JSON.parse(v.toJSON());h.spin(i),a="newreply"===editTCR?editTCR:"editreply",d&&(o.message="@ "+d+" : "+o.message),n={docId:r,type:a,position:c,twocent:l,reply:o},g.request("WriteTwocent",n,function(t){i.setAttribute("style","background: #8cab68;"),h.stop(),"ok"!==t?alert(s.get("labels").get("somethingwrong")):(e.classList.add("invisible"),v.reset({author:p.get("_id"),message:"",firstname:p.get("firstname"),date:"",datemod:"",plusones:0}))})}},this.press=function(e,t){t.setAttribute("style","-webkit-box-shadow: inset 0 0 5px 1px rgba(0,0,0,0.6); background: #666666;")}}return function(t){return r.prototype=new e,new r(t)}}),define("twocents/twocentreplylist",["OObject","Store","Bind.plugin","Event.plugin","service/utils","service/config","twocents/writetwocentreply","service/avatar"],function(e,t,i,n,s,a,o,r){function l(e,l,c){var d=new t(e),u=this,p=a.get("user"),g=a.get("labels"),h=a.get("transport");u.plugins.addAll({reply:new i(d,{date:function m(m){m&&(this.innerHTML=s.formatDate(m))},setFirstname:function(e){var t=this.getAttribute("data-reply_id");this.innerHTML=e,d.get(t).author===p.get("_id")&&(this.innerHTML=g.get("youlbl"))},setReplylbl:function(){var e=this.getAttribute("data-reply_id");this.innerHTML=g.get("twocentreplycommentlbl"),d.get(e).author===p.get("_id")&&(this.innerHTML=g.get("yourepliedlbl"))},setAvatar:function(e){var t=document.createDocumentFragment(),i=new r([e]);i.place(t),this.hasChildNodes()?this.replaceChild(t,this.firstChild):this.appendChild(t)},setVisible:function(e){e&&e===p.get("_id")?this.setAttribute("style","display: block;"):this.setAttribute("style","display: none;")},setInVisible:function(e){e&&e===p.get("_id")?this.setAttribute("style","display: none;"):this.setAttribute("style","display: block;")}}),replyevent:new n(u),labels:new i(g)}),u.template='<ul class="replies" data-reply="foreach"><li class="twocentReply"><div class="twocentHeader"><div class="replyAvatar" data-reply="bind:setAvatar, author"></div><div class="twocentAuthor" data-reply="bind: setFirstname, firstname"></div><span class="commentLabel" data-labels="bind: setReplylbl, firstname"></span><br/><div class="twocentDate date" data-reply="bind: date, date"></div><div class="twocentMenu"><div class="twocentButton twocentEditButton" data-reply="bind: setVisible, author" data-replyevent="listen: mousedown, edit"></div><div class="twocentButton twocentDeleteButton" data-reply="bind: setVisible, author" data-replyevent="listen: mousedown, deleteTwocentReply"></div><div class="twocentButton twocentReplyButton" data-reply="bind: setInVisible, author" data-replyevent="listen:mousedown, reply"></div></div></div><p class="twocentMessage replyMessage" data-reply="bind: innerHTML, message"></p><div class="writePublicTwocentReply replyToReply invisible"></div></li></ul>',u.edit=function(t,i){var n=i.getAttribute("data-reply_id"),s=u.dom.children[n],a=new o,r=function(){u.dom.replaceChild(s,a.dom)},d=document.createDocumentFragment();a.reset(l,c,e[n],n,null,r),a.render(),a.place(d),u.dom.replaceChild(d,s),UI=u.dom},u.deleteTwocentReply=function(e,t){var i=t.getAttribute("data-reply_id"),n={docId:l,type:"deltcreply",twocent:c,position:i};h.request("WriteTwocent",n,function(e){"ok"!==e&&alert(a.get("labels").get("somethingwrong"))})},u.reply=function(t,i){var n=i.getAttribute("data-reply_id"),s=u.dom.parentNode,a=s.querySelector(".writePublicTwocentReply[data-reply_id='"+n+"']"),r=document.createDocumentFragment(),d=new o(a);d.reset(l,c,null,n,e[n].firstname),d.render(),d.place(r),a.hasChildNodes()||a.appendChild(r),a.classList.remove("invisible")}}return function(t,i,n,s){return l.prototype=new e,new l(t,i,n,s)}}),define("twocents/twocentlist",["OObject","service/config","CouchDBDocument","Store","Promise","service/utils","Bind.plugin","Event.plugin","twocents/twocentreplylist","twocents/writetwocent","twocents/writetwocentreply","service/avatar"],function(e,t,i,n,s,a,o,r,l,c,d,u){function p(e){var p,g=this,h=new i,m=t.get("labels"),v=new n([]),f=t.get("transport"),b=t.get("user"),w=e;h.setTransport(f),g.plugins.addAll({labels:new o(t.get("labels")),twocents:new o(v,{date:function y(y){y&&(this.innerHTML=a.formatDate(y))},setFirstName:function(e){var i;e&&(e!==b.get("firstname")?this.innerHTML=e:(i=this.getAttribute("data-twocents_id"),this.innerHTML=v.get(i).author===b.get("_id")?t.get("labels").get("youlbl"):e))},setCommentlbl:function(e){var t;e&&(e!==b.get("firstname")?this.innerHTML=m.get("twocentcommentlbl"):(t=this.getAttribute("data-twocents_id"),this.innerHTML=v.get(t).author===b.get("_id")?m.get("youcommentedlbl"):m.get("twocentcommentlbl")))},setVisible:function(e){e&&(e===b.get("_id")?this.setAttribute("style","display: block;"):this.setAttribute("style","display: none;"))},setInVisible:function(e){e&&(e===b.get("_id")?this.setAttribute("style","display: none;"):this.setAttribute("style","display: block;"))},deleteOK:function(e){var t;e&&e.length>0?this.setAttribute("style","display: none;"):(t=this.getAttribute("data-twocents_id"),b.get("_id")===v.get(t).author?this.setAttribute("style","display: block;"):this.setAttribute("style","display: none;"))},toggleHideButton:function(e){e&&e.length?(this.classList.remove("invisible"),this.innerHTML=1===e.length?t.get("labels").get("showonetcreply"):t.get("labels").get("showtcrepliesbefore")+e.length+t.get("labels").get("showtcrepliesafter")):this.classList.add("invisible")},displayReplies:function(e){var t,i,n;e&&e.length?(t=this.getAttribute("data-twocents_id"),i=new l(e,p,t,w),n=document.createDocumentFragment(),i.render(),i.place(n),this.hasChildNodes()?this.replaceChild(n,this.firstChild):this.appendChild(n),this.classList.remove("invisible")):this.classList.add("invisible")},setAvatar:function(e){var t,i;e&&(t=document.createDocumentFragment(),i=new u([e]),i.place(t),this.hasChildNodes()?this.replaceChild(t,this.firstChild):this.appendChild(t))}}),twocentevent:new r(g)}),g.template='<ul class="twocentList" data-twocents="foreach"><li class="twocent"><div class="twocentHeader"><div class="twocentAvatar" data-twocents="bind: setAvatar, author"></div><div class="twocentAuthor"data-twocents="bind: setFirstName, firstname"></div><span class="commentLabel" data-twocents="bind: setCommentlbl, firstname"></span><br/><div class="twocentDate date" data-twocents="bind: date, date"></div><div class="twocentMenu"><div class="twocentButton twocentEditButton" data-twocents="bind: setVisible, author" data-twocentevent="listen: mousedown, edit"></div><div class="twocentButton twocentDeleteButton" data-twocents="bind: deleteOK, replies" data-twocentevent="listen: mousedown, deleteTwocent"></div><div class="twocentButton twocentReplyButton" data-twocents="bind: setInVisible, author" data-twocentevent="listen: mousedown, reply"></div></div></div><div class="twocentBody"><p class="twocentMessage" data-twocents="bind: innerHTML, message"></p><div class="repliesButton hideReplies" name="hide" data-twocents="bind: toggleHideButton, replies" data-twocentevent="listen: mousedown, toggleReplies" data-labels="bind:innerHTML, hidetwocentreplies"></div></div><div class="writePublicTwocentReply invisible"></div><div class="displayReplies" data-twocents="bind: displayReplies, replies"></div></li></ul>',g.edit=function(e,t){var i=t.getAttribute("data-twocents_id"),n=g.dom.children[i],s=new c,a=document.createDocumentFragment(),o=function(){g.dom.replaceChild(n,s.dom)};s.reset(p,v.get(i),i,o),s.render(),s.place(a),g.dom.replaceChild(a,n)},g.reset=function(e){var i=new s;return p=e,v.reset([]),h.unsync(),h.reset({}),h.sync(t.get("db"),p).then(function(){var e=h.get("twocents")||[];e.length&&v.reset(h.get("twocents")),h.watchValue("twocents",function(e){v.reset(e)}),i.fulfill()},function(e){console.log(e)}),i},g.deleteTwocent=function(e,i){var n=i.getAttribute("data-twocents_id"),s={docId:p,type:"delete",position:n,twocent:{author:b.get("_id")}};alert("Are you sure?"),f.request("WriteTwocent",s,function(e){"ok"!==e&&alert(t.get("labels").get("somethingwrong"))})},g.reply=function(e,t){var i=t.getAttribute("data-twocents_id"),n=g.dom.querySelector(".writePublicTwocentReply[data-twocents_id='"+i+"']"),s=new d(n),a=document.createDocumentFragment();s.reset(p,i),s.render(),s.place(a),n.hasChildNodes()||n.appendChild(a),n.classList.remove("invisible")},g.toggleReplies=function(e,t){var i=t.getAttribute("data-twocents_id"),n=(v.get(i).replies,t.getAttribute("name")),s=g.dom.querySelector(".displayReplies[data-twocents_id='"+i+"']");"show"===n?(s.classList.remove("invisible"),t.setAttribute("name","hide"),t.classList.remove("showReplies"),t.classList.add("hideReplies")):(s.classList.add("invisible"),t.setAttribute("name","show"),t.classList.remove("hideReplies"),t.classList.add("showReplies"))}}return function(t){return p.prototype=new e,new p(t)}}),define("service/confirm",["OObject","service/map","Bind.plugin","Event.plugin","service/config","Store"],function(e,t,i,n,s,a){function o(e,o,r,l){var c=s.get("labels"),d=this,u=new a({question:o}),p=r;d.plugins.addAll({label:new i(c),confirm:new i(u),confirmevent:new n(this)}),d.template='<div class = "confirm"><div class="help-doctor"></div><p class="confirm-question" data-confirm="bind:innerHTML,question"></p><div class="option left" data-confirmevent="listen:mousedown, press; listen:mouseup, ok" data-label="bind: innerHTML, continuelbl">Continue</div><div class="option right" data-confirmevent="listen:mousedown, press; listen:mouseup, cancel" data-label="bind:innerHTML, cancellbl">Cancel</div></div>',d.press=function(e,t){e.stopPropagation(),t.classList.add("pressed")},d.ok=function(e,i){i.classList.remove("pressed"),t.get("cache").classList.remove("appear"),"EULA"===l&&t.get("cache").classList.remove("EULA"),p&&p(!0)},d.cancel=function(e,i){i&&i.classList.remove("pressed"),t.get("cache").classList.remove("appear"),"EULA"===l&&t.get("cache").classList.remove("EULA"),p&&p(!1)},d.close=function(){t.get("cache").classList.remove("appear"),"EULA"===l&&t.get("cache").classList.remove("EULA"),e&&e.removeChild(e.lastChild)},d.hide=function(){t.get("cache").classList.remove("appear"),"EULA"===l&&t.get("cache").classList.remove("EULA"),d.dom.classList.add("invisible")},d.show=function(){t.get("cache").classList.add("appear"),"EULA"===l&&(t.get("cache").classList.add("EULA"),d.dom.querySelector(".option.left").innerHTML=c.get("accept"),d.dom.querySelector(".option.right").innerHTML=c.get("reject")),d.dom.classList.remove("invisible")},d.reset=function(e,t){u.set("question",e),p=t},d.render(),e&&d.place(e),l&&d.dom.classList.add(l),o?u.set("question",o):d.hide(),setTimeout(function(){d.close},15e3)}return function(t,i,n,s){return o.prototype=new e,new o(t,i,n,s)}}),define("attach/attachment",["OObject","service/config","Store","CouchDBDocument","Bind.plugin","Event.plugin","twocents/writetwocent","twocents/twocentlist","Place.plugin","service/utils","service/confirm","Promise","lib/spin.min"],function(e,t,n,s,a,o,r,c,d,u,p,g){function h(){var e,h,m=this,v=new c("attach"),f=new r("attach"),b=new s,w=new n,y=new n({status:null}),L=t.get("labels"),k=t.get("transport"),S=t.get("user"),T=t.get("cat"),M=new n([{active:!1},{active:!1},{active:!1},{active:!1},{active:!1}]),A=!1;b.setTransport(k),m.plugins.addAll({labels:new a(L),attach:new a(b,{setCat:function(e){var i=t.get("catColors"),n=T.indexOf(e);n>-1?(this.innerHTML=L.get(e),this.setAttribute("style","color:"+i[n])):(this.innerHTML=e,this.setAttribute("sytle","color: #404040"))},setDescription:function(e){e&&"\n"!==e?(this.classList.remove("invisible"),this.innerHTML=e.replace(/\n/g,"<br>")):this.classList.add("invisible")},displayTwocentList:function(e){e&&e.length?this.classList.remove("invisible"):this.classList.add("invisible")},setDate:function(e){var t=parseInt(e.replace("A:",""),10);this.innerHTML=u.formatDateStamp(t)},setAuthors:function(e){var t="";if(e&&e instanceof Array&&e.length){for(i=0,l=e.length;l>i;i++)t+=i===l-1?e[i]:e[i]+", ";this.innerHTML=t}else this.innerHTML=e},showVoting:function(e){var t=S.get("rated_a")||[],i=b.get("authors");i.indexOf(S.get("_id"))>-1?this.classList.add("invisible"):t.indexOf(e)>-1?this.classList.add("invisible"):this.classList.remove("invisible")},showRating:function(e){var t=m.dom.querySelector(".a-vote");this.classList.add("invisible"),e&&e.length&&t.classList.contains("invisible")&&this.classList.remove("invisible")},displayRating:function(e){e&&e.length&&(this.innerHTML=Math.round(100*(e.reduce(function(e,t){return e+t})/e.length))/100)},displayNbVotes:function(e){this.innerHTML=e?0===e.length?"("+L.get("novotesyet")+")":1===e.length?"("+L.get("onevote")+")":"("+e.length+" "+L.get("votes")+")":""},setRef:function(e){var i,n=t.get("location")+"/downloads";b.get("docId").search("I:")>-1&&(i="idea"),e&&(n+="?atype="+i+"&docid="+b.get("docId")+"&file="+e,this.setAttribute("href",n))},showWriteTwocent:function(e){length?this.classList.add("invisible"):this.classList.remove("invisible")},displayEdit:function(e){e.indexOf(S.get("_id"))>-1?this.setAttribute("style","display:inline-block;"):this.setAttribute("style","display:none;")},displayDelete:function(e){e&&e.length?this.setAttribute("style","display:none;"):b.get("authors").indexOf(S.get("_id"))<0?this.setAttribute("style","display:none;"):this.setAttribute("style","display:inline-block;")}}),edit:new a(w,{show:function(e){e&&m.dom.classList.contains("edit-a")?this.setAttribute("style","display:inline-block;"):this.setAttribute("style","display:none;")},setSelectCat:function(e){var t,i,n,s=S.get("categories")||[],a=null,o=this,r="<option selected disabled style='display:none;'>"+L.get("choosecat")+"</option>";for([1,2,3,4,5,6].forEach(function(e){o.classList.remove("acolor"+e),o.classList.add("acolor")}),t=0,i=T.length;i>t;t++)n=T[t],r+="<option>"+L.get(n)+"</option>",e===n&&(a=t+1,o.classList.add("acolor"+a));if(s.length)for(t=0,i=s.length;i>t;t++)r+="<option>"+s[t]+"</option>",e===s[t]&&(a=T.length+t+1);r+="<option>"+L.get("other")+"</option>",this.innerHTML=r,this.selectedIndex=a||0}}),progress:new a(y,{showStatus:function(e){e?this.setAttribute("value",e):this.setAttribute("value",0)},showVal:function(e){this.innerHTML=e?e+"%":""}}),vote:new a(M,{setIcon:function(e){var t="background-image: url('img/public/activeIdeaVote.png');",i="background-image: url('img/public/rateForList.png');";e?this.setAttribute("style",t):this.setAttribute("style",i)}}),place:new d({LibraryTwocentUI:v}),attachevent:new o(m)}),m.template='<div class = "attachment-screen invisible"><div class="close-popup" data-attachevent = "listen:mousedown, close"></div><div class="attach-header" data-attach="bind:innerHTML, name"></div><div class="attach-details"><div class="attach-body"><div class="a-type" data-attach="bind:setType, type"></div><div class="a-type-edit" data-attachevent="listen:mousedown, press"><input type="file" class="a-input" data-attachevent="listen:mousedown, check;listen:change, uploadFile"></div><div class="a-left"><div class="a-name" data-attach="bind:innerHTML, name" data-edit="bind:innerHTML, name" data-attachevent="listen:input, updateName"></div><div class="a-contrib"><span class="a-span" data-labels="bind: innerHTML, contrib"></span><span class="a-author" data-attach="bind: setAuthors, authornames"></span></div><div class="a-date" data-attach="bind:setDate, _id"></div></div><div class="a-cat"><span data-attach="bind:setCat, category"></span><select class="acolor invisible" data-edit="bind:setSelectCat, category" data-attachevent="listen: change, selectCat"></select><input maxlength=18 type="text" placeholder="Enter category" class="input custom-cat invisible" data-edit="bind:show, custom" data-attachevent="listen:input, setCat"></div><div class="a-rating invisible" data-attach="bind:showRating, votes"><a class="item-acorn"></a><span data-attach="bind:displayRating, votes"></span><span class="votes" data-attach="bind:displayNbVotes, votes"></span></div><div class="a-preview invisible"><div class="a-content" data-edit="bind:innerHTML, fileName"></div><progress class="uploadbar" data-progress="bind:showStatus, status" max=100></progress><div class="uploadval" data-progress="bind:showVal, status"></div></div><div class="a-vote" data-attach="bind:showVoting, _id"><legend data-labels="bind:innerHTML, rateit"></legend><ul class="acorns" data-vote="foreach"><li class="item-acorn" data-vote="bind: setIcon, active" data-attachevent="listen: mousedown, previewVote; listen: mouseup, castVote"></li></ul></div></div><ul class="actionbtn"><li><a class="attach-download" data-attach="bind: setRef, fileName" data-attachevent="listen:mousedown, press; listen:mouseup, download"></a></li><li><div class="a-2cent" data-attachevent="listen:mousedown, press; listen:mouseup, displayWriteTwocent"></div></li><li data-attach="bind:displayEdit, authors"><div class="a-edit" data-attachevent="listen:mousedown, press; listen:mouseup, edit"></div></li><li data-attach="bind:displayDelete, twocents"><div class="a-delete" data-attachevent="listen:mousedown, press; listen:mouseup, confirmDelete"></div></li><li class="a-publish invisible"><div class="sendmail" data-labels="bind: innerHTML, publishlbl" data-attachevent="listen:mousedown, press; listen: mouseup, update"></div></li><li class="a-cancel invisible"><div class="cancelmail" data-labels="bind: innerHTML, cancellbl" data-attachevent="listen: mousedown, press; listen: mouseup, cancel">Cancel</div></li></ul><p class="a-desc invisible" data-attach="bind: setDescription, description" data-attachevent="listen:input, updateDesc"></p><div class="attach-preview invisible"></div><div id="attach-writetwocents" data-attach="bind:showWriteTwocent, twocents"></div><div div id="attach-twocents" class="twocents" data-attach="bind:displayTwocentList, twocents" data-place="place:LibraryTwocentUI"></div></div></div>',m.reset=function(e){var i=m.dom.querySelector("#attach-writetwocents");f.reset(e),v.reset(e),A=!1,m.dom.classList.remove("invisible"),f.place(i),h||(h=new p(m.dom,L.get("deleteattachment"),m.deleteAttachment,"a-delconfirm"),h.hide()),b.unsync(),b.reset({}),b.sync(t.get("db"),e).then(function(){b.get("authors").indexOf(S.get("_id"))>-1&&m.resetEdit()
},function(e){console.log(e)})},m.resetEdit=function(){w.reset({}),w.set("type",b.get("type")),w.set("name",b.get("name")),w.set("authors",b.get("authors").concat()),w.set("authornames",b.get("authornames")),w.set("fileName",b.get("fileName")),w.set("category",b.get("category")),w.set("custom",b.get("custom")),w.set("description",b.get("description")||L.get("attachdescplaceholder"))},m.close=function(){m.dom.classList.contains("edit-a")&&m.dom.classList.remove("edit-a"),m.dom.classList.add("invisible"),document.querySelector(".cache").classList.remove("appear")},m.previewVote=function(e,t){var i=t.getAttribute("data-vote_id");M.loop(function(e,t){i>=t?M.update(t,"active",!0):M.update(t,"active",!1)})},m.castVote=function(e,i){var n=parseInt(i.getAttribute("data-vote_id"))+1,s=b.get("_id"),a={id:s,vote:n,voter:S.get("_id")};A||(A=!0,k.request("Vote",a,function(e){var i=S.get("rated_a")||[];"ok"!==e?(console.log(e,"something went wrong, please try again later"),A=!1):(i.unshift(s),S.set("rated_a",i),alert(t.get("labels").get("thankyou")),m.dom.querySelector(".a-vote").classList.add("invisible"),m.dom.querySelector(".a-rating").classList.remove("invisible"),M.reset([{active:!1},{active:!1},{active:!1},{active:!1},{active:!1}]))}))},m.press=function(e,t){t.classList.contains("a-type")?m.dom.classList.contains("edit-a")&&t.classList.add("a-pressed"):t.classList.add("a-pressed")},m.download=function(e,t){t.classList.remove("a-pressed")},m.displayWriteTwocent=function(e,t){m.dom.querySelector("#attach-writetwocents").classList.remove("invisible"),t.classList.remove("a-pressed")},m.edit=function(e,t){var i=m.dom.querySelector(".a-name"),n=m.dom.querySelector(".a-desc");t.classList.remove("a-pressed"),m.dom.classList.add("edit-a"),i.setAttribute("contentEditable",!0),n.setAttribute("contentEditable",!0),b.get("description")||(n.classList.remove("invisible"),n.innerHTML=w.get("description"))},m.updateName=function(e,t){w.set("name",t.innerHTML)},m.updateDesc=function(e,t){w.set("description",t.innerText)},m.selectCat=function(e,t){if(t.value===t.lastChild.innerHTML){for(w.set("custom",!0),i=1,l=T.length;l>=i;i++)t.classList.remove("acolor"+i);t.classList.add("acolor")}else for(t.classList.remove("acolor"),w.set("custom",!1),w.set("category",T[t.selectedIndex-1]),i=1,l=T.length;l>=i;i++)t.selectedIndex===i?t.classList.add("acolor"+i):t.classList.remove("acolor"+i)},m.setCat=function(e,t){w.set("category",t.value)},m.check=function(e,t){t.classList.remove("a-pressed")},m.uploadFile=function(t,i){var n,s=new FileReader,a=new FormData,o=b.get("docId"),r="/upload",l="afile",c="";o.search("I:")>-1&&(n="ideas/"+o),i.files&&i.files.length&&(c=i.files[0].name,m.dom.querySelector(".a-preview").classList.remove("invisible"),w.set("fileName",c),w.get("name")||w.set("name",c),s.onloadend=function(){a.append("type",l),a.append("dir",n),a.append("userfile",i.files[0]),a.append("filename",c),e=u.uploadFile(r,a,y,function(e){return e})},s.readAsArrayBuffer(i.files[0]))},m.checkUpdate=function(){var e=!1;return(w.get("name")!==b.get("name")||w.get("description")!==b.get("description")||w.get("fileName")!==b.get("fileName")||w.get("category")!==b.get("category")||w.get("authors").join()!==b.get("authors").join())&&(e=!0),e},m.update=function(e,t){t.classList.remove("a-pressed"),m.checkUpdate()?(b.get("fileName")!==w.get("fileName")&&m.deleteAttachmentFile(b.get("fileName")),b.set("name",w.get("name")),b.set("description",w.get("description")),b.set("fileName",w.get("fileName")),b.set("category",w.get("category")),b.set("custom",w.get("custom")),b.set("authors",w.get("authors")),b.set("authornames",w.get("authornames")),m.dom.classList.remove("edit-a"),m.dom.querySelector(".a-name").setAttribute("contentEditable",!1),m.dom.querySelector(".a-desc").setAttribute("contentEditable",!1),m.dom.querySelector(".a-preview").classList.add("invisible"),m.resetEdit(),b.upload().then(function(){return m.updateParentDoc(b.get("docId"))})):m.cancel()},m.cancel=function(t,i){i&&i.classList.remove("a-pressed"),e&&4!==e.readyState&&(e.abort(),y.reset({status:""})),w.get("fileName")!==b.get("fileName")&&m.deleteAttachmentFile(w.get("fileName")),m.dom.querySelector(".a-name").setAttribute("contentEditable",!1),m.dom.querySelector(".a-desc").setAttribute("contentEditable",!1),m.dom.querySelector(".a-preview").classList.add("invisible"),m.dom.classList.remove("edit-a"),m.resetEdit()},m.confirmDelete=function(e,t){t.classList.remove("a-pressed"),h.reset(L.get("deleteattachment"),m.deleteAttachment),h.show()},m.deleteAttachmentFile=function(e){return u.deleteAttachmentFile(b.get("docId"),e)},m.deleteAttachment=function(e){var i=b.get("docId"),n=b.get("_id"),a=b.get("fileName"),o=new s;e?(o.setTransport(k),o.sync(t.get("db"),i).then(function(){var e,t=o.get("attachments").concat()||[],i=t.length,s=null,a=new g;for(e=0;i>e;e++)if(t[e].docId===n){s=e;break}return null===s?a.reject("error: attachment not found"):(t.splice(s,1),o.set("attachments",t),o.upload().then(function(){a.fulfill()})),a}).then(function(){return console.log("before calling remove"),b.remove()}).then(function(){return m.close(),u.deleteAttachmentFile(i,a)})):h.hide()},m.updateParentDoc=function(e){var i=new g,n=new s;return n.setTransport(k),n.sync(t.get("db"),e).then(function(){var e,t,i=n.get("attachments").concat(),s=i.length;for(t=0;s>t;t++)if(i[t].docId===b.get("_id")){e=t;break}return i.splice(e,1,{docId:b.get("_id"),type:b.get("type"),category:b.get("category"),name:b.get("name"),fileName:b.get("fileName"),authornames:b.get("authornames")}),n.set("attachments",i),n.upload()}).then(function(){i.fulfill()}),i}}return function(t){return h.prototype=new e,new h(t)}}),define("public/detail-stack/public-idea",["OObject","Store","Bind.plugin","Event.plugin","service/map","service/utils","service/avatar","service/config","twocents/writetwocent","twocents/twocentlist","Observable","Promise","CouchDBDocument","Place.plugin","lib/spin.min","attach/attachment"],function(e,t,i,n,s,a,o,r,l,c,d,u,p,g,h,m){return function(v){var f,b=new e,w=new m("idea"),y=new l,L=new c("public"),k=r.get("labels"),S=new t([{active:!1},{active:!1},{active:!1},{active:!1},{active:!1}]),T=!1,M=r.get("user"),A=r.get("transport"),C=new p,x=new t([]),q=s.get("public-detail");return new d,C.setTransport(A),b.plugins.addAll({label:new i(k),publicdetail:new i(C,{toggleFavEdit:function(e){var t=this;e.indexOf(M.get("_id"))>-1?t.setAttribute("href","#public-edit"):(t.setAttribute("href","#public-favorites"),M.get("public-favorites")&&M.get("public-favorites").indexOf(C.get("_id"))>-1?t.classList.add("unfav"):t.classList.remove("unfav"),M.watchValue("public-favorites",function(e){e.indexOf(C.get("_id"))>-1?t.classList.add("unfav"):t.classList.remove("unfav")}))},toggleTwocentShare:function(e){e.indexOf(M.get("_id"))>-1?this.setAttribute("href","#public-share"):this.setAttribute("href","#public-2cents")},displayWriteTwocent:function(e){e.indexOf(M.get("_id"))<0?this.classList.remove("invisible"):this.classList.add("invisible")},displayTwocentList:function(e){e&&e.length&&document.getElementById("public-writetwocents").classList.add("invisible")},date:function H(H){H&&(this.innerHTML=a.formatDate(H))},setAuthor:function(e){this.innerHTML=e===M.get("username")&&C.get("authors").indexOf(M.get("_id"))>-1?k.get("youlbl"):e},setWrotelbl:function(e){this.innerHTML=1===e.length&&e[0]===M.get("_id")?k.get("youwrotelbl"):e.length>1?k.get("theywrotelbl"):k.get("ideawrotelbl")},setAvatar:function(e){var t=document.createDocumentFragment(),i=new o(e);i.place(t),this.hasChildNodes()?this.replaceChild(t,this.firstChild):this.appendChild(t)},setRating:function(e){this.innerHTML=0===e.length?"":Math.round(100*(e.reduce(function(e,t){return e+t})/e.length))/100},setDescription:function(e){this.innerHTML=e.replace(/\n/g,"<br>")},setSolution:function(e){this.innerHTML=e.replace(/\n/g,"<br>")},toggleVoteButton:function(e){var t=C.get("_id"),i=C.get("authors");document.getElementById("ratingPopup").classList.remove("appear"),M.get("rated_ideas").indexOf(t)<0&&i.indexOf(M.get("_id"))<0&&!T?(this.setAttribute("name","vote"),this.innerHTML=k.get("votebuttonlbl"),this.classList.remove("votes"),this.classList.add("publicButton")):(T=!0,this.classList.remove("publicButton"),this.setAttribute("name","voted"),this.innerHTML=0===e.length?"("+k.get("novotesyet")+")":1===e.length?"("+k.get("onevote")+")":"("+e.length+" "+k.get("votes")+")",this.classList.add("votes"))},showAttachments:function(e){e&&e.length?this.classList.remove("invisible"):this.classList.add("invisible")}}),alist:new i(x,{setCat:function(e){var t=r.get("cat"),i=r.get("catColors"),n=t.indexOf(e);n>-1?(this.innerHTML=k.get(e),this.setAttribute("style","color:"+i[n])):(this.innerHTML=e,this.setAttribute("sytle","color: #404040"))},setType:function(e){switch(e){default:this.setAttribute("style","background-image: url(../img/r2/download.png)")}},setRef:function(e){var t=r.get("location")+"/downloads";this.getAttribute("data-alist_id"),e&&(t+="?atype=idea&docid="+C.get("_id")+"&file="+e,this.setAttribute("href",t))},setRating:function(e){var t,i=this;e&&(t=new p,t.setTransport(A),t.sync(r.get("db"),e).then(function(){var e=t.get("votes")||[],n=e.length;0===n?(i.innerHTML="",i.parentNode.setAttribute("style","display: none;")):(i.innerHTML=Math.round(100*(e.reduce(function(e,t){return e+t})/n))/100,i.parentNode.setAttribute("style","display: inline-block;"))}))}}),vote:new i(S,{setIcon:function(e){var t="background-image: url('img/public/activeIdeaVote.png');",i="background-image: url('img/public/rateForList.png');";e?this.setAttribute("style",t):this.setAttribute("style",i)}}),place:new g({PublicTwocentUI:L,AttachmentUI:w}),publicdetailevent:new n(b)}),b.template='<div class="public-idea"><div class="header blue-dark"><a href="#public-2cents" data-publicdetail="bind: toggleTwocentShare, authors" data-publicdetailevent="listen: mousedown, action" class="option left"></a><span data-label="bind: innerHTML, publicdetailsheadertitle"></span><a href="#public-favorites" data-publicdetail="bind: toggleFavEdit, authors" data-publicdetailevent="listen: mousedown, action" class="option right"></a></div><div id="idea-cache"></div><div class = "detail-contents"><div class="detail-header"><div class="avatar" data-publicdetail="bind:setAvatar, authors"></div><h2 data-publicdetail="bind:innerHTML,title"></h2><span class="date" data-publicdetail="bind:date, creation_date"></span><br><span class="author" data-publicdetail="bind:setAuthor,authornames"></span><span class="commentlbl" data-publicdetail="bind: setWrotelbl, authors"></span></div><div class="detail-body"><legend class="idealegend" data-label="bind:innerHTML, principle"></legend><p data-publicdetail="bind:setDescription,description"></p><legend class="idealegend" data-label="bind:innerHTML, solution"></legend><p data-publicdetail="bind:setSolution,solution"></p><div class="attachments invisible" data-publicdetail="bind:showAttachments, attachments"><legend class="idealegend" data-label="bind:innerHTML, attachments"></legend><div class="toggleattach" data-publicdetailevent="listen: mousedown, toggleAttachments"></div><ul class="a-list" data-alist="foreach"><li><a class="a-type" data-alist="bind:setType, type; bind: setRef, fileName" data-publicdetailevent="listen: mousedown, press; listen: mouseup, release"></a><label class="a-name" data-alist="bind:innerHTML, name">Name</label><label class="a-cat" data-alist="bind:setCat, category"></label><div class="a-rating"><a class="item-acorn"></a><label class="rating" data-alist="bind:setRating,docId"></label></div><label class="a-zoom" data-publicdetailevent="listen: mousedown, press; listen: mouseup, release; listen:mouseup, zoom"></label></li></ul></div></div><div class="detail-footer"><div class ="rateIdea"><a class="item-acorn"></a><div class="rating" data-publicdetail="bind:setRating,votes"></div><div class="publicButton" data-publicdetail="bind:toggleVoteButton, votes" name="vote" data-publicdetailevent="listen: mousedown, press; listen: mouseup, vote;" data-label="bind: innerHTML, votebuttonlbl"></div><div id="ratingPopup" class="popup"><ul class="acorns" data-vote="foreach"><li class="item-acorn" data-vote="bind: setIcon, active" data-publicdetailevent="listen: mousedown, previewVote; listen: mouseup, castVote"></li></ul></div></div></div></div><div id="public-writetwocents" class="invisible" data-publicdetail="bind: displayWriteTwocent, authors"></div><div id="public-twocents" class="twocents" data-publicdetail="bind: displayTwocentList, twocents" data-place="place: PublicTwocentUI"></div><div data-place="place: AttachmentUI"></div></div>',b.showCache=function(){b.dom.querySelector("#idea-cache").classList.remove("invisible")},b.hideCache=function(){b.dom.querySelector("#idea-cache").classList.add("invisible")},b.reset=function(e,t){var i=e.get(t).id,n=new u;return S.reset([{active:!1},{active:!1},{active:!1},{active:!1},{active:!1}]),b.getIdea(i).then(function(){C.get("attachments")?x.reset(C.get("attachments")):x.reset([]),C.watchValue("attachments",function(e){x.reset(e)}),T=!1,y.reset(C.get("_id")),L.reset(C.get("_id")),f=document.getElementById("public-writetwocents"),y.place(f),n.fulfill()}),n},b.getIdea=function(e){return C.unsync(),C.reset(),C.sync(r.get("db"),e)},b.refresh=function(){return b.getIdea(C.get("_id"))},b.action=function(e,t){var i,n,s=t.getAttribute("href"),a=C.get("_id"),o=new h({color:"#FFFFFF",lines:8,length:6,width:3,radius:6,left:3,top:3});switch(s){case"#public-2cents":y.reset(a),f.classList.remove("invisible");break;case"#public-favorites":t.classList.add("favwait"),o.spin(t),i=M.get("public-favorites")?M.get("public-favorites").concat():[],n=i.indexOf(a),n>-1?i.splice(n,1):i.push(a),i.length<100||i.length<M.get("public-favorites").length?(M.unsync(),M.sync(r.get("db"),M.get("_id")).then(function(){return M.set("public-favorites",i),M.upload()}).then(function(){o.stop(),t.classList.remove("favwait"),n>-1?(alert(k.get("removedfav")),t.classList.remove("unfav")):(alert(k.get("addedfav")),t.classList.add("unfav"))})):(alert(k.get("maxfavsize")),o.stop(),t.classList.remove("favwait"));break;default:v(s)}},b.edit=function(){_stack.getStack().show("#public-edit")},b.press=function(e,t){t.classList.add("pressed")},b.release=function(e,t){t.classList.remove("pressed")},b.toggleAttachments=function(e,t){var i=b.dom.querySelector(".a-list");t.classList.contains("show")?(i.classList.remove("invisible"),t.classList.remove("show")):(i.classList.add("invisible"),t.classList.add("show"))},b.zoom=function(e,t){var i=t.getAttribute("data-alist_id");w.reset(x.get(i).docId),document.querySelector(".cache").classList.add("appear")},b.vote=function(e,t){T||(document.getElementById("cache").classList.add("appear1"),document.getElementById("ratingPopup").classList.add("appear")),t.classList.remove("pressed")},b.previewVote=function(e,t){var i=t.getAttribute("data-vote_id");S.loop(function(e,t){i>=t?S.update(t,"active",!0):S.update(t,"active",!1)})},b.castVote=function(e,t){var i=parseInt(t.getAttribute("data-vote_id"))+1,n=C.get("_id"),s={id:n,vote:i,voter:M.get("_id")};T||(T=!0,A.request("Vote",s,function(e){var t=M.get("rated_ideas")||[];"ok"!==e?(console.log(e,"something went wrong, please try again later"),T=!1):(t.unshift(n),M.set("rated_ideas",t),alert(r.get("labels").get("thankyou")),r.get("observer").notify("update-polling"),document.getElementById("cache").classList.remove("appear1"),document.getElementById("ratingPopup").classList.remove("appear"),S.reset([{active:!1},{active:!1},{active:!1},{active:!1},{active:!1}]))}))},b.place(q),b}}),define("attach/add",["OObject","service/config","Store","CouchDBDocument","Bind.plugin","Event.plugin","service/utils","Promise","lib/spin.min"],function(e,t,n,s,a,o,r,c,d){function u(){var e,c,u,p,g=this,h=t.get("transport"),m=t.get("user"),v=t.get("cat"),f=t.get("labels"),b=new s({custom:!1,category:"",name:"",description:"",type:"",fileName:"",authors:[m.get("_id")],authornames:m.get("username"),docId:"",rating:null,votes:[],twocents:[],uploaded:!1}),w=new n({status:null}),y=new d({color:"#657b99",lines:8,length:6,width:3,radius:6,top:-2,left:-2}).spin();b.setTransport(h),g.plugins.addAll({labels:new a(f),attach:new a(b,{show:function(e){e?this.setAttribute("style","display:inline-block;"):this.setAttribute("style","display:none;")},setContent:function(e){var t=this;switch(e){case"file":t.innerHTML=b.get("fileName");break;default:t.innerHTML=b.get("name")}},setName:function(e){this.value=e},resetCat:function(e){var t=this;""===e&&(t.selectedIndex=0,[1,2,3,4,5,6].forEach(function(e){t.classList.remove("acolor"+e),t.classList.add("acolor")}))},setAttachmentCat:function(e){if(!e){var t,i,n,s=[],a="<option selected disabled style='display:none;'>"+f.get("choosecat")+"</option>";for(m.get("categories")&&(s=m.get("categories")),t=0,i=v.length;i>t;t++)n=v[t],a+="<option>"+f.get(n)+"</option>";if(s.length)for(t=0,i=s.length;i>t;t++)a+="<option>"+s[t]+"</option>";a+="<option>"+f.get("other")+"</option>",this.innerHTML=a}}}),progress:new a(w,{showStatus:function(e){e?this.setAttribute("value",e):this.setAttribute("value",0)},showVal:function(e){this.innerHTML=e?e+"%":""}}),addevent:new o(g)}),g.template='<div class="add-attachments"><select class="acolor" data-attach="bind:setAttachmentCat, uploaded; bind:resetCat, category" data-addevent="listen: change, selectCat"></select><input maxlength=18 type="text" placeholder="Enter category" class="input custom-cat" data-attach="bind:show, custom" data-addevent="listen:input, setCat"><input maxlength=36 type="text" placeholder="Enter name" class="input a-name" data-attach="bind:setName, name" data-addevent="listen: input, setName"><ul class="a-tools" data-attach="bind:show, category"><li class="toolbox-button"><div class="upload-button" name="upload" data-addevent="listen:mousedown, press; listen:mouseup, release"><input type="file" class="a-input" data-addevent="listen:change, uploadFile"></div><legend data-labels="bind:innerHTML, filelbl"></legend></li><li class="toolbox-button" style="display:none"><div class="importpic-button" name="import" data-addevent="listen:mousedown, press"></div><legend data-labels="bind:innerHTML, imagelbl"></legend></li><li class="toolbox-button" style="display:none"><div class="drawingtool-button" name="drawing" data-addevent="listen:mousedown, press"></div><legend data-labels="bind:innerHTML, drawinglbl">Drawing</legend></li></ul><div class="a-preview invisible"><div class="a-content" data-attach="bind:setContent, type"></div><progress class="uploadbar" data-progress="bind:showStatus, status" max=100></progress><div class="uploadval" data-progress="bind:showVal, status"></div></div><div class="a-button a-confirm" data-attach="bind:show, uploaded" data-addevent="listen:mousedown, press; listen: mousedown, aconfirm; listen:mouseup, release">&#10003</div><div class="a-button a-cancel" data-attach="bind:show, uploaded" data-addevent="listen:mousedown, press; listen:mousedown, acancel">&#10007</div><textarea class="a-desc input" data-labels="bind:placeholder, attachdescplaceholder" data-attach="bind: value, description" data-attachevent="listen: input, updateDesc"></textarea></div>',g.reset=function(e,t,i){c=e,u=t,p=i,b.unsync(),b.reset({custom:!1,category:"",name:"",description:"",type:"",fileName:"",authors:[m.get("_id")],authornames:[m.get("username")],docId:c,rating:null,votes:[],twocents:[],uploaded:!1}),g.dom.querySelector(".a-confirm").classList.remove("pressed"),g.dom.querySelector(".a-cancel").classList.remove("pressed"),g.dom.querySelector(".a-preview").classList.add("invisible")},g.show=function(){g.dom.classList.remove("invisible")},g.hide=function(){g.dom.classList.add("invisible")},g.press=function(e,t){t.classList.add("pressed")},g.release=function(e,t){t.classList.remove("pressed")},g.selectCat=function(e,t){if(t.selectedIndex>v.length){if(t.value===t.lastChild.innerHTML)b.set("custom",!0);else{for(b.set("custom",!1),i=1,l=v.length;l>=i;i++)t.classList.remove("acolor"+i);b.set("category",t.value)}t.classList.add("acolor")}else for(t.classList.remove("acolor"),b.set("custom",!1),b.set("category",v[t.selectedIndex-1]),i=1,l=v.length;l>=i;i++)t.selectedIndex===i?t.classList.add("acolor"+i):t.classList.remove("acolor"+i)},g.setCat=function(e,t){b.set("category",t.value)},g.setName=function(e,t){b.set("name",t.value)},g.updateDesc=function(e,t){b.set("description",t.value)},g.check=function(e,t){t.parentNode.classList.remove("pressed")},g.uploadFile=function(e,t){var i,n=new FileReader,s=new FormData,a=new Date,o=c,l="/upload",d="afile",p="";switch(u){case"idea":"new"===o&&(o="I:"+a.getTime()),i="ideas/"+o,c=o;break;default:"new"===o&&(o="I:"+a.getTime()),i="ideas/"+o,c=o}t.files&&t.files.length&&(p=t.files[0].name,g.dom.querySelector(".a-preview").classList.remove("invisible"),b.set("fileName",p),b.set("docId",o),b.get("name")||b.set("name",p),b.set("type","file"),n.onloadend=function(){s.append("type",d),s.append("dir",i),s.append("userfile",t.files[0]),s.append("filename",p),_uploadReq=r.uploadFile(l,s,w,function(){b.set("uploaded",!0)})},n.readAsArrayBuffer(t.files[0]))},g.deleteAttachmentFile=function(e){return r.deleteAttachmentFile(c,e)},g.deleteAttachmentDoc=function(e){return r.deleteAttachmentDoc(e)},g.aconfirm=function(e,i){var n=new Date,s="A:"+n.getTime();b.get("name")&&b.get("category")?(y.spin(i),b.sync(t.get("db"),s).then(function(e){return e&&console.log(e),b.upload()}).then(function(){var e=[];m.get("categories")&&(e=m.get("categories").concat()),p.alter("unshift",{docId:s,type:b.get("type"),category:b.get("category"),name:b.get("name"),fileName:b.get("fileName"),authornames:b.get("authornames")}),b.get("custom")&&-1===e.indexOf(b.get("category"))&&(e.push(b.get("category")),m.set("categories",e),m.upload()),y.stop(),g.reset(c,u,p)})):!b.get("name")},g.acancel=function(){var e=b.get("fileName");g.abortReq(),g.deleteAttachmentFile(e),g.reset(c,u,p)},g.getDocId=function(){return"new"===c?!1:c},g.getFileName=function(){return b.get("fileName")},g.getReq=function(){return e},g.abortReq=function(){e&&4!==e.readyState&&(e.abort(),w.reset({status:""}))}}return function(){return u.prototype=new e,new u}}),define("public/detail-stack/public-edit",["OObject","service/map","Store","CouchDBDocument","Bind.plugin","Event.plugin","service/config","service/confirm","Promise","Place.plugin","attach/attachment","attach/add"],function(e,t,n,s,a,o,r,l,c,d,u,p){return function(g){var h,m=new e,v=new u("idea"),f=new p,b=new s,w=new n(r.get("userLanguages")),y=function(){w.loop(function(e,t){b.get("lang")&&e.name===b.get("lang").substring(0,2)?w.update(t,"selected",!0):w.update(t,"selected",!1)})},L=r.get("labels"),k=new n({error:""}),S=new n([]),T=[],M=[];return b.setTransport(r.get("transport")),m.plugins.addAll({editlabel:new a(L),editidea:new a(b,{displayLang:function(e){var t;e&&(t=e.substring(0,2),this.setAttribute("style","background-image:url('img/flags/"+t+".png');"))},setVisibility:function(e){this.innerHTML="public"===e?L.get("publiclbl"):L.get("privatelbl")},hideVisibility:function(e){"public"===e?this.setAttribute("style","display:none"):this.setAttribute("style","display:inline-block")},setVisibleIcon:function(e){"public"===e?this.setAttribute("style","background:url('img/public/publicForList.png') no-repeat left center; background-size: 14px 12px;"):this.setAttribute("style","background-image:url('img/public/privateForList.png');")},setReplay:function(e){e&&-1===e.search("deleted")?this.setAttribute("style","display:inline-block"):this.setAttribute("style","display:none")},setIdeafyStatus:function(e){this.innerHTML=e?L.get("enabledreplaylbl"):L.get("disabledreplaylbl")},setSessionReplay:function(e){this.innerHTML=e?L.get("disablereplaylbl"):L.get("enablereplaylbl")},showAttachments:function(e){e&&e.length?this.classList.remove("invisible"):this.classList.add("invisible")}}),alist:new a(S,{setCat:function(e){var t=r.get("cat"),i=r.get("catColors"),n=t.indexOf(e);n>-1?(this.innerHTML=L.get(e),this.setAttribute("style","color:"+i[n])):(this.innerHTML=e,this.setAttribute("style","color: #404040"))},setType:function(e){switch(e){default:this.setAttribute("style","background-image: url(../img/r2/download.png)")}},setRef:function(e){var t=r.get("location")+"/downloads";this.getAttribute("data-alist_id"),e&&(t+="?atype=idea&docid="+b.get("_id")+"&file="+e,this.setAttribute("href",t))},setRating:function(e){var t,i=this;e&&(t=new s,t.setTransport(transport),t.sync(r.get("db"),e).then(function(){var e=t.get("votes")||[],n=e.length;i.innerHTML=0===n?"":Math.round(100*(e.reduce(function(e,t){return e+t})/n))/100}))}}),select:new a(w,{setBg:function(e){e&&this.setAttribute("style","background-image:url('img/flags/"+e+".png');")},setSelected:function(e){e?this.classList.add("selected"):this.classList.remove("selected")}}),place:new d({AttachmentUI:v,AddAttachmentUI:f}),editevent:new o(m),errormsg:new a(k,{setError:function(e){switch(e){case"notitle":this.innerHTML=L.get("titlefield")+L.get("emptyfielderror");break;case"nodesc":this.innerHTML=L.get("descriptionfield")+L.get("emptyfielderror");break;case"nosol":this.innerHTML=L.get("solutionfield")+L.get("emptyfielderror");break;default:this.innerHTML=""}}})}),m.template='<div class="idea-edit"><div class="header blue-dark"><span data-editlabel="bind:innerHTML, modifyidealbl">Modify your idea</span></div><form class="form"><div class="idealang"><div class="currentlang" data-editidea="bind: displayLang, lang" data-editevent="listen: mouseup, showLang"></div><ul class="invisible" data-select="foreach"><li data-select="bind: setBg, name; bind: setSelected, selected" data-editevent="listen: mousedown, selectFlag; listen: mouseup, setLang"></li></ul></div><p><input type="text" class="input" data-editidea="bind: value, title"></p><p><textarea class="description input" data-editidea="bind: value, description"></textarea></p><p><textarea class="solution input" data-editidea="bind: value, solution"></textarea></p><div class="options"><div class="current-visibility" data-editidea="bind:setVisibleIcon, visibility"><span class="label" data-editlabel="bind:innerHTML,ideavisiblelbl"></span><span data-editlabel="bind:innerHTML, privatelbl" data-editidea="bind:setVisibility, visibility"></span></div><div class="edit-visibility" data-editidea="bind:hideVisibility, visibility"><span class="label" data-editlabel="bind:innerHTML,setideavisiblelbl"></span><div class="visibility public" data-editlabel="bind:innerHTML, publiclbl" data-editevent="listen:mousedown, editVisibility"></div></div></div><div class="options invisible" data-editidea="bind:setReplay, sessionId"><div class="current-visibility replay"><span class="label" data-editlabel="bind:innerHTML,ideafyreplaylbl"></span><span data-editlabel="bind:innerHTML, disabledreplaylbl" data-editidea="bind:setIdeafyStatus, sessionReplay"></span></div><div class="edit-visibility replay"><span class="label" data-editlabel="bind:innerHTML, ideafysetreplaylbl"></span><div class="toggle-replay" data-editidea = "bind: setSessionReplay, sessionReplay" data-editevent="listen:mousedown, press; listen:mouseup, enableReplay" data-editlabel="bind:innerHTML, enablereplaylbl"></div></div></div><p class="submit"><label class="publish pressed-btn" data-editevent="listen: mousedown, press;listen:mouseup, upload">Publish</label><label class="cancel pressed-btn" data-editevent="listen: mousedown, press;listen:mouseup, cancel">Cancel</label><label class="editerror" data-errormsg="bind:setError, error"></label></p></form><div class="attachments"><legend class="idealegend" data-editlabel="bind:innerHTML, attachments"></legend><div class="toggleattach" data-editevent="listen: mousedown, toggleAttachments"></div><ul class="a-list" data-alist="foreach"><li><a class="a-type" data-alist="bind:setType, type; bind: setRef, fileName" data-editevent="listen: mousedown, press; listen: mouseup, release"></a><label class="a-name" data-alist="bind:innerHTML, name">Name</label><label class="a-cat" data-alist="bind:setCat, category"></label><label class="a-delete" data-editevent="listen:mousedown, press; listen:mouseup, removeAttachment"></label><label class="a-zoom" data-editevent="listen: mousedown, press; listen: mouseup, release; listen:mouseup, zoom"></label></li></ul><legend class="a-legend" data-editlabel="bind:innerHTML, alegend"></legend><div data-place="place: AddAttachmentUI"></div></div><div data-place="place: AttachmentUI"></div></div>',m.place(t.get("public-edit")),m.reset=function(e){b.unsync(),b.reset(),T=[],M=[],b.sync(r.get("db"),e).then(function(){y(),b.get("attachments")?S.reset(b.get("attachments").concat()):S.reset([]),f.reset(e,"idea",S),S.watch("added",function(e,t){T.push(t.docId)})}),h=!1},m.showLang=function(){m.dom.querySelector(".idealang ul").classList.remove("invisible")},m.selectFlag=function(e,t){var i;e.stopPropagation(),i=parseInt(t.getAttribute("data-select_id"),10),w.loop(function(e,t){i===t?w.update(t,"selected",!0):w.update(t,"selected",!1)})},m.setLang=function(e,t){var i;e.stopPropagation(),i=t.getAttribute("data-select_id"),b.set("lang",w.get(i).name),m.dom.querySelector(".idealang ul").classList.add("invisible")},m.editVisibility=function(e,t){var i=new l(t,L.get("setpublicquestion"),function(e){e?b.set("visibility","public"):b.set("visibility","private"),i.close()})},m.press=function(e,t){t.classList.add("pressed")},m.release=function(e,t){t.classList.remove("pressed")},m.toggleAttachments=function(e,t){var i=m.dom.querySelector(".a-list");t.classList.contains("show")?(i.classList.remove("invisible"),t.classList.remove("show")):(i.classList.add("invisible"),t.classList.add("show"))},m.removeAttachment=function(e,t){var i=t.getAttribute("data-alist_id"),n=S.get(i).docId;M.push(n),S.alter("splice",i,1),t.classList.remove("pressed")},m.manageAttachments=function(){var e=T,t=M;t.length&&t.forEach(function(t){var n=-1,s=-1;for(i=0;i<e.length;i++)if(e[i]===t){n=i;break}n>-1&&e.splice(n,1),S.loop(function(e,i){e.docId===t&&(s=i)}),s>-1&&S.alter("splice",s,1),f.deleteAttachmentDoc(t)}),(e.length||t.length)&&b.set("attachments",JSON.parse(S.toJSON()))},m.zoom=function(e,t){var i=t.getAttribute("data-alist_id");v.reset(S.get(i).docId),document.querySelector(".cache").classList.add("appear")},m.enableReplay=function(e,t){setTimeout(function(){b.get("sessionReplay")?b.set("sessionReplay",!1):b.set("sessionReplay",!0),h=!0,t.classList.remove("pressed")},300)},m.updateSessionReplay=function(e){var t=new c,i=new s;return i.setTransport(r.get("transport")),i.sync(r.get("db"),b.get("sessionId")).then(function(){var t,n=i.get("replayIdeas")||[];if(e)n.push(b.get("_id"));else for(t=n.length-1;t>=0;t--)n[t]===b.get("_id")&&n.splice(t,1);return i.set("replayIdeas",n),i.upload()}).then(function(){t.fulfill(),i.unsync()}),t},m.upload=function(e,t){var i=new Date,n=[i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds()];""===b.get("title")?k.set("error","notitle"):""===b.get("description")?k.set("error","nodesc"):""===b.get("solution")?k.set("error","nosol"):(m.manageAttachments(),b.set("modification_date",n),b.upload().then(function(){h&&m.updateSessionReplay(b.get("sessionReplay")).then(null,function(e){console.log(e)}),m.dom.querySelector(".idealang ul").classList.add("invisible"),g("close")})),t.classList.remove("pressed")},m.cancel=function(e,t){t.classList.remove("pressed"),m.dom.querySelector(".idealang ul").classList.add("invisible"),g("close")},m}}),define("public/detail-stack/public-sendmail",["OObject","service/map","service/config","Bind.plugin","Event.plugin","Store","service/avatar","service/utils"],function(e,t,n,s,a,o,r,c){return function(d){var u=new e,p=new o({errormsg:""}),g=n.get("user"),h=n.get("transport"),m=n.get("labels"),v=new o({toField:"",from:"",subject:"",body:"",signature:"",attachment:"",sent:!1});return u.plugins.addAll({labels:new s(m),mail:new s(v,{setUserAvatar:function(e){e&&this.setAttribute("style","background: url('"+n.get("avatar")+"') no-repeat center center; background-size: cover;")
},date:function f(f){f&&(this.innerHTML=c.formatDate(f))},setAvatar:function(e){var t=document.createDocumentFragment(),i=new r(e);i.place(t),this.hasChildNodes()?this.replaceChild(t,this.firstChild):this.appendChild(t)},setRating:function(){},setVotes:function(){}}),mailevent:new a(u),errormsg:new s(p)}),u.template='<div class="idea-sendmail"><div class="header blue-dark"><a href="#public-2cents" class="option left"></a><span data-labels="bind:innerHTML, sendidealbl"></span><a href="#public-favorites" class="option right"></a></div><div class="avatar" data-mail="bind:setUserAvatar, from"></div><form class="form"><p><textarea class="mail-header" data-mail="bind: value, toField" data-labels="bind:placeholder, tolbl"></textarea></p><p><input type="text" class="input" data-mail="bind:value, subject" data-labels="bind:placeholder, subjectlbl"></textarea></p><p><textarea class="input" data-mail="bind:value, body"></textarea></p><p><legend data-labels="bind: innerHTML, signaturelbl"></legend><textarea class="signature" data-mail="bind:value, signature"></textarea></p><div class="attachment"><div class="attachment-header"><div data-mail="bind:setAvatar, attachment.authors"></div><span class="date" data-mail="bind:date, attachment.creation_date"></span><h2 data-mail="bind:innerHTML,attachment.title"></h2><span class="author" data-mail="bind:innerHTML,attachment.authornames"></span><span data-labels="bind:innerHTML, ideawrotelbl"></span><div class="visibility-icon private"></div></div><div class="attachment-body"><p data-mail="bind:innerHTML,attachment.description"></p><p data-mail="bind:innerHTML,attachment.solution"></p><div class = "rating" data-mail="bind:setRating, attachment.rating"></div><div class = "votes" data-mail="bind:setVotes, attachment. votes"></div></div></div><div class="sendmail-footer"><p class="send"><label class="cancelmail" data-labels="bind:innerHTML, cancellbl" data-mailevent="listen: mousedown, press; listen:mouseup, cancel">Cancel</label><label class="sendmail" data-labels="bind:innerHTML, sendlbl" data-mailevent="listen:mousedown, press; listen:mouseup, send">Send</label><label class="editerror" data-errormsg="bind:innerHTML, errormsg"></label></p></div></form></div>',u.place(t.get("public-sendmail")),u.reset=function(e){p.reset({errormsg:""}),v.reset({toField:"",from:g.get("username"),subject:"",body:"",signature:g.get("username")+" <"+g.get("_id"),attachment:e,sent:!1}),g.get("signature")&&v.set("signature",g.get("signature")),json={}},u.validateAddress=function(e){var t=/^[a-z0-9._-]+@[a-z0-9.-]+\.[a-z]{2,4}$/,n=e.toLowerCase().split(/,|;/),s=!0;for(i=0,l=n.length;l>i;i++)if(!t.test(n[i].trim())){p.set("errormsg",n[i]+m.get("notavalidaddress")),s=!1;break}return s},u.validateMessage=function(){return v.get("toField")?u.validateAddress(v.get("toField")):p.set("errormsg",m.get("norecipient")),""===p.get("errormsg")},u.sendMail=function(){json.type="doc",json.recipient=v.get("toField"),json.cc=g.get("_id"),json.replyTo=g.get("_id"),json.subject=g.get("username")+m.get("sentdocmsg"),json.header=v.get("subject"),json.body=v.get("body"),json.signature=v.get("signature"),json.attachHeader="<div style='background:#657B99; font-family:Helvetica; padding:15px;'><p style='color:white;font-size:24px;font-weight:bold;margin-top:10px;'>"+v.get("attachment").title+"</p><p style='color: #F27B3D; font-size:16px; font-weight:bold;margin-bottom:10px;'>"+v.get("attachment").authornames+", <span style='color:black';>"+c.formatDate(v.get("attachment").creation_date)+"</span></p></div>",json.attachBody="<div style='border:1px solid #657b99;background:white'><p style='font-size:14px; font-family:Helvetica; text-align:justify; padding:15px;'>"+v.get("attachment").description+"</p><p style='font-size:14px; font-family:Helvetica; text-align:justify; padding:15px;'>"+v.get("attachment").solution+"</p></div>",h.request("SendMail",json,function(e){"ok"===e.sendmail?(p.set("errormsg",m.get("yourmessage")+e.recipient+m.get("sentoklbl")),setTimeout(function(){d("close")},350)):(p.set("errormsg",m.get("somethingwrong")),v.set("sent",!1),console.log("error",e.error),console.log("response",e.response))})},u.press=function(e,t){t.classList.contains("sendmail")&&v.get("sent")||t.classList.add("pressed")},u.send=function(e,t){v.get("sent")||(v.set("sent",!0),p.set("errormsg",""),t.classList.remove("pressed"),u.validateMessage()?u.sendMail():v.set("sent",!1))},u.cancel=function(e,t){t.classList.remove("pressed"),d("close")},u}}),define("service/autocontact",["OObject","service/map","Bind.plugin","Event.plugin","service/config","Store"],function(e,t,n,s,a,o){function r(e,t,r){var c=this,d=a.get("user"),u=!1,p=new o([]);c.plugins.addAll({auto:new n(p,{setSelected:function(e){e?this.classList.add("selected"):this.classList.remove("selected")},setType:function(e){"group"===e?this.classList.add("group"):this.classList.remove("group")}}),select:new s(c)}),c.template='<div class = "autocontact"><div class="autoclose" data-select="listen:mousedown,close"></div><ul data-auto="foreach"><li data-auto="bind:innerHTML, username; bind:setType, type; bind:setSelected, selected" data-select="listen:mousedown, select"></li></ul></div>',c.init=function(){var e=d.get("connections"),n=[],s=[],a={};for(p.reset([]),i=0,l=e.length;l>i;i++)n.push(e[i].username),a[e[i].username]=e[i].type;if(n.sort().forEach(function(e){p.alter("push",{username:e,type:a[e]})}),t.value)for(s=t.value.split(/,|;/),i=0,l=s.length;l>i;i++)s[i]=s[i].trim();p.loop(function(e,t){s.indexOf(e.username)>-1?p.update(t,"selected",!0):p.update(t,"selected",!1)})},c.updateList=function(){var e,n;if(t.value){if(u=!0,e=t.value.split(/,|;/),n=e[e.length-1].trim().toLowerCase(),p.reset([]),d.get("connections").forEach(function(e){0===e.username.toLowerCase().search(n)&&p.alter("push",{username:e.username,type:e.type})}),t.value)for(currentList=t.value.split(/,|;/),i=0,l=currentList.length;l>i;i++)currentList[i]=currentList[i].trim();p.loop(function(e,t){currentList.indexOf(e.username)>-1?p.update(t,"selected",!0):p.update(t,"selected",!1)})}},c.close=function(t){t.stopPropagation(),e.classList.add("invisible")},c.select=function(e,t){var i=t.getAttribute("data-auto_id"),n=p.get(i).selected;p.update(i,"selected",!n),n?c.remove(p.get(i)):c.add(p.get(i))},c.add=function(e){var n;if("user"===e.type)if(u){var s=t.value.split(/,|;/),a="";for(s.forEach(function(e){e=e.trim()}),s.pop(),i=0,l=s.length;l>i;i++)a+=s[i]+", ";a+=e.username,t.value=a,u=!1}else t.value?t.value+=", "+e.username:t.value=e.username;else d.get("connections").forEach(function(t){t.username===e.username&&(n=t.contacts)}),n.forEach(function(e){t.value.search(e.username)<0&&(c.add(e),p.loop(function(t,i){t.username===e.username&&p.update(i,"selected",!0)}))});r(t.value)},c.remove=function(e){var n,s="";if("user"===e.type){for(n=t.value.split(/,|;/),i=0,l=n.length;l>i;i++)n[i]=n[i].trim();n.splice(n.indexOf(e.username),1),n.forEach(function(e){s+=e+", "}),t.value=s.substr(0,s.length-2),r(s.substr(0,s.length-2)),p.loop(function(t,i){"group"===t.type&&t.selected&&d.get("connections").forEach(function(n){n.username===t.username&&JSON.stringify(n).search(e.username)>-1&&p.update(i,"selected",!1)})})}else d.get("connections").forEach(function(t){t.username===e.username&&t.contacts.forEach(function(e){p.loop(function(t,i){t.username===e.username&&p.update(i,"selected",!1)}),c.remove(e)})})},c.init(),c.render(),c.place(e)}return function(t,i,n){return r.prototype=new e,new r(t,i,n)}}),define("public/detail-stack/public-share",["OObject","service/map","service/config","Bind.plugin","Event.plugin","Store","service/avatar","service/utils","service/autocontact","CouchDBDocument","Promise","lib/spin.min"],function(e,t,n,s,a,o,r,l,c,d,u,p){return function(r){var l=new e,c=new o({errormsg:""}),g=n.get("user"),h=n.get("transport"),m=n.get("labels"),v=new o({body:"",docId:"",docType:"",attachment:"",docTitle:"",signature:g.get("signature")}),f=new o([]),b=new o([]),w=!1,y=new p({color:"#5F8F28",lines:8,length:8,width:4,radius:8,left:30,top:-6}).spin();return l.plugins.addAll({labels:new s(m),share:new s(v,{setHeader:function(e){this.innerHTML=m.get("sharing")+e}}),contacts:new s(b,{setSelected:function(e){this.innerHTML=e?"&#10003;":""}}),auto:new s(f,{highlight:function(e){e?this.classList.add("selected"):this.classList.remove("selected")}}),shareevent:new a(l),errormsg:new s(c)}),l.template='<div class="idea-share"><div class="header blue-dark"><span data-share="bind:setHeader, docTitle">Sharing idea</span></div><form class="form"><legend>Select contacts</legend><div class="selectall" data-labels="bind:innerHTML, selectall" data-shareevent="listen: mousedown, press; listen:mouseup, selectAll">Select all</div><input class="search" data-shareevent="listen:mousedown, displayAutoContact; listen:input, updateAutoContact" data-labels="bind:placeholder, tocontactlbl"><div id="sharelistauto" class="autocontact invisible"><div class="autoclose" data-shareevent="listen:mousedown,close"></div><ul data-auto="foreach"><li data-auto="bind:innerHTML, username; bind:highlight, selected" data-shareevent="listen:mouseup, select"></li></ul></div><div class="sharecontactlist"><ul data-contacts="foreach"><li class = "contact list-item" data-shareevent="listen:mousedown, discardContact"><p class="contact-name" data-contacts="bind:innerHTML, username"></p><div class="remove-contact"></div><p class="contact-intro" data-contacts="bind:innerHTML, intro"></p></li></ul><p><legend>Add a message</legend><textarea class="input sharemessage" data-share="bind:value, body"></textarea></p><p><legend>Signature</legend><textarea class="signature" data-share="bind:value, signature"></textarea></p><div class="sendmail-footer"><p class="send"><label class="cancelmail" data-labels="bind:innerHTML, cancellbl" data-shareevent="listen: mousedown, press; listen:mouseup, cancel">Cancel</label><label class="sendmail" data-labels="bind:innerHTML, sendlbl" data-shareevent="listen:mousedown, press; listen:mouseup, share">Share</label><label class="editerror" data-errormsg="bind:innerHTML, errormsg"></label></p></div></form></div>',l.reset=function(e){c.reset({errormsg:""}),v.reset({body:"",docId:e,docType:"",docTitle:"",signature:g.get("username")+" <"+g.get("_id")+">"}),l.getIdeaDetails(e),g.get("signature")&&v.set("signature",g.get("signature")),b.reset([]),f.reset(g.get("connections").concat())},l.getIdeaDetails=function(e){var t=new d({});t.setTransport(h),t.sync(n.get("db"),e).then(function(){v.set("docType",t.get("type")),v.set("docTitle",t.get("title")),t.unsync()})},l.updateAutoContact=function(e,t){var n,s=JSON.parse(f.toJSON()),a=g.get("connections").concat(),o=t.value.toLowerCase();if(""===t.value)f.reset(a);else{for(i=s.length-1;i>=0;i--)n=s[i].username.toLowerCase(),0!==n.search(o)&&s.splice(i,1);f.reset(s)}f.loop(function(e,t){b.toJSON().search(e.userid)>-1&&f.update(t,"selected",!0)})},l.close=function(e,t){t.parentNode.classList.add("invisible")},l.displayAutoContact=function(){l.dom.querySelector("#sharelistauto").classList.remove("invisible"),f.reset(g.get("connections").concat())},l.discardContact=function(e,t){var i=t.getAttribute("data-contacts_id"),n=b.get(i).userid;b.alter("splice",i,1),f.loop(function(e,t){e.userid===n&&setTimeout(function(){f.update(t,"selected",!1)},200)}),l.unselectGroup(n)},l.select=function(e,t){var i=t.getAttribute("data-auto_id");f.get(i).selected?(l.removeContact(f.get(i)),setTimeout(function(){f.update(i,"selected",!1),l.dom.querySelector("#sharelistauto").classList.add("invisible")},200)):(l.addContact(f.get(i)),l.selectGroup(),setTimeout(function(){f.update(i,"selected",!0),l.dom.querySelector("#sharelistauto").classList.add("invisible")},200))},l.selectAll=function(e,t){t.classList.remove("pressed"),b.reset([]),f.reset(g.get("connections").concat()),f.loop(function(e,t){f.update(t,"selected",!0),"user"===e.type&&b.alter("push",e)})},l.removeContact=function(e){if("group"===e.type)for(j=e.contacts.length-1;j>=0;j--)l.removeContact(e.contacts[j]);else b.loop(function(t,i){t.userid===e.userid&&b.alter("splice",i,1)}),l.unselectGroup(e.userid),f.loop(function(t,i){t.userid===e.userid&&f.update(i,"selected",!1)})},l.selectGroup=function(){var e,t=!1;f.loop(function(i,n){if("group"===i.type&&!i.selected){for(e=i.contacts,t=!0,j=e.length-1;j>=0;j--)if(b.toJSON().search(e[j].userid)<0){t=!1;break}t&&f.update(n,"selected",!0)}})},l.unselectGroup=function(e){f.loop(function(t,i){"group"===t.type&&t.selected&&JSON.stringify(t.contacts).search(e)>0&&f.update(i,"selected",!1)})},l.addContact=function(e){var t,i,n=!0;if("user"===e.type)b.alter("push",e);else for(t=0,i=e.contacts.length;i>t;t++)b.loop(function(i){i.userid===e.contacts[t].userid&&(n=!1)}),n&&(b.alter("push",e.contacts[t]),f.loop(function(i,n){i.userid===e.contacts[t].userid&&f.update(n,"selected",!0)}))},l.press=function(e,t){t.classList.add("pressed")},l.share=function(e,t){var i=new Date,n={type:"DOC",status:"unread",date:[i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getMinutes()],author:g.get("_id"),username:g.get("username"),firstname:g.get("firstname"),toList:"",ccList:"",object:"",body:v.get("body"),signature:v.get("signature"),docId:v.get("docId"),docType:v.get("docType"),docTitle:v.get("docTitle"),dest:[]};w||(w=!0,y.spin(t),l.buildRecipientList(n.docId,n.dest).then(function(){n.dest.length?h.request("Notify",n,function(){c.set("errormsg",m.get("shareok")),t.classList.remove("pressed"),w=!1,setTimeout(function(){y.stop(),l.reset(n.docId),l.dom.querySelector("#sharelistauto").classList.add("invisible"),f.reset(g.get("connections").concat()),r("close")},2e3)}):(c.set("errormsg","intented recipients already have this idea"),t.classList.remove("pressed"),w=!1,setTimeout(function(){y.stop(),l.reset(n.docId),l.dom.querySelector("#sharelistauto").classList.add("invisible"),f.reset(g.get("connections").concat()),r("close")},2500))}))},l.cancel=function(e,t){t.classList.remove("pressed"),r("close")},l.buildRecipientList=function(e,t){var i=new u,s=new d;return s.setTransport(h),s.sync(n.get("db"),e).then(function(){var e=s.get("sharedwith")||[],i=s.get("authors");return b.loop(function(n){i.indexOf(n.userid)<0&&(e.length?e.indexOf(n.userid)<0&&(e.push(n.userid),t.push(n.userid)):(e.push(n.userid),t.push(n.userid)))}),s.set("sharedwith",e),s.upload()}).then(function(){i.fulfill()}),i},l.place(t.get("public-share")),l}}),define("public/public-stack",["OObject","Bind.plugin","service/map","Amy/Stack-plugin","./detail-stack/public-idea","./detail-stack/public-edit","./detail-stack/public-sendmail","./detail-stack/public-share","service/config","Store","lib/spin.min"],function(e,t,i,n,s,a,o,r,l,c,d){return function(){var i,u,p,g,h=new e,m=new e,v=new n,f=l.get("labels"),b=l.get("observer"),w=new c,y=0,L=new d({color:"#808080",lines:10,length:12,width:6,radius:10,top:328}).spin();return h.plugins.addAll({detailstack:v}),h.template='<div class="detail-stack" data-detailstack="destination"></div>',m.template='<div class="msgsplash"><div class="header blue-dark"><span data-labels="bind:innerHTML, noideafound"></span></div><div class="innersplash"><span data-labels="bind: innerHTML, tryotherview"></span></div></div>',m.plugins.add("labels",new t(f)),h.reset=function(e,t){w=e,y=t,w.getNbItems()?(v.getStack().show("#public-ideadetail"),i.hideCache(),L.spin(h.dom),i.reset(e,t).then(function(){L.stop(),cache.classList.add("invisible")})):v.getStack().show("#empty-list")},h.displayEmpty=function(){v.getStack().show("#empty-list")},h.action=function(e){var t=w.get(y).id;switch(e){case"#public-edit":g.reset(t),v.getStack().show("#public-edit");break;case"#public-favorites":break;case"#public-share":p.reset(t),v.getStack().show("#public-share");break;case"close":v.getStack().show("#public-ideadetail");break;default:v.getStack().show("#public-ideadetail")}},h.edit=function(e){g.reset(e),v.getStack().show("#public-edit")},h.sendMail=function(e){u.reset(e),v.getStack().show("#public-sendmail")},h.share=function(e){p.reset(e._id),v.getStack().show("#public-share")},i=new s(h.action),g=new a(h.action),u=new o(h.action),p=new r(h.action),v.getStack().add("#public-ideadetail",i),v.getStack().add("#public-edit",g),v.getStack().add("#public-sendmail",u),v.getStack().add("#public-share",p),v.getStack().add("#empty-list",m),b.watch("public-viewidea",function(e){h.viewIdea(e)}),b.watch("public-edit",function(e){h.edit(e)}),b.watch("public-sendmail",function(e){h.sendMail(e)}),b.watch("public-share",function(e){h.share(e)}),h}}),define("service/new2c",["OObject","service/map","Bind.plugin","Event.plugin","service/config","Store"],function(e,t,i,n,s,a){return new function(){var o,r=new e,l=new a({userid:"",username:""}),c=s.get("user"),d=new a,u=s.get("labels"),p=s.get("transport"),g=!1,h=new a({error:""});return r.plugins.addAll({new2c:new i(d),dest:new i(l,{setHeader:function(e){this.innerHTML=u.get("sendtcprefix")+e+u.get("sendtcsuffix")}}),labels:new i(u),errormsg:new i(h),new2cevent:new n(r)}),r.template='<div><div class = "header blue-dark"><span data-dest="bind: setHeader, username"></span><div class="close-popup" data-new2cevent="listen:mousedown, cancel"></div></div><form class="form"><p><textarea class="description input" data-labels="bind:placeholder, twocentplaceholder" data-new2c="bind: value, message"></textarea></p><div><span class="errormsg" data-errormsg="bind:innerHTML, error"></span><div class="sendmail" data-new2cevent="listen:mousedown, press; listen:mouseup, upload" data-labels="bind:innerHTML, sendlbl"></div></div></form></div>',r.render(),r.place(t.get("new2c-popup")),r.press=function(e,t){t.classList.add("pressed")},r.closePopup=function(){document.getElementById("new2c-popup").classList.remove("appear"),document.getElementById("cache").classList.remove("appear"),d.reset(),l.reset(),h.reset({error:""})},r.reset=function(e){o=e,t.get("new2c-popup").classList.add("appear"),t.get("cache").classList.add("appear"),l.set("userid",o.userid),l.set("username",o.username),d.reset({author:c.get("_id"),message:"",firstname:c.get("firstname"),username:c.get("username"),date:[],datemod:"",plusones:0,replies:[]}),g=!1},r.cancel=function(){r.closePopup()},r.upload=function(e,t){var i,n=new Date,s={};d.get("message")?(g=!0,i=setInterval(function(){h.get("error")===u.get("sendinginprogress")?h.set("error",u.get("sendinginprogress")+" ..."):h.set("error",u.get("sendinginprogress"))},150),d.set("date",[n.getFullYear(),n.getMonth(),n.getDate()]),s.tc=JSON.parse(d.toJSON()),s.userid=l.get("userid"),s.username=l.get("username"),p.request("SendTwocent",s,function(e){var n,a=o.twocents||[],l=c.get("connections");if("ok"===e){for(a.unshift(s.tc),o.twocents=a,n=l.length-1;n>=0;n--)"user"===l[n].type&&l[n].userid===o.userid&&l.splice(n,1,o);c.set("connections",l),c.upload().then(function(){clearInterval(i),t.classList.remove("pressed"),r.closePopup()})}else h.set("error","something went wrong - try again later"),clearInterval(i),t.classList.remove("pressed")})):(h.set("error",u.get("nomessage")),t.classList.remove("pressed"))},r}}),define("service/actionbar",["OObject","Bind.plugin","Event.plugin","service/config","Store","CouchDBView","CouchDBDocument","Promise","service/new2c","lib/spin.min","service/confirm","service/utils"],function(e,t,i,n,s,a,o,r,c,d,u,p){function g(e,g,h){var m,v=new s([]),f=g.offsetHeight,b=new s({height:f}),w=10,y=n.get("user"),L=n.get("labels"),k=n.get("observer"),S=n.get("transport"),T=n.get("db"),M=this,A=new d({color:"#9AC9CD",lines:10,length:10,width:8,radius:10}).spin(),C=new d({color:"#a0a0a0",lines:10,length:6,width:4,radius:6}).spin();this.plugins.addAll({buttons:new t(v,{setIcon:function(e){this.setAttribute("style","background-image:url('"+e+"');")}}),style:new t(b,{setPosition:function(e){this.setAttribute("style","height:"+e+"px; margin-top:-"+(e-w)+"px;")},setButtons:function(e){var t=Math.floor((e-w-40)/2);this.setAttribute("style","margin-top:"+t+"px;")}}),action:new i(this)}),this.template='<div class="actionbar" data-style="bind:setPosition, height" data-action="listen:mouseup, hide"><ul class="buttonlist" data-style="bind:setButtons, height" data-buttons="foreach"><li class="actionbutton" data-buttons ="bind:setIcon,icon" data-action="listen:mousedown, press; listen:mouseup, action"></li></ul><div id="abspinner"></div></div>',this.hide=function(){var e=M.dom.parentElement;e&&e.removeChild(e.lastChild)},this.getParent=function(){return g},this.press=function(e,t){e.stopPropagation(),e.preventDefault(),t.classList.add("pressed"),A.el=document.getElementById("abspinner")},this.action=function(e,t){var i=t.getAttribute("data-buttons_id"),s=v.get(i).name;switch(e.stopPropagation(),e.preventDefault(),t.classList.remove("pressed"),s){case"delete":this.deleteItem().then(function(){M.hide()});break;case"edit":this.editItem();break;case"share":this.shareItem();break;case"replay":n.get("observer").notify("replay-session",h.sessionId);break;case"mail":this.mailItem();break;case"twocent":this.sendTwocent();break;case"unfav":C.spin(t),document.getElementById("public")?this.removeFav("public-favorites"):this.removeFav("library-favorites");break;case"addfav":C.spin(t),document.getElementById("public")?this.addFav("public-favorites"):this.addFav("library-favorites")}},m=function(e,t){var i;switch(e){case"idea":i=new a,i.setTransport(S),i.sync(T,"ideas","_view/all",{key:'"'+t+'"',include_docs:!0}).then(function(){var e=y.get("public-favorites")||[],s=y.get("library-favorites")||[];if(t=i.get(0).doc,h=i.get(0).doc,t.authors.indexOf(y.get("_id"))>-1&&v.alter("push",{name:"edit",icon:"img/wall/35modify.png"}),t.sessionId&&""!==t.sessionId&&-1===t.sessionId.search("deleted")&&(t.sessionReplay||t.authors.indexOf(y.get("_id"))>-1)){var o=new a;o.setTransport(n.get("transport")),o.sync(n.get("db"),"library","_view/sessioncount",{key:'"'+t.sessionId+'"'}).then(function(){o.get(0)&&v.alter("push",{name:"replay",icon:"img/library/25goToSession.png"})})}document.getElementById("public")?e.indexOf(t._id)>-1?v.alter("push",{name:"unfav",icon:"img/public/unfav-actionbar.png"}):v.alter("push",{name:"addfav",icon:"img/public/addfav-actionbar.png"}):document.getElementById("library")&&(s.indexOf(t._id)>-1?v.alter("push",{name:"unfav",icon:"img/public/unfav-actionbar.png"}):v.alter("push",{name:"addfav",icon:"img/public/addfav-actionbar.png"})),v.alter("push",{name:"mail",icon:"img/wall/35mail.png"}),t.authors.indexOf(y.get("_id"))>-1&&(y.get("connections")&&y.get("connections").length?v.alter("push",{name:"share",icon:"img/wall/35share.png"}):(y.get("facebook")||y.get("twitter")||y.get("gplus")||y.get("linkedin"))&&v.alter("push",{name:"share",icon:"img/wall/35share.png"})),1!==t.authors.length||t.authors[0]!==y.get("_id")||t.twocents.length||t.sharedwith.length||"public"===t.visibility||v.alter("push",{name:"delete",icon:"img/wall/35delete.png"}),-1===t.authors.indexOf(y.get("_id"))&&t.sharedwith.indexOf(y.get("_id"))>-1&&document.getElementById("library")&&v.alter("push",{name:"delete",icon:"img/wall/35delete.png"})});break;case"deck":var s=new o;s.setTransport(S),s.sync(T,h).then(function(){s.get("created_by")===y.get("_id")&&(y.get("connections")&&y.get("connections").length?v.alter("push",{name:"share",icon:"img/wall/35share.png"}):(y.get("facebook")||y.get("twitter")||y.get("gplus")||y.get("linkedin"))&&v.alter("push",{name:"share",icon:"img/wall/35share.png"})),y.get("taiaut_decks").length+y.get("custom_decks").length>1&&v.alter("push",{name:"delete",icon:"img/wall/35delete.png"})});break;case"message":v.alter("push",{name:"mail",icon:"img/wall/35mail.png"}),v.alter("push",{name:"delete",icon:"img/wall/35delete.png"});break;case"contact":v.alter("push",{name:"mail",icon:"img/wall/35mail.png"}),"user"===t.type&&v.alter("push",{name:"twocent",icon:"img/2centDisable.png"}),v.alter("push",{name:"delete",icon:"img/wall/35delete.png"})}},this.deleteItem=function(){var t=new r,i=new o,s=this;switch(i.setTransport(S),e){case"idea":1===h.authors.length&&h.authors[0]===y.get("_id")?i.sync(n.get("db"),h._id).then(function(){var e=i.get("attachments")||[];return e.length&&e.forEach(function(e){p.deleteAttachmentDoc(e.docId)}),i.remove()}).then(function(){t.fulfill()}):S.request("RemoveFromLibrary",{id:h._id,userid:y.get("_id")},function(){t.fulfill()});break;case"deck":y.get("active_deck")===h?(alert(L.get("cannotdelactivedeck")),s.hide()):(document.getElementById("cache").classList.add("appear"),confirmUI=new u(document.body,L.get("deldeckwarning"),function(e){var n=new d({lines:10,length:20,width:8,radius:10}).spin();if(e)if(n.spin(document.getElementById("deckview")),document.getElementById("cache").classList.add("appear"),y.get("taiaut_decks").indexOf(h)>-1){var a=y.get("taiaut_decks");a.splice(a.indexOf(h),1),y.set("taiaut_decks",a),y.upload().then(function(){n.stop(),document.getElementById("cache").classList.remove("appear"),t.fulfill()})}else i.sync(T,h).then(function(){var e=i.get("sharedwith")||[],s=y.get("custom_decks").concat();e.length&&e.indexOf(y.get("_id"))>-1?(e.splice(e.indexOf(y.get("_id")),1),i.set("sharedwith",e),i.upload.then(function(){return s.splice(s.indexOf(h),1),y.set("custom_decks",s),y.upload()}).then(function(){n.stop(),document.getElementById("cache").classList.remove("appear"),t.fulfill()})):i.get("created_by")===y.get("_id")&&S.request("DeleteDeck",{id:h,userid:y.get("_id")},function(e){"ok"===e?(s.splice(s.indexOf(h),1),y.set("custom_decks",s),y.upload().then(function(){n.stop(),document.getElementById("cache").classList.remove("appear"),t.fulfill()})):console.log(e)})});else s.hide();document.body.removeChild(document.querySelector(".confirm"))},"importcard-confirm"));break;case"message":var a,c,g=y.get("notifications");for(a=0,l=g.length;l>a;a++)if(JSON.stringify(g[a])===JSON.stringify(h)){c=a;break}g.splice(c,1),y.set("notifications",g),y.upload();break;case"contact":var g=y.get("connections"),m=new Date,v=[m.getFullYear(),m.getMonth(),m.getDate(),m.getHours(),m.getMinutes(),m.getSeconds()];if("user"===h.type){for(a=g.length-1;a>=0;a--)if("user"===g[a].type&&g[a].userid===h.userid)g.splice(a,1);else if("group"===g[a].type){var f=g[a].contacts;for(j=f.length-1;j>=0;j--)f[j].userid===h.userid&&f.splice(j,1)}}else for(a=g.length-1;a>=0;a--)g[a].username===h.username&&g.splice(a,1);y.set("connections",g),"user"===h.type&&y.get("news").unshift({type:"CX-",date:v,content:{userid:h.userid,username:h.username}}),y.upload().then(function(){if("user"===h.type){var e=(new Date,{dest:[h.userid],date:v,original:"",type:"CXCancel",author:y.get("_id"),username:y.get("username"),firstname:y.get("firstname"),toList:h.username,ccList:"",object:y.get("username")+L.get("canceledCX"),body:"",signature:"",contactInfo:{firstname:y.get("firstname"),lastname:y.get("lastname"),userid:y.get("_id"),username:y.get("username"),intro:y.get("intro"),type:"user"}});S.request("Notify",e,function(e){console.log(e)})}k.notify("contact-deleted")})}return t},this.editItem=function(){switch(e){case"idea":document.getElementById("public")?k.notify("public-edit",h._id):k.notify("library-edit",h._id)}A.stop()},this.mailItem=function(){switch(e){case"idea":document.getElementById("public")?k.notify("public-sendmail",h):k.notify("library-sendmail",h);break;case"message":break;case"contact":k.notify("message-contact",h)}},this.shareItem=function(){switch(e){case"idea":document.getElementById("public")?k.notify("public-share",h):k.notify("library-share",h);break;case"deck":k.notify("deck-share",h);break;case"message":break;case"contact":}},this.sendTwocent=function(){c.reset(h)},this.addFav=function(e){var t;t=y.get(e)?y.get(e).concat():[],t.length<100?(t.push(h._id),y.set(e,t),y.upload().then(function(){C.stop(),alert(L.get("addedfav")),M.hide()})):(C.stop(),alert(L.get("maxfavsize")),M.hide())},this.removeFav=function(e){var t;t=y.get(e)?y.get(e).concat():[],t.splice(t.indexOf(h._id),1),y.set(e,t),y.upload().then(function(){C.stop(),alert(L.get("removedfav")),M.hide()})},m(e,h)}return function(t,i,n){return g.prototype=new e,new g(t,i,n)}}),define("public/lists/list-public",["OObject","CouchDBView","service/config","Bind.plugin","Event.plugin","service/utils","service/avatar","service/actionbar","Promise"],function(e,t,i,n,s,a,o,r,l){function c(e,o,c,d){var u=new t([]),p=i.get("user"),g=null,h={db:e,view:c,design:o,query:{descending:!0,limit:50}},m=this;u.setTransport(i.get("transport")),d&&(h.query=d),this.template="<div><div class='noresult date invisible' data-labels='bind:innerHTML,noresult' ></div><ul class='idea-list' data-listideas='foreach'><li class='list-item' data-listevent='listen:mousedown, setStart; listen:dblclick, showActionBar'><div class='item-header'><div class='avatar' data-listideas='bind:setAvatar,value.doc.authors'></div><h2 data-listideas='bind:innerHTML,value.doc.authornames'></h2><span class='date' data-listideas='bind:date,value.doc.creation_date'></span></div><div class='item-body'><h3 data-listideas='bind:innerHTML,value.doc.title'>Idea title</h3><p data-listideas='bind:innerHTML,value.doc.description'></p></div><div class='item-footer'><a class='idea-type'></a><a class='item-acorn'></a><span class='rating' data-listideas='bind:setRating, value.rating'></span> </div></li></ul></div>",h.query.q&&(this.template="<div><div class='noresult date invisible' data-labels='bind:innerHTML,noresult' ></div><ul class='idea-list' data-listideas='foreach'><li class='list-item' data-listevent='listen:mousedown, setStart; listen:dblclick, showActionBar'><div class='item-header'><div class='avatar' data-listideas='bind:setAvatar,doc.authors'></div><h2 data-listideas='bind:innerHTML,doc.authornames'></h2><span class='date' data-listideas='bind:date,doc.creation_date'></span></div><div class='item-body'><h3 data-listideas='bind:innerHTML,doc.title'>Idea title</h3><p data-listideas='bind:setDesc,doc.description'></p></div><div class='item-footer'><a class='idea-type'></a><a class='item-acorn'></a><span class='rating' data-listideas='bind:setRating, rating'></span> </div></li></ul></div>"),m.plugins.addAll({labels:new n(i.get("labels")),listideas:new n(u,{date:function v(v){v&&(this.innerHTML=a.formatDate(v))},setDesc:function(e){e&&(this.innerHTML=e.replace(/\n/g,"<br>"))},setRating:function(e){if(void 0===e){var t=this.getAttribute("data-listideas_id"),i=u.get(t).doc.votes||[];this.innerHTML=0===i.length?"":Math.round(100*(i.reduce(function(e,t){return e+t})/i.length))/100}else this.innerHTML=e},setAvatar:function(){}}),listevent:new s(this)}),m.getModel=function(){return u},m.resetQuery=function(e){var t=new l,n=p.get("public-favorites")||[],s={idList:n},a=m.dom.querySelector(".noresult");return h.query=e,u.unsync(),u.reset([]),"fav"===d&&n.length?i.get("transport").request("GetFavList",s,function(i){var n,s,o,r=JSON.parse(i);if(e&&"*"!==e)for(n=0,s=r.length;s>n;n++)o=r[n].value.doc.lang.substring(0,2),e===o&&u.alter("push",r[n]);else u.reset(r);u.getNbItems()?a.classList.add("invisible"):a.classList.remove("invisible"),t.fulfill()}):u.sync(h.db,h.design,h.view,h.query).then(function(){g&&g.hide(),u.getNbItems()?a.classList.add("invisible"):a.classList.remove("invisible"),t.fulfill()}),t},m.setLang=function(e){return"fav"===d?m.resetQuery(e):"*"===e?m.resetQuery({startkey:"[0,{}]",endkey:"[0]",descending:!0,limit:50}):m.resetQuery({startkey:'[1,"'+e+'", {}]',endkey:'[1,"'+e+'"]',descending:!0,limit:50})},m.setStart=function(e){touchStart=[e.pageX,e.pageY],g&&(g.hide(),g=null)},m.showActionBar=function(e,t){var i,n=t.getAttribute("data-listideas_id"),s=!1,a=document.getElementById("public");g&&g.getParent()===t&&(s=!0),a.classList.contains("mosaic")||s||(g=new r("idea",t,u.get(n).id),i=document.createDocumentFragment(),g.place(i),t.appendChild(i),s=!0)},m.init=function(){var e=new l,t=p.get("public-favorites")||[],n={idList:t},s=m.dom.querySelector(".noresult");return"fav"===d?t.length?i.get("transport").request("GetFavList",n,function(t){u.reset(JSON.parse(t)),s.classList.add("invisible"),e.fulfill()
}):(u.reset([]),s.classList.remove("invisible"),e.fulfill()):u.sync(h.db,h.design,h.view,h.query).then(function(){u.getNbItems()?s.classList.add("invisible"):s.classList.remove("invisible"),e.fulfill()}),e}}return function(t,i,n,s){return c.prototype=new e,new c(t,i,n,s)}}),define("public/lists/list-polling",["OObject","CouchDBView","Store","service/config","Bind.plugin","Event.plugin","service/utils","service/avatar","service/actionbar","Promise"],function(e,t,i,n,s,a,o,r,l,c){function d(e,i,r,d){var u,p=new t([]),g=null,h=n.get("user"),m={db:e,view:r,design:i,query:{descending:!0,limit:50}},v=this;d&&(m.query=d),this.template="<div><div class='noresult date invisible' data-labels='bind:innerHTML,noresult' ></div><ul class='idea-list' data-listideas='foreach'><li class='list-item' data-listevent='listen:mousedown, setStart; listen:dblclick, showActionBar'><div class='item-header'><div class='avatar' data-listideas='bind:setAvatar,value.doc.authors'></div><h2 data-listideas='bind:innerHTML,value.doc.authornames'></h2><span class='date' data-listideas='bind:date,value.doc.creation_date'></span></div><div class='item-body'><h3 data-listideas='bind:innerHTML,value.doc.title'>Idea title</h3><p data-listideas='bind:setDesc,value.doc.description'></p></div><div class='item-footer'><a class='idea-type'></a><a class='item-acorn'></a><span class='rating' data-listideas='bind:setRating, value.rating'></span> </div></li></ul></div>",this.plugins.addAll({labels:new s(n.get("labels")),listideas:new s(p,{date:function(e){this.innerHTML=o.formatDate(e)},setDesc:function(e){this.innerHTML=e.replace(/\n/g,"<br>")},setRating:function(e){if(void 0===e){var t=this.getAttribute("data-listideas_id"),i=p.get(t).doc.votes||[];this.innerHTML=0===i.length?"":Math.round(100*(i.reduce(function(e,t){return e+t})/i.length))/100}else this.innerHTML=e},setAvatar:function(){}}),listevent:new a(this)}),this.getModel=function(){return p},v.resetQuery=function(e){var i=new c,s=h.get("settings").polling_interval||n.get("polling_interval"),a=new t,o=v.dom.querySelector(".noresult");return e&&(m.query=e),clearInterval(u),a.setTransport(n.get("transport")),a.sync(m.db,m.design,m.view,m.query).then(function(){g&&g.hide(),p.reset(JSON.parse(a.toJSON())),p.getNbItems()?o.classList.add("invisible"):o.classList.remove("invisible"),a.unsync(),u=setInterval(function(){a.reset([]),a.sync(m.db,m.design,m.view,m.query).then(function(){g&&g.hide(),p.reset(JSON.parse(a.toJSON())),p.getNbItems()?o.classList.add("invisible"):o.classList.remove("invisible"),a.unsync()})},s),i.fulfill()}),i},this.setLang=function(e){return"*"===e?v.resetQuery({startkey:"[0,{}]",endkey:"[0]",descending:!0,limit:50}):v.resetQuery({key:'[1,"'+e+'"]',descending:!0,limit:50})},this.setStart=function(){g&&(g.hide(),g=null)},this.showActionBar=function(e,t){var i,n=t.getAttribute("data-listideas_id"),s=!1,a=document.getElementById("public");g&&g.getParent()===t&&(s=!0),a.classList.contains("mosaic")||s||(g=new l("idea",t,p.get(n).id),i=document.createDocumentFragment(),g.place(i),t.appendChild(i),s=!0)},this.init=function(){var e=new c,i=h.get("settings").polling_interval||n.get("polling_interval"),s=new t,a=v.dom.querySelector(".noresult");return s.setTransport(n.get("transport")),s.sync(m.db,m.design,m.view,m.query).then(function(){p.reset(JSON.parse(s.toJSON())),p.getNbItems()?a.classList.add("invisible"):a.classList.remove("invisible"),s.unsync(),u=setInterval(function(){s.reset([]),s.sync(m.db,m.design,m.view,m.query).then(function(){p.reset(JSON.parse(s.toJSON())),p.getNbItems()?a.classList.add("invisible"):a.classList.remove("invisible"),s.unsync()})},i),e.fulfill()}),e},h.watchValue("settings",function(){var e,i=new t,s=v.dom.querySelector(".noresult");h.get("settings").polling_interval!==n.get("polling_interval")&&(n.set("polling_interval",h.get("settings").polling_interval),e=n.get("polling_interval"),clearInterval(u),i.setTransport(n.get("transport")),u=setInterval(function(){i.reset(),i.sync(m.db,m.design,m.view,m.query).then(function(){g&&g.hide(),p.reset(JSON.parse(i.toJSON())),p.getNbItems()?s.classList.add("invisible"):s.classList.remove("invisible"),i.unsync()})},e))}),n.get("observer").watch("update-polling",function(){v.resetQuery()})}return function(t,i,n,s){return d.prototype=new e,new d(t,i,n,s)}}),define("service/submenu",["OObject","Bind.plugin","Amy/Control-plugin","service/config"],function(e,t,i,n){function s(e,s){var a,o,r,l,c,d=!1,u=new i(this),p=function(t){t?e.setAttribute("style","display : block;"):e.setAttribute("style","display : none;"),d=t};a="<div></div>",o='<div class="sub-menu"><div class="left-caret"></div><ul class="menu-list" data-menucontrol="radio:li,selected,mousedown,setCurrentWidget"><li class="menu-item selected" name="#ideas" data-menucontrol="init"><a class="library-item" href="#ideas" data-label="bind:innerHTML, library-ideas"></a></li><li class="menu-item" name="#sessions"><a class="library-item" href="#sessions" data-label="bind:innerHTML, library-sessions"></a></li><li class="menu-item" name="#decks"><a class="library-item" href="#decks" data-label="bind:innerHTML, library-decks"></a></li></ul></div>',r="<div></div>",l='<div class="sub-menu"><div class="left-caret"></div><ul class="menu-list" data-menucontrol="radio:li,selected,mousedown,setCurrentWidget"><li class="menu-item selected" data-menucontrol="init" name="#messages"><a class="connect-item" href="#connect-messages" data-label="bind:innerHTML, connect-messages"></a></li><li class="menu-item" name="#contacts"><a class="connect-item" href="#connect-contacts" data-label="bind:innerHTML, connect-contacts"></a></li><li class="menu-item" name="#twocents"><a class="connect-item" href="#connect-twocents" data-label="bind:innerHTML, connect-twocents"></a></li></ul></div>',c='<div class="sub-menu"><div class="left-caret"></div><ul class="menu-list" data-menucontrol="radio:li,selected,mousedown,setCurrentWidget"><li class="menu-item selected" name="#profile" data-menucontrol="init"><a class="dashboard-item" href="#dashboard-profile" data-label="bind:innerHTML, dashboard-profile"></a></li><li class="menu-item" name="#settings"><a class="dashboard-item" href="#dashboard-settings" data-label="bind:innerHTML, dashboard-settings">Settings</a></li><li class="menu-item" name="#about"><a class="dashboard-item" href="#dashboard-about" data-label="bind:innerHTML, dashboard-about">About Ideafy</a></li></ul></div>',e.id.search("public")>-1&&(this.template=a),e.id.search("library")>-1&&(this.template=o),e.id.search("brainstorm")>-1&&(this.template=r),e.id.search("connect")>-1&&(this.template=l),e.id.search("dashboard")>-1&&(this.template=c),this.plugins.addAll({label:new t(n.get("labels")),menucontrol:u}),this.getState=function(){return d},this.toggleActive=function(e){p(e)},this.setCurrentWidget=function(e){var t=e.target.getAttribute("name");s&&s(t),setTimeout(function(){p(!1)},200)},this.setWidget=function(e){var t=this.dom.querySelector('li[name="'+e+'"]');s(e),t.parentNode.querySelector(".selected").classList.remove("selected"),t.classList.add("selected"),u.init(this.dom.querySelector('li[name="'+e+'"]'))},this.reset=function(){var e=this.dom.querySelector(".menu-list");e&&(e.querySelector(".selected").classList.remove("selected"),e.firstChild.classList.add("selected"),u.init(e.firstChild))},this.render(),this.place(e)}return function(t,i){return s.prototype=new e,new s(t,i)}}),define("public/public",["OObject","Amy/Control-plugin","Bind.plugin","Place.plugin","Amy/Delegate-plugin","service/map","service/config","./public-stack","service/utils","./lists/list-public","./lists/list-polling","Amy/Stack-plugin","service/submenu","Store","lib/spin.min"],function(e,t,i,n,s,a,o,r,l,c,d,u,p,g,h){return function(){var l,m,v,f,b,w,y=new e,L=o.get("db"),k=o.get("observer"),S=new t(y),T=new r,M=o.get("user"),A=o.get("labels"),C=M.get("lang").substring(0,2),x=new g([{name:"#list-fav",css:"byfav",pushed:!1,lang:null},{name:"#list-date",css:"bydate",pushed:!0,lang:null},{name:"#list-rating",css:"byrating",pushed:!1,lang:null},{name:"#lang",css:"bylang",pushed:!1,lang:C}]),q=new g([{name:"*"}]),H=o.get("userLanguages"),_=new u,I=new h({color:"#808080",lines:10,length:12,width:6,radius:10,top:328}).spin();return H.forEach(function(e){q.alter("push",e)}),y.template='<div id="public"><div class="cache"></div><div id = "public-menu"></div><div id="public-list" class="list"><div class="header blue-light"><div class="option left" data-publiccontrol="toggle:.option.left,mosaic,mousedown,mosaic"></div><span data-label="bind: innerHTML, publicideasheadertitle"></span><div class="option right" data-publicevent="listen: mousedown, plus"></div></div><div data-liststack="destination" data-publiccontrol="radio:li.list-item,selected,mousedown,selectStart"><div class="tools"><input class="search" type="text" data-label="bind: placeholder, searchpublicplaceholder" data-publicevent="listen: keypress, search"><ul class="listbtns" data-listbtns="foreach"><li class="tools-button" data-listbtns="bind:setName, name; bind:setClass, css; bind:setPushed, pushed; bind:setLang, lang" data-publicevent="listen:mouseup,show"></li></ul><ul class="langlist invisible" data-select="foreach"><li data-select="bind: setBg, name" data-publicevent="listen: mousedown, setLang; listen:mouseup, stopPropagation"></li></ul></div></div></div><div id="public-detail" class="details" data-publicplace="place:details"></div></div>',y.plugins.addAll({liststack:_,listbtns:new i(x,{setPushed:function(e){e?this.classList.add("pushed"):this.classList.remove("pushed")},setLang:function(e){e&&"*"!==e&&(this.setAttribute("style","background-image:url('img/flags/"+e+".png');"),this.innerHTML=""),"*"===e&&(this.setAttribute("style","background-image: none;"),this.innerHTML="*")},setClass:function(e){e&&this.classList.add(e)},setName:function(e){e&&this.setAttribute("name",e)}}),select:new i(q,{setBg:function(e){"*"===e?(this.setAttribute("style","background-image: none;background: whitesmoke;"),this.innerHTML="*"):this.setAttribute("style","background-image:url('img/flags/"+e+".png');")}}),label:new i(A),publicevent:new s(y),publicplace:new n({details:T}),publiccontrol:S}),y.place(a.get("public")),y.selectStart=function(e){var t=_.getStack().getCurrentScreen().getModel(),i=e.target.getAttribute("data-listideas_id");T.reset(t,i)},y.displayHighlightedIdea=function(){var e,t,i;e=_.getStack().getCurrentScreen(),t=e.dom.querySelector(".list-item.selected")||e.dom.querySelector("li[data-listideas_id='0']"),i=0,t&&(i=t.getAttribute("data-listideas_id")),t.classList.add("selected"),t.scrollIntoView(),S.init(t),T.reset(e.getModel(),i)},y.show=function(e,t){var i=parseInt(t.getAttribute("data-listbtns_id"),10),n=x.get(i).name,s=_.getStack();"#lang"===n?y.dom.querySelector(".langlist").classList.remove("invisible"):(x.loop(function(e,t){t===i?x.update(t,"pushed",!0):x.update(t,"pushed",!1)}),n!==s.getCurrentName()&&(s.show(n),s.get(n).getModel().getNbItems()?y.displayHighlightedIdea():T.displayEmpty(n)))},y.setLang=function(e,t){var i,n;e.stopPropagation(),e.preventDefault(),i=t.getAttribute("data-select_id"),n=q.get(i).name,C=n,I.spin(document.getElementById("public-list")),x.loop(function(e,t){"#lang"===e.name&&x.update(t,"lang",n)}),y.dom.querySelector(".langlist").classList.add("invisible"),["#list-rating","#list-fav","#list-date"].forEach(function(e){var t=_.getStack();t.get(e).setLang(n).then(function(){t.getCurrentName()===e&&I.stop(),t.getCurrentName()===e&&0===t.get(e).getModel().getNbItems()?T.displayEmpty(e):y.displayHighlightedIdea()})})},y.stopPropagation=function(e){e.stopPropagation(),e.preventDefault()},y.mosaic=function(){var e=document.getElementById("public-detail");y.dom.classList.toggle("mosaic"),e.classList.contains("invisible")&&(e.classList.remove("invisible"),T.reset(m.getModel(),0))},y.plus=function(){a.get("newidea-popup").classList.add("appear"),a.get("cache").classList.add("appear")},y.search=function(e,t){13===e.keyCode&&(""===t.value?m.resetQuery().then(function(){y.dom.querySelector(".listbtns").classList.remove("invisible"),_.getStack().show("#list-date"),x.loop(function(e,t){"#list-date"===e.name?x.update(t,"pushed",!0):x.update(t,"pushed",!1)}),y.displayHighlightedIdea()}):y.searchIdea(t.value),t.blur())},y.searchIdea=function(e){y.dom.querySelector(".listbtns").classList.add("invisible"),b.resetQuery({q:e,sort:"\\creation_date<date>",include_docs:!0}).then(function(){_.getStack().show("#list-search"),b.getModel().getNbItems()>0?y.displayHighlightedIdea():T.displayEmpty("search")})},y.reset=function(){v.init(T.reset),m.init(T.reset).then(function(){_.getStack().show("#list-date"),T.reset(m.getModel(),0)})},y.showMenu=function(){l.toggleActive(!0)},y.hideMenu=function(){l.toggleActive(!1)},l=new p(y.dom.querySelector("#public-menu")),l.toggleActive(!1),M.get("settings").contentLang&&(C=M.get("settings").contentLang,"all"===C&&(C="*"),x.loop(function(e,t){"#lang"===e.name&&x.update(t,"lang",C)})),w="*"===C?{startkey:"[0,{}]",endkey:"[0]",descending:!0,limit:50}:{startkey:'[1,"'+C+'", {}]',endkey:'[1,"'+C+'"]',descending:!0,limit:50},m=new d(L,"library","_view/publicideasbylang",w),v=new c(L,"ideas","_view/ideasbyvotes",w),f=new c(L,"library","_view/publicideas","fav"),b=new c("_fti/local/"+L,"indexedideas","publicbyname",{q:"init_listSearch_UI",sort:"\\creation_date<date>",limit:60,include_docs:!0}),_.getStack().add("#list-rating",v),_.getStack().add("#list-search",b),_.getStack().add("#list-fav",f),_.getStack().add("#list-date",m),v.init(),m.init().then(function(){return _.getStack().show("#list-date"),m.getModel().getNbItems()?y.displayHighlightedIdea():T.displayEmpty("#list-date"),f.setLang(C)}).then(function(){M.watchValue("public-favorites",function(e){e.length!==f.getModel().getNbItems()&&f.resetQuery(C).then(function(){"#list-fav"===_.getStack().getCurrentName()&&(f.getModel().getNbItems()?y.displayHighlightedIdea():T.displayEmpty("#list-fav"))})}),M.watchValue("settings",function(e){C=e.contentLang?"all"===e.contentLang?"*":e.contentLang:M.get("lang").substring(0,2),x.loop(function(e,t){"#lang"===e.name&&x.update(t,"lang",C)}),["#list-date","#list-rating","#list-fav"].forEach(function(e){_.getStack().get(e).setLang(C)})})}),["#list-date","#list-rating","#list-fav"].forEach(function(e){var t,i,n=_.getStack().get(e),s=n.getModel();s.watch("deleted",function(){console.log("deleted"),n===_.getStack().getCurrentScreen()&&(t=n.dom.querySelector(".list-item.selected")||n.dom.querySelector("li[data-listideas_id='0']"),t&&(i=t.getAttribute("data-listideas_id")),s.getNbItems()?T.reset(s,i):T.displayEmpty(_.getStack().getCurrentName()))})}),k.watch("NewIdea",function(e,t){var i,n,s,a=m.getModel();t&&("#list-date"!==_.getStack().getCurrentName()&&_.getStack().show("#list-date"),x.loop(function(e,t){"#list-date"===e.name?x.update(t,"pushed",!0):x.update(t,"pushed",!1)}),I.spin(document.getElementById("public-list")),m.resetQuery().then(function(){a.loop(function(t,i){t.id===e&&(n=i)}),i=m.dom.querySelector(".list-item.selected"),i&&i.classList.remove("selected"),s=m.dom.querySelector("li[data-listideas_id='"+n+"']"),s.classList.add("selected"),S.init(n),s.scrollIntoView(),T.reset(a,n),I.stop()}))}),y}}),define("library/ideas/detail-stack/library-idea",["OObject","Store","Bind.plugin","Event.plugin","service/map","service/utils","service/avatar","service/config","twocents/writetwocent","twocents/twocentlist","Observable","Promise","CouchDBDocument","Place.plugin","lib/spin.min","attach/attachment"],function(e,t,i,n,s,a,o,r,l,c,d,u,p,g,h,m){return function(v){var f=new e,b=new c("library"),w=new l("library"),y=new m("idea"),L=r.get("labels"),k=new t([{active:!1},{active:!1},{active:!1},{active:!1},{active:!1}]),S=!1,T=r.get("user"),M=r.get("transport"),A=new p,C=new t([]),x=new t([]),q=s.get("ideas-detail"),H=s.get("library-writetwocents");return new d,A.setTransport(M),f.plugins.addAll({label:new i(L),ideadetail:new i(A,{displayView:function(e){e?this.classList.remove("invisible"):this.classList.add("invisible")},toggleFavEdit:function(e){var t=this;e.indexOf(T.get("_id"))>-1?t.setAttribute("href","#library-edit"):(t.setAttribute("href","#library-favorites"),T.get("library-favorites")&&T.get("library-favorites").indexOf(A.get("_id"))>-1?t.classList.add("unfav"):t.classList.remove("unfav"),T.watchValue("library-favorites",function(e){e.indexOf(A.get("_id"))>-1?t.classList.add("unfav"):t.classList.remove("unfav")}))},toggleTwocentShare:function(e){e.indexOf(T.get("_id"))>-1?this.setAttribute("href","#library-share"):this.setAttribute("href","#library-2cents")},displayWriteTwocent:function(e){e.indexOf(T.get("_id"))<0?this.classList.remove("invisible"):this.classList.add("invisible")},displayTwocentList:function(e){e&&e.length&&document.getElementById("library-writetwocents").classList.add("invisible")},date:function _(_){_&&(this.innerHTML=a.formatDate(_))},setAuthor:function(e){this.innerHTML=e===T.get("username")&&A.get("authors").indexOf(T.get("_id"))>-1?L.get("youlbl"):e},setWrotelbl:function(e){this.innerHTML=1===e.length&&e[0]===T.get("_id")?L.get("youwrotelbl"):e.length>1?L.get("theywrotelbl"):L.get("ideawrotelbl")},setAvatar:function(e){var t=document.createDocumentFragment(),i=new o(e);i.place(t),this.hasChildNodes()?this.replaceChild(t,this.firstChild):this.appendChild(t)},hideRating:function(e){e.search("I:WELCOME")>-1?this.classList.add("invisible"):this.classList.remove("invisible")},setRating:function(e){this.innerHTML=0===e.length?"":Math.round(100*(e.reduce(function(e,t){return e+t})/e.length))/100},setDescription:function(e){this.innerHTML=e.replace(/\n/g,"<br>")},setSolution:function(e){this.innerHTML=e.replace(/\n/g,"<br>")},toggleVoteButton:function(e){var t=A.get("_id"),i=A.get("authors");document.getElementById("ratingPopup").classList.remove("appear"),T.get("rated_ideas").indexOf(t)<0&&i.indexOf(T.get("_id"))<0&&!S?(this.setAttribute("name","vote"),this.innerHTML=L.get("votebuttonlbl"),this.classList.remove("votes"),this.classList.add("publicButton")):(S=!0,this.classList.remove("publicButton"),this.setAttribute("name","voted"),this.innerHTML=0===e.length?"("+L.get("novotesyet")+")":1===e.length?"("+L.get("onevote")+")":"("+e.length+" "+L.get("votes")+")",this.classList.add("votes"))},setSharedWith:function(e){A.get("_id").search("I:WELCOME")<0&&e&&e.length?(this.classList.remove("invisible"),this.innerHTML=1===e.length?L.get("sharedwith")+"<b><u>"+1+L.get("ideafyer")+"</u></b>":L.get("sharedwith")+"<b><u>"+e.length+L.get("ideafyer")+"</u></b>"):this.classList.add("invisible")},showAttachments:function(e){e&&e.length?this.classList.remove("invisible"):this.classList.add("invisible")}}),alist:new i(x,{setCat:function(e){var t=r.get("cat"),i=r.get("catColors"),n=t.indexOf(e);n>-1?(this.innerHTML=L.get(e),this.setAttribute("style","color:"+i[n])):(this.innerHTML=e,this.setAttribute("sytle","color: #404040"))},setType:function(e){switch(e){default:this.setAttribute("style","background-image: url(../img/r2/download.png)")}},setRef:function(e){var t=r.get("location")+"/downloads";this.getAttribute("data-alist_id"),e&&(t+="?atype=idea&docid="+A.get("_id")+"&file="+e,this.setAttribute("href",t))},setRating:function(e){var t,i=this;e&&(t=new p,t.setTransport(M),t.sync(r.get("db"),e).then(function(){var e=t.get("votes")||[],n=e.length;0===n?(i.innerHTML="",i.parentNode.setAttribute("style","display: none;")):(i.innerHTML=Math.round(100*(e.reduce(function(e,t){return e+t})/n))/100,i.parentNode.setAttribute("style","display: inline-block;"))}))}}),share:new i(C),vote:new i(k,{setIcon:function(e){var t="background-image: url('img/public/activeIdeaVote.png');",i="background-image: url('img/public/rateForList.png');";e?this.setAttribute("style",t):this.setAttribute("style",i)}}),place:new g({LibraryTwocentUI:b,AttachmentUI:y}),ideadetailevent:new n(f)}),f.template='<div class="library-idea invisible" data-ideadetail="bind:displayView, _id"><div class="header blue-dark"><a href="#library-2cents" data-ideadetail="bind: toggleTwocentShare, authors" data-ideadetailevent="listen: mousedown, action" class="option left"></a><span data-label="bind: innerHTML, ideadetailsheadertitle"></span><a href="#library-favorites" data-ideadetail="bind: toggleFavEdit, authors" data-ideadetailevent="listen: mousedown, action" class="option right"></a></div><div id="idea-cache" class="invisible"></div><div class = "detail-contents"><div class="detail-header"><div class="avatar" data-ideadetail="bind:setAvatar, authors"></div><h2 data-ideadetail="bind:innerHTML,title"></h2><span class="date" data-ideadetail="bind:date, creation_date"></span><br><span class="author" data-ideadetail="bind:setAuthor,authornames"></span><span class="commentlbl" data-ideadetail="bind: setWrotelbl, authors"></span></div><div class="detail-body"><legend class="idealegend" data-label="bind:innerHTML, principle"></legend><p data-ideadetail="bind:setDescription,description"></p><legend class="idealegend" data-label="bind:innerHTML, solution"></legend><p data-ideadetail="bind:setSolution,solution"></p><div class="attachments invisible" data-ideadetail="bind:showAttachments, attachments"><legend class="idealegend" data-label="bind:innerHTML, attachments"></legend><div class="toggleattach" data-ideadetailevent="listen: mousedown, toggleAttachments"></div><ul class="a-list" data-alist="foreach"><li><a class="a-type" data-alist="bind:setType, type; bind: setRef, fileName" data-ideadetailevent="listen: mousedown, press; listen: mouseup, release"></a><label class="a-name" data-alist="bind:innerHTML, name">Name</label><label class="a-cat" data-alist="bind:setCat, category"></label><div class="a-rating"><a class="item-acorn"></a><label class="rating" data-alist="bind:setRating,docId"></label></div><label class="a-zoom" data-ideadetailevent="listen: mousedown, press; listen: mouseup, release; listen:mouseup, zoom"></label></li></ul></div></div><div class="detail-footer"><div class="sharedwith invisible" data-ideadetail="bind: setSharedWith, sharedwith" data-ideadetailevent="listen:mousedown, displayList"></div><div id="sharelist" class="autocontact invisible"><div class="autoclose" data-ideadetailevent="listen:mousedown,close"></div><ul data-share="foreach"><li data-share="bind:innerHTML, value.username"></li></ul></div><div class ="rateIdea" data-ideadetail="bind:hideRating, id"><a class="item-acorn"></a><div class="rating" data-ideadetail="bind:setRating,votes"></div><div class="publicButton" data-ideadetail="bind: toggleVoteButton, votes" name="vote" data-ideadetailevent="listen: mousedown, press; listen: mouseup, vote;" data-label="bind: innerHTML, votebuttonlbl"></div><div id="ratingPopup" class="popup"><ul class="acorns" data-vote="foreach"><li class="item-acorn" data-vote="bind: setIcon, active" data-ideadetailevent="listen: mousedown, previewVote; listen: mouseup, castVote"></li></ul></div></div></div></div><div id="library-writetwocents" class="invisible" data-ideadetail="bind: displayWriteTwocent, authors"></div><div id="library-twocents" class="twocents" data-ideadetail="bind: displayTwocentList, twocents" data-place="place: LibraryTwocentUI"></div><div data-place="place: AttachmentUI"></div></div>',f.showCache=function(){f.dom.querySelector("#idea-cache").classList.remove("invisible")},f.hideCache=function(){f.dom.querySelector("#idea-cache").classList.add("invisible")},f.reset=function(e,t){var i=e.get(t).id,n=new u;return k.reset([{active:!1},{active:!1},{active:!1},{active:!1},{active:!1}]),f.getIdea(i).then(function(){A.get("attachments")?x.reset(A.get("attachments")):x.reset([]),A.watchValue("attachments",function(e){x.reset(e)}),S=!1,w.reset(A.get("_id")),b.reset(A.get("_id")),H=document.getElementById("library-writetwocents"),w.place(H),n.fulfill()}),n},f.getIdea=function(e){return A.unsync(),A.reset(),A.sync(r.get("db"),e)},f.refresh=function(){return f.getIdea(A.get("_id"))},f.action=function(e,t){var i,n,s=t.getAttribute("href"),a=A.get("_id"),o=new h({color:"#FFFFFF",lines:8,length:6,width:3,radius:6,left:3,top:3});switch(s){case"#library-2cents":w.reset(a),H.classList.remove("invisible");break;case"#library-favorites":t.classList.add("favwait"),o.spin(t),i=T.get("library-favorites")?T.get("library-favorites").concat():[],n=i.indexOf(a),n>-1?i.splice(i.indexOf(a),1):i.push(a),i.length<100?(T.set("library-favorites",i),T.upload().then(function(){o.stop(),t.classList.remove("favwait"),n>-1?alert(L.get("removedfav")):alert(L.get("addedfav")),t.classList.toggle("unfav")})):(alert(L.get("maxfavsize")),o.stop(),t.classList.remove("favwait"));break;default:v(s)}},f.edit=function(){_stack.getStack().show("#public-edit")},f.press=function(e,t){t.classList.add("pressed")},f.release=function(e,t){t.classList.remove("pressed")},f.toggleAttachments=function(e,t){var i=f.dom.querySelector(".a-list");t.classList.contains("show")?(i.classList.remove("invisible"),t.classList.remove("show")):(i.classList.add("invisible"),t.classList.add("show"))},f.zoom=function(e,t){var i=t.getAttribute("data-alist_id");y.reset(x.get(i).docId),document.querySelector(".cache").classList.add("appear")},f.vote=function(e,t){S||(document.getElementById("cache").classList.add("appear1"),document.getElementById("ratingPopup").classList.add("appear")),t.classList.remove("pressed")},f.previewVote=function(e,t){var i=t.getAttribute("data-vote_id");k.loop(function(e,t){i>=t?k.update(t,"active",!0):k.update(t,"active",!1)})},f.castVote=function(e,t){var i=parseInt(t.getAttribute("data-vote_id"))+1,n=A.get("_id"),s={id:n,vote:i,voter:T.get("_id")};S||(S=!0,M.request("Vote",s,function(e){var t=T.get("rated_ideas")||[];"ok"!==e?(console.log(e,"something went wrong, please try again later"),S=!1):(t.unshift(n),T.set("rated_ideas",t),alert(r.get("labels").get("thankyou")),document.getElementById("ratingPopup").classList.remove("appear"),document.getElementById("cache").classList.remove("appear1"),k.reset([{active:!1},{active:!1},{active:!1},{active:!1},{active:!1}]))}))},f.close=function(e,t){t.parentNode.classList.add("invisible")},f.displayList=function(){M.request("GetUserNames",{list:A.get("sharedwith")},function(e){C.reset(e),document.getElementById("sharelist").classList.remove("invisible")})},f.place(q),f}}),define("library/ideas/detail-stack/library-edit",["OObject","service/map","Store","CouchDBDocument","Bind.plugin","Event.plugin","service/config","service/confirm","Promise","Place.plugin","attach/attachment","attach/add"],function(e,t,n,s,a,o,r,l,c,d,u,p){return function(g){var h,m=new e,v=new u("idea"),f=new p,b=new s,w=new n(r.get("userLanguages")),y=(r.get("user"),r.get("transport")),L=function(){w.loop(function(e,t){b.get("lang")&&e.name===b.get("lang").substring(0,2)?w.update(t,"selected",!0):w.update(t,"selected",!1)})},k=r.get("labels"),S=new n({error:""}),T=new n([]),M=[],A=[];return b.setTransport(y),m.plugins.addAll({editlabel:new a(k),editidea:new a(b,{displayLang:function(e){var t;e&&(t=e.substring(0,2),this.setAttribute("style","background-image:url('img/flags/"+t+".png');"))},setVisibility:function(e){this.innerHTML="public"===e?k.get("publiclbl"):k.get("privatelbl")},hideVisibility:function(e){"public"===e?this.setAttribute("style","display:none"):this.setAttribute("style","display:inline-block")},setVisibleIcon:function(e){"public"===e?this.setAttribute("style","background:url('img/public/publicForList.png') no-repeat left center; background-size: 14px 12px;"):this.setAttribute("style","background-image:url('img/public/privateForList.png');")},setReplay:function(e){e&&-1===e.search("deleted")?this.setAttribute("style","display:inline-block"):this.setAttribute("style","display:none")},setIdeafyStatus:function(e){this.innerHTML=e?k.get("enabledreplaylbl"):k.get("disabledreplaylbl")},setSessionReplay:function(e){this.innerHTML=e?k.get("disablereplaylbl"):k.get("enablereplaylbl")},showAttachments:function(e){e&&e.length?this.classList.remove("invisible"):this.classList.add("invisible")}}),alist:new a(T,{setCat:function(e){var t=r.get("cat"),i=r.get("catColors"),n=t.indexOf(e);n>-1?(this.innerHTML=k.get(e),this.setAttribute("style","color:"+i[n])):(this.innerHTML=e,this.setAttribute("style","color: #404040"))},setType:function(e){switch(e){default:this.setAttribute("style","background-image: url(../img/r2/download.png)")}},setRef:function(e){var t=r.get("location")+"/downloads";this.getAttribute("data-alist_id"),e&&(t+="?atype=idea&docid="+b.get("_id")+"&file="+e,this.setAttribute("href",t))},setRating:function(e){var t,i=this;e&&(t=new s,t.setTransport(y),t.sync(r.get("db"),e).then(function(){var e=t.get("votes")||[],n=e.length;i.innerHTML=0===n?"":Math.round(100*(e.reduce(function(e,t){return e+t})/n))/100}))}}),select:new a(w,{setBg:function(e){e&&this.setAttribute("style","background-image:url('img/flags/"+e+".png');")},setSelected:function(e){e?this.classList.add("selected"):this.classList.remove("selected")}}),place:new d({AttachmentUI:v,AddAttachmentUI:f}),editevent:new o(m),errormsg:new a(S,{setError:function(e){switch(e){case"notitle":this.innerHTML=k.get("titlefield")+k.get("emptyfielderror");break;case"nodesc":this.innerHTML=k.get("descriptionfield")+k.get("emptyfielderror");break;case"nosol":this.innerHTML=k.get("solutionfield")+k.get("emptyfielderror");break;default:this.innerHTML=""}}})}),m.template='<div class="idea-edit"><div class="header blue-dark"><span data-editlabel="bind:innerHTML, modifyidealbl"></span></div><form class="form"><div class="idealang"><div class="currentlang" data-editidea="bind: displayLang, lang" data-editevent="listen: mouseup, showLang"></div><ul class="invisible" data-select="foreach"><li data-select="bind: setBg, name; bind: setSelected, selected" data-editevent="listen: mousedown, selectFlag; listen: mouseup, setLang"></li></ul></div><p><legend class="idealegend" data-editlabel="bind:innerHTML, title"></legend><input type="text" class="input" data-editidea="bind: value, title"></p><p><legend class="idealegend" data-editlabel="bind:innerHTML, principle"></legend><textarea class="description input" data-editidea="bind: value, description"></textarea></p><p><legend class="idealegend" data-editlabel="bind:innerHTML, solution"></legend><textarea class="solution input" data-editidea="bind: value, solution"></textarea></p><div class="options"><div class="current-visibility" data-editidea="bind:setVisibleIcon, visibility"><span class="label" data-editlabel="bind:innerHTML,ideavisiblelbl"></span><span data-editlabel="bind:innerHTML, privatelbl" data-editidea="bind:setVisibility, visibility"></span></div><div class="edit-visibility" data-editidea="bind:hideVisibility, visibility"><span class="label" data-editlabel="bind:innerHTML,setideavisiblelbl"></span><div class="visibility public" data-editlabel="bind:innerHTML, publiclbl" data-editevent="listen:mousedown, editVisibility"></div></div></div><div class="options invisible" data-editidea="bind:setReplay, sessionId"><div class="current-visibility replay"><span class="label" data-editlabel="bind:innerHTML,ideafyreplaylbl"></span><span data-editlabel="bind:innerHTML, disabledreplaylbl" data-editidea="bind:setIdeafyStatus, sessionReplay"></span></div><div class="edit-visibility replay"><span class="label" data-editlabel="bind:innerHTML, ideafysetreplaylbl"></span><div class="toggle-replay" data-editidea = "bind: setSessionReplay, sessionReplay" data-editevent="listen:mousedown, press; listen:mouseup, enableReplay" data-editlabel="bind:innerHTML, enablereplaylbl"></div></div></div><p class="submit"><label class="publish pressed-btn" data-editlabel="bind:innerHTML, publishlbl" data-editevent="listen: mousedown, press; listen:mouseup, upload"></label><label class="cancel pressed-btn" data-editlabel="bind:innerHTML, cancellbl" data-editevent="listen: mousedown, press;listen:mouseup, cancel"></label><label class="editerror" data-errormsg="bind:setError, error"></label></p></form><div class="attachments"><legend class="idealegend" data-editlabel="bind:innerHTML, attachments"></legend><div class="toggleattach" data-editevent="listen: mousedown, toggleAttachments"></div><ul class="a-list" data-alist="foreach"><li><a class="a-type" data-alist="bind:setType, type; bind: setRef, fileName" data-editevent="listen: mousedown, press; listen: mouseup, release"></a><label class="a-name" data-alist="bind:innerHTML, name">Name</label><label class="a-cat" data-alist="bind:setCat, category"></label><label class="a-delete" data-editevent="listen:mousedown, press; listen:mouseup, removeAttachment"></label><label class="a-zoom" data-editevent="listen: mousedown, press; listen: mouseup, release; listen:mouseup, zoom"></label></li></ul><legend class="a-legend" data-editlabel="bind:innerHTML, alegend"></legend><div data-place="place: AddAttachmentUI"></div></div><div data-place="place: AttachmentUI"></div></div>',m.place(t.get("library-edit")),m.reset=function(e){b.unsync(),b.reset(),M=[],A=[],b.sync(r.get("db"),e).then(function(){L(),b.get("attachments")?T.reset(b.get("attachments").concat()):T.reset([]),f.reset(e,"idea",T),T.watch("added",function(e,t){M.push(t.docId)
})}),h=!1},m.showLang=function(){m.dom.querySelector(".idealang ul").classList.remove("invisible")},m.selectFlag=function(e,t){var i;e.stopPropagation(),i=parseInt(t.getAttribute("data-select_id"),10),w.loop(function(e,t){i===t?w.update(t,"selected",!0):w.update(t,"selected",!1)})},m.setLang=function(e,t){var i;e.stopPropagation(),i=t.getAttribute("data-select_id"),b.set("lang",w.get(i).name),m.dom.querySelector(".idealang ul").classList.add("invisible")},m.editVisibility=function(e,t){var i=new l(t,k.get("setpublicquestion"),function(e){e?b.set("visibility","public"):b.set("visibility","private"),i.close()})},m.press=function(e,t){t.classList.add("pressed")},m.release=function(e,t){t.classList.remove("pressed")},m.toggleAttachments=function(e,t){var i=m.dom.querySelector(".a-list");t.classList.contains("show")?(i.classList.remove("invisible"),t.classList.remove("show")):(i.classList.add("invisible"),t.classList.add("show"))},m.removeAttachment=function(e,t){var i=t.getAttribute("data-alist_id"),n=T.get(i).docId;A.push(n),T.alter("splice",i,1),t.classList.remove("pressed")},m.manageAttachments=function(){var e=M,t=A;t.length&&t.forEach(function(t){var n=-1,s=-1;for(i=0;i<e.length;i++)if(e[i]===t){n=i;break}n>-1&&e.splice(n,1),T.loop(function(e,i){e.docId===t&&(s=i)}),s>-1&&T.alter("splice",s,1),f.deleteAttachmentDoc(t)}),(e.length||t.length)&&b.set("attachments",JSON.parse(T.toJSON()))},m.zoom=function(e,t){var i=t.getAttribute("data-alist_id");v.reset(T.get(i).docId),document.querySelector(".cache").classList.add("appear")},m.enableReplay=function(e,t){setTimeout(function(){b.get("sessionReplay")?b.set("sessionReplay",!1):b.set("sessionReplay",!0),h=!0,t.classList.remove("pressed")},300)},m.updateSessionReplay=function(e){var t=new c,i=new s;return i.setTransport(r.get("transport")),i.sync(r.get("db"),b.get("sessionId")).then(function(){var n,s=i.get("replayIdeas")||[];if(e)s.push(b.get("_id"));else for(n=s.length-1;n>=0;n--)s[n]===b.get("_id")&&s.splice(n,1);i.set("replayIdeas",s),i.upload().then(function(){t.fulfill(),i.unsync()})}),t},m.upload=function(e,t){var i=new Date,n=[i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds()];""===b.get("title")?S.set("error","notitle"):""===b.get("description")?S.set("error","nodesc"):""===b.get("solution")?S.set("error","nosol"):(m.manageAttachments(),b.set("modification_date",n),b.upload().then(function(){h&&m.updateSessionReplay(b.get("sessionReplay")).then(null,function(e){console.log(e)}),m.dom.querySelector(".idealang ul").classList.add("invisible"),g("close")})),t.classList.remove("pressed")},m.cancel=function(e,t){t.classList.remove("pressed"),m.dom.querySelector(".idealang ul").classList.add("invisible"),g("close")},m}}),define("library/ideas/detail-stack/library-sendmail",["OObject","service/map","service/config","Bind.plugin","Event.plugin","Store","service/avatar","service/utils"],function(e,t,n,s,a,o,r,c){return function(d){var u=new e,p=new o({errormsg:""}),g=n.get("user"),h=n.get("transport"),m=n.get("labels"),v=new o({toField:"",from:"",subject:"",body:"",signature:"",attachment:"",sent:!1});return u.plugins.addAll({labels:new s(m),mail:new s(v,{setUserAvatar:function(e){e&&this.setAttribute("style","background: url('"+n.get("avatar")+"') no-repeat center center; background-size: cover")},date:function f(f){f&&(this.innerHTML=c.formatDate(f))},setAvatar:function(e){if(e){var t=document.createDocumentFragment(),i=new r(e);i.place(t),this.hasChildNodes()?this.replaceChild(t,this.firstChild):this.appendChild(t)}},setRating:function(){},setVotes:function(){}}),mailevent:new a(u),errormsg:new s(p)}),u.template='<div class="idea-sendmail"><div class="header blue-dark"><span data-labels="bind:innerHTML, sendidealbl"></span></div><div class="avatar" data-mail="bind:setUserAvatar, from"></div><form class="form"><p><textarea class="mail-header" data-mail="bind: value, toField" data-labels="bind:placeholder, tolbl"></textarea></p><p><input type="text" class="input" data-mail="bind:value, subject" data-labels="bind:placeholder, subjectlbl"></textarea></p><p><textarea class="input" data-mail="bind:value, body"></textarea></p><p><legend data-labels="bind: innerHTML, signaturelbl"></legend><textarea class="signature" data-mail="bind:value, signature"></textarea></p><div class="attachment"><div class="attachment-header"><div data-mail="bind:setAvatar, attachment.authors"></div><span class="date" data-mail="bind:date, attachment.creation_date"></span><h2 data-mail="bind:innerHTML,attachment.title"></h2><span class="author" data-mail="bind:innerHTML,attachment.authornames"></span><span data-labels="bind:innerHTML, ideawrotelbl"></span><div class="visibility-icon private"></div></div><div class="attachment-body"><p data-mail="bind:innerHTML,attachment.description"></p><p data-mail="bind:innerHTML,attachment.solution"></p><div class = "rating" data-mail="bind:setRating, attachment.rating"></div><div class = "votes" data-mail="bind:setVotes, attachment.votes"></div></div></div><div class="sendmail-footer"><p class="send"><label class="cancelmail" data-labels="bind:innerHTML, cancellbl" data-mailevent="listen: mousedown, press; listen:mouseup, cancel">Cancel</label><label class="sendmail" data-labels="bind:innerHTML, sendlbl" data-mailevent="listen:mousedown, press; listen:mouseup, send">Send</label><label class="editerror" data-errormsg="bind:innerHTML, errormsg"></label></p></div></form></div>',u.reset=function(e){p.reset({errormsg:""}),v.reset({toField:"",from:g.get("username"),subject:"",body:"",signature:g.get("username")+" <"+g.get("_id"),attachment:e,sent:!1}),g.get("signature")&&v.set("signature",g.get("signature"))},u.validateAddress=function(e){var t=/^[a-z0-9._-]+@[a-z0-9.-]+\.[a-z]{2,4}$/,n=e.toLowerCase().split(/,|;/),s=!0;for(i=0,l=n.length;l>i;i++)if(!t.test(n[i].trim())){p.set("errormsg",n[i]+m.get("notavalidaddress")),s=!1;break}return s},u.validateMessage=function(){return v.get("toField")?u.validateAddress(v.get("toField")):p.set("errormsg",m.get("norecipient")),""===p.get("errormsg")},u.sendMail=function(){var e={};e.type="doc",e.recipient=v.get("toField"),e.cc=g.get("_id"),e.replyTo=g.get("_id"),e.subject=g.get("username")+m.get("sentdocmsg"),e.header=v.get("subject"),e.body=v.get("body"),e.signature=v.get("signature"),e.attachHeader="<div style='background:#657B99; font-family:Helvetica; padding:15px;'><p style='color:white;font-size:24px;font-weight:bold;margin-top:10px;'>"+v.get("attachment").title+"</p><p style='color: #F27B3D; font-size:16px; font-weight:bold;margin-bottom:10px;'>"+v.get("attachment").authornames+", <span style='color:black';>"+c.formatDate(v.get("attachment").creation_date)+"</span></p></div>",e.attachBody="<div style='border:1px solid #657b99;background:white'><p style='font-size:14px; font-family:Helvetica; text-align:justify; padding:15px;'>"+v.get("attachment").description+"</p><p style='font-size:14px; font-family:Helvetica; text-align:justify; padding:15px;'>"+v.get("attachment").solution+"</p></div>",h.request("SendMail",e,function(e){"ok"===e.sendmail?(p.set("errormsg",m.get("yourmessage")+e.recipient+m.get("sentoklbl")),setTimeout(function(){d("close")},350)):(p.set("errormsg",m.get("somethingwrong")),v.set("sent",!1),console.log("error",e.error),console.log("response",e.response))})},u.press=function(e,t){t.classList.contains("sendmail")&&v.get("sent")||t.classList.add("pressed")},u.send=function(e,t){v.get("sent")||(v.set("sent",!0),p.set("errormsg",""),t.classList.remove("pressed"),u.validateMessage()?u.sendMail():v.set("sent",!1))},u.cancel=function(e,t){t.classList.remove("pressed"),d("close")},u.place(t.get("library-sendmail")),u}}),define("library/ideas/detail-stack/library-share",["OObject","service/map","service/config","Bind.plugin","Event.plugin","Store","service/avatar","service/utils","service/autocontact","CouchDBDocument","Promise","lib/spin.min"],function(e,t,n,s,a,o,r,l,c,d,u,p){return function(r){var l=new e,c=new o({errormsg:""}),g=n.get("user"),h=n.get("transport"),m=n.get("labels"),v=new o({body:"",docId:"",docType:"",attachment:"",docTitle:"",signature:g.get("signature")}),f=new o([]),b=new o([]),w=!1,y=new p({color:"#5F8F28",lines:8,length:8,width:4,radius:8,left:30,top:-6}).spin();return l.plugins.addAll({labels:new s(m),share:new s(v,{setHeader:function(e){this.innerHTML=m.get("sharing")+e}}),contacts:new s(b,{setSelected:function(e){this.innerHTML=e?"&#10003;":""}}),auto:new s(f,{highlight:function(e){e?this.classList.add("selected"):this.classList.remove("selected")}}),shareevent:new a(l),errormsg:new s(c)}),l.template='<div class="idea-share"><div class="header blue-dark"><span data-share="bind:setHeader, docTitle">Sharing idea</span></div><form class="form"><legend>Select contacts</legend><div class="selectall" data-labels="bind:innerHTML, selectall" data-shareevent="listen: mousedown, press; listen:mouseup, selectAll">Select all</div><input class="search" data-shareevent="listen:mousedown, displayAutoContact; listen:input, updateAutoContact" data-labels="bind:placeholder, tocontactlbl"><div id="sharelistauto" class="autocontact invisible"><div class="autoclose" data-shareevent="listen:mousedown,close"></div><ul data-auto="foreach"><li data-auto="bind:innerHTML, username; bind:highlight, selected" data-shareevent="listen:mouseup, select"></li></ul></div><div class="sharecontactlist"><ul data-contacts="foreach"><li class = "contact list-item" data-shareevent="listen:mousedown, discardContact"><p class="contact-name" data-contacts="bind:innerHTML, username"></p><div class="remove-contact"></div><p class="contact-intro" data-contacts="bind:innerHTML, intro"></p></li></ul></div><p><legend>Add a message</legend><textarea class="input sharemessage" data-share="bind:value, body"></textarea></p><p><legend>Signature</legend><textarea class="signature" data-share="bind:value, signature"></textarea></p><div class="sendmail-footer"><p class="send"><label class="cancelmail" data-labels="bind:innerHTML, cancellbl" data-shareevent="listen: mousedown, press; listen:mouseup, cancel">Cancel</label><label class="sendmail" data-labels="bind:innerHTML, sharelbl" data-shareevent="listen:mousedown, press; listen:mouseup, share">Share</label><label class="editerror" data-errormsg="bind:innerHTML, errormsg"></label></p></div></form></div>',l.reset=function(e){c.reset({errormsg:""}),v.reset({body:"",docId:e,docType:"",docTitle:"",signature:g.get("username")+" <"+g.get("_id")+">"}),l.getIdeaDetails(e),g.get("signature")&&v.set("signature",g.get("signature")),b.reset([]),f.reset(g.get("connections").concat())},l.getIdeaDetails=function(e){var t=new d({});t.setTransport(h),t.sync(n.get("db"),e).then(function(){v.set("docType",t.get("type")),v.set("docTitle",t.get("title")),t.unsync()})},l.updateAutoContact=function(e,t){var n,s=JSON.parse(f.toJSON()),a=g.get("connections").concat(),o=t.value.toLowerCase();if(""===t.value)f.reset(a);else{for(i=s.length-1;i>=0;i--)n=s[i].username.toLowerCase(),0!==n.search(o)&&s.splice(i,1);f.reset(s)}f.loop(function(e,t){b.toJSON().search(e.userid)>-1&&f.update(t,"selected",!0)})},l.close=function(e,t){t.parentNode.classList.add("invisible")},l.displayAutoContact=function(){l.dom.querySelector("#sharelistauto").classList.remove("invisible"),f.reset(g.get("connections").concat())},l.discardContact=function(e,t){var i=t.getAttribute("data-contacts_id"),n=b.get(i).userid;b.alter("splice",i,1),f.loop(function(e,t){e.userid===n&&setTimeout(function(){f.update(t,"selected",!1)},200)}),l.unselectGroup(n)},l.select=function(e,t){var i=t.getAttribute("data-auto_id");f.get(i).selected?(l.removeContact(f.get(i)),setTimeout(function(){f.update(i,"selected",!1),document.getElementById("sharelistauto").classList.add("invisible")},200)):(l.addContact(f.get(i)),l.selectGroup(),setTimeout(function(){f.update(i,"selected",!0),document.getElementById("sharelistauto").classList.add("invisible")},200))},l.selectAll=function(e,t){t.classList.remove("pressed"),b.reset([]),f.reset(g.get("connections").concat()),f.loop(function(e,t){f.update(t,"selected",!0),"user"===e.type&&b.alter("push",e)})},l.removeContact=function(e){if("group"===e.type)for(j=e.contacts.length-1;j>=0;j--)l.removeContact(e.contacts[j]);else b.loop(function(t,i){t.userid===e.userid&&b.alter("splice",i,1)}),l.unselectGroup(e.userid),f.loop(function(t,i){t.userid===e.userid&&f.update(i,"selected",!1)})},l.selectGroup=function(){var e,t=!1;f.loop(function(i,n){if("group"===i.type&&!i.selected){for(e=i.contacts,t=!0,j=e.length-1;j>=0;j--)if(b.toJSON().search(e[j].userid)<0){t=!1;break}t&&f.update(n,"selected",!0)}})},l.unselectGroup=function(e){f.loop(function(t,i){"group"===t.type&&t.selected&&JSON.stringify(t.contacts).search(e)>0&&f.update(i,"selected",!1)})},l.addContact=function(e){var t,i,n=!0;if("user"===e.type)b.alter("push",e);else for(t=0,i=e.contacts.length;i>t;t++)b.loop(function(i){i.userid===e.contacts[t].userid&&(n=!1)}),n&&(b.alter("push",e.contacts[t]),f.loop(function(i,n){i.userid===e.contacts[t].userid&&f.update(n,"selected",!0)}))},l.press=function(e,t){t.classList.add("pressed")},l.share=function(e,t){var i=new Date,n={type:"DOC",status:"unread",date:[i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getMinutes()],author:g.get("_id"),username:g.get("username"),firstname:g.get("firstname"),toList:"",ccList:"",object:"",body:v.get("body"),signature:v.get("signature"),docId:v.get("docId"),docType:v.get("docType"),docTitle:v.get("docTitle"),dest:[]};w||(w=!0,y.spin(t),l.buildRecipientList(n.docId,n.dest).then(function(){n.dest.length?h.request("Notify",n,function(){c.set("errormsg",m.get("shareok")),t.classList.remove("pressed"),w=!1,setTimeout(function(){y.stop(),l.reset(n.docId),l.dom.querySelector("#sharelistauto").classList.add("invisible"),f.reset(g.get("connections").concat()),r("close")},2500)}):(c.set("errormsg","intented recipients already have this idea"),t.classList.remove("pressed"),w=!1,setTimeout(function(){y.stop(),l.reset(n.docId),l.dom.querySelector("#sharelistauto").classList.add("invisible"),f.reset(g.get("connections").concat()),r("close")},2500))}))},l.cancel=function(e,t){t.classList.remove("pressed"),r("close")},l.buildRecipientList=function(e,t){var i=new u,s=new d;return s.setTransport(h),s.sync(n.get("db"),e).then(function(){var e=s.get("sharedwith")||[],i=s.get("authors");return b.loop(function(n){i.indexOf(n.userid)<0&&(e.length?e.indexOf(n.userid)<0&&(e.push(n.userid),t.push(n.userid)):(e.push(n.userid),t.push(n.userid)))}),s.set("sharedwith",e),s.upload()}).then(function(){i.fulfill()}),i},l.place(t.get("library-share")),l}}),define("library/ideas/idea-stack",["OObject","service/map","Amy/Stack-plugin","Bind.plugin","./detail-stack/library-idea","./detail-stack/library-edit","./detail-stack/library-sendmail","./detail-stack/library-share","service/config","Store","lib/spin.min"],function(e,t,i,n,s,a,o,r,l,c,d){return function(){var t,u,p,g,h=new e,m=new e,v=new i,f=l.get("observer"),b=l.get("labels"),w=new c,y=0,L=new d({color:"#808080",lines:10,length:12,width:6,radius:10,top:328}).spin();return h.plugins.addAll({detailstack:v}),h.template='<div class="detail-stack" data-detailstack="destination"></div>',m.template='<div class="msgsplash"><div class="header blue-dark"><span data-labels="bind:innerHTML, noideafound"></span></div><div class="innersplash"><span data-labels="bind: innerHTML, tryotherview"></span></div></div>',m.plugins.add("labels",new n(b)),h.reset=function(e,i){var n;w=e,y=i,v.getStack().show("#library-ideadetail"),t.hideCache(),L.spin(h.dom),t.reset(e,i).then(function(){L.stop(),n.classList.add("invisible")})},h.action=function(e){switch(e){case"#library-edit":g.reset(w.get(y).id),v.getStack().show("#library-edit");break;case"#library-favorites":break;case"#library-share":p.reset(w.get(y).id),v.getStack().show("#library-share");break;case"close":v.getStack().show("#library-ideadetail"),L.spin(h.dom),t.refresh().then(function(){L.stop()});break;default:v.getStack().show("#library-ideadetail")}},h.edit=function(e){g.reset(e),v.getStack().show("#library-edit")},h.sendMail=function(e){u.reset(e),v.getStack().show("#library-sendmail")},h.share=function(e){p.reset(e._id),v.getStack().show("#library-share")},h.displayEmpty=function(){v.getStack().show("#empty-list")},t=new s(h.action),g=new a(h.action),u=new o(h.action),p=new r(h.action),v.getStack().add("#library-ideadetail",t),v.getStack().add("#library-edit",g),v.getStack().add("#library-sendmail",u),v.getStack().add("#library-share",p),v.getStack().add("#empty-list",m),f.watch("library-viewidea",function(e){h.viewIdea(e)}),f.watch("library-edit",function(e){h.edit(e)}),f.watch("library-sendmail",function(e){h.sendMail(e)}),f.watch("library-share",function(e){h.share(e)}),h}}),define("library/ideas/lists/idealist",["OObject","CouchDBView","service/config","Bind.plugin","Event.plugin","service/utils","service/avatar","service/actionbar","Promise"],function(e,t,i,n,s,a,o,r,l){function c(e,o,c,d){var u=new t([]),p=null,g={db:e,view:c,design:o,query:{descending:!0}},h=i.get("user"),m=this;u.setTransport(i.get("transport")),d&&(g.query=d),this.template='<div><div class="noresult date invisible" data-labels="bind:innerHTML, noresult"></div><ul class="idea-list" data-listideas="foreach"><li class="list-item" data-listevent="listen:mousedown, setStart; listen:dblclick, showActionBar"><div class="item-header"><div class="avatar" data-listideas="bind:setAvatar,value.doc.authors"></div><h2 data-listideas="bind:innerHTML,value.doc.authornames"></h2><span class="date" data-listideas="bind:date, value.doc.creation_date"></span></div><div class="item-body"><h3 data-listideas="bind:innerHTML,value.doc.title"></h3><p data-listideas="bind:innerHTML, value.doc.description"></p></div><div class="item-footer"><a class="idea-type private" data-listideas="bind:setVisibility, value.doc.visibility"></a><a class="item-acorn"></a><span class="rating" data-listideas="bind:setRating, value.rating"></span></div></li></ul></div>',g.query.q&&(this.template='<div><div class="noresult date invisible" data-labels="bind:innerHTML, noresult"></div><ul class="idea-list" data-listideas="foreach"><li class="list-item" data-listevent="listen:mousedown, setStart; listen:dblclick, showActionBar"><div class="item-header"><div class="avatar" data-listideas="bind:setAvatar,doc.authors"></div><h2 data-listideas="bind:innerHTML,doc.authornames"></h2><span class="date" data-listideas="bind:date, doc.creation_date"></span></div><div class="item-body"><h3 data-listideas="bind:innerHTML,doc.title"></h3><p data-listideas="bind:setDesc, doc.description"></p></div><div class="item-footer"><a class="idea-type private" data-listideas="bind:setVisibility, doc.visibility"></a><a class="item-acorn"></a><span class="rating" data-listideas="bind:setRating, rating"></span></div></li></ul></div>'),m.plugins.addAll({labels:new n(i.get("labels")),listideas:new n(u,{date:function v(v){this.innerHTML=v?a.formatDate(v):""},setDesc:function(e){this.innerHTML=e.replace(/\n/g,"<br>")},setRating:function(e){if(void 0===e){var t=this.getAttribute("data-listideas_id"),i=u.get(t).doc.votes||[];this.innerHTML=0===i.length?"0":Math.round(100*(i.reduce(function(e,t){return e+t})/i.length))/100}else this.innerHTML=Math.round(100*e)/100},setAvatar:function(){},setVisibility:function(e){"public"===e?this.classList.add("public"):this.classList.remove("public")}}),listevent:new s(this)}),m.getModel=function(){return u},m.resetQuery=function(e){var t=new l,n=m.dom.querySelector(".noresult"),s=i.get("user").get("library-favorites")||[],a={idList:s};return g.query=e,u.unsync(),u.reset([]),"fav"===d?i.get("transport").request("GetFavList",a,function(i){var s,a,o,r=JSON.parse(i);if(e&&"*"!==e)for(s=0,a=r.length;a>s;s++)o=r[s].value.doc.lang.substring(0,2),e===o&&u.alter("push",r[s]);else u.reset(r);u.getNbItems()?n.classList.add("invisible"):n.classList.remove("invisible"),t.fulfill()}):u.sync(g.db,g.design,g.view,g.query).then(function(){p&&p.hide(),u.getNbItems()?n.classList.add("invisible"):n.classList.remove("invisible"),t.fulfill()}),t},m.setStart=function(){p&&(p.hide(),p=null)},m.setLang=function(e){var t;if("fav"===d)t=e;else switch(c){case"_view/ideas":t="*"===e?{key:'"'+h.get("_id")+'"',descending:!0}:{key:'[0,"'+h.get("_id")+'","'+e+'"]',descending:!0};break;case"_view/privatebyvotes":t="*"===e?{endkey:'[0,"'+h.get("_id")+'"]',startkey:'[0,"'+h.get("_id")+'",{},{}]',descending:!0}:{endkey:'[1,"'+h.get("_id")+'"]',startkey:'[1,"'+h.get("_id")+'","'+e+'",{},{}]',descending:!0}}return m.resetQuery(t)},m.showActionBar=function(e,t){var i,n=t.getAttribute("data-listideas_id"),s=!1,a=document.getElementById("ideas");p&&p.getParent()===t&&(s=!0),a.classList.contains("mosaic")||s||(p=new r("idea",t,u.get(n).id),i=document.createDocumentFragment(),p.place(i),t.appendChild(i),s=!0)},m.init=function(){var e=new l,t=h.get("library-favorites")||[],n={idList:t},s=m.dom.querySelector(".noresult");return"fav"===d?t.length?i.get("transport").request("GetFavList",n,function(t){u.reset(JSON.parse(t)),s.classList.add("invisible"),e.fulfill()}):(u.reset([]),s.classList.remove("invisible"),e.fulfill()):u.sync(g.db,g.design,g.view,g.query).then(function(){u.getNbItems()?s.classList.add("invisible"):s.classList.remove("invisible"),e.fulfill()}),e}}return function(t,i,n,s){return c.prototype=new e,new c(t,i,n,s)}}),define("library/ideas/ideas",["OObject","Amy/Control-plugin","Bind.plugin","Place.plugin","Amy/Delegate-plugin","Store","service/map","service/config","./idea-stack","./lists/idealist","Amy/Stack-plugin","lib/spin.min"],function(e,t,i,n,s,a,o,r,l,c,d,u){return function(){var p,g,h,m,v,f,b=new e,w=new a({search:""}),y=r.get("db"),L=r.get("observer"),k=new t(b),S=new l,T=r.get("user"),M=r.get("labels"),A=T.get("lang").substring(0,2),C=new a([{name:"#list-fav",css:"byfav",pushed:!1,lang:null},{name:"#list-date",css:"bydate",pushed:!0,lang:null},{name:"#list-rating",css:"byrating",pushed:!1,lang:null},{name:"#lang",css:"bylang",pushed:!1,lang:A}]),x=new a([{name:"*"}]),q=r.get("userLanguages"),H=new d,_=new u({color:"#808080",lines:10,length:12,width:6,radius:10,top:328}).spin();return q.forEach(function(e){x.alter("push",e)}),b.template='<div id = "ideas"><div id="idea-list" class="list"><div class="header blue-light"><div class="option left" data-ideascontrol="toggle:.option.left,mosaic,mousedown,mosaic"></div><span data-label="bind: innerHTML, idealistheadertitle">My Ideas</span><div class="option right" data-ideasevent="listen: mousedown, plus"></div></div><div data-idealiststack="destination" data-ideascontrol="radio:li.list-item,selected,mousedown,selectStart"><div class="tools"><input class="search" type="text" data-search="bind: value, search" data-label="bind: placeholder, searchprivateplaceholder" data-ideasevent="listen: keypress, search"><ul class="listbtns" data-listbtns="foreach"><li class="tools-button" data-listbtns="bind:setName, name; bind:setClass, css; bind:setPushed, pushed; bind:setLang, lang" data-ideasevent="listen:mouseup,show"></li></ul><ul class="langlist invisible" data-select="foreach"><li data-select="bind: setBg, name" data-ideasevent="listen: mousedown, setLang; listen:touchend, mouseup"></li></ul></div></div></div><div id="ideas-detail" class="details" data-ideaplace="place:details"></div></div>',b.plugins.addAll({idealiststack:H,listbtns:new i(C,{setPushed:function(e){e?this.classList.add("pushed"):this.classList.remove("pushed")},setLang:function(e){e&&"*"!==e&&(this.setAttribute("style","background-image:url('img/flags/"+e+".png');"),this.innerHTML=""),"*"===e&&(this.setAttribute("style","background-image: none;"),this.innerHTML="*")},setClass:function(e){e&&this.classList.add(e)},setName:function(e){e&&this.setAttribute("name",e)}}),select:new i(x,{setBg:function(e){"*"===e?(this.setAttribute("style","background-image: none;background: whitesmoke;"),this.innerHTML="*"):this.setAttribute("style","background-image:url('img/flags/"+e+".png');")}}),label:new i(M),search:new i(w),ideasevent:new s(b),ideaplace:new n({details:S}),ideascontrol:k}),b.place(o.get("ideas")),b.selectStart=function(e){var t=H.getStack().getCurrentScreen().getModel(),i=e.target.getAttribute("data-listideas_id");S.reset(t,i),w.set("search","")},b.displayHighlightedIdea=function(){var e,t=H.getStack().getCurrentScreen(),i=t.dom.querySelector(".list-item.selected")||t.dom.querySelector("li[data-listideas_id='0']");i?(e=i.getAttribute("data-listideas_id"),i.classList.add("selected"),i.scrollIntoView(),k.init(i),S.reset(t.getModel(),e)):S.displayEmpty(H.getStack().getCurrentName())},b.show=function(e,t){var i=parseInt(t.getAttribute("data-listbtns_id"),10),n=C.get(i).name,s=H.getStack();"#lang"===n?b.dom.querySelector(".langlist").classList.remove("invisible"):(C.loop(function(e,t){t===i?C.update(t,"pushed",!0):C.update(t,"pushed",!1)}),n!==s.getCurrentName&&(s.show(n),s.get(n).getModel().getNbItems()?b.displayHighlightedIdea():S.displayEmpty(n)))},b.setLang=function(e,t){var i,n;e.stopPropagation(),e.preventDefault(),i=t.getAttribute("data-select_id"),n=x.get(i).name,A=n,_.spin(document.getElementById("idea-list")),C.loop(function(e,t){"#lang"===e.name&&C.update(t,"lang",n)}),b.dom.querySelector(".langlist").classList.add("invisible"),["#list-rating","#list-fav","#list-date"].forEach(function(e){var t=H.getStack();t.get(e).setLang(n).then(function(){t.getCurrentName()===e&&_.stop(),t.getCurrentName()===e&&0===t.get(e).getModel().getNbItems()?S.displayEmpty(e):b.displayHighlightedIdea()})})},b.stopPropagation=function(e){e.stopPropagation(),e.preventDefault()},b.mosaic=function(){var e=document.getElementById("ideas-detail");b.dom.classList.toggle("mosaic"),e.classList.contains("invisible")&&(e.classList.remove("invisible"),S.reset(p.getModel(),0))},b.plus=function(){o.get("newidea-popup").classList.add("appear"),o.get("cache").classList.add("appear")},b.search=function(e,t){var i;13===e.keyCode&&(""===t.value?(b.dom.querySelector(".listbtns").classList.remove("invisible"),H.getStack().show("#list-date"),C.loop(function(e,t){"#list-date"===e.name?C.update(t,"pushed",!0):C.update(t,"pushed",!1)}),b.displayHighlightedIdea()):(i=T.get("_id").replace(/@/,"at"),b.searchIdea("users:"+i+" AND "+t.value)),t.blur())},b.searchIdea=function(e){b.dom.querySelector(".listbtns").classList.add("invisible"),h.resetQuery({q:e,sort:"\\creation_date<date>",include_docs:!0}).then(function(){H.getStack().show("#list-search"),h.getModel().getNbItems()>0?(w.set("search",h.getModel().get(0).doc.title),b.dom.querySelector(".noresult").classList.add("invisible"),b.displayHighlightedIdea()):b.dom.querySelector(".noresult").classList.remove("invisible")})},b.reset=function(){w.set("search",""),h.resetQuery({q:"init_listSearch_UI",sort:"\\creation_date<date>",limit:30,include_docs:!0}),g.resetQuery({startkey:'["'+r.get("user").get("_id")+'",{}]',endkey:'["'+r.get("user").get("_id")+'"]',descending:!0,include_docs:!0}),p.resetQuery({key:'"'+T.get("_id")+'"',descending:!0,include_docs:!0}).then(function(){H.getStack().show("#list-date"),b.displayHighlightedIdea()})},T.get("settings").contentLang&&(A=T.get("settings").contentLang,"all"===A&&(A="*"),C.loop(function(e,t){"#lang"===e.name&&C.update(t,"lang",A)})),"*"===A?(v={key:'"'+T.get("_id")+'"',descending:!0},f={endkey:'[0,"'+T.get("_id")+'"]',startkey:'[0,"'+T.get("_id")+'",{},{}]',descending:!0}):(v={key:'[0,"'+T.get("_id")+'","'+A+'"]',descending:!0},f={endkey:'[1,"'+T.get("_id")+'","'+A+'"]',startkey:'[1,"'+T.get("_id")+'","'+A+'",{},{}]',descending:!0}),p=new c(y,"library","_view/ideas",v),h=new c("_fti/local/"+y,"indexedideas","userbyname",{q:"init_listSearch_UI",sort:"\\creation_date<date>",limit:30,include_docs:!0}),g=new c(y,"ideas","_view/privatebyvotes",f),m=new c(y,"library","_view/allideas","fav"),H.getStack().add("#list-date",p),H.getStack().add("#list-rating",g),H.getStack().add("#list-search",h),H.getStack().add("#list-fav",m),g.init(),p.init().then(function(){return H.getStack().show("#list-date"),p.getModel().getNbItems()?b.displayHighlightedIdea():S.displayEmpty("#list-date"),m.setLang(A)}).then(function(){T.watchValue("library-favorites",function(e){e.length!==m.getModel().getNbItems()&&m.resetQuery(A).then(function(){"#list-fav"===H.getStack().getCurrentName()&&(m.getModel().getNbItems()?b.displayHighlightedIdea():S.displayEmpty("#list-fav"))})}),T.watchValue("settings",function(e){A=e.contentLang?"all"===e.contentLang?"*":e.contentLang:T.get("lang").substring(0,2),C.loop(function(e,t){"#lang"===e.name&&C.update(t,"lang",A)}),["#list-date","#list-rating","#list-fav"].forEach(function(e){H.getStack().get(e).setLang(A)})})}),["#list-date","#list-rating","#list-fav"].forEach(function(e){var t,i,n=H.getStack().get(e),s=n.getModel();s.watch("deleted",function(){n===H.getStack().getCurrentScreen()&&(t=n.dom.querySelector(".list-item.selected")||n.dom.querySelector("li[data-listideas_id='0']"),t&&(i=t.getAttribute("data-listideas_id")),s.getNbItems()?S.reset(s,i):S.displayEmpty(H.getStack().getCurrentName()))})}),L.watch("NewIdea",function(e){["#list-date","#list-rating","#list-fav","#list-search"].forEach(function(t){var i,n,s,a=H.getStack().get(t),o=a.getModel();t===H.getStack().getCurrentName()&&(_.spin(document.getElementById("idea-list")),o.watch("added",function(){o.loop(function(t,i){t.id===e&&(n=i)}),i=a.dom.querySelector(".list-item.selected"),i&&i.classList.remove("selected"),s=a.dom.querySelector("li[data-listideas_id='"+n+"']"),s.classList.add("selected"),k.init(n),s.scrollIntoView(),S.reset(o,n),_.stop()}))})}),b}}),define("service/avatarlist",["OObject","Bind.plugin","Event.plugin","service/config","service/utils","Store"],function(e,t,i,n,s,a){function o(e){var s,o=new a([]),r=n.get("avatars");for(this.plugins.addAll({avatar:new t(o,{setAvatar:function(e){this.setAttribute("style","background-image: url('"+e+"');")}}),event:new i(this)}),this.template='<ul data-avatar="foreach"><li data-avatar="bind: setAvatar, img; bind: name, id"></li></ul>',s=0;s<e.length;s++)e[s]===n.get("user").get("_id")?o.alter("push",{id:e[s],img:n.get("avatar")}):r.get(e[s])?o.alter("push",{id:e[s],img:r.get(e[s])}):n.get("transport").request("GetAvatar",{id:e[s]},function(t){t.error||o.alter("push",{id:e[s],img:t})})}return function(t){return o.prototype=new e,new o(t)}}),define("library/sessions/sessions",["OObject","service/map","Bind.plugin","Event.plugin","service/config","CouchDBView","CouchDBDocument","Store","service/utils","service/avatarlist","service/confirm","lib/spin.min","Promise"],function(e,t,n,s,a,o,r,l,c,d,u,p,g){return function(){var h=new e,m=(new e,t.get("sessions")),v=new l,f=a.get("db"),b=a.get("transport"),w=a.get("user"),y=(a.get("avatars"),a.get("labels")),L=new l({}),k="sbydate",S=[],T=[],M="",A=new o,C=new p({color:"#9AC9CD",lines:10,length:10,width:8,radius:10,top:330}).spin();return A.setTransport(b),h.plugins.addAll({label:new n(y),sort:new n(L,{setSelected:function(e){e?this.classList.add("selectsort"):this.classList.remove("selectsort")},setOrder:function(e){e?(this.classList.remove("sort-ascending"),this.classList.add("sort-descending")):(this.classList.remove("sort-descending"),this.classList.add("sort-ascending"))}}),sessions:new n(v,{setMode:function(e){switch(e){case"roulette":this.setAttribute("style","background-image:url('img/brainstorm/roulette-green.png');");break;case"campfire":this.setAttribute("style","background-image:url('img/brainstorm/campfire-orange.png');");break;case"boardroom":this.setAttribute("style","background-image:url('img/brainstorm/boardroom.png');");break;default:this.setAttribute("style","background-image:url('img/library/sessionQuick.png');")}},formatDate:function(e){e&&e.length&&(this.innerHTML=c.formatDate(e))},formatIdeas:function(e){if(e&&1===e.length)this.innerHTML=e[0].title;else if(e&&e.length>1){var t=[];for(i=0;i<e.length;i++)t.push(e[i].title);this.innerHTML=t.join("<br/>")
}else this.innerHTML=y.get("noideayet")},setAvatars:function(e){var t,i;e&&(t=new d(e),i=document.createDocumentFragment(),node=this,t.place(i),node.hasChildNodes()?node.replaceChild(i,node.firstChild):node.appendChild(i))},setStatus:function(e){this.innerHTML="completed"===e?y.get("completed"):y.get("inprogress")},setScore:function(e){this.innerHTML=e>=0?e:""},setSuffix:function(e){this.innerHTML=void 0===e||""===e||null===e?y.get("noscore"):"ip"}}),sortevent:new s(h),sessionevent:new s(h)}),h.template='<div id="sessions"><div id="session-list" class="list"><div id="sessionlistspinner"></div><div class="header blue-light" data-label="bind: innerHTML, library-sessions"></div><div class="session-tools"><div class="session-sorting"><div id="sbytitle" class="sort-button" data-sort="bind: setSelected, sbytitle.selected" data-sortevent="listen: mousedown, sort"><span data-label="bind: innerHTML, sbytitle"></span><div class="sort-caret" data-sort="bind: setOrder, sbytitle.descending"></div></div><div id="sbydate" class="sort-button" data-sort="bind: setSelected, sbydate.selected" data-sortevent="listen: mousedown, sort"><span data-label="bind: innerHTML, sbydate"></span><div class="sort-caret" data-sort="bind: setOrder, sbydate.descending"></div></div><div id="sbyidea" class="sort-button" data-sort="bind: setSelected, sbyidea.selected" data-sortevent="listen: mousedown, sort"><span data-label="bind: innerHTML, sbyidea"></span><div class="sort-caret" data-sort="bind: setOrder, sbyidea.descending"></div></div><div id="sbyscore" class="sort-button" data-sort="bind: setSelected, sbyscore.selected" data-sortevent="listen: mousedown, sort"><span data-label="bind: innerHTML, sbyscore"></span><div class="sort-caret" data-sort="bind: setOrder, sbyscore.descending"></div></div></div><input class="search" type="text" data-label="bind:placeholder, searchsessions" data-sortevent="listen: keypress, search"><div id="sessionsearchresult"></div></div><div class="session-details"><ul data-sessions="foreach"><li class="session-item" data-sessionevent="listen: dblclick, displayActionBar"><table class="session-boxscore"><tr><td class="session-type" data-sessions="bind: setMode, mode"></td><td class="session-info"><p class="session-title" data-sessions="bind: innerHTML, title">Titre de la session</p><p class="session-date" data-sessions="bind: formatDate, date">jj/mm/aaaa</p></td><td class="session-idea" data-sessions="bind:formatIdeas, idea">Idea(s) generated from session</td><td class="avatarlist" data-sessions="bind: setAvatars, participants"></td><td class="session-status" data-sessions="bind:setStatus, status">completed</td><td class="session-score"><span class="points" data-sessions="bind:setScore, score"></span><span data-sessions="bind: setSuffix, score">ip</span></td></tr></table><div class="actionbar" data-sessionevent="listen: mouseup, hideActionBar"><div class="replaysession" name="replay" data-sessionevent="listen: mousedown, press; listen:mouseup, replay"></div><div class="deletesession" name="delete" data-sessionevent="listen: mousedown, press; listen:mouseup, deleteSession"></div></div></li></ul></div></div></div>',h.sort=function(e,t){var i=t.getAttribute("id");L.get(i).selected?L.set(i,{selected:!0,descending:!L.get(i).descending}):(L.set(k,{selected:!1,descending:L.get(k).descending}),L.set(i,{selected:!0,descending:L.get(i).descending}),k=i),h.sortSessions(i)},h.sortSessions=function(e){var t;if(t=M?T:S,t.length)switch(e){case"sbytitle":c.sortByProperty(t,"title",L.get("sbytitle").descending);break;case"sbydate":c.sortByProperty(t,"date",L.get("sbydate").descending);break;case"sbyidea":c.sortByProperty(t,"idea",L.get("sbyidea").descending);break;case"sbyscore":c.sortByProperty(t,"score",L.get("sbyscore").descending)}v.reset(t)},h.acceptinput=function(e,t){t.removeAttribute("readonly")},h.search=function(e,t){var i=document.getElementById("sessionsearchresult");i.innerHTML="",13===e.keyCode&&(M=t.value,""===M?(h.sortSessions(k),v.reset(S)):(T=c.searchArray(S,M),i.innerHTML=y.get("foundlbl")+" "+T.length+" "+y.get("matchingsessions"),v.reset(T)))},h.displayActionBar=function(e,t){var i=t.getAttribute("data-sessions_id"),n=t.offsetHeight,s=v.get(i);t.querySelector(".actionbar").setAttribute("style","display: block;margin-top:-"+n+"px;height: "+n+"px;"),s.participants.length>1||s.participants[0]!=w.get("_id")||s.id===w.get("sessionInProgress").id?t.querySelector(".deletesession").setAttribute("style","display: none;"):t.querySelector(".deletesession").setAttribute("style","display: inline-block; background-size: 40px 40px;"),setTimeout(function(){t.querySelector(".actionbar").setAttribute("style","display: none;")},2e3)},h.hideActionBar=function(e,t){t.setAttribute("style","display: none;")},h.press=function(e,t){var i=t.getAttribute("data-sessions_id");t.classList.add("pressed"),i&&C.spin(document.getElementById("sessionlistspinner"))},h.replay=function(e,t){var i=t.getAttribute("data-sessions_id"),n=v.get(i).id,s=v.get(i).mode;t.parentNode.setAttribute("style","display: none;"),t.classList.remove("pressed"),C.stop(),a.get("observer").notify("replay-session",n,s)},h.deleteSession=function(e,t){var i,n=t.getAttribute("data-sessions_id"),s=v.get(n).id,a=function(e){var t=new r,i=new g;return t.setTransport(b),t.sync(f,e).then(function(){var e=t.get("replayIdeas")||[];e.forEach(function(e){var t=new r;t.setTransport(b),t.sync(f,e).then(function(){return t.set("sessionId",t.get("sessionId")+"_deleted"),t.set("sessionReplay",!1),t.upload()}).then(function(){t.unsync()},function(e){console.log(e)})}),b.request("cleanUpSession",s,function(e){e.err&&console.log(e.err),t.remove().then(function(){t.unsync(),i.fulfill()})})}),i},o=y.get("deletereplay"),l=function(e){e?(C.spin(document.getElementById("sessionlistspinner")),a(s).then(function(){C.stop(),i.close()})):i.close()};t.classList.remove("pressed"),t.parentNode.setAttribute("style","display: none;"),v.get(n).replayIdeas&&v.get(n).replayIdeas.length?(C.stop(),i=new u(document.getElementById("session-list"),o,l),i.show()):a(s).then(function(){C.stop()})},h.resetSessionData=function(){S=[],A.loop(function(e){var t={id:e.id,title:e.value.title,date:e.value.date,idea:e.value.idea,participants:[],usernames:[],status:e.value.status,score:e.value.score,mode:e.value.mode,replayIdeas:e.value.replayIdeas};for(t.participants.push(e.value.initiator.id),t.usernames.push(e.value.initiator.username),j=0;j<e.value.participants.length;j++)t.participants.push(e.value.participants[j].id),t.usernames.push(e.value.participants[j].username);t.idea&&t.idea.length>1&&c.sortByProperty(t.idea,"title",!1),S.push(t)}),h.sortSessions("sbydate")},h.getMode=function(e){var t;return A.loop(function(i){i.id===e&&(t=i.value.mode)}),t},h.place(m),h.reset=function(){A.unsync(),A.reset(),v.reset([]),L.reset({sbytitle:{selected:!1,descending:!0},sbydate:{selected:!0,descending:!0},sbyidea:{selected:!1,descending:!0},sbyscore:{selected:!1,descending:!0}}),k="sbydate",S=[],T=[],M="",A.sync(f,"library","_view/sessions",{key:'"'+w.get("_id")+'"',descending:!0}).then(function(){h.resetSessionData()})},["added","deleted","updated"].forEach(function(e){A.watch(e,function(){h.resetSessionData(),h.sortSessions(k)})}),h.reset(),h}}),define("library/decks/decklist/decklist",["OObject","service/map","service/config","Bind.plugin","Event.plugin","Store","CouchDBBulkDocuments","Promise","service/utils","service/actionbar"],function(e,t,i,n,s,a,o,r,l,c){return function(t){var r=new e,d=i.get("labels"),u=i.get("user"),p=new a([]),g=null;return r.plugins.addAll({labels:new n(d),active:new n(u,{}),decks:new n(p,{setVersion:function(e){this.innerHTML=e?d.get("version")+e:""},setAuthor:function(e){"Taiaut"===e?(this.innerHTML="",this.setAttribute("style","background-image:url('img/logo.png');")):this.innerHTML=e},date:function(e){this.innerHTML=e?l.formatDate(e):""}}),decklistevent:new s(r)}),r.template='<ul id="deck-list" data-decks="foreach"><li class="list-item" data-decklistevent="listen:mousedown, setStart; listen:dblclick, showActionBar"><div class = "decklight"></div><div class="item-header"><h3 data-decks="bind:innerHTML, title"></h3><span class="version" data-decks="bind:setVersion, version"></span></div><div class="item-body"><p data-decks="bind:innerHTML,description"></p></div><div class="item-footer"><label data-labels="bind:innerHTML, designedby"></label><div class="author" data-decks="bind:setAuthor, author"></div><span class="date" data-decks="bind:date, date"></div></div></li></ul>',r.setStart=function(){g&&g.hide()},r.showActionBar=function(e,t){var i,n=t.getAttribute("data-decks_id"),s=!1;g&&g.getParent()===t&&(s=!0),s||(g=new c("deck",t,p.get(n)._id),i=document.createDocumentFragment(),g.place(i),t.appendChild(i),s=!0)},r.reset=function(e){var i=e||null;p.reset([]),r.getDecks(t,i),display=!1},r.getModel=function(){return p},r.getDecks=function(e,t){var n=new o,s=[];switch(e){default:s=u.get("taiaut_decks").concat(u.get("custom_decks"))}n.setTransport(i.get("transport")),n.sync(i.get("db"),{keys:s}).then(function(){var e=u.get("lang"),i=[];n.loop(function(t){t.doc.default_lang&&t.doc.default_lang!==e?t.doc.translations&&t.doc.translations[e]?i.push(t.doc.translations[e]):i.push(t.doc):i.push(t.doc)}),i.sort(function(e,t){var i=e.title,n=t.title;return n>i?-1:i>n?1:i===n?0:void 0}),p.reset(i),t&&t("ok"),n.unsync()})},r.initSelected=function(e,t){var i=r.dom,n=i.querySelector(".list-item[data-decks_id='"+t+"']");e(n),n.classList.add("selected")},r.highlightDeck=function(e,t){var i,n,s=r.dom;return 0===t?(i=s.querySelector(".list-item[data-decks_id='0']"),n=0):(p.loop(function(e,i){e._id===t&&(n=i)}),i=s.querySelector(".list-item[data-decks_id='"+n+"']")),e(i),i.classList.add("selected"),i.scrollIntoView(),n},r.init=function(e){r.reset(e)},u.watchValue("lang",function(){r.getDecks(t)}),r}}),define("library/decks/deckview/deckdetails",["OObject","service/config","Bind.plugin","Event.plugin","Store","service/utils","CouchDBDocument","CouchDBView","lib/spin.min"],function(e,t,i,n,s,a,o,r,l){return function(c){var d,u,p=new e,g=new s,h=new s({max:0}),m=new s([]),v=new r,f=new l({top:255,left:297,lines:8,radius:6,color:"#cccccc"}).spin(),b=t.get("user"),w=t.get("labels"),y=new s(t.get("userLanguages")),L=function(){y.loop(function(e,t){g.get("default_lang")&&e.name===g.get("default_lang").substring(0,2)?y.update(t,"selected",!0):y.update(t,"selected",!1)})},k=60,S=60,T=function(e){var t,i,n=document.createElement("canvas"),s=n.getContext("2d");return t=e.width,i=e.height,i>t?(i*=k/t,t=k):(t*=S/i,i=S),n.width=t,n.height=i,s.drawImage(e,0,0,t,i),n.toDataURL("image/png")},M=function(e,t){var i,n,s=new Image,a=document.createElement("canvas"),o=a.getContext("2d"),r=k,l=S;s.src=e,setTimeout(function(){a.width=r,a.height=l,i=Math.floor(Math.max(0,(s.width-r)/2)),n=Math.floor(Math.max(0,(s.height-l)/2)),o.drawImage(s,i,n,r,l,0,0,r,l),t(a.toDataURL("image/png"))},300)},A=function(){var e="/upload",t=new FormData,i="deckpic",n=u;t.append("type",i),t.append("dir","decks"),t.append("filename",g.get("_id")),t.append("dataString",n),a.uploadFile(e,t,null,function(e){return e})};return v.setTransport(t.get("transport")),p.plugins.addAll({labels:new i(w),range:new i(h,{setCursorWidth:function(){}}),cards:new i(m,{setStyle:function(e){e&&"null"===e?this.classList.add("invisible"):this.classList.remove("invisible")},formatTitle:function(e){var t,i=this;e&&(t=i.getAttribute("data-cards_id"),m.get(t).type&&4!==m.get(t).type?this.innerHTML=e.substring(0,1).toUpperCase()+e.substring(1).toLowerCase():(this.innerHTML=e.toUpperCase(),this.setAttribute("style","font-family:Helvetica;")))},setPic:function(e){var i,n,s=this;e&&e.search("img/decks/")>-1?this.setAttribute("style","background-image:url('"+e+"');"):e?(n=new l({color:"#657b99"}).spin(s),i={dir:"cards",filename:e},t.get("transport").request("GetFile",i,function(e){s.setAttribute("style","background-image: url('"+e+"');"),n.stop()})):this.setAttribute("style","background-image: none;")}}),deckdetails:new i(g,{displayLang:function(e){var t;e?(p.dom.querySelector(".idealang").classList.remove("invisible"),t=e.substring(0,2),this.setAttribute("style","background-image:url('img/flags/"+t+".png');")):p.dom.querySelector(".idealang").classList.add("invisible")},formatDate:function(e){this.innerHTML=e?a.formatDate(e):""},setPic:function(e){var i,n,s=this;""===e?this.setAttribute("style","background-image:url('img/connect/graygroup.png');"):"img/logo.png"===e?this.setAttribute("style","background-image:url('img/logo.png');"):"decklogo"===e&&(n=new l({color:"#657b99"}).spin(s),i={dir:"decks",filename:g.get("_id")},t.get("transport").request("GetFile",i,function(e){s.setAttribute("style","background-image: url('"+e+"');"),n.stop()})),g.get("created_by")===b.get("_id")&&s.querySelector("input").classList.remove("invisible")},edit:function(e){e===b.get("_id")?(this.setAttribute("contenteditable",!0),this.classList.add("editable")):(this.setAttribute("contenteditable",!1),this.classList.remove("editable"))}}),select:new i(y,{setBg:function(e){e&&this.setAttribute("style","background-image:url('img/flags/"+e+".png');")},setSelected:function(e){e?this.classList.add("selected"):this.classList.remove("selected")}}),carouselevent:new n(p),editevent:new n(p)}),p.template='<div class="deckdetails"><div class="deckinfo"><div class="deckheader"><div class="idealang invisible"><div class="currentlang" data-deckdetails="bind: displayLang, default_lang" data-editevent="listen: mouseup, showLang"></div><ul class="invisible" data-select="foreach"><li data-select="bind: setBg, name; bind: setSelected, selected" data-editevent="listen: mousedown, selectFlag; listen: mouseup, setLang"></li></ul></div><div class="decklogo" data-deckdetails="bind: setPic, picture_file" data-editevent="listen: mousedown, editPic"><input class="invisible" type="file" enctype="multipart/form-data" accept = "image/gif, image/jpeg, image/png" data-editevent="listen: change, changePic"></div><p><h2 data-deckdetails="bind:innerHTML, title; bind: edit, created_by" data-editevent="listen:input, displayButtons"></h2><span data-labels="bind:innerHTML, designedby"></span><span data-deckdetails="bind: innerHTML, author"></span></p><span class="date" data-deckdetails="bind:formatDate,date"></span></div><div class="deckbody"><p class="deckdescription" data-deckdetails="bind: innerHTML, description; bind: edit, created_by" data-editevent="listen:input, displayButtons"></p><div class="cancelmail invisible" data-editevent="listen:mousedown, press; listen:mouseup, cancel" data-labels="bind:innerHTML, cancellbl"></div><div class="sendmail invisible" data-editevent="listen:mousedown, press; listen:mouseup, upload" data-labels="bind:innerHTML, savelbl">Save</div></div></div><div class="deckcarousel"><div class="innercarousel"><ul data-cards="foreach"><li data-cards="bind: setStyle,style"><div class="card"><div class="cardpicture" data-cards="bind:setPic,picture_file"></div><div class="cardtitle" data-cards="bind: formatTitle, title"></div></div></li></ul><input class="deckslider invisible" type="range" value=0 min=0 data-range="bind: max, max; bind: setCursorWidth, max" data-carouselevent="listen: input, updateCards"></div></div></div>',p.displayCards=function(e){var t,i=[];for(m.reset([]),t=0;5>t;t++)i[t]=v.get(e-2+t)?v.get(e-2+t).value:{style:"null"};m.reset(i),f.stop()},p.updateCards=function(e,t){p.displayCards(t.value)},p.displayButtons=function(){p.dom.querySelector(".cancelmail").classList.remove("invisible"),p.dom.querySelector(".sendmail").classList.remove("invisible")},p.hideButtons=function(){p.dom.querySelector(".cancelmail").classList.add("invisible"),p.dom.querySelector(".sendmail").classList.add("invisible")},p.editPic=function(e,t){g.get("created_by")===b.get("_id")&&(t.setAttribute("style","background-image: url('img/brainstorm/reload.png')"),document.body.onfocus=function(){t.querySelector("input").value.length||(g.set("picture_file",""),g.set("picture_file",d.picture_file)),document.body.onfocus=null})},p.showLang=function(){g.get("created_by")===b.get("_id")&&p.dom.querySelector(".idealang ul").classList.remove("invisible")},p.selectFlag=function(e,t){var i;e.stopPropagation(),e.preventDefault(),i=parseInt(t.getAttribute("data-select_id"),10),y.loop(function(e,t){i===t?y.update(t,"selected",!0):y.update(t,"selected",!1)})},p.setLang=function(e,t){var i;e.stopPropagation(),e.preventDefault(),i=t.getAttribute("data-select_id"),g.set("default_lang",y.get(i).name),g.get("default_lang")!==d.default_lang.substring(0,2)?p.displayButtons():p.hideButtons(),p.dom.querySelector(".idealang ul").classList.add("invisible")},p.changePic=function(e,t){var i=new FileReader,n=new Image,s=p.dom.querySelector(".decklogo"),a=new l({color:"#4d4d4d",lines:12,length:12,width:6,radius:10}).spin();s.setAttribute("style","background-image: none"),a.spin(s),i.onload=function(e){n.src=e.target.result,setTimeout(function(){M(T(n),function(e){s.setAttribute("style","background-image: url('"+e+"')"),a.stop(),u=e,p.displayButtons()})},300)},t.files.length?i.readAsDataURL(t.files[0]):t.querySelector("input").classList.add("invisible")},p.press=function(e,t){t.classList.add("pressed")},p.cancel=function(e,t){g.reset(d),p.hideButtons(),t.classList.remove("pressed")},p.upload=function(e,i){var n=new o,s=p.dom.querySelector(".deckheader h2").innerHTML,a=p.dom.querySelector(".deckdescription").innerHTML,r=new l({color:"#8cab68",lines:10,length:8,width:4,radius:8,top:-6,left:30}).spin(i);i.classList.add("invisible"),n.setTransport(t.get("transport")),n.sync(t.get("db"),g.get("_id")).then(function(){var e=new Date;return u&&(A(),n.set("picture_file","decklogo")),n.set("title",s),n.set("description",a),n.set("last_updated",[e.getFullYear(),e.getMonth(),e.getDate()]),n.upload()}).then(function(){c("updated",n.get("_id")),p.hideButtons(),i.classList.remove("pressed"),r.stop()}),u&&A()},p.reset=function(e){var i=p.dom.querySelector(".deckslider");p.dom.querySelector(".cancelmail").classList.add("invisible"),p.dom.querySelector(".sendmail").classList.add("invisible"),u=null,g.set("picture_file",""),g.reset(e),L(),d=JSON.parse(g.toJSON()),h.set("max",0),f.spin(p.dom.querySelector(".deckcarousel")),v.reset([]),v.sync(t.get("db"),"library","_view/cards",{key:'"'+g.get("_id")+'"'}).then(function(){v.getNbItems()?i.classList.remove("invisible"):i.classList.add("invisible"),v.getNbItems()&&h.set("max",v.getNbItems()-1),v.unsync(),v.alter("sort",function(e,t){var i=e.value.title,n=t.value.title;return n>i?-1:i>n?1:i===n?0:void 0}),p.displayCards(0)})},p}}),define("service/cardpopup",["OObject","Bind.plugin","Event.plugin","service/config","Store"],function(e,t,i,n,s){function a(e){var a,o=new s,r=n.get("labels"),l='<div class="cardpopup" data-carddetails="bind:setPosition, position"><div class="card-detail"><div class="cd-header blue-dark"> <span data-carddetails="bind: formatName, firstname"></span><div class="close-popup" data-popupevent="listen:mousedown, close"></div></div><div class="cd-picarea"><div class="cardpicture" data-carddetails="bind:setPic, picture_file"></div><div class="cardinfo"><ul><li><span class="cd-agelbl"></span><span data-carddetails="bind:innerHTML, age"></span><span class="agesuffix" data-label="bind:innerHTML, agelbl"></span></li><li><span class="cd-locationlbl"></span><span class="cd-info" data-carddetails="bind: innerHTML, location"></span></li><li><span class="cd-joblbl"></span><span class="cd-info" data-carddetails="bind: innerHTML, occupation.description"></span></li><li><span class="cd-familylbl"></span><span class="cd-info" data-carddetails="bind: setFamily, family"></span></li><li><span class="cd-creditslbl" data-label="bind:innerHTML, credits"></span><span class="cd-info" data-carddetails="bind:innerHTML, picture_credit"></span></li></ul></div></div><div class="cd-contentarea"><span class="contentTitle" data-label="bind: innerHTML, hobbieslbl">Hobbies</span><p class = "charinfo" data-carddetails="bind:setLeisure, leisure_activities">hobbies</p><span class="contentTitle" data-label="bind: innerHTML, interestslbl">Centers of interest</span><p class = "charinfo" data-carddetails="bind: setInterests, interests">Centers of interest</p><span class="contentTitle" data-label="bind: innerHTML, commentslbl">Comments</span><p class = "charinfo" data-carddetails="bind:setComments, comments"></p></div></div><div class="leftcaret" data-carddetails="bind: setCaret, caret.left"></div><div class="rightcaret" data-carddetails="bind: setCaret, caret.right"></div></div>',c='<div class="cardpopup" data-carddetails="bind:setPosition, position"><div class="card-detail"><div class="cd-header blue-dark"> <span data-carddetails="bind: formatTitle, title"></span><div class="close-popup" data-popupevent="listen:mousedown, close"></div></div><div class="cd-picarea"><div class="cardpicture" data-carddetails="bind:setPic, picture_file"></div><div class="cardinfo"><p><span class="cd-creditslbl" data-label="bind:innerHTML, credits"></span><span class="cd-info" data-carddetails="bind:innerHTML, picture_credit">Picture credits</span><br/><span class="cd-sourcelbl" data-label="bind:innerHTML, source">Source : </span><span class="cd-info" data-carddetails="bind: setSources, sources"></span></div></div><div class="cd-contentarea"><span class="contentTitle" data-label="bind: innerHTML, dyknow"></span><p class = "dyknow" data-carddetails="bind:innerHTML,didYouKnow"></p></div></div><div class="leftcaret" data-carddetails="bind: setCaret, caret.left"></div><div class="rightcaret" data-carddetails="bind: setCaret, caret.right"></div></div>',d='<div class="cardpopup" data-carddetails="bind:setPosition, position"><div class="card-detail"><div class="cd-header blue-dark story"> <div class="storytitlelbl" data-label="bind:innerHTML, storytitlelbl"></div><div class="storytitle"><span data-label="bind:innerHTML, cdtitlelbl"></span> <span data-carddetails="bind: formatTitle, title"></span></div><div class="close-popup" data-popupevent="listen:mousedown, close"></div></div><div class="cd-contentarea story"><span class="contentTitle" data-label="bind: innerHTML, scenariodesclbl"></span><p class = "dyknow" data-carddetails="bind:innerHTML,story"></p><span class="contentTitle" data-label="bind: innerHTML, soldesclbl"></span><p class = "dyknow" data-carddetails="bind:innerHTML,solution"></p></div></div><div class="leftcaret" data-carddetails="bind: setCaret, caret.left"></div><div class="rightcaret" data-carddetails="bind: setCaret, caret.right"></div></div>';this.plugins.addAll({label:new t(r),carddetails:new t(o,{setPosition:function(e){e&&this.setAttribute("style","left:"+e.x+"px; top:"+e.y+"px;")},setCaret:function(e){var t,i=o.get("position").y;t=i>340?240:60,e?this.setAttribute("style","display: inline-block; margin-top:"+t+"px;"):this.setAttribute("style","display: none;")},setPic:function(e){var t,i=this;e?e.search("img/decks")>-1?this.setAttribute("style","background-image:url('"+e+"');"):(t={dir:"cards",filename:e},n.get("transport").request("GetFile",t,function(e){i.setAttribute("style","background:white; background-image: url('"+e+"');")})):this.setAttribute("style","background-image: none;")},setSources:function(e){this.innerHTML=e&&e.length?e instanceof Array?e.join(", "):e:""},formatTitle:function(e){e&&(this.innerHTML=e.toUpperCase())},formatName:function(e){e&&(this.innerHTML=e.substring(0,1).toUpperCase()+e.substring(1).toLowerCase()+"  "+o.get("lastname").toUpperCase())},setFamily:function(e){var t,i,n=e.couple,s=e.children;0===n?t=r.get("singlelbl"):1===n?t=r.get("marriedlbl"):2===n?t=r.get("divorcedlbl"):3===n&&(t=r.get("widowlbl")),0===s?i="":(i=o.get("age")<20?1===s?s+r.get("onesiblinglbl"):s+r.get("siblingslbl"):1===s?s+r.get("onechildlbl"):s+r.get("childrenlbl"),i=", "+i),this.innerHTML=t+i},setLeisure:function(e){var t,i="<ul>";if(e&&e.length){for(t=0;t<e.length;t++)i+=e[t].comment?"<li>"+e[t].name+" ("+e[t].comment+")</li>":"<li>"+e[t].name+"</li>";this.innerHTML=i+"</ul>"}else this.innerHTML=""},setInterests:function(e){var t,i="<ul>";if(e&&e.length){for(t=0;t<e.length;t++)i+=e[t].comment?"<li>"+e[t].name+" ("+e[t].comment+")</li>":"<li>"+e[t].name+"</li>";this.innerHTML=i+"</ul>"}else this.innerHTML=""},setComments:function(e){var t,i="<ul>";if(e&&e.length){for(t=0;t<e.length;t++)i+="<li>"+e[t]+"</li>";this.innerHTML=i+"</ul>"}else this.innerHTML=""}}),popupevent:new i(this)}),this.close=function(){a.classList.add("invisible"),e()},this.reset=function(e,t,i,n){a=n,this.template="","string"==typeof e?o.reset(JSON.parse(e)):o.reset(e),o.set("position",t),"left"===i?o.set("caret",{left:!0,right:!1}):o.set("caret",{left:!1,right:!0}),this.template=1===o.get("type")?l:5===o.get("type")?d:c,this.render(),this.place(a),a.classList.remove("invisible")}}return function(t){return a.prototype=new e,new a(t)}}),define("library/decks/deckview/cardlist",["OObject","service/config","Bind.plugin","Event.plugin","CouchDBBulkDocuments","CouchDBDocument","Store","service/cardpopup","Promise"],function(e,t,i,n,s,a,o,r,l){return function(c,d,u){var p,g=new e,h=new o([]),m=new o([]),v=new o({currentPage:0,nbPages:0}),f=t.get("labels"),b=t.get("user"),w=null,y=null;return g.plugins.addAll({pagination:new i(v,{setPage:function(e){var t=e+1;this.innerHTML=v.get("nbPages")>1?f.get("page")+t+" / "+v.get("nbPages"):""},setLeft:function(e){e>0?this.classList.remove("invisible"):this.classList.add("invisible")},setRight:function(e){e<v.get("nbPages")-1?this.classList.remove("invisible"):this.classList.add("invisible")}}),cards:new i(m,{formatTitle:function(e){e?(this.classList.remove("newcard"),"techno"!==c?this.innerHTML=e.substring(0,1).toUpperCase()+e.substring(1).toLowerCase():(this.innerHTML=e.toUpperCase(),this.setAttribute("style","font-family:Helvetica;"))):this.classList.add("newcard")},setPic:function(e){var i,n=this;if(e&&e.search("img/decks/")>-1)this.setAttribute("style","background-image:url('"+e+"');");else if(e)i={dir:"cards",filename:e},t.get("transport").request("GetFile",i,function(e){n.setAttribute("style","background:white; background-image: url('"+e+"'); background-repeat: no-repeat; background-position: center center; background-size:contain;")});else switch(c){case"characters":this.classList.add("newchar");break;case"contexts":this.classList.add("newctx");break;case"problems":this.classList.add("newpb");break;case"techno":this.classList.add("newtech");break;default:this.setAttribute("style","background-image: none;")}}}),cardlistevent:new n(g)}),g.template='<div class="cardlist"><div id="cardlist-popup" class="invisible"></div><div class="cardpage" data-cardlistevent="listen:mousedown, setStart; listen:dblclick, changePage"><div class="pagenb"><div class="leftcaret" data-pagination="bind: setLeft, currentPage" data-cardlistevent="listen:mousedown, push; listen:mouseup, previousPage"></div><span data-pagination="bind: setPage, currentPage"></span><div class = "rightcaret" data-pagination="bind: setRight, currentPage" data-cardlistevent="listen:mousedown, push; listen:mouseup, nextPage"></div></div><ul data-cards="foreach"><li class="card" data-cardlistevent="listen:mousedown, highlight; listen:mouseup, zoom"><div class="cardpicture" data-cards="bind:setPic,picture_file"></div><div class="cardtitle" data-cards="bind: formatTitle, title"></div><div class="cardbtnbar invisible"><div class="editcardbtn" data-cardlistevent="listen: mousedown, press; listen:mouseup, editCard"></div><div class="deletecardbtn " data-cardlistevent="listen: mousedown, press; listen:mouseup, deleteCard"></div></div></li></ul></div></div>',g.reset=function(e){y=null,g.dom.querySelector("#cardlist-popup").classList.add("invisible"),w=e,g.getCardList(e.content[c])},g.getCardList=function(e){var i=new s,n=e,a=new l;return"newcard"===e[0]&&(n=e.slice(1,e.length)),n.length?(i.setTransport(t.get("transport")),i.sync(t.get("db"),{keys:n}).then(function(){"newcard"===e[0]?h.reset([{_id:"newcard",title:"",picture_file:""}]):h.reset([]),i.loop(function(e){h.alter("push",e.doc)}),v.set("nbPages",Math.ceil(h.getNbItems()/12)),g.displayPage(0),a.fulfill(),i.unsync()})):(h.reset([{_id:"newcard",title:"",picture_file:""}]),v.set("nbPages",1),g.displayPage(0),a.fulfill()),a},g.displayPage=function(e){var t,i=h.getNbItems()-12*e;for(v.set("currentPage",e),m.reset([]),t=0;i>t;t++)m.alter("push",h.get(12*e+t))},g.removeCard=function(e){var i,n,s,o,r=new a,d=new a,p=!0;b.get("active_deck")===w._id&&(i=w.content.characters.length,n=w.content.contexts.length,s=w.content.problems.length,o=w.content.techno.length,(2>=i||2>=n||2>=s||4>=o)&&(p=!1,alert(f.get("cannotremovecard")))),p&&(r.setTransport(t.get("transport")),d.setTransport(t.get("transport")),r.sync(t.get("db"),w._id).then(function(){var t=r.get("content"),i=t[c];return i.splice(i.indexOf(e),1),t[c]=i,r.set("content",t),r.upload()}).then(function(){return u("updated",w._id,c),r.unsync(),d.sync(t.get("db"),e)}).then(function(){var e,i=d.get("deck"),n=new l,s=d.get("picture_file");return i.splice(i.indexOf(w._id),1),i.length?(d.set("deck",i),d.upload().then(function(){n.fulfill()})):(-1===s.search("img/decks")&&(e={type:"card",file:s},t.get("transport").request("DeleteAttachment",e,function(e){"ok"!==e&&console.log(e)})),d.remove().then(function(){n.fulfill()})),n}))},g.push=function(e,t){t.classList.add("invisible"),e.stopPropagation()},g.press=function(e,t){t.classList.add("pressed")},g.previousPage=function(){g.displayPrevious()},g.nextPage=function(){g.displayNext()},g.displayPrevious=function(){var e=v.get("currentPage");e>0&&g.displayPage(e-1)},g.displayNext=function(){var e=v.get("currentPage");e<v.get("nbPages")-1&&g.displayPage(e+1)},g.changePage=function(e){var t=[e.pageX,e.pageY];t[0]>(document.width+301)/2?g.displayNext():g.displayPrevious()},g.highlight=function(e,t){null!==y&&document.querySelector("li[data-cards_id='"+y+"']").classList.remove("highlighted"),y=t.getAttribute("data-cards_id"),t.classList.add("highlighted")},g.zoom=function(e,t){var i=t.getAttribute("data-cards_id");"newcard"===m.get(i)._id?(d("newcard",c),t.classList.remove("highlighted")):(g.setPopup(i),b.get("_id")===w.created_by&&(t.querySelector(".cardbtnbar").classList.remove("invisible"),m.get(i).created_by===b.get("_id")?t.querySelector(".editcardbtn").classList.remove("invisible"):t.querySelector(".editcardbtn").classList.add("invisible")))},g.editCard=function(e,t){var i=t.getAttribute("data-cards_id");e.stopPropagation(),p.close(),t.parentNode.classList.add("invisible"),d(m.get(i)._id,c)},g.deleteCard=function(e,t){var i=t.getAttribute("data-cards_id");e.stopPropagation(),p.close(),t.parentNode.classList.add("invisible"),g.removeCard(m.get(i)._id)},g.setPopup=function(e){var t,i={x:0,y:0},n="";switch(t=e%12){case 1:i.x=304,i.y=157,n="left";break;case 2:i.x=23,i.y=157,n="right";break;case 3:i.x=170,i.y=157,n="right";break;case 4:i.x=157,i.y=339,n="left";break;case 5:i.x=304,i.y=339,n="left";break;case 6:i.x=23,i.y=339,n="right";break;case 7:i.x=170,i.y=339,n="right";break;case 8:i.x=157,i.y=350,n="left";break;case 9:i.x=304,i.y=350,n="left";break;case 10:i.x=23,i.y=350,n="right";break;case 11:i.x=170,i.y=350,n="right";break;default:i.x=157,i.y=157,n="left"}p.reset(m.get(e),i,n,document.getElementById("cardlist-popup"))},g.closePopup=function(){g.dom.querySelector("li[data-cards_id='"+y+"']").classList.remove("highlighted"),g.dom.querySelector("li[data-cards_id='"+y+"']").querySelector(".cardbtnbar").classList.add("invisible"),y=null},p=new r(g.closePopup),g}}),define("library/decks/deckview/cardeditor/editchar",["OObject","service/config","CouchDBDocument","Bind.plugin","Event.plugin","Store","service/utils","lib/spin.min"],function(e,t,i,n,s,a,o,r){return function(l,c){var d,u=new e,p=t.get("user"),g=t.get("labels"),h={_id:"",default_lang:p.get("lang"),title:"",gender:0,age:null,firstname:"",lastname:"",location:"",occupation:{description:"",details:[1,"",""]},family:{couple:0,children:0},leisure_activities:[{name:"",comment:""},{name:"",comment:""},{name:"",comment:""}],interests:[{name:"",comment:""},{name:"",comment:""},{name:"",comment:""}],comments:[],type:1,deck:[],created_by:p.get("_id"),created_on:[],picture_file:"img/decks/characters.png",picture_credit:""},m=new i,v={},f=new a({error:""}),b=87,w=87,y=function(e){var t,i,n=document.createElement("canvas"),s=n.getContext("2d");
return t=e.width,i=e.height,i>t?(i*=b/t,t=b):(t*=w/i,i=w),n.width=t,n.height=i,s.drawImage(e,0,0,t,i),n.toDataURL("image/png")},L=function(e,t){var i,n,s=new Image,a=document.createElement("canvas"),o=a.getContext("2d"),r=b,l=w;s.src=e,setTimeout(function(){a.width=r,a.height=l,i=Math.floor(Math.max(0,(s.width-r)/2)),n=Math.floor(Math.max(0,(s.height-l)/2)),o.drawImage(s,i,n,r,l,0,0,r,l),t(a.toDataURL("image/png"))},300)},k=function(){var e="/upload",t=new FormData,i="cardpic",n="cards",s=d;t.append("type",i),t.append("dir",n),t.append("filename",m.get("_id")),t.append("dataString",s),o.uploadFile(e,t,null,function(e){"ok"!==e.response&&console.log(e)})},S=new r({color:"#8cab68",lines:10,length:8,width:4,radius:8,top:-7,left:28}).spin();return m.setTransport(t.get("transport")),u.plugins.addAll({label:new n(g),model:new n(m,{setTitle:function(e){e&&""!==e&&"<br>"!==e?(this.innerHTML=e.toUpperCase(),this.setAttribute("style","color: white;")):(this.innerHTML=g.get("cardtitle"),this.setAttribute("style","color: whitesmoke;"))},setPic:function(e){var i,n,s=this;e&&e.search("img/decks/")>-1?(n="background-image:url('"+e+"');background-repeat: no-repeat; background-position: center center; background-size: cover;",s.setAttribute("style",n)):e&&(i={dir:"cards",filename:e},t.get("transport").request("GetFile",i,function(e){s.setAttribute("style","background-image: url('"+e+"');background-repeat: no-repeat; background-position: center center; background-size: cover;")}))},setAge:function(e){e||0===e||(this.innerHTML="",this.setAttribute("placeholder","age"))},setCity:function(e){var t="";e&&e.length?(t=e.split(",")[0].trim(),this.value=t):this.value=""},setCountry:function(e){var t="";e&&e.length?(t=e.split(",").slice(1,e.length).join().trim(),this.value=t):this.value=""},setFamilyStatus:function(e){(e||0===e)&&(this.selectedIndex=e)},setChildren:function(e){(e||0===e)&&(this.selectedIndex=e)},setChildrenlbl:function(e){this.innerHTML=e&&"1"===e?g.get("onechildlbl"):g.get("childrenlbl")},setSituation:function(e){e&&e.length&&(this.selectedIndex=e[0])},setLeisureName:function(e){var t=this,i=t.getAttribute("name");[0,1,2].forEach(function(n){e[n]&&i.search(n)>0&&(t.value=e[n].name)})},setLeisureDesc:function(e){var t=this,i=t.getAttribute("name");[0,1,2].forEach(function(n){e[n]&&i.search(n)>0&&(t.value=e[n].comment)})},setInterestName:function(e){var t=this,i=t.getAttribute("name");[0,1,2].forEach(function(n){e[n]&&i.search(n)>0&&(t.value=e[n].name)})},setInterestDesc:function(e){var t=this,i=t.getAttribute("name");[0,1,2].forEach(function(n){e[n]&&i.search(n)>0&&(t.value=e[n].comment)})},setComment:function(e){var t=this,i=t.getAttribute("name");[0,1].forEach(function(n){e&&e[n]&&i.search(n)>0&&(t.value=e[n])})}}),error:new n(f),editevent:new s(u)}),u.template='<div class="cardpopup editchar"><div class="card-detail"><div class="cd-header blue-dark"><div name="title" data-model="bind: setTitle, title" data-editevent="listen: mousedown, clearDefault; listen: blur, updateTitle" contenteditable=true></div></div><div class="cd-picarea"><div class="cardpicture" data-model="bind:setPic, picture_file"></div><span class="importbutton"><input type="file" enctype="multipart/form-data" accept = "image/gif, image/jpeg, image/png" data-editevent="listen: mousedown, selectpress; listen: change, uploadnDisplay"><div data-label="bind:innerHTML, importlbl"></div></span><input class="input" type="text" name="picture_credit" data-label="bind: placeholder,picturecredit" data-model="bind: value, picture_credit" data-editevent="listen: input, updateField"></div><table class="cardinfo"><tr class="charname"><th></th><td><input class="input" name="firstname" type="text" data-label="bind: placeholder,firstnameplaceholder" data-model="bind: value, firstname" data-editevent="listen: input, updateField"></td><td><input class="input" type="text" name="lastname" data-label="bind: placeholder,lastnameplaceholder" data-model="bind: value, lastname" data-editevent="listen: input, updateField"></td></tr><tr class="age"><th></th><td><input class="input" type="number" name="age" maxlength=3 size=4 data-model="bind: setAge, age; bind: value, age"></td></tr><tr class="loc"><th></th><td><input class="input city" name="city" type="text" data-label="bind:placeholder, city" data-model="bind:setCity, location" data-editevent="listen:input, updateLocation"></td><td><input class="input" name="country" type="text" data-label="bind:placeholder, countrystate" data-model="bind:setCountry, location" data-editevent="listen:input, updateLocation"></td></tr><tr class="family"><th></th><td><select class="status" name="couple" data-model="bind: setFamilyStatus, family.couple" data-editevent="listen:change, updateFamily"><option data-label="bind:innerHTML, single"></option><option data-label="bind:innerHTML, married"></option><option data-label="bind:innerHTML, divorced"></option><option data-label="bind:innerHTML, widow"></option><option data-label="bind:innerHTML, relation"></option></select></td><td><select class="children" name="children" data-model="bind: setChildren, family.children" data-editevent="listen:change, updateFamily"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option><option>7</option><option>8+</option></select><span data-model="bind:setChildrenlbl, family.children"></span></td></tr><tr class="occupation"><th></th><td><select class="status" name="situation" data-model="bind: setSituation, occupation.details" data-editevent="listen:change, updateJob"><option data-label="bind:innerHTML, student"></option><option data-label="bind:innerHTML, active"></option><option data-label="bind:innerHTML, retired"></option><option data-label="bind:innerHTML, unemployed"></option><option data-label="bind:innerHTML, stayathome"></option></select></td><td><textarea class="input" type="text" name="jobdesc" data-label="bind: placeholder, desc" data-model="bind:value, occupation.description" data-label="bind:placeholder, jobtitle" data-editevent="listen:input, updateJob"></textarea></td></tr></table><div class="cd-contentarea"><legend data-label="bind:innerHTML, hobbieslbl"></legend><input name="leisure0" class="input inputleft" type="text" data-label="bind:placeholder, name" data-model="bind: setLeisureName, leisure_activities" data-editevent="listen: input, updateLeisureName"><input class="input description" name="leisure0" type="text" data-label="bind:placeholder, desc" data-model="bind: setLeisureDesc, leisure_activities" data-editevent="listen: input, updateLeisureDesc"><input name="leisure1" class="input inputleft" type="text"  data-label="bind:placeholder, name" data-model="bind: setLeisureName, leisure_activities" data-editevent="listen: input, updateLeisureName"><input class="input description" name="leisure1" type="text" data-label="bind:placeholder, desc" data-model="bind: setLeisureDesc, leisure_activities" data-editevent="listen: input, updateLeisureDesc"><input class="input inputleft" name="leisure2" type="text" data-label="bind:placeholder, name" data-model="bind: setLeisureName, leisure_activities" data-editevent="listen: input, updateLeisureName"><input class="input description" name="leisure2" type="text" data-label="bind:placeholder, desc" data-label="bind:placeholder, name" data-model="bind: setLeisureDesc, leisure_activities" data-editevent="listen: input, updateLeisureDesc"><legend data-label="bind:innerHTML, interestslbl"></legend><input class="input inputleft" name="interest0" type="text" data-label="bind:placeholder, name" data-model="bind: setInterestName, interests" data-editevent="listen: input, updateInterestName"><input class="input description" name="interest0" type="text" data-label="bind:placeholder, desc" data-model="bind: setInterestDesc, interests" data-editevent="listen: input, updateInterestDesc"><input class="input inputleft" name="interest1" type="text" data-label="bind:placeholder, name" data-model="bind: setInterestName, interests" data-editevent="listen: input, updateInterestName"><input class="input description" name="interest1" type="text" data-label="bind:placeholder, desc" data-model="bind: setInterestDesc, interests" data-editevent="listen: input, updateInterestDesc"><input class="input inputleft" name="interest2" type="text" data-label="bind:placeholder, name" data-model="bind: setInterestName, interests" data-editevent="listen: input, updateInterestName"><input class="input description" name="interest2" type="text" data-label="bind:placeholder, desc" data-model="bind: setInterestDesc, interests" data-editevent="listen: input, updateInterestDesc"><legend data-label="bind:innerHTML, commentslbl"></legend><input class="input" name="comment0" type="text" data-label="bind:placeholder, addcomment" data-model="bind: setComment, comments" data-editevent="listen: input, updateComments"><input class="input" name="comment1" type="text" data-label="bind:placeholder, addcomment" data-model="bind: setComment, comments" data-editevent="listen: input, updateComments"></div><label class="editerror" data-error="bind:innerHTML, error"></label><div class="cancelmail" data-editevent="listen:mousedown, press; listen:mouseup, cancel" data-label="bind:innerHTML, cancellbl"></div><div class="sendmail" data-editevent="listen:mousedown, press; listen:mouseup, upload" data-label="bind:innerHTML, savelbl"></div></div></div>',u.reset=function(e,i){var n=new Date;d=null,f.set("error",""),v={},m.reset(),"newcard"===i?(m.reset(h),m.set("_id","C:"+n.getTime()),m.set("created_on",[n.getFullYear(),n.getMonth(),n.getDate()]),m.set("deck",[e])):m.sync(t.get("db"),i)},u.clearDefault=function(e,t){var i=t.getAttribute("name");""===m.get(i)&&(t.innerHTML="")},u.updateTitle=function(e,t){var i=t.innerHTML;i=i.charAt(0).toUpperCase()+i.slice(1),m.set("title",i)},u.selectpress=function(e,t){t.value=""},u.release=function(e,t){setTimeout(function(){t.classList.remove("pressed")},300)},u.uploadnDisplay=function(e,t){var i=new FileReader,n=new Image,s=u.dom.querySelector(".cardpicture"),a=new r({color:"#4d4d4d",lines:12,length:12,width:6,radius:10}).spin();s.setAttribute("style","background-image: none"),a.spin(s),i.onload=function(e){n.src=e.target.result,setTimeout(function(){L(y(n),function(e){s.setAttribute("style","background-image: url('"+e+"')"),a.stop(),d=e})},300)},i.readAsDataURL(t.files[0])},u.updateField=function(e,t){var i=t.getAttribute("name");v[i]=t.value},u.updateLocation=function(){var e,t,i=m.get("location");e=u.dom.querySelector("input[name='city']").value||"",t=u.dom.querySelector("input[name='country']").value||"",i=e&&t?e+", "+t:e+t,v.location=i},u.updateFamily=function(e,t){var i=t.getAttribute("name"),n=m.get("family");n[i]=t.selectedIndex,v.family=n},u.updateJob=function(e,t){var i=m.get("occupation"),n=t.getAttribute("name");switch(n){case"situation":i.details[0]=t.selectedIndex;break;case"job":i.details[1]=t.value;break;case"organization":i.details[2]=t.value;break;default:i.description=t.value}v.occupation=i},u.updateLeisureName=function(e,t){var i=t.getAttribute("name"),n=i.charAt(i.length-1),s=m.get("leisure_activities");s[n].name=t.value,v.leisure_activities=s},u.updateLeisureDesc=function(e,t){var i=t.getAttribute("name"),n=i.charAt(i.length-1),s=m.get("leisure_activities");s[n].comment=t.value,v.leisure_activities=s},u.updateInterestName=function(e,t){var i=t.getAttribute("name"),n=i.charAt(i.length-1),s=m.get("interests");s[n].name=t.value,v.interests=s},u.updateInterestDesc=function(e,t){var i=t.getAttribute("name"),n=i.charAt(i.length-1),s=m.get("interests");s[n].comment=t.value,v.interests=s},u.updateComments=function(e,t){var i=t.getAttribute("name"),n=i.charAt(i.length-1),s=m.get("comments");s[n]=t.value,v.comments=s},u.press=function(e,t){t.classList.add("pressed")},u.cancel=function(){c()},u.upload=function(e,i){var n=new Date,s=m.get("firstname"),a=m.get("lastname");i.classList.remove("pressed"),f.set("error",""),S.spin(i),m.get("title")||(s&&a?m.set("title",s+" "+a):(s||a)&&m.set("title",s+a)),m.get("title")||f.set("error",g.get("titlerequired")),f.get("error")?S.stop():m.get("_rev")?(m.set("last_modified",[n.getFullYear(),n.getMonth(),n.getDate()]),u.uploadCard(i)):m.sync(t.get("db"),m.get("_id")).then(function(){console.log("new card created : ",m.toJSON()),u.uploadCard()})},u.uploadCard=function(){var e;if(d&&(k(),m.set("picture_file",m.get("_id"))),v!=={})for(e in v)m.set(e,v[e]);m.upload().then(function(){return console.log("card upload successful :",m.get("_rev")),l(m.get("type"),m.get("_id"))}).then(function(){S.stop(),c(),m.unsync(),m.reset({})})},MODEL=m,u}}),define("library/decks/deckview/cardeditor/editcard",["OObject","service/config","CouchDBDocument","Bind.plugin","Event.plugin","Store","service/utils","lib/spin.min"],function(e,t,i,n,s,a,o,r){return function(l,c){var d,u=new e,p=t.get("user"),g=t.get("labels"),h={_id:"",default_lang:p.get("lang"),title:"",didYouKnow:"",deck:[],category:"",coefficient:1,sources:[],created_by:p.get("_id"),created_on:[],picture_credit:"",type:null,picture_file:""},m=new i,v=new a({error:""}),f=87,b=87,w=function(e){var t,i,n=document.createElement("canvas"),s=n.getContext("2d");return t=e.width,i=e.height,i>t?(i*=f/t,t=f):(t*=b/i,i=b),n.width=t,n.height=i,s.drawImage(e,0,0,t,i),n.toDataURL("image/png")},y=function(e,t){var i,n,s=new Image,a=document.createElement("canvas"),o=a.getContext("2d"),r=f,l=b;s.src=e,setTimeout(function(){a.width=r,a.height=l,i=Math.floor(Math.max(0,(s.width-r)/2)),n=Math.floor(Math.max(0,(s.height-l)/2)),o.drawImage(s,i,n,r,l,0,0,r,l),t(a.toDataURL("image/png"))},300)},L=function(){var e="/upload",t=new FormData,i="cardpic",n="cards",s=d;t.append("type",i),t.append("dir",n),t.append("filename",m.get("_id")),t.append("dataString",s),o.uploadFile(e,t,null,function(e){"ok"!==e.response&&console.log(e)})},k=new r({color:"#8cab68",lines:10,length:8,width:4,radius:8,top:-7,left:28}).spin();return m.setTransport(t.get("transport")),u.plugins.addAll({label:new n(g),model:new n(m,{setTitle:function(e){e&&""!==e&&"<br>"!==e?(this.innerHTML=e.toUpperCase(),this.setAttribute("style","color: white;")):(this.innerHTML=g.get("cardtitle"),this.setAttribute("style","color: whitesmoke;"))},formatTitle:function(e){switch(e){case 2:this.setAttribute("style","background: #5f8f28");break;case 3:this.setAttribute("style","background: #bd262c");break;case 4:this.setAttribute("style","background: #f27b3d")}},setSources:function(e){this.innerHTML=e&&e.length?e instanceof Array?e.join(", "):e:""},setPic:function(e){var i,n,s=this;e&&e.search("img/decks/")>-1?(n="background-image:url('"+e+"');background-repeat: no-repeat; background-position: center center; background-size: cover;",s.setAttribute("style",n)):e&&(i={dir:"cards",filename:e},t.get("transport").request("GetFile",i,function(e){s.setAttribute("style","background-image: url('"+e+"');background-repeat: no-repeat; background-position: center center; background-size: cover;")}))}}),error:new n(v),editevent:new s(u)}),u.template='<div class="cardpopup editcard"><div class="card-detail"><div class="cd-header blue-dark" data-model="bind:formatTitle, type"><div name="title" data-model="bind: setTitle, title" data-editevent="listen: mousedown, clearDefault; listen: blur, updateTitle" contenteditable=true></div></div><div class="cd-picarea"><div class ="cardpicture" data-model="bind:setPic, picture_file"></div><div class="picinfo"><span class="cd-creditslbl"data-label="bind:innerHTML, credits"></span><input type="text" class="input editcredit" data-label="bind: placeholder, picturecredit" data-model="bind:value, picture_credit"></div><span class="importbutton"><input type="file" enctype="multipart/form-data" accept = "image/gif, image/jpeg, image/png" data-editevent="listen: mousedown, selectpress; listen: change, uploadnDisplay"><div data-label="bind:innerHTML, importlbl" data-editevent="listen:mousedown, press; listen:mouseup, release"></div></span></div><div class="cd-contentarea"><span class="contentTitle" data-label="bind: innerHTML, dyknow"></span><textarea class="input enterdyknow" data-label="bind: placeholder, enterdyknow" data-model="bind:value,didYouKnow"></textarea><span class="cd-sourcelbl" data-label="bind:innerHTML, source"></span><textarea class="input entersources" data-label="bind: placeholder, dyknowsources" data-model="bind: value, sources"></textarea></div><label class="editerror" data-error="bind:innerHTML, error"></label><div class="cancelmail" data-editevent="listen:mousedown, press; listen:mouseup, cancel" data-label="bind:innerHTML, cancellbl"></div><div class="sendmail" data-editevent="listen:mousedown, press; listen:mouseup, upload" data-label="bind:innerHTML, savelbl">Save</div></div></div>',u.reset=function(e,i,n){var s=new Date;d=null,v.set("error",""),m.reset(),"newcard"===i?(m.reset(h),m.set("_id","C:"+s.getTime()),m.set("created_on",[s.getFullYear(),s.getMonth(),s.getDate()]),m.set("deck",[e]),"contexts"===n&&(m.set("type",2),m.set("picture_file","img/decks/context.png")),"problems"===n&&(m.set("type",3),m.set("picture_file","img/decks/problem.png")),"techno"===n&&(m.set("type",4),m.set("picture_file","img/decks/technology.png"))):m.sync(t.get("db"),i)},u.changeType=function(e){switch(e){case 1:m.set("type",2),m.set("picture_file","img/decks/context.png");break;case 2:m.set("type",3),m.set("picture_file","img/decks/problem.png");break;case 3:m.set("type",4),m.set("picture_file","img/decks/technology.png");break;default:m.set("type",2),m.set("picture_file","img/decks/context.png")}},u.clearDefault=function(e,t){var i=t.getAttribute("name");""===m.get(i)&&(t.innerHTML="")},u.updateTitle=function(e,t){var i=t.innerHTML;i=4===m.get("type")?i.toUpperCase():i.charAt(0).toUpperCase()+i.slice(1),m.set("title",i)},u.selectpress=function(e,t){t.value=""},u.release=function(e,t){setTimeout(function(){t.classList.remove("pressed")},300)},u.uploadnDisplay=function(e,t){var i=new FileReader,n=new Image,s=u.dom.querySelector(".cardpicture"),a=new r({color:"#4d4d4d",lines:12,length:12,width:6,radius:10}).spin();s.setAttribute("style","background-image: none"),a.spin(s),i.onload=function(e){n.src=e.target.result,setTimeout(function(){y(w(n),function(e){s.setAttribute("style","background-image: url('"+e+"')"),a.stop(),d=e})},300)},i.readAsDataURL(t.files[0])},u.press=function(e,t){t.classList.add("pressed")},u.cancel=function(e,t){t.classList.remove("pressed"),c(),m.unsync(),m.reset({})},u.upload=function(e,i){var n=new Date;i.classList.remove("pressed"),v.set("error",""),k.spin(i),m.get("title")&&"<br>"!==m.get("title")||v.set("error",g.get("titlerequired")),v.get("error")?k.stop():m.get("_rev")?(m.set("last_modified",[n.getFullYear(),n.getMonth(),n.getDate()]),u.uploadCard(i)):m.sync(t.get("db"),m.get("_id")).then(function(){u.uploadCard()})},u.uploadCard=function(){d&&(L(),m.set("picture_file",m.get("_id"))),m.upload().then(function(){return l(m.get("type"),m.get("_id"))}).then(function(){k.stop(),c(),m.unsync(),m.reset({})})},u}}),define("library/decks/deckview/cardeditor/importcard",["OObject","service/config","Bind.plugin","Event.plugin","Store","CouchDBBulkDocuments","CouchDBView","Promise","lib/spin.min","service/confirm","service/map"],function(e,t,i,n,s,a,o,r,l,c,d){return function(u,p){var g,h,m=new e,v=t.get("labels"),f=t.get("user"),b=t.get("transport"),w=t.get("db"),y=new s([]),L=new s([]),k=[],S=new s;return m.template='<div class="importcard"><div class="importfrom"><label data-label="bind:innerHTML, importfrom"></label><select data-model="bind:setDecks, decks" data-importevent="listen: change, updateSelect"></select></div><div class="importlist"><legend data-label="bind:innerHTML, seldeck"></legend><ul name="selected" data-selected="foreach"><li name="selected" data-selected="bind: setType, type; bind: innerHTML, title; bind: setSelected, selected" data-importevent="listen: mouseup , toggleSelect"></li></ul></div><div class="importarea"><button class="addremove invisible" data-model="bind: setVisible, sel; bind: setDirection, direction" data-importevent="listen: mouseup , addRemoveSelected">Add/remove</button><button class="invisible" data-label="bind:innerHTML, selall" data-model="bind:setVisible, sel" data-importevent="listen: mouseup , selectAll"></button><button class="invisible" data-label="bind:innerHTML, clearsel" data-model="bind: setVisible, sel" data-importevent="listen: mouseup , clearSelected">Clear selection</button></div><div class="importlist"><legend data-label="bind:innerHTML, workdeck"></legend><ul data-current="foreach"><li name="current" data-current="bind: setType, type; bind: innerHTML, title; bind: setSelected, selected" data-importevent="listen: mouseup , toggleSelect"></li></ul></div><div class="cancelmail" data-importevent="listen:mousedown, press; listen:mouseup , cancel" data-label="bind:innerHTML, cancellbl"></div><div class="sendmail" data-importevent="listen:mousedown, press; listen:mouseup , upload" data-label="bind:innerHTML, savelbl">Save</div></div>',m.plugins.addAll({label:new i(v),model:new i(S,{setDecks:function(e){var t,i,n="";if(e)for(t=0,i=e.length;i>t;t++)e[t]._id!==g&&(n+="<option>"+e[t].title+"</option>");this.innerHTML=n},setDirection:function(e){e?node.classList.remove("invisible"):node.classList.add("invisible"),this.innerHTML="remove"===e?v.get("remsel"):v.get("impsel")},setVisible:function(e){e?this.classList.remove("invisible"):this.classList.add("invisible")}}),current:new i(y,{setType:function(e){switch(e){case 1:this.setAttribute("style","background-image:url('../img/decks/characters.png'); color: #657b99;");break;case 2:this.setAttribute("style","background-image:url('../img/decks/context.png');color:#5f8f28;");break;case 3:this.setAttribute("style","background-image:url('../img/decks/problem.png');color: #bd262c");break;case 4:this.setAttribute("style","background-image:url('../img/decks/technology.png');color: #f27b3d;")}},setSelected:function(e){e?this.classList.add("selected"):this.classList.remove("selected")}}),selected:new i(L,{setType:function(e){switch(e){case 1:this.setAttribute("style","background-image:url('../img/decks/characters.png'); color: #657b99;");break;case 2:this.setAttribute("style","background-image:url('../img/decks/context.png');color:#5f8f28;");break;case 3:this.setAttribute("style","background-image:url('../img/decks/problem.png');color: #bd262c");break;case 4:this.setAttribute("style","background-image:url('../img/decks/technology.png');color: #f27b3d;")}},setSelected:function(e){e?this.classList.add("selected"):this.classList.remove("selected")}}),importevent:new n(m)}),m.cancel=function(e,t){t.classList.remove("pressed"),p()},m.upload=function(e,t){var i=new l({color:"#8cab68",lines:10,length:8,width:4,radius:8,top:-7,left:28}).spin(t),n=["newcard"],s=["newcard"],a=["newcard"],o=["newcard"];k.length&&b.request("DeleteCards",{idList:k},function(e){return"ok"===e&&(k=[]),e}),y.loop(function(e){switch(e.type){case 1:n.push(e.id);break;case 2:s.push(e.id);break;case 3:a.push(e.id);break;case 4:o.push(e.id);break;default:n.push(e.id)}}),u({characters:n,contexts:s,problems:a,techno:o}).then(function(){i.stop(),t.classList.remove("pressed"),p()})},m.press=function(e,t){t.classList.add("pressed")},m.updateSelect=function(e,t){var i=t.selectedIndex;L.reset([]),m.getDeckCards(S.get("decks")[i]._id,L)},m.toggleSelect=function(e,t){var i,n=t.getAttribute("name"),s=t.getAttribute("data-"+n+"_id"),a=S.get("sel")||0;"current"===n?(i=y,"remove"!==S.get("direction")&&(m.clearSelection("selected"),S.set("direction","remove"),a=0)):(i=L,"add"!==S.get("direction")&&(m.clearSelection("current"),S.set("direction","add"),a=0)),i.get(s).selected?(i.update(s,"selected",!1),S.set("sel",a-1)):(i.update(s,"selected",!0),S.set("sel",a+1))},m.selectAll=function(){var e;e="add"===S.get("direction")?L:y,e.loop(function(t,i){e.update(i,"selected",!0)})},m.clearSelected=function(){var e;e="add"===S.get("direction")?L:y,e.loop(function(t,i){e.update(i,"selected",!1)}),S.set("sel",0)},m.addRemoveSelected=function(){var e=S.get("direction");"add"===e?m.addSelected():m.removeSelected()},m.addSelected=function(){var e=y.toJSON(),t=JSON.parse(e),i=m.dom.querySelector("ul[name='current']"),n=(new l).spin(i);y.reset([]),L.loop(function(i){i.selected&&-1===e.search(i.id)&&t.push({id:i.id,type:i.type,title:i.title,deck:i.deck.concat(),selected:i.selected})}),t.sort(function(e,t){var i=e.title,n=t.title;return n>i?-1:i>n?1:i===n?0:void 0}),y.reset(t),n.stop(),m.clearSelection("selected"),S.set("direction","remove")},m.removeSelected=function(){var e=[],t=[],i="";y.loop(function(i,n){i.selected&&(e.push(n),1===i.deck.length&&i.deck[0]===g&&t.push({title:i.title.toUpperCase(),id:i.id}))}),t.length?(d.get("cache").classList.add("appear"),t.forEach(function(e){i+=e.title+", "}),i=i.slice(0,-2),h=new c(document.body,v.get("delcardwarning")+i,function(i){i&&(y.delAll(e),m.clearSelection("current"),S.set("sel",0),t.forEach(function(e){k.push(e.id)})),document.body.removeChild(document.querySelector(".confirm")),d.get("cache").classList.remove("appear")},"importcard-confirm")):(y.delAll(e),m.clearSelection("current"),S.set("sel",0))},m.clearSelection=function(e){var t;t="current"===e?y:L,t.loop(function(e,i){e.selected&&e.selected===!0&&t.update(i,"selected",!1)})},m.getDecks=function(e){var t=new a,i=f.get("taiaut_decks").concat(f.get("custom_decks")),n=new r;return t.setTransport(b),t.sync(w,{keys:i}).then(function(){var i,s=f.get("lang"),a=[];for(t.loop(function(e){(e.doc.public||e.doc.created_by===f.get("_id")||e.doc.sharedwith&&e.doc.sharedwith.indexOf(f.get("_id")))&&(e.doc.default_lang&&e.doc.default_lang!==s?e.doc.translations&&e.doc.translations[s]?a.push(e.doc.translations[s]):a.push(e.doc):a.push(e.doc))}),i=a.length-1;i>=0;i--)a[i]._id===e&&a.splice(i,1);a.sort(function(e,t){var i=e.title,n=t.title;return n>i?-1:i>n?1:i===n?0:void 0}),S.set("decks",a.concat()),n.fulfill(),t.unsync()}),n},m.getDeckCards=function(e,t){var i=new o,n=new r,s=m.dom.querySelector("ul[name='selected']"),a=(new l).spin(s);return i.setTransport(b),i.sync(w,"library","_view/cards",{key:'"'+e+'"'}).then(function(){var e=[];i.loop(function(t){e.push({id:t.value._id,type:t.value.type,title:t.value.title,deck:t.value.deck})}),e.sort(function(e,t){var i=e.title,n=t.title;return n>i?-1:i>n?1:i===n?0:void 0}),a.stop(),t.reset(e),n.fulfill()}),n},m.reset=function(e){S.reset({}),y.reset([]),L.reset([]),k=[],m.dom.querySelector("select").selectedIndex=0,g=e,m.getDecks(g).then(function(){m.getDeckCards(g,y),m.getDeckCards(S.get("decks")[0]._id,L)})},f.watchValue("taiaut_decks",function(){m.getDecks()}),f.watchValue("custom_decks",function(){m.getDecks()}),f.watchValue("lang",function(){m.getDecks()}),m}}),define("library/decks/deckview/cardeditor/newcard",["OObject","Bind.plugin","Event.plugin","Amy/Stack-plugin","service/config","Store","CouchDBDocument","./editchar","./editcard","./importcard","Promise"],function(e,t,i,n,s,a,o,r,l,c,d){return function(u){var p=new e,g=new n,h=new a;return cardCDB=new o,labels=s.get("labels"),user=s.get("user"),transport=s.get("transport"),close=function(){p.dom.classList.add("invisible")},updateDeck=function(e,t){var i=new d,n=h.get("deckId"),a=new o,r="characters";switch(e){case 1:r="characters";break;case 2:r="contexts";break;case 3:r="problems";break;case 4:r="techno";break;default:console.log("no type detected")}return a.setTransport(transport),a.sync(s.get("db"),n).then(function(){var e=new Date,i=a.get("content"),n=i[r];return n.indexOf(t)<0&&(n.push(t),i[r]=n,a.set("content",i)),a.set("last_updated",[e.getFullYear(),e.getMonth(),e.getDate()]),a.upload()}).then(function(){a.unsync(),u("updated",n,e),i.fulfill()}),i},removeCard=function(e){var t=new o,i=new d;return t.setTransport(transport),t.sync(s.get("db"),e).then(function(){var e=t.get("deck")||[],i=new d;return e.splice(e.indexOf(h.get("deckId")),1),e.length?(t.set("deck",e),t.upload().then(function(){i.fulfill()})):(-1===file.search("img/decks")&&(json={type:"card",file:file},transport.request("DeleteAttachment",json,function(e){"ok"!==e&&console.log(e)})),t.remove().then(function(){i.fulfill()})),i}).then(function(){return i}),i},addToDeck=function(e){var t=new o,i=new d;return t.setTransport(transport),t.sync(s.get("db"),e).then(function(){var e=t.get("deck")||[],i=h.get("deckId");return e.indexOf(i)<0&&e.push(i),t.set("deck",e),t.upload()}).then(function(){i.fulfill(),t.unsync()}),i},updateImport=function(e){var t=new d,i=h.get("deckId"),n=new o,a=[],r=[],l=new Date;return n.setTransport(transport),n.sync(s.get("db"),i).then(function(){var t,i={},s={characters:e.characters.concat(),contexts:e.contexts.concat(),problems:e.problems.concat(),techno:e.techno.concat()},o=!1;return t=n.get("translations")?n.get("translations"):{},t.hasOwnProperty(user.get("lang"))&&(o=!0),o?(["characters","contexts","problems","techno"].forEach(function(e){i[e]=t[user.get("lang")].content[e].concat()}),t[user.get("lang")].content=s,n.set("translations",t)):(["characters","contexts","problems","techno"].forEach(function(e){i[e]=n.get("content")[e].concat()}),n.set("content",s)),["characters","contexts","problems","techno"].forEach(function(e){var t,n,o,l,c=i[e],d=s[e];for(t=0,l=c.length;l>t;t++)d.indexOf(c[t])<0&&r.push(c[t]);for(n=0,o=d.length;o>n;n++)c.indexOf(d[n])<0&&a.push(d[n])}),a.forEach(function(e){addToDeck(e)}),r.forEach(function(e){removeCard(e)}),(a.length||r.length)&&n.set("last_updated",[l.getFullYear(),l.getMonth(),l.getDate()]),n.upload()}).then(function(){u("updated",i,null),t.fulfill()}),t},editCard=new l(updateDeck,close),editChar=new r(updateDeck,close),importCard=new c(updateImport,close),p.template='<div id="card_creation" class="invisible"><div class="header blue-dark" data-label="bind: innerHTML, cardeditor"></div><div class="create_header"><label data-label="bind:innerHTML, createnew"></label><select class="changetype" data-setup="bind: selectedIndex, type" data-newcardevent="listen: change, changeType"><option data-label="bind:innerHTML, char"></option><option data-label="bind:innerHTML, context"></option><option data-label="bind:innerHTML, problem"></option><option data-label="bind:innerHTML, techno"></option><option data-label="bind:innerHTML, importcard"></option></select></div><div class="createcontentstack" data-newcardcontentstack="destination"></div></div>',p.plugins.addAll({label:new t(labels),setup:new t(h),newcardcontentstack:g,newcardevent:new i(p)}),p.close=close,p.reset=function(e,t,i,n){document.getElementById("card_creation").classList.remove("invisible"),h.reset({deckId:i,title:n,type:["characters","contexts","problems","techno"].indexOf(t)}),"characters"===t?(editChar.reset(i,e),g.getStack().show("editchar")):(editCard.reset(i,e,t),g.getStack().show("editcard"))},p.press=function(e,t){t.classList.add("pressed")},p.changeType=function(e,t){var i=t.selectedIndex;4===i?(importCard.reset(h.get("deckId")),g.getStack().show("importcard")):0===i?(editChar.reset(h.get("deckId"),"newcard"),g.getStack().show("editchar")):(editCard.reset(h.get("deckId"),"newcard",h.get("type")),g.getStack().show("editcard"),editCard.changeType(i))},p.init=function(){g.getStack().add("editchar",editChar),g.getStack().add("editcard",editCard),g.getStack().add("importcard",importCard)},p.init(),p}}),define("library/decks/deckview/deck-share",["OObject","service/map","service/config","Bind.plugin","Event.plugin","Store","service/avatar","service/utils","service/autocontact","CouchDBDocument","Promise","lib/spin.min"],function(e,t,n,s,a,o,r,l,c,d,u,p){return function(){var t=new e,r=new o({errormsg:""}),l=n.get("user"),c=n.get("transport"),g=n.get("labels"),h=new o({body:"",docId:"",docType:"",attachment:"",docTitle:"",signature:l.get("signature")}),m=new o([]),v=new o([]),f=!1,b=new p({color:"#5F8F28",lines:8,length:8,width:4,radius:8,left:30,top:-6}).spin();return t.plugins.addAll({labels:new s(g),share:new s(h,{setHeader:function(e){this.innerHTML=g.get("sharing")+e
}}),contacts:new s(v,{setSelected:function(e){this.innerHTML=e?"&#10003;":""}}),auto:new s(m,{highlight:function(e){e?this.classList.add("selected"):this.classList.remove("selected")}}),shareevent:new a(t),errormsg:new s(r)}),t.template='<div class="deck-share invisible"><div class="header blue-dark"><span data-share="bind:setHeader, docTitle">Sharing idea</span></div><form class="form"><legend>Select contacts</legend><div class="selectall" data-labels="bind:innerHTML, selectall" data-shareevent="listen: mousedown, press; listen:mouseup, selectAll">Select all</div><input class="search" data-shareevent="listen:mousedown, displayAutoContact; listen:input, updateAutoContact" data-labels="bind:placeholder, tocontactlbl"><div id="sharelistauto" class="autocontact invisible"><div class="autoclose" data-shareevent="listen:mouseup,close"></div><ul data-auto="foreach"><li data-auto="bind:innerHTML, username; bind:highlight, selected" data-shareevent="listen:mouseup, select"></li></ul></div><div class="sharecontactlist"><ul data-contacts="foreach"><li class = "contact list-item" data-shareevent="listen:mousedown, discardContact"><p class="contact-name" data-contacts="bind:innerHTML, username"></p><div class="remove-contact"></div><p class="contact-intro" data-contacts="bind:innerHTML, intro"></p></li></ul></div><p><legend>Add a message</legend><textarea class="input sharemessage" data-share="bind:value, body"></textarea></p><p><legend>Signature</legend><textarea class="signature" data-share="bind:value, signature"></textarea></p><div class="sendmail-footer"><p class="send"><label class="cancelmail" data-labels="bind:innerHTML, cancellbl" data-shareevent="listen: mousedown, press; listen:mouseup, cancel">Cancel</label><label class="sendmail" data-labels="bind:innerHTML, sharelbl" data-shareevent="listen:mousedown, press; listen:mouseup, share">Share</label><label class="editerror" data-errormsg="bind:innerHTML, errormsg"></label></p></div></form></div>',t.show=function(){t.dom.classList.remove("invisible"),document.getElementById("deckview").setAttribute("style","overflow-y: scroll;")},t.hide=function(){t.dom.classList.add("invisible"),document.getElementById("deckview")&&document.getElementById("deckview").setAttribute("style","overflow-y: none;"),h.reset({body:"",docId:"",docType:"",docTitle:"",signature:l.get("username")+" <"+l.get("_id")+">"}),r.reset({errormsg:""}),v.reset([]),m.reset(l.get("connections").concat())},t.reset=function(e){r.reset({errormsg:""}),h.reset({body:"",docId:e,docType:"",docTitle:"",signature:l.get("username")+" <"+l.get("_id")+">"}),t.getDocDetails(e),l.get("signature")&&h.set("signature",l.get("signature")),v.reset([]),m.reset(l.get("connections").concat())},t.getDocDetails=function(e){var t=new d({});t.setTransport(c),t.sync(n.get("db"),e).then(function(){h.set("docType",t.get("type")),h.set("docTitle",t.get("title")),t.unsync()})},t.updateAutoContact=function(e,t){var n,s=JSON.parse(m.toJSON()),a=l.get("connections").concat(),o=t.value.toLowerCase();if(""===t.value)m.reset(a);else{for(i=s.length-1;i>=0;i--)n=s[i].username.toLowerCase(),0!==n.search(o)&&s.splice(i,1);m.reset(s)}m.loop(function(e,t){v.toJSON().search(e.userid)>-1&&m.update(t,"selected",!0)})},t.close=function(e,t){t.parentNode.classList.add("invisible")},t.displayAutoContact=function(){t.dom.querySelector("#sharelistauto").classList.remove("invisible"),m.reset(l.get("connections").concat())},t.discardContact=function(e,i){var n=i.getAttribute("data-contacts_id"),s=v.get(n).userid;v.alter("splice",n,1),m.loop(function(e,t){e.userid===s&&setTimeout(function(){m.update(t,"selected",!1)},200)}),t.unselectGroup(s)},t.select=function(e,i){var n=i.getAttribute("data-auto_id");m.get(n).selected?(t.removeContact(m.get(n)),setTimeout(function(){m.update(n,"selected",!1),document.getElementById("sharelistauto").classList.add("invisible")},200)):(t.addContact(m.get(n)),t.selectGroup(),setTimeout(function(){m.update(n,"selected",!0),document.getElementById("sharelistauto").classList.add("invisible")},200))},t.selectAll=function(e,t){t.classList.remove("pressed"),v.reset([]),m.reset(l.get("connections").concat()),m.loop(function(e,t){m.update(t,"selected",!0),"user"===e.type&&v.alter("push",e)})},t.removeContact=function(e){if("group"===e.type)for(j=e.contacts.length-1;j>=0;j--)t.removeContact(e.contacts[j]);else v.loop(function(t,i){t.userid===e.userid&&v.alter("splice",i,1)}),t.unselectGroup(e.userid),m.loop(function(t,i){t.userid===e.userid&&m.update(i,"selected",!1)})},t.selectGroup=function(){var e,t=!1;m.loop(function(i,n){if("group"===i.type&&!i.selected){for(e=i.contacts,t=!0,j=e.length-1;j>=0;j--)if(v.toJSON().search(e[j].userid)<0){t=!1;break}t&&m.update(n,"selected",!0)}})},t.unselectGroup=function(e){m.loop(function(t,i){"group"===t.type&&t.selected&&JSON.stringify(t.contacts).search(e)>0&&m.update(i,"selected",!1)})},t.addContact=function(e){var t,i,n=!0;if("user"===e.type)v.alter("push",e);else for(t=0,i=e.contacts.length;i>t;t++)v.loop(function(i){i.userid===e.contacts[t].userid&&(n=!1)}),n&&(v.alter("push",e.contacts[t]),m.loop(function(i,n){i.userid===e.contacts[t].userid&&m.update(n,"selected",!0)}))},t.press=function(e,t){t.classList.add("pressed")},t.share=function(e,i){var n=new Date,s=new u,a={type:"DOC",status:"unread",date:[n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getMinutes()],author:l.get("_id"),username:l.get("username"),firstname:l.get("firstname"),toList:"",ccList:"",object:"",body:h.get("body"),signature:h.get("signature"),docId:h.get("docId"),docType:h.get("docType"),docTitle:h.get("docTitle"),dest:[]};f||(f=!0,b.spin(i),t.buildRecipientList(a.docId,a.dest).then(function(){a.dest.length?(c.request("ShareDeck",{idList:a.dest,docId:a.docId},function(e){"ok"===e&&s.fulfill()}),s.then(function(){c.request("Notify",a,function(){r.set("errormsg",g.get("shareok")),i.classList.remove("pressed"),f=!1,setTimeout(function(){b.stop(),t.reset(a.docId),t.dom.querySelector("#sharelistauto").classList.add("invisible"),m.reset(l.get("connections").concat()),t.hide()},2500)})})):(r.set("errormsg",g.get("alreadyshared")),i.classList.remove("pressed"),f=!1,setTimeout(function(){b.stop(),t.reset(a.docId),t.dom.querySelector("#sharelistauto").classList.add("invisible"),m.reset(l.get("connections").concat()),t.hide()},2500))}))},t.cancel=function(e,i){i.classList.remove("pressed"),t.hide()},t.buildRecipientList=function(e,t){var i=new u,s=new d;return s.setTransport(c),s.sync(n.get("db"),e).then(function(){var e=s.get("sharedwith")||[];return v.loop(function(i){e.length?e.indexOf(i.userid)<0&&(e.push(i.userid),t.push(i.userid)):(e.push(i.userid),t.push(i.userid))}),s.set("sharedwith",e),s.upload()}).then(function(){i.fulfill()}),i},t}}),define("library/decks/deckview/deckview",["OObject","Bind.plugin","Event.plugin","Place.plugin","Amy/Stack-plugin","Store","service/map","./deckdetails","./cardlist","service/config","./cardeditor/newcard","./deck-share"],function(e,t,i,n,s,a,o,r,l,c,d,u){return function(o){var p=new e,g=new d(o),h=new u,m=new a([{name:"characters",active:!1,count:0},{name:"contexts",active:!1,count:0},{name:"problems",active:!1,count:0},{name:"techno",active:!1,count:0}]),v=new s,f="",b="";return p.plugins.addAll({cardmenu:new t(m,{setClass:function(e){e&&this.classList.add(e)},setActive:function(e){e?this.classList.add("active"):this.classList.remove("active")}}),place:new n({newCard:g,shareDeck:h}),deckviewstack:v,deckviewevent:new i(p)}),p.template='<div id="deckview" class="details"><div data-place="place: newCard"></div><div data-place="place: shareDeck"></div><ul class="card-menu" data-cardmenu="foreach"><li><div class="card-type" data-cardmenu = "bind: setClass, name; bind:setActive, active" data-deckviewevent="listen: mousedown, viewCards"></div><div class="card-count" data-cardmenu="bind:innerHTML, count"></div></li></li></ul><div id="deckviewstack" data-deckviewstack="destination"></div></div>',p.viewCards=function(e,t){var i=t.getAttribute("data-cardmenu_id");m.loop(function(e,t){t===parseInt(i)?m.update(t,"active",!0):m.update(t,"active",!1)}),v.getStack().show(m.get(i).name)},p.editCard=function(e,t){g.reset(e,t,b,f)},p.hideEditView=function(){g&&g.close()},p.reset=function(e,t){p.hideEditView(),h.hide(),p.dom.setAttribute("style","overflow-y: none;"),["details","characters","contexts","problems","techno"].forEach(function(t){v.getStack().get(t).reset(e)}),b=e._id,f=e.title,m.reset([]),["characters","contexts","problems","techno"].forEach(function(t){"newcard"===e.content[t][0]?m.alter("push",{name:t,active:!1,count:e.content[t].length-1}):m.alter("push",{name:t,active:!1,count:e.content[t].length})}),t?v.getStack().show(t):v.getStack().show("details")},p.init=function(){v.getStack().add("details",new r(o)),v.getStack().add("characters",new l("characters",p.editCard,o)),v.getStack().add("contexts",new l("contexts",p.editCard,o)),v.getStack().add("problems",new l("problems",p.editCard,o)),v.getStack().add("techno",new l("techno",p.editCard,o))},c.get("observer").watch("deck-share",function(e){h.reset(e),h.show()}),p}}),define("library/decks/newdeck",["OObject","service/map","Bind.plugin","Event.plugin","service/config","CouchDBDocument","lib/spin.min","service/utils"],function(e,t,i,n,s,a,o,r){return function(t){var l,c=new e,d=new a({}),u=s.get("user"),p=new a(s.get("userLanguages")),g=function(){var e=u.get("lang").substring(0,2);d.set("default_lang",e),p.loop(function(t,i){t.name===e?p.update(i,"selected",!0):p.update(i,"selected",!1)})},h=(s.get("transport"),s.get("labels")),m=new a({error:""}),v=new o({color:"#8cab68",lines:10,length:8,width:4,radius:8,top:-8,left:340}).spin(),f=60,b=60,w=function(e){var t,i,n=document.createElement("canvas"),s=n.getContext("2d");return t=e.width,i=e.height,i>t?(i*=f/t,t=f):(t*=b/i,i=b),n.width=t,n.height=i,s.drawImage(e,0,0,t,i),n.toDataURL("image/png")},y=function(e,t){var i,n,s=new Image,a=document.createElement("canvas"),o=a.getContext("2d"),r=f,l=b;s.src=e,setTimeout(function(){a.width=r,a.height=l,i=Math.floor(Math.max(0,(s.width-r)/2)),n=Math.floor(Math.max(0,(s.height-l)/2)),o.drawImage(s,i,n,r,l,0,0,r,l),t(a.toDataURL("image/png"))},300)},L=function(){var e="/upload",t=new FormData,i="deckpic",n="decks",s=l;t.append("type",i),t.append("dir",n),t.append("filename",d.get("_id")),t.append("dataString",s),r.uploadFile(e,t,null,function(e){console.log(e)})};return d.setTransport(s.get("transport")),g(),c.plugins.addAll({newdeck:new i(d,{displayLang:function(e){var t=e.substring(0,2);this.setAttribute("style","background-image:url('img/flags/"+t+".png');")}}),select:new i(p,{setBg:function(e){this.setAttribute("style","background-image:url('img/flags/"+e+".png');")},setSelected:function(e){e?this.classList.add("selected"):this.classList.remove("selected")}}),labels:new i(h),errormsg:new i(m,{setError:function(e){switch(e){case"notitle":this.innerHTML=h.get("titlefield")+h.get("emptyfielderror");break;case"nodesc":this.innerHTML=h.get("descriptionfield")+h.get("emptyfielderror");break;default:this.innerHTML=e}this.setAttribute("style","color: #F27B3D;")}}),newdeckevent:new n(c)}),c.template='<div id="newdeck-popup"><div class = "header blue-dark"><span data-labels="bind: innerHTML, createdecklbl"></span><div class="close-popup" data-newdeckevent="listen:mousedown, cancel"></div></div><form class="form"><div class="idealang"><div class="currentlang" data-newdeck="bind: displayLang, default_lang" data-newdeckevent="listen: mouseup, showLang"></div><ul class="invisible" data-select="foreach"><li data-select="bind: setBg, name; bind: setSelected, selected" data-newdeckevent="listen: mousedown, selectFlag; listen: mouseup, setLang"></li></ul></div><input maxlength=40 type="text" class="input newideatitle" data-labels="bind:placeholder, decktitleplaceholder" data-newdeck="bind: value, title" data-newdeckevent="listen: input, resetError"><textarea class="description input" data-labels="bind:placeholder, deckdescplaceholder" data-newdeck="bind: value, description" data-newdeckevent="listen: input, resetError"></textarea><legend data-labels="bind: innerHTML, setdecklogo"></legend><div class="deckicon"><div class="decklogo"></div><span class="importbutton"><input type="file" enctype="multipart/form-data" accept = "image/gif, image/jpeg, image/png" data-newdeckevent="listen: mousedown, selectpress; listen: change, uploadnDisplay"><div data-labels="bind:innerHTML, importlbl" data-newdeckevent="listen: mousedown, press; listen: mouseup, release"></div></span></div><div class="newidea-footer"><span class="errormsg" data-errormsg="bind:setError, error"></span><div class="sendmail" data-newdeckevent="listen:mousedown, press; listen:mouseup, upload" data-labels="bind:innerHTML, savelbl">Save</div></div></form></div>',c.reset=function(){d.reset({_id:"",type:9,description:"",default_lang:u.get("lang"),content:{characters:["newcard"],contexts:["newcard"],problems:["newcard"],techno:["newcard"]},title:"",version:0,date:[],picture_file:"",translations:{},created_by:u.get("_id"),author:u.get("username"),"public":!1,sharedwith:[]}),l=null},c.show=function(){c.reset(),document.querySelector("#library .cache").classList.add("appear"),c.dom.classList.add("appear")},c.press=function(e,t){t.classList.add("pressed")},c.showLang=function(){c.dom.querySelector(".idealang ul").classList.remove("invisible")},c.selectFlag=function(e,t){var i;e.stopPropagation(),i=parseInt(t.getAttribute("data-select_id"),10),p.loop(function(e,t){i===t?p.update(t,"selected",!0):p.update(t,"selected",!1)})},c.setLang=function(e,t){var i;e.stopPropagation(),i=t.getAttribute("data-select_id"),d.set("default_lang",p.get(i).name),c.dom.querySelector(".idealang ul").classList.add("invisible")},c.selectpress=function(e,t){t.value=""},c.release=function(e,t){setTimeout(function(){t.classList.remove("pressed")},300)},c.uploadnDisplay=function(e,t){var i=new FileReader,n=new Image,s=c.dom.querySelector(".decklogo"),a=new o({color:"#4d4d4d",lines:12,length:12,width:6,radius:10}).spin();s.setAttribute("style","background-image: none;"),a.spin(s),i.onload=function(e){n.src=e.target.result,setTimeout(function(){y(w(n),function(e){s.setAttribute("style","background-image: url('"+e+"')"),a.stop(),l=e,d.set("picture_file","decklogo")})},300)},i.readAsDataURL(t.files[0])},c.closePopup=function(){c.dom.classList.remove("appear"),document.querySelector("#library .cache").classList.remove("appear"),d.unsync(),c.reset(),m.reset({error:""})},c.resetError=function(e,t){var i;t.scrollTop=99999,m.get("error")&&(i=t.classList.contains("description")?"nodesc":t.classList.contains("solution")?"nosol":"notitle",m.get("error")===i&&t.value&&m.set("error",""))},c.cancel=function(){c.closePopup()},c.upload=function(e,i){var n=new Date,a="D:"+n.getTime();i.classList.remove("pressed"),d.get("title")?d.get("description")||m.set("error","nodesc"):m.set("error","notitle"),m.get("error")||d.get("_id")||(i.classList.add("invisible"),v.spin(i.parentNode),d.set("_id",a),d.set("date",[n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds()]),d.sync(s.get("db"),a).then(function(){return d.get("picture_file")&&L(),d.upload()}).then(function(){t("new",a);var e=u.get("custom_decks")||[];return e.unshift(a),u.set("custom_decks",e),u.upload()}).then(function(){v.stop(),i.classList.remove("invisible"),c.closePopup()}))},c.reset(),c}}),define("library/decks/decks",["OObject","Bind.plugin","Amy/Stack-plugin","Amy/Control-plugin","Event.plugin","Place.plugin","service/config","service/map","./decklist/decklist","./deckview/deckview","./newdeck"],function(e,t,i,n,s,a,o,r,l,c,d){return function(){var r,u,p,g=new e,h=new n(g),m=o.get("user"),v=new i,f=function(e){var t=v.getStack().getCurrentScreen(),i=t.getModel();r=t.highlightDeck(h.init,e),y.reset(i.get(r))},b=!1,w=function(e,t,i){var n;p=t,"new"===e&&(b=!0,p=t),"updated"===e&&(n=v.getStack().getCurrentScreen(),n.reset(function(e){e&&(n.highlightDeck(h.init,t),y.reset(n.getModel().get(r),i))}))},y=new c(w),L=new d(w);return g.plugins.addAll({label:new t(o.get("labels")),deckliststack:v,decksevent:new s(g),deckplace:new a({deckView:y,newDeck:L}),deckscontrol:h}),g.template='<div id="decks"><div id="decklist" class="list"><div class="header blue-light"><div class="option left" data-deckscontrol=""></div><span data-label="bind: innerHTML, decklistheadertitle"></span><div class="option right" data-decksevent="listen: mousedown, plus"></div></div><div class="overflow" data-deckliststack="destination" data-deckscontrol="radio:li,selected,mousedown,selectStart"></div></div><div data-deckplace="place:deckView"></div><div data-deckplace="place:newDeck"></div></div>',g.reset=function(){u.reset(function(e){e&&(v.getStack().show("ideafy"),u.highlightDeck(h.init,0),y.reset(u.getModel().get(0)),r=0)})},g.displayDeck=f,g.init=function(){u=new l("all_decks"),v.getStack().add("ideafy",u),u.init(function(e){e&&(v.getStack().show("ideafy"),y.init(),u.highlightDeck(h.init,0),y.reset(u.getModel().get(0),"details"),r=0)})},g.selectStart=function(e){var t=v.getStack().getCurrentScreen().getModel(),i=e.target.getAttribute("data-decks_id");y.reset(t.get(i)),r=i},g.plus=function(){L.show()},g.init(),m.watchValue("lang",function(){var e,t=v.getStack().getCurrentName(),i=v.getStack().getCurrentScreen();switch(t){case"taiaut":e="taiaut_decks";case"custom":e="custom_decks";break;default:e="all_decks"}i.getDecks(e,function(e){e&&(i.initSelected(h.init,r),y.reset(i.getModel().get(r)))})}),m.watchValue("custom_decks",function(e,t,i){u.reset(function(t){var n;t&&b?f(p):t&&e.length<i.length&&(n=u.getModel(),n.getNbItems()&&(u.initSelected(h.init,0),y.reset(n.get(0)),r=0)),b=!1})}),m.watchValue("taiaut_decks",function(){u.reset(function(e){e&&(u.initSelected(h.init,0),y.reset(u.getModel().get(0)))})}),g}}),define("library/library",["OObject","Amy/Stack-plugin","service/map","service/submenu","./ideas/ideas","./sessions/sessions","./decks/decks","service/config"],function(e,t,i,n,s,a,o,r){return function(){var l,c,d,u,p=new e,g=new t,h=r.get("observer"),m=function(e){g.getStack().show(e)};return p.plugins.add("librarystack",g),p.template='<div id="library"><div class="cache"></div><div id="library-menu"></div><div class="stack" data-librarystack="destination"></div></div>',p.place(i.get("library")),p.showMenu=function(){u.toggleActive(!0)},p.hideMenu=function(){u.toggleActive(!1)},p.reset=function(){l.reset(),d.reset(),c.reset(),u.reset(),g.getStack().show("#ideas")},u=new n(p.dom.querySelector("#library-menu"),m),u.toggleActive(!1),l=new s,c=new a,d=new o,g.getStack().add("#ideas",l),g.getStack().add("#sessions",c),g.getStack().add("#decks",d),g.getStack().show("#ideas"),h.watch("display-doc",function(e,t){switch(t){case 6:var i=g.getStack().get("#ideas");i.searchIdea(e.substr(2)),g.getStack().getCurrentScreen()!==i&&g.getStack().show("#ideas");break;case 9:g.getStack().show("#decks")}}),p}}),define("brainstorm/ideafy-menu",["OObject","service/map","Store","Bind.plugin","Event.plugin","service/config"],function(e,t,i,n,s,a){return function(o){var r=new e,l=a.get("user"),c=a.get("labels"),d=new i,u={name:"continue",active:!0,selected:!1,label:c.get("continuesession"),bg:"continuesession.png",bgselected:"continueactive.png"},p="";return r.plugins.addAll({ideafymenu:new n(d,{setActive:function(e){e?this.classList.remove("inactive"):this.classList.add("inactive")},setBg:function(e){var t=this.getAttribute("data-ideafymenu_id");e?this.setAttribute("style","background-image:url('img/brainstorm/"+d.get(t).bgselected+"');color:white;"):this.setAttribute("style","background-image:url('img/brainstorm/"+d.get(t).bg+"');color:#4D4D4D;")}}),labels:new n(c),ideafyevent:new s(this)}),r.template='<div id="ideafy-menu"><div class="brainstorm-header header blue-light" data-labels="bind: innerHTML, brainstormchoosemode"></div><ul class="menu" data-ideafymenu = "foreach"><li data-ideafymenu="bind:innerHTML, label; bind: setActive, active; bind:setBg, selected" data-ideafyevent="listen:mousedown, press; listen: mouseup, start"></li></ul></div>',r.place(t.get("ideafy-menu")),this.press=function(e,t){var i=t.getAttribute("data-ideafymenu_id");d.update(i,"selected",!0),t.classList.add("pressed")},this.start=function(e,t){var i=t.getAttribute("data-ideafymenu_id");"continue"===d.get(i).name?o("continue",p):o(d.get(i).name),t.classList.remove("pressed"),d.update(i,"selected",!1)},r.addContinue=function(e){var t=JSON.parse(d.toJSON());"continue"!==d.get(0).name&&(t.unshift(u),d.reset(t)),p=e},r.removeContinue=function(){var e=JSON.parse(d.toJSON());"continue"===e[0].name&&e.splice(0,1),d.reset(e),p=""},r.reset=function(){d.reset([{name:"quick",active:!0,selected:!1,label:c.get("quickbmode"),bg:"quick.png",bgselected:"quickactive.png"},{name:"musession",active:!0,selected:!1,label:c.get("musession"),bg:"multiuser.png",bgselected:"multiuseractive.png"},{name:"customb",active:!1,selected:!1,label:c.get("customsession"),bg:"customb.png",bgselected:"custombactive.png"},{name:"tutorial",active:!0,selected:!1,label:c.get("ideafytutorial"),bg:"tutorial.png",bgselected:"tutorialactive.png"}]),l.get("sessionInProgress")&&l.get("sessionInProgress").id&&r.addContinue(l.get("sessionInProgress"))},r.reset(),l.watchValue("sessionInProgress",function(e){e.id&&e.type?r.addContinue(e):r.removeContinue()}),l.watchValue("lang",function(){var e=a.get("labels");d.loop(function(t,i){switch(t.name){case"continue":d.update(i,"label",e.get("continuesession"));break;case"quick":d.update(i,"label",e.get("quickbmode"));break;case"musession":d.update(i,"label",e.get("musession"));break;case"customb":d.update(i,"label",e.get("customsession"));break;case"tutorial":d.update(i,"label",e.get("ideafytutorial"))}})}),r}}),define("service/help",["OObject","service/map","Bind.plugin","Event.plugin","service/config","Store"],function(e,t,i,n,s,a){return new function(){var o=new e,r=s.get("labels"),l=new a({html:""});return o.plugins.addAll({help:new i(l),helpevent:new n(o)}),o.template='<div><div class="help-doctor"></div><div class="close-help" data-helpevent="listen:mousedown, closeHelp"></div><div class="help-screen" data-help="bind:innerHTML,html"></div></div>',o.render(),o.place(t.get("help-popup")),o.setContent=function(e){l.set("html",r.get(e))},o.closeHelp=function(){document.getElementById("help-popup").classList.remove("appear"),document.getElementById("cache").classList.remove("appear")},o}}),define("brainstorm/quickb/quickstart",["OObject","service/map","Bind.plugin","Event.plugin","service/config","service/help","lib/spin.min","Promise","Store"],function(e,t,i,n,s,a,o,r,l){return function(c,d,u,p){var g=new e,h=s.get("user"),m=s.get("db"),v=new l(s.get("userLanguages")),f=function(){var e=h.get("lang").substring(0,2);c.set("lang",e),v.loop(function(t,i){t.name===e?v.update(i,"selected",!0):v.update(i,"selected",!1)})},b=s.get("labels"),w="step",y=new o({color:"#657B99",lines:10,length:8,width:4,radius:8,top:360,left:545}).spin();return f(),g.plugins.addAll({labels:new i(b),select:new i(v,{setBg:function(e){this.setAttribute("style","background-image:url('img/flags/"+e+".png');")},setSelected:function(e){e?this.classList.add("selected"):this.classList.remove("selected")}}),model:new i(c,{setTitle:function(e){new Date,e&&e.username&&this.setAttribute("placeholder",b.get("quickstarttitleplaceholderpre")+e.username+b.get("quickstarttitleplaceholderpost"))},displayLang:function(e){var t=e.substring(0,2);this.setAttribute("style","background-image:url('img/flags/"+t+".png');")}}),quickstartevent:new n(g)}),g.template='<div id = "quickstart"><div class="previousbutton" data-quickstartevent="listen: mousedown, press; listen: mousedown, prev"></div><div class="brainstorm-header header blue-light" data-labels="bind: innerHTML, quickstart" data-quickstartevent="listen:mousedown, toggleProgress"></div><div class="help-brainstorm" data-quickstartevent="listen:mousedown, help"></div><form class="quickstart-form"><div class="idealang"><div class="currentlang" data-model="bind: displayLang, lang" data-quickstartevent="listen: mouseup, showLang"></div><ul class="invisible" data-select="foreach"><li data-select="bind: setBg, name; bind: setSelected, selected" data-quickstartevent="listen: mousedown, selectFlag; listen: mouseup, setLang"></li></ul></div><label data-labels="bind:innerHTML, quickstarttitle"></label><hr/><textarea class="quickstart-title" autofocus="" name="title" data-model="bind:value, title; bind: setTitle, initiator"></textarea><label data-labels="bind:innerHTML, quickstartdesc"></label><hr/><textarea class="quickstart-desc" name="description" data-model="bind:value, description" data-labels="bind: placeholder, quickstartdescplaceholder"></textarea><div class="next-button" data-labels="bind:innerHTML, nextbutton" data-quickstartevent="listen: mousedown, press; listen:mouseup, next"></div></form><div>',g.place(t.get("quickstart")),g.press=function(e,t){t.classList.add("pressed")},g.next=function(e,t){y.spin(t.parentNode),t.classList.add("invisible"),t.classList.remove("pressed"),"step"===w?(w="screen",""===c.get("title")&&c.set("title",b.get("quickstarttitleplaceholderpre")+c.get("initiator").username+b.get("quickstarttitleplaceholderpost")),c.set("lang",h.get("lang")),c.set("_id","S:QUICK:"+c.get("startTime")),c.sync(m,c.get("_id")).then(function(){return h.set("sessionInProgress",{id:c.get("_id"),type:"quick"}),h.upload()}).then(function(){u("quickstart")})):u("quickstart")},g.stopSpinner=function(){y.stop(),g.dom.querySelector(".next-button").classList.remove("invisible")},g.prev=function(e,t){t.classList.remove("pressed"),d("quickstart")},g.toggleProgress=function(){p()},g.showLang=function(){g.dom.querySelector(".idealang ul").classList.remove("invisible")},g.selectFlag=function(e,t){var i;e.stopPropagation(),i=parseInt(t.getAttribute("data-select_id"),10),v.loop(function(e,t){i===t?v.update(t,"selected",!0):v.update(t,"selected",!1)})},g.setLang=function(e,t){var i;e.stopPropagation(),i=t.getAttribute("data-select_id"),c.set("lang",v.get(i).name),g.dom.querySelector(".idealang ul").classList.add("invisible")},g.reset=function(e){var t=new Date,i=c.get("step");new r,e?(w="quickstart"===i?"step":"screen","quickwrapup"!==i&&c.set("resumeTime",t.getTime())):(c.set("startTime",t.getTime()),c.set("date",[t.getFullYear(),t.getMonth(),t.getDate()]),c.set("lang",h.get("lang")),w="step")},g.help=function(){a.setContent("quickstarthelp"),document.getElementById("cache").classList.add("appear"),document.getElementById("help-popup").classList.add("appear")},g}}),define("brainstorm/quickb/quicksetup",["OObject","service/map","Bind.plugin","Event.plugin","service/config","CouchDBDocument","Store","Promise","service/cardpopup","service/help","service/utils","lib/spin.min"],function(e,t,i,n,s,a,o,r,l,c,d,u){return function(p,g,h,m,v){var f,b,w=new e,y=t.get("quicksetup"),L=s.get("labels"),k=s.get("transport"),S=s.get("db"),T=(s.get("user"),{}),M=new o({timer:null,display:!1}),A=new o({"char":{selected:!1,left:null,popup:!1},context:{selected:!1,left:null,popup:!1},problem:{selected:!1,left:null,popup:!1}}),C=new o({"char":{id:"",title:L.get("char"),pic:""},context:{id:"",title:L.get("context"),pic:""},problem:{id:"",title:L.get("problem"),pic:""}}),x={"char":0,context:0,problem:0},q=!0,H={"char":new o,context:new o,problem:new o},_="",I=null,D=0,N="step",O=new u({color:"#657B99",lines:10,length:8,width:4,radius:8,top:373,left:373}).spin();return w.plugins.addAll({labels:new i(L),quicksetup:new i(A,{setReload:function(e){0===e?this.classList.add("reload"):this.classList.remove("reload")},updateNext:function(){A.get("char").selected&&A.get("context").selected&&A.get("problem").selected?this.classList.remove("invisible"):this.classList.add("invisible")},popup:function(e){e?this.classList.add("highlighted"):this.classList.remove("highlighted")},setSelected:function(e){e?this.classList.add("pushed"):this.classList.remove("pushed")}}),quicksetuptimer:new i(M,{setTime:function(e){this.innerHTML=d.formatDuration(e)},displayTimer:function(e){e?this.classList.add("showtimer"):this.classList.remove("showtimer")}}),quicksetupcards:new i(C,{removeDefault:function(e){e?this.classList.remove("defaultcard"):this.classList.add("defaultcard")},formatTitle:function(e){this.innerHTML=e?e.substring(0,1).toUpperCase()+e.substring(1).toLowerCase():e},setPic:function(e){var t=this;e?e.search("img/decks")>-1?this.setAttribute("style","background-image:url('"+e+"');"):(json={dir:"cards",filename:e},s.get("transport").request("GetFile",json,function(e){t.setAttribute("style","background:white; background-image: url('"+e+"'); background-repeat: no-repeat; background-position: center center; background-size:contain;")})):this.setAttribute("style","background-image: none;")}}),quicksetupevent:new n(w)}),w.template='<div id = "quicksetup"><div class="previousbutton" data-quicksetupevent="listen: mousedown, press; listen: mousedown, prev"></div><div id="quicksetup-popup" class="invisible"></div><div class="brainstorm-header header blue-light" data-labels="bind: innerHTML, quicksetup" data-quicksetupevent="listen:mousedown, toggleProgress"></div><div class="timer" data-quicksetuptimer="bind:setTime, timer; bind: displayTimer, display" data-quicksetupevent="listen:mousedown,toggleTimer"></div><div class="help-brainstorm" data-quicksetupevent="listen:mousedown, help"></div><div class="drawarea"><div class="decks"><div class="drawbutton drawchar" name="char" data-quicksetupevent="listen: mousedown, push; listen:mouseup, draw" data-quicksetup="bind: setReload, char.left"></div><div class="drawbutton drawcontext" name="context" data-quicksetupevent="listen: mousedown, push; listen:mouseup, draw" data-quicksetup="bind:setReload, context.left"></div><div class="drawbutton drawproblem" name="problem" data-quicksetupevent="listen: mousedown, push; listen:mouseup, draw" data-quicksetup="bind:setReload, problem.left"></div></div><div class="cards"><div class="card char defaultcard" name="char" data-quicksetupevent="listen:mousedown, zoom" data-quicksetupcards="bind:removeDefault, char.pic" data-quicksetup="bind: popup, char.popup"><div class="cardpicture" data-quicksetupcards="bind: setPic, char.pic"></div><div class="cardtitle" data-quicksetupcards="bind:formatTitle, char.title">Character</div></div><div class="card context defaultcard" name="context" data-quicksetupevent="listen:mousedown, zoom" data-quicksetupcards="bind:removeDefault, context.pic" data-quicksetup="bind: popup, context.popup"><div class="cardpicture" data-quicksetupcards="bind: setPic, context.pic"></div><div class="cardtitle" data-quicksetupcards="bind:formatTitle, context.title">Context</div></div><div class="card problem defaultcard" name="problem" data-quicksetupevent="listen:mousedown, zoom" data-quicksetupcards="bind:removeDefault, problem.pic" data-quicksetup="bind: popup, problem.popup"><div class="cardpicture" data-quicksetupcards="bind: setPic, problem.pic"></div><div class="cardtitle" data-quicksetupcards="bind:formatTitle, problem.title">Problem</div></div></div><div class="confirmdraw"><div class="drawok" name="char" data-quicksetup="bind:setSelected, char.selected" data-quicksetupevent="listen: mousedown, push; listen:mouseup, accept"></div><div class="drawok" name="context" data-quicksetup="bind:setSelected, context.selected" data-quicksetupevent="listen: mousedown, push; listen:mouseup, accept"></div><div class="drawok" name="problem" data-quicksetup="bind:setSelected, problem.selected" data-quicksetupevent="listen: mousedown, push; listen:mouseup, accept"></div></div><div class="next-button invisible" data-labels="bind:innerHTML, nextbutton" data-quicksetupevent="listen: mousedown, press; listen:mouseup, next" data-quicksetup="bind:updateNext, char.selected;bind:updateNext, context.selected;bind:updateNext, problem.selected"></div></div></div>',w.place(y),w.press=function(e,t){t.classList.add("pressed")
},w.next=function(e,t){O.spin(t.parentNode),t.classList.add("invisible"),t.classList.remove("pressed"),"step"===N?(N="screen",g.set("characters",C.get("char")),g.set("contexts",C.get("context")),g.set("problems",C.get("problem")),clearInterval(b),M.set("display",!0),w.updateSessionScore(M.get("timer")).then(function(){return p.unsync(),p.sync(s.get("db"),p.get("_id"))}).then(function(){p.set("elapsedTimers",{quicksetup:M.get("timer")}),p.set("characters",[C.get("char").id]),p.set("contexts",[C.get("context").id]),p.set("problems",[C.get("problem").id]),m("quicksetup")})):m("quicksetup")},w.stopSpinner=function(){O.stop(),w.dom.querySelector(".next-button").classList.remove("invisible")},w.help=function(){c.setContent("quicksetuphelp"),document.getElementById("cache").classList.add("appear"),document.getElementById("help-popup").classList.add("appear")},w.prev=function(e,t){t.classList.remove("pressed"),h("quicksetup")},w.toggleProgress=function(){v()},w.toggleTimer=function(){M.set("display",!M.get("display"))},w.push=function(e,t){"screen"!==N&&t.classList.add("pushed")},w.draw=function(e,t){var i=t.getAttribute("name"),n=A.get(i);_now=new Date,"step"===N&&q&&(0===n.left&&(T[i]=g.get("deck")[i].concat(),n.left=T[i].length,A.set(i,n)),n.selected&&alert("please unlock selected card first"),q&&!n.selected&&(q=!1,n.selected===!1?w.drawCard(i).then(function(){var e=!1;t.classList.remove("pushed"),q=!0,A.loop(function(t){t.popup===!0&&(e=!0)}),e&&w.setPopup(i)}):(t.classList.remove("pushed"),q=!0)))},w.accept=function(e,t){var i=t.getAttribute("name"),n=A.get(i);"step"===N&&(C.get(i).id?n.selected?(n.selected=!1,A.set(i,n)):(n.selected=!0,A.set(i,n)):(n.selected=!1,A.set(i,n)))},w.zoom=function(e,t){var i=t.getAttribute("name");w.setPopup(i)},w.setPopup=function(e){var t={x:0,y:337},i="left",n=A.get(_)||"",s=A.get(e);n&&(n.popup=!1,A.set(_,n)),s.popup=!0,A.set(e,s),_=e,"char"===e&&(t.x=382),"context"===e&&(t.x=102,i="right"),"problem"===e&&(t.x=249,i="right"),H[e].getNbItems()&&f.reset(H[e].toJSON(),t,i,document.getElementById("quicksetup-popup"))},w.closePopup=function(){var e=A.get(_);e.popup=!1,A.set(_,e),_=""},f=new l(w.closePopup),w.initTimer=function(e){var t=new Date,i=t.getTime(),n=e||0;M.set("display",!1),M.set("timer",n),"quicksetup"===p.get("step")&&(b=setInterval(function(){var e=new Date;M.set("timer",n+e.getTime()-i)},1e3))},w.reset=function(e){N="step",e?(D=p.get("elapsedTimers").quicksetup||0,p.get("characters").length?(N="screen",A.reset({"char":{selected:!0,left:1,popup:!1},context:{selected:!0,left:1,popup:!1},problem:{selected:!0,left:1,popup:!1}}),_="",M.set("timer",D),M.set("display",!0),w.getDeck(p.get("deck")).then(function(){return w.getCard(p.get("characters")[0],H.char)}).then(function(){var e=H.char;return C.set("char",{id:e.get("_id"),title:e.get("title"),pic:e.get("picture_file")}),g.set("characters",C.get("char")),w.getCard(p.get("contexts")[0],H.context)}).then(function(){var e=H.context;return C.set("context",{id:e.get("_id"),title:e.get("title"),pic:e.get("picture_file")}),g.set("contexts",C.get("context")),w.getCard(p.get("problems")[0],H.problem)}).then(function(){var e=H.problem;C.set("problem",{id:e.get("_id"),title:e.get("title"),pic:e.get("picture_file")}),g.set("problems",C.get("problem"))})):(w.init(),w.initTimer(D))):w.init()},w.getDeck=function(e){var t=new r,i=new a;return i.setTransport(k),i.sync(S,e).then(function(){var e,n={},a=s.get("user").get("lang");e=i.get("default_lang")&&i.get("default_lang")!==a?i.get("translations")&&i.get("translations")[a]?i.get("translations")[a]:JSON.parse(i.toJSON()):JSON.parse(i.toJSON()),n.char=e.content.characters,n.context=e.content.contexts,n.problem=e.content.problems,n.techno=e.content.techno,["char","context","problem","techno"].forEach(function(e){"newcard"===n[e][0]&&n[e].shift()}),g.set("deck",n),t.fulfill(),setTimeout(function(){i.unsync()},2e3)}),t},w.getCard=function(e,t){var i=new r,n=new a;return n.setTransport(k),n.sync(S,e).then(function(){t.reset(JSON.parse(n.toJSON())),i.fulfill(),n.unsync()}),i},w.drawCard=function(e){var t=new r,i=A.get(e),n=C.get(e),s=Math.floor(Math.random()*T[e].length),a=T[e][s];return w.getCard(a,H[e]).then(function(){var o=H[e];x[e]++,T[e].splice(s,1),n.id=a,n.title=o.get("title"),n.pic=o.get("picture_file"),C.set(e,n),i.left=T[e].length,A.set(e,i),t.fulfill()}),t},w.updateSessionScore=function(e){var t=new r,i={sid:p.get("_id"),step:"quicksetup",time:e,cards:x.char+x.context+x.problem};return k.request("UpdateSessionScore",i,function(e){"ok"===e.res?t.fulfill():t.reject()}),t},w.init=function(){w.getDeck(s.get("user").get("active_deck")).then(function(){var e=g.get("deck");T.char=e.char.concat(),T.context=e.context.concat(),T.problem=e.problem.concat(),x.char=0,x.context=0,x.problem=0,H={"char":new o,context:new o,problem:new o},_="",q=!0,I=null,C.reset({"char":{id:"",title:L.get("char"),pic:""},context:{id:"",title:L.get("context"),pic:""},problem:{id:"",title:L.get("problem"),pic:""}}),A.reset({"char":{selected:!1,left:null,popup:!1},context:{selected:!1,left:null,popup:!1},problem:{selected:!1,left:null,popup:!1}})})},w}}),define("brainstorm/whiteboard/wbdefault",["OObject","service/config","Bind.plugin"],function(e,t,i){return function(n,s){var a=new e,o="",r=t.get("labels"),l="quick";return a.plugins.add("labels",new i(r)),l=s?s:"quick",o="scenario"===n?l+"scenariohelp":l+"ideahelp",a.template='<div id="whiteboard-default" class="defaultcontent"><div class="doctor-deedee"></div><div class="help" data-labels="bind:innerHTML,'+o+'"></div></div>',a}}),define("brainstorm/whiteboard/wbmain",["OObject","Bind.plugin","Event.plugin","service/config","lib/spin.min","Store"],function(e,t,i,n,s,a){return function(o,r,l){var c,d=new e,u=!0,p=!1,g=n.get("transport"),h=new a([]),m=8,v=new a({currentPage:1,nbPages:1});return d.plugins.addAll({pagination:new t(v,{setPage:function(e){var t=e;this.innerHTML=v.get("nbPages")>1?labels.get("page")+t+" / "+v.get("nbPages"):""},setNbPages:function(e){var t=v.get("currentPage");this.innerHTML=e>1?labels.get("page")+t+" / "+v.get("nbPages"):""},setLeft:function(e){e>1?this.classList.remove("invisible"):this.classList.add("invisible")},setRight:function(e){e<v.get("nbPages")?this.classList.remove("invisible"):this.classList.add("invisible")}}),wbmain:new t(h,{displayPost:function(e){var t,i,n,a=this,o=a.getAttribute("data-wbmain_id"),r=h.get(o).content,l=h.get(o).style,d=h.get(o).background;switch(e){case"postit":a.classList.remove("photo"),a.classList.remove("drawing"),a.innerHTML='<div class="inner-postit">'+r.replace(/\n/g,"<br>")+"</div>",a.setAttribute("style","background:url('img/brainstorm/"+l.img+"') no-repeat center center; background-size: contain; color:"+l.marker+";");break;case"import":a.classList.add("photo"),a.classList.remove("drawing"),this.innerHTML="",i=new s({color:"#657B99",lines:10,length:8,width:4,radius:8,left:50,top:50}).spin(a),t="sessions/"+c,n={dir:t,filename:r},g.request("GetFile",n,function(e){a.setAttribute("style","background:white; background-image: url('"+e+"'); background-repeat: no-repeat; background-position: center center; background-size:contain;"),i.stop()});break;case"drawing":a.classList.remove("photo"),a.classList.add("drawing"),this.innerHTML="",i=new s({color:"#657B99",lines:10,length:8,width:4,radius:8,left:50,top:30}).spin(a),t="sessions/"+c,n={dir:t,filename:r},g.request("GetFile",n,function(e){a.setAttribute("style","background:"+d+"; background-image: url('"+e+"'); background-repeat: no-repeat; background-position: center center; background-size:contain;"),i.stop()})}}}),wbevent:new i(d)}),d.template='<div class="wbmain"><div class="pagenb"><div class="leftcaret" data-pagination="bind: setLeft, currentPage" data-wbevent="listen:mousedown, push; listen:mouseup, previousPage"></div><span data-pagination="bind: setPage, currentPage; bind:setNbPages, nbPages"></span><div class = "rightcaret" data-pagination="bind: setRight, currentPage" data-wbevent="listen:mousedown, push; listen:mouseup, nextPage"></div></div><ul class="wblist" data-wbmain="foreach"><li class="wb-item postit" data-wbmain="bind: displayPost, type" data-wbevent="listen: mouseup, edit; listen:dblclick, cancelEdit"></li><ul><div>',d.push=function(e,t){t.classList.add("invisible"),e.stopPropagation()},d.previousPage=function(){d.displayPage("previous")},d.nextPage=function(){d.displayPage("next")},d.edit=function(e,t){var i=t.getAttribute("data-wbmain_id"),n=o.get(i).type;u?p?"postit"!==o.get(i).type&&(t.classList.contains("enlarge")?t.classList.remove("enlarge"):t.classList.add("enlarge")):(r.set(n,"active"),l(n,i)):u=!0},d.cancelEdit=function(e){e.stopPropagation(),u=!1},d.setSessionId=function(e){c=e},d.setReadonly=function(e){p=e},d.displayPage=function(e){var t,i,n,s=v.get("currentPage");switch(e){case"next":t=s,v.set("currentPage",t+1);break;case"previous":t=s-2,v.set("currentPage",t+1);break;default:t=s-1}for(h.reset([]),i=0;m>i&&(n=t*m+i,o.get(n));i++)h.alter("push",o.get(n))},d.getNbPages=function(){var e=o.getNbItems(),t=e/m,i=e%m;return i>0?parseInt(t)+1:0===t?1:t},d.init=function(){v.set("nbPages",d.getNbPages()),d.displayPage("current"),v.get("nbPages")>1&&d.dom.querySelector(".rightcaret").classList.remove("invisible"),o.watch("added",function(e){var t=d.getNbPages();v.set("nbPages",t),h.getNbItems()===m&&o.get(e).author===n.get("user").get("_id")?d.displayPage("next"):d.displayPage("current")}),o.watch("deleted",function(){v.set("nbPages",d.getNbPages()),1===h.getNbItems()&&v.get("currentPage")===v.get("nbPages")?d.displayPage("previous"):d.displayPage("current")}),o.watch("updated",function(){d.displayPage("current")})},d}}),define("brainstorm/whiteboard/wbpostit",["OObject","Store","Bind.plugin","Event.plugin","service/config"],function(e,t,i,n,s){return function(a,o){var r=new e,l=s.get("labels"),c="#4D4D4D",d=[{name:"blue",color:"#657B99",img:"postItBlue.png",selected:!1},{name:"azur",color:"#9AC9CD",img:"postItAzur.png",selected:!1},{name:"yellow",color:"#F2E520",img:"postItYellow.png",selected:!0},{name:"orange",color:"#F27B3D",img:"postItOrange.png",selected:!1}],u=new t(d),p=null,g=new t({type:"postit",content:"",style:{postit:"yellow",img:"postItYellow.png",marker:"#4D4D4D"}});return r.plugins.addAll({labels:new i(l),postit:new i(g,{setStyle:function(e){var t=e.marker,i=e.img;this.setAttribute("style","background-image:url('img/brainstorm/"+i+"'); color:"+t+";")}}),colors:new i(u,{setBg:function(e){this.setAttribute("style","background:"+e+";")},setSelected:function(e){this.innerHTML=e?"&#10003;":""}}),postitevent:new n(r)}),r.template='<div class="wbpostit"><div class="postit-cancel postit-close" data-postitevent="listen:mousedown,cancel"></div><div class="postit" data-postit="bind:setStyle, style"><textarea data-postit="bind: value, content"></textarea></div><span class="choosecolorlbl" data-labels="bind:innerHTML, choosecolorlbl"></span><ul class="postitcolors" data-colors="foreach"><li class="postitcolor" data-postitevent="listen:mousedown,choose" data-colors="bind:setBg, color;bind:setSelected, selected"></li></ul><div name="post" class = "postpostit" data-postitevent="listen: mousedown, press; listen:mouseup, post"></div><div class = "delpostit" name="del" data-postitevent="listen:mousedown, press;listen:mouseup, del"></div></div>',r.cancel=function(){o("postit")},r.choose=function(e,t){var i=t.getAttribute("data-colors_id");u.loop(function(e,t){t===parseInt(i,10)?u.update(t,"selected",!0):u.update(t,"selected",!1)}),g.set("style",{postit:u.get(i).name,marker:c,img:u.get(i).img})},r.press=function(e,t){t.classList.add("pressed")},r.post=function(e,t){p||0===p?a.alter("splice",p,1,JSON.parse(g.toJSON())):a.alter("push",JSON.parse(g.toJSON())),t.classList.remove("pressed"),o("postit"),r.reset()},r.reset=function(e){p=e,p||0===p?g.reset(a.get(p)):(g.reset({type:"postit",content:"",style:{postit:"yellow",img:"postItYellow.png",marker:"#4D4D4D"}}),u.reset([{name:"blue",color:"#657B99",img:"postItBlue.png",selected:!1},{name:"azur",color:"#9AC9CD",img:"postItAzur.png",selected:!1},{name:"yellow",color:"#F2E520",img:"postItYellow.png",selected:!0},{name:"orange",color:"#F27B3D",img:"postItOrange.png",selected:!1}]))},r.del=function(e,t){p&&a.del(p),t.classList.remove("pressed"),r.reset(),o("postit")},r}}),define("brainstorm/whiteboard/wbimport",["OObject","service/map","service/config","Bind.plugin","Event.plugin","service/utils","Store","Promise"],function(e,t,i,n,s,a,o,r){return function(t,l){var c,d=new e,u=i.get("labels"),p=(new FileReader,new o({status:null})),g=null,h=new o({type:"import",content:""}),m=400,v=300,f=function(e){var t,i,n=document.getElementById("preview"),s=n.getContext("2d");t=e.width,i=e.height,t>i?t>m&&(i*=m/t,t=m):i>v&&(t*=v/i,i=v),n.width=t,n.height=i,s.drawImage(e,0,0,t,i)},b=function(e){var t=new r,n="/upload",s=new FormData,o="postit",l="sessions/"+c,d=document.getElementById("preview"),u=d.toDataURL("image/png"),g=new Date,m=e||i.get("user").get("_id")+"_"+g.getTime();return s.append("type",o),s.append("dir",l),s.append("filename",m),s.append("dataString",u),a.uploadFile(n,s,p,function(){h.set("content",m),t.fulfill()}),t},w=function(){var e=document.getElementById("preview"),t=e.getContext("2d");t.clearRect(0,0,e.width,e.height)};return d.template='<div class="import"><span class="importbutton"><input type="file" enctype="multipart/form-data" accept = "image/*" data-importevent="listen: mousedown, selectpress; listen:mouseup, check; listen: change, preview"><div data-labels="bind:innerHTML, importlbl" data-importevent="listen: mousedown, press; listen: mouseup, release"></div></span><div id="postpic" class="wbpostit invisible" data-importmodel="bind:setVisibility, content"><div class="postit-cancel postit-close" data-importevent="listen:mousedown,cancel"></div><div class="picframe"><canvas id="preview" data-importmodel="bind:showPreview, content"></canvas></div><div name="post" class = "postpostit" data-importevent="listen: mousedown, press; listen:mouseup, post"></div><div class = "delpostit" name="del" data-importevent="listen:mousedown, press;listen:mouseup, del"></div><div class="uploadprogress" data-importprogress="bind:showProgress, status"></div></div>',d.plugins.addAll({labels:new n(u),importmodel:new n(h,{setVisibility:function(e){e?this.classList.remove("invisible"):this.classList.add("invisible")},showPreview:function(e){var t,n=this,s=i.get("transport");e?(t={dir:"sessions/"+c,filename:e},s.request("GetFile",t,function(e){var t=new Image,i=n.getContext("2d");t.src=e,n.width=t.width,n.height=t.height,i.drawImage(t,0,0),d.dom.querySelector("#postpic").scrollIntoView(!1)})):this.innerHTML=""}}),importprogress:new n(p,{showProgress:function(e){this.innerHTML=e?e+"%":""}}),importevent:new s(d)}),d.cancel=function(e,t){t.parentNode.classList.add("invisible"),l("import")},d.check=function(e,t){t.classList.remove("pressed"),t.files.length&&d.preview("change",t)},d.preview=function(e,t){var i=new Image,n=new FileReader;n.onloadend=function(e){i.src=e.target.result,setTimeout(function(){f(i),document.getElementById("postpic").classList.remove("invisible")},300)},n.readAsDataURL(t.files[0])},d.selectpress=function(e,t){t.value=""},d.press=function(e,t){t.classList.add("pressed")},d.release=function(e,t){setTimeout(function(){t.classList.remove("pressed")},300)},d.post=function(e,i){b(h.get("content")).then(function(){g||0===g?t.alter("splice",g,1,JSON.parse(h.toJSON())):t.alter("push",JSON.parse(h.toJSON())),i.classList.remove("pressed"),d.reset(),p.reset({status:""}),w(),d.dom.querySelector(".importbutton").classList.remove("invisible"),l("import")})},d.reset=function(e){g=e,h.reset({type:"import",content:""}),(g||0===g)&&(h.reset(t.get(e)),d.dom.querySelector("#postpic").scrollIntoView())},d.setSessionId=function(e){c=e},d.del=function(e,i){(g||0===g)&&t.del(g),i.classList.remove("pressed"),i.parentNode.classList.add("invisible"),d.reset(),w(),document.getElementById("importbuttons").classList.remove("invisible"),l("import")},d}}),define("brainstorm/whiteboard/wbdrawing",["OObject","service/map","service/config","Bind.plugin","Event.plugin","Store","Promise","service/utils"],function(e,t,i,n,s,a,o,r){return function(t,l){var c,d=new e,u=null,p={},g=new a({color:"#4D4D4D",size:"1",cap:"round",bg:"white",mode:"pencil"}),h=new a([{color:"#4D4D4D",active:!0},{color:"#657B99",active:!1},{color:"#9AC9CD",active:!1},{color:"#F2E520",active:!1},{color:"#F27B3D",active:!1},{color:"#BD262C",active:!1},{color:"#5F8F28",active:!1},{color:"white",active:!1}]),m=new a([{color:"white",active:!0},{color:"#657B99",active:!1},{color:"#9AC9CD",active:!1},{color:"#F2E520",active:!1},{color:"#F27B3D",active:!1},{color:"#BD262C",active:!1},{color:"#5F8F28",active:!1},{color:"#4D4D4D",active:!1}]),v=i.get("labels"),f=new a({status:null}),b=new a({type:"drawing",content:"",background:""}),w=function(e){var t=new o,n="/upload",s=new FormData,a="postit",l="sessions/"+c,u=d.dom.querySelector(".drawingcanvas"),p=u.toDataURL("image/png"),h=new Date,m=e||i.get("user").get("_id")+"_"+h.getTime();return s.append("type",a),s.append("dir",l),s.append("filename",m),s.append("dataString",p),r.uploadFile(n,s,f,function(){b.set("content",m),b.set("background",g.get("bg")),t.fulfill()}),t},y=!1,L=(document.body.clientWidth-1024)/2,k=(document.body.clientHeight-748)/2,S=93;return d.plugins.addAll({labels:new n(v),color:new n(h,{setColor:function(e){this.setAttribute("style","background:"+e+";")},setActive:function(e){this.innerHTML=e?"&#10003;":""}}),pencil:new n(g,{setSize:function(e){this.setAttribute("r",Math.round(e/2))},setColor:function(e){this.setAttribute("style","background:"+e+";")},togglebgfill:function(e){this.setAttribute("fill",e)},togglemode:function(e){"pencil"===e?this.setAttribute("fill",g.get("bg")):this.setAttribute("fill","#CCCCCC")},togglepencil:function(e){"pencil"===g.get("mode")?this.setAttribute("fill",e):this.setAttribute("fill",g.get("bg"))},toggleselected:function(e){this.classList.contains(e)?this.classList.add("selected"):this.classList.remove("selected")}}),bgcolor:new n(m,{setColor:function(e){this.setAttribute("style","background:"+e+";")},setActive:function(e){this.innerHTML=e?"&#10003;":""}}),uploadprogress:new n(f,{showProgress:function(e){this.innerHTML=e?e+"%":""}}),drawing:new n(b,{draw:function(e){var t,n=i.get("transport"),s=this;e&&(t={dir:c,filename:e},n.request("GetFile",t,function(e){var t=new Image,i=s.getContext("2d");t.src=e,i.drawImage(t,0,0)}))}}),drawingevent:new s(d)}),d.template='<div class = "wbdrawing"><div class="drawingtools"><div class="pencil selected" data-pencil="bind:toggleselected, mode" data-drawingevent="listen:mousedown, drawactive"><span></span></div><div class="erase" data-drawingevent="listen:mousedown, erase" data-pencil="bind:toggleselected, mode"><span></span></div><div class="clear" data-drawingevent="listen:mousedown, select; listen:mouseup,clear"><span data-labels="bind:innerHTML, cleardrawinglbl">Clear</span></div><p name="pencilsize" data-drawingevent="listen:mousedown, expand"><svg width="60" height="39"  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><circle class="stroke" cx="30" cy="21" r="18" stroke-width="1" stroke="rgba(145,145,145,0.7)" data-pencil="bind:togglebgfill,bg; bind:togglemode,mode"/><circle class="fill" cx="30" cy="21" r="18" data-pencil="bind:setSize,size; bind:togglepencil,color"/></svg><div class="drawinglabel" data-labels="bind:innerHTML, pencilsizelbl">size</div></p><input id="pencilsize" class="vertical invisible" type="range" min="1" max="36" data-pencil="bind:value,size" data-drawingevent="listen:mousedown, stop; listen:mousemove,stop; listen:mouseup,hide"><div name="pencilcolors" id="pencilcolor" data-drawingevent="listen:mousedown, expand"><ul id="pencilcolors"  class="pencilcolors invisible" data-color="foreach"><li class="color-item" data-drawingevent="listen:mousedown, getColor"><div data-color="bind:setColor, color; bind:setActive, active"></div></li></ul><div class="pencilpreview" data-pencil="bind:setColor, color"></div><div class="drawinglabel" data-labels="bind:innerHTML, pencilcolorlbl">Color</div></div><div name="pencilbgcolors" id="pencilbgcolor" data-drawingevent="listen:mousedown, expand"><ul id="pencilbgcolors"  class="pencilbgcolors invisible" data-bgcolor="foreach"><li class="color-item" data-drawingevent="listen:mousedown, getBgColor"><div data-bgcolor="bind:setColor, color; bind:setActive, active"></div></li></ul><div class="bgpreview" data-pencil="bind:setColor, bg"></div><div class="drawinglabel" data-labels="bind:innerHTML, drawbgcolorlbl">Background</div></div><div class="canceldrawing" data-drawingevent="listen:mousedown, select; listen:mouseup,cancel"></div><div class="deletedrawing" data-drawingevent="listen:mousedown,select;listen:mouseup,deletedrawing"></div><div class="savedrawing" data-drawingevent="listen:mousedown, post" data-uploadprogress="bind:showProgress,status" ></div></div><canvas class="drawingcanvas" width=652 height=438 data-pencil="bind:setColor, bg" data-drawingevent="listen:mousedown,start;listen:mousemove,move;listen:mouseup,end;" data-drawing="bind:draw, content"></canvas></div>',d.setSessionId=function(e){c=e},d.clear=function(e,t){var i=d.dom.querySelector(".drawingcanvas"),n=i.getContext("2d");n.clearRect(0,0,i.width,i.height),t.classList.remove("selected")},d.resetColors=function(){g.reset({color:"#4D4D4D",size:"1",cap:"round",bg:"white",mode:"pencil"}),h.reset([{color:"#4D4D4D",active:!0},{color:"#657B99",active:!1},{color:"#9AC9CD",active:!1},{color:"#F2E520",active:!1},{color:"#F27B3D",active:!1},{color:"#BD262C",active:!1},{color:"#5F8F28",active:!1},{color:"white",active:!1}]),m.reset([{color:"white",active:!0},{color:"#657B99",active:!1},{color:"#9AC9CD",active:!1},{color:"#F2E520",active:!1},{color:"#F27B3D",active:!1},{color:"#BD262C",active:!1},{color:"#5F8F28",active:!1},{color:"#4D4D4D",active:!1}])},d.erase=function(){g.set("mode","erase"),g.set("color",g.get("bg"))},d.drawactive=function(){g.set("mode","pencil"),h.loop(function(e){e.active&&g.set("color",e.color)})},d.expand=function(e,t){var i=t.getAttribute("name"),n=document.getElementById(i);n.classList.contains("invisible")?n.classList.remove("invisible"):n.classList.add("invisible")},d.stop=function(e){e.stopPropagation()},d.hide=function(e,t){e.stopPropagation(),t.classList.add("invisible")},d.select=function(e,t){t.classList.add("selected")},d.getColor=function(e,t){var i=t.getAttribute("data-color_id");e.stopPropagation(),h.loop(function(e,t){t===parseInt(i)?h.update(t,"active",!0):h.update(t,"active",!1)}),g.set("color",h.get(i).color),g.set("mode","pencil"),t.parentNode.classList.add("invisible")},d.getBgColor=function(e,t){var i=t.getAttribute("data-bgcolor_id");e.stopPropagation(),m.loop(function(e,t){t===parseInt(i)?m.update(t,"active",!0):m.update(t,"active",!1)}),g.set("bg",m.get(i).color),t.parentNode.classList.add("invisible")},d.cancel=function(e,t){d.clear(e,t),d.resetColors(),b.reset({type:"drawing",content:"",background:""}),t.classList.remove("selected"),l("drawing")},d.deletedrawing=function(e,i){(u||0===u)&&t.del(u),d.cancel(e,i)},d.post=function(e,i){i.classList.add("selected"),w(b.get("content")).then(function(){u||0===u?t.alter("splice",u,1,JSON.parse(b.toJSON())):t.alter("push",JSON.parse(b.toJSON())),i.classList.remove("selected"),d.cancel(e,i),f.reset({status:""})})},d.reset=function(e){var i=d.dom.querySelector(".drawingcanvas");u=e,d.resetColors(),_lines=[],(document.getElementById("muscenario")||document.getElementById("muidea"))&&i.setAttribute("height",380),u||0===u?(b.reset(t.get(e)),g.set("bg",b.get("background")),m.loop(function(e,t){e.color===b.get("background")?m.update(t,"active",!0):m.update(t,"active",!1)})):b.reset({type:"drawing",content:"",background:""})},d.start=function(e,t){var i=t.offsetLeft+S;p={x:e.pageX-i-L,y:e.pageY-t.offsetTop-k},y=!0,e.preventDefault()},d.end=function(){y=!1},d.move=function(e,t){var i,n,s,a=t.offsetLeft+S;y&&(i=e.pageX-a-L-p.x,n=e.pageY-t.offsetTop-k-p.y,s=d.draw(t,i,n),p={x:s.x,y:s.y}),e.preventDefault()},d.draw=function(e,t,i){var n=e.getContext("2d");return n.lineWidth=g.get("size"),n.strokeStyle=g.get("color"),n.lineCap=g.get("cap"),n.beginPath(),n.moveTo(p.x,p.y),n.lineTo(p.x+t,p.y+i),n.stroke(),n.closePath(),{x:p.x+t,y:p.y+i}},d}}),define("brainstorm/whiteboard/whiteboard",["Amy/Stack-plugin","./wbdefault","./wbmain","./wbpostit","./wbimport","./wbdrawing","Store"],function(e,t,i,n,s,a,o){function r(e,r,l,c){var d=new o([]),u=this;this.selectScreen=function(e,t){var i=u.getStack().get(e);i.reset&&i.reset(t),u.getStack().show(e)},this.exitScreen=function(e){r.getNbItems()?u.getStack().show("main"):u.getStack().show("default"),l.set(e,"inactive")},this.getContent=function(){return d},this.setSessionId=function(e){u.getStack().get("main").setSessionId(e),u.getStack().get("import").setSessionId(e),u.getStack().get("drawing").setSessionId(e)},this.setReadonly=function(e){u.getStack().get("main").setReadonly(e)},this.getStack().add("default",new t(e,c)),this.getStack().add("main",new i(r,l,this.selectScreen)),this.getStack().add("postit",new n(r,this.exitScreen)),this.getStack().add("import",new s(r,this.exitScreen)),this.getStack().add("drawing",new a(r,this.exitScreen)),this.init=function(){u.getStack().get("main").init(e)}}return function(t,i,n,s){return r.prototype=new e,new r(t,i,n,s)}}),define("brainstorm/quickb/quickscenario",["OObject","service/map","Bind.plugin","Event.plugin","service/config","Store","CouchDBDocument","service/cardpopup","../whiteboard/whiteboard","Promise","service/utils","lib/spin.min"],function(e,t,i,n,s,a,o,r,l,c,d,u){return function(p,g,h,m,v){var f,b,w,y=new e,L=s.get("labels"),k=new a,S=new a,T=new a,M=new a({"char":{id:"",title:"",pic:""},context:{id:"",title:"",pic:""},problem:{id:"",title:"",pic:""}}),A={cardpopup:{"char":!1,context:!1,problem:!1},postit:"inactive","import":"inactive",drawing:"inactive",ready:!1,showstory:!1,shownext:!1,readonly:!1},C=new a(A),x=new a({timer:null,display:!1}),q=new a({title:"",story:"",solution:""}),H=new a([]),_=new l("scenario",H,C),I=0,D="step",N=s.get("transport"),O=new u({color:"#657B99",lines:10,length:8,width:4,radius:8,top:665,left:690}).spin();return y.plugins.addAll({labels:new i(L,{setPlaceholder:function(e){this.setAttribute("placeholder",e)}}),cards:new i(M,{formatTitle:function(e){e&&(this.innerHTML=e.substring(0,1).toUpperCase()+e.substring(1).toLowerCase())},setPic:function(e){var t=this;e?e.search("img/decks")>-1?this.setAttribute("style","background-image:url('"+e+"');"):(json={dir:"cards",filename:e},s.get("transport").request("GetFile",json,function(e){t.setAttribute("style","background:white; background-image: url('"+e+"'); background-repeat: no-repeat; background-position: center center; background-size:contain;")})):this.setAttribute("style","background-image: none;")}}),wbtools:new i(C,{setActive:function(e){"active"===e?this.classList.add("pushed"):this.classList.remove("pushed")},setReady:function(e){e?this.classList.remove("invisible"):this.classList.add("invisible")},toggleToolbox:function(e){e?this.classList.add("invisible"):this.classList.remove("invisible")},setReadonly:function(e){e?this.setAttribute("readonly","readonly"):this.removeAttribute("readonly")},popup:function(e){e?this.classList.add("highlighted"):this.classList.remove("highlighted")}}),quickscenariotimer:new i(x,{setTime:function(e){e&&(this.innerHTML=d.formatDuration(e))},displayTimer:function(e){e?this.classList.add("showtimer"):this.classList.remove("showtimer")}}),scenario:new i(q),wbstack:_,quickscenarioevent:new n(y)}),y.template='<div id = "quickscenario"><div class="previousbutton" data-quickscenarioevent="listen: mousedown, press; listen: mousedown, prev"></div><div class="brainstorm-header header blue-light" data-labels="bind: innerHTML, quickscenario" data-quickscenarioevent="listen:mousedown, toggleProgress"></div><div class="timer" data-quickscenariotimer="bind:setTime, timer; bind: displayTimer, display" data-quickscenarioevent="listen:mousedown,toggleTimer"></div><div id="quickscenario-left" class="leftarea"><div class = "card char" data-wbtools="bind:popup,cardpopup.char" name="char" data-quickscenarioevent="listen:mousedown, zoom"><div class="cardpicture" data-cards="bind:setPic,char.pic"></div><div class="cardtitle" data-cards="bind:formatTitle,char.title">Character</div></div><div class="card context" name="context" data-wbtools="bind: popup,cardpopup.context" data-quickscenarioevent="listen:mousedown, zoom"><div class="cardpicture" data-cards="bind:setPic,context.pic"></div><div class="cardtitle" data-cards="bind: formatTitle,context.title">Context</div></div><div class="card problem" name="problem" data-wbtools="bind:popup, cardpopup.problem" data-quickscenarioevent="listen:mousedown, zoom"><div class="cardpicture" data-cards="bind:setPic,problem.pic"></div><div class="cardtitle" data-cards="bind:formatTitle,problem.title">Problem</div></div></div><div id="quickscenario-popup"></div><div id="quickscenario-right" class="workarea"><div id="scenario-whiteboard" class="whiteboard"><div class="stack" data-wbstack="destination"></div></div><div id="toolbox" data-wbtools="bind:toggleToolbox, showstory"><div class="toolbox-button"><div class="postit-button" name="postit" data-wbtools="bind:setActive, postit" data-quickscenarioevent="listen: mousedown, push; listen:mouseup, post"></div><legend data-labels="bind:innerHTML, post">Post-it</legend></div><div class="toolbox-button"><div class="importpic-button" name="import" data-wbtools="bind:setActive, import" data-quickscenarioevent="listen: mousedown, push; listen:mouseup, importpic"></div><legend data-labels="bind:innerHTML, import">Import pictures</legend></div><div class="toolbox-button"><div class="drawingtool-button" name="drawing" data-wbtools="bind:setActive, drawing" data-quickscenarioevent="listen: mousedown, push; listen:mouseup, draw"></div><legend data-labels="bind:innerHTML, draw">Drawing tool</legend></div></div><div class="finish-button invisible" data-wbtools="bind:setReady, ready" data-labels="bind:innerHTML, finishbutton" data-quickscenarioevent="listen: mousedown, press; listen:mouseup, finish"></div><div id = "quickscenario-writeup" class="writeup invisible" data-wbtools="bind: setReady,showstory"><textarea class = "enterTitle" maxlength="30" data-labels="bind:setPlaceholder, storytitleplaceholder" data-scenario="bind:value, title" data-wbtools="bind:setReadonly, readonly"></textarea><div class="setPrivate"></div><div class="setPublic"></div><textarea class = "enterDesc" data-labels="bind:setPlaceholder, storydescplaceholder" data-scenario="bind:value, story" data-wbtools="bind:setReadonly, readonly"></textarea><textarea class = "enterSol" data-labels="bind:setPlaceholder, storysolplaceholder" data-scenario="bind:value, solution" data-wbtools="bind:setReadonly, readonly"></textarea></div><div class="next-button invisible" data-wbtools="bind:setReady, shownext" data-labels="bind:innerHTML, nextbutton" data-quickscenarioevent="listen: mousedown, press; listen:mouseup, next"></div></div></div>',y.place(t.get("quickscenario")),y.press=function(e,t){t.classList.add("pressed")},y.next=function(e,t){O.spin(t.parentNode),t.classList.add("invisible"),t.classList.remove("pressed"),"step"===D?(D="screen",clearInterval(w),x.set("display",!0),g.set("scenario",JSON.parse(q.toJSON())),y.updateSessionScore(x.get("timer")).then(function(){return p.unsync(),p.sync(s.get("db"),p.get("_id"))}).then(function(){var e=p.get("elapsedTimers");e.quickscenario=x.get("timer"),p.set("scenario",[JSON.parse(q.toJSON())]),p.set("elapsedTimers",e),C.set("readonly",!0),m("quickscenario")})):m("quickscenario")},y.stopSpinner=function(){O.stop(),y.dom.querySelector(".next-button").classList.remove("invisible")},y.prev=function(e,t){t.classList.remove("pressed"),h("quickscenario")
},y.toggleProgress=function(){v()},y.toggleTimer=function(){x.set("display",!x.get("display"))},y.push=function(e,t){var i=t.getAttribute("name");C.set(i,"active")},y.zoom=function(e,t){var i=t.getAttribute("name");y.setPopup(i)},y.setPopup=function(e){var t,i={x:147,y:130},n="left",a=M.get(e),r=C.get("cardpopup"),l="";b&&(r[b]=!1),r[e]=!0,C.set("cardpopup",r),b=e,"char"===e&&(i.y=120,a.id===k.get("_id")&&(l=k.toJSON())),"context"===e&&(i.y=290,a.id===S.get("_id")&&(l=S.toJSON())),"problem"===e&&(i.y=350,a.id===T.get("_id")&&(l=T.toJSON())),l?f.reset(l,i,n,document.getElementById("quickscenario-popup")):(t=new o,t.setTransport(N),t.sync(s.get("db"),a.id).then(function(){l=t.toJSON(),f.reset(l,i,n,document.getElementById("quickscenario-popup")),"char"===e&&k.reset(JSON.parse(t.toJSON())),"context"===e&&S.reset(JSON.parse(t.toJSON())),"problem"===e&&T.reset(JSON.parse(t.toJSON()))}))},y.closePopup=function(){var e=C.get("cardpopup");e[b]=!1,C.set("cardpopup",e),b=""},f=new r(y.closePopup),y.post=function(){_.selectScreen("postit"),C.set("import","inactive"),C.set("drawing","inactive")},y.importpic=function(){_.selectScreen("import"),C.set("postit","inactive"),C.set("drawing","inactive")},y.draw=function(){_.selectScreen("drawing"),C.set("import","inactive"),C.set("postit","inactive")},y.exitTool=function(e){C.set(e,"inactive")},y.finish=function(e,t){_.setReadonly(!0),C.set("ready",!1),C.set("showstory",!0),t.classList.remove("pressed")},y.updateSessionScore=function(e){var t=new c,i={sid:p.get("_id"),step:"quickscenario",time:e,wbcontent:H.toJSON(),scenario:q.toJSON()};return N.request("UpdateSessionScore",i,function(e){"ok"===e.res?t.fulfill():t.reject()}),t},y.reset=function(){C.reset({cardpopup:{"char":!1,context:!1,problem:!1},postit:"inactive","import":"inactive",drawing:"inactive",ready:!1,showstory:!1,shownext:!1,readonly:!1}),_.setSessionId(p.get("_id")),H.reset(p.get("scenarioWB")),_.init(),H.getNbItems()?_.selectScreen("main"):_.selectScreen("default"),p.get("scenario").length?(D="screen",C.set("ready",!1),C.set("showstory",!0),_.setReadonly(!0),q.reset(p.get("scenario")[0]),g.set("scenario",p.get("scenario")[0]),C.set("readonly",!0),C.set("shownext",!0)):(q.reset({title:"",story:"",solution:""}),H.getNbItems()?C.set("ready",!0):C.set("ready",!1),_.setReadonly(!1),D="step"),p.get("elapsedTimers").quickscenario&&(I=p.get("elapsedTimers").quickscenario,x.set("timer",I)),"screen"===D?x.set("display",!0):y.initTimer(I)},y.initTimer=function(e){var t=new Date,i=t.getTime(),n=e||0;x.set("display",!1),x.set("timer",n),"quickscenario"===p.get("step")&&(clearInterval(w),w=setInterval(function(){var e=new Date;x.set("timer",n+e.getTime()-i)},1e3))},g.watchValue("characters",function(e){M.set("char",e)}),g.watchValue("contexts",function(e){M.set("context",e)}),g.watchValue("problems",function(e){M.set("problem",e)}),p.watchValue("_id",function(e){_.setSessionId(e)}),["added","deleted","updated"].forEach(function(e){H.watch(e,function(){JSON.stringify(p.get("scenarioWB"))!==H.toJSON()&&(p.set("scenarioWB",JSON.parse(H.toJSON())),p.upload()),H.getNbItems()&&"step"===D?C.set("ready",!0):C.set("ready",!1)})}),q.watch("updated",function(){q.get("title")&&q.get("story")&&q.get("solution")?C.set("shownext",!0):C.set("shownext",!1)}),y}}),define("brainstorm/quickb/quicktech",["OObject","service/map","Bind.plugin","Event.plugin","service/config","service/help","Store","CouchDBDocument","Promise","service/cardpopup","service/utils","lib/spin.min"],function(e,t,i,n,s,a,o,r,l,c,d,u){return function(p,g,h,m,v){var f,b,w,y=new e,L=null,k=null,S=new o({timer:null,display:!1}),T=s.get("transport"),M=(s.get("user"),s.get("labels")),A={left:"",scenario:{popup:!1},tech1:{popup:!1,selected:!1},tech2:{popup:!1,selected:!1},tech3:{popup:!1,selected:!1}},C=new o(A),x=[],q=!0,H=new o,_=new o,I=new o,D={tech1:H,tech2:_,tech3:I},N=0,O=new o([{id:"",title:"",pic:""},{id:"",title:"",pic:""},{id:"",title:"",pic:""}]),E="step",B=new u({color:"#657B99",lines:10,length:8,width:4,radius:8,top:373,left:373}).spin();return y.plugins.addAll({labels:new i(M),display:new i(C,{setReload:function(e){!e&&N>0?this.classList.add("reload"):this.classList.remove("reload")},updateNext:function(){C.get("tech1").selected&&C.get("tech2").selected&&C.get("tech3").selected?this.classList.remove("invisible"):this.classList.add("invisible")},setSelected:function(e){e?this.classList.add("pushed"):this.classList.remove("pushed")},popup:function(e){e?this.classList.add("highlighted"):this.classList.remove("highlighted")}}),techcards:new i(O,{removeDefault:function(e){e?this.classList.remove("defaultcard"):this.classList.add("defaultcard")},formatTitle:function(e){this.innerHTML=e?e.toUpperCase():M.get(this.parentNode.getAttribute("name")+"lbl")},setPic:function(e){var t=this;e?e.search("img/decks")>-1?this.setAttribute("style","background-image:url('"+e+"');"):(json={dir:"cards",filename:e},s.get("transport").request("GetFile",json,function(e){t.setAttribute("style","background:white; background-image: url('"+e+"'); background-repeat: no-repeat; background-position: center center; background-size:contain;")})):this.setAttribute("style","background-image: none;")}}),quicktechtimer:new i(S,{setTime:function(e){this.innerHTML=d.formatDuration(e)},displayTimer:function(e){e?this.classList.add("showtimer"):this.classList.remove("showtimer")}}),quicktechevent:new n(y)}),y.template='<div id = "quicktech"><div class="previousbutton" data-quicktechevent="listen: mousedown, press; listen: mousedown, prev"></div><div id="quicktech-popup" class="invisible"></div><div class="brainstorm-header header blue-light" data-labels="bind: innerHTML, quicktech" data-quicktechevent="listen:mousedown, toggleProgress"></div><div class="timer" data-quicktechtimer="bind:setTime, timer; bind: displayTimer, display" data-quicktechevent="listen:mousedown,toggleTimer"></div><div class="help-brainstorm" data-quicktechevent="listen:mousedown, help"></div><div id="quicktech-left" class="leftarea"><div class="card defaultscenario" name="scenario" data-quicktechevent="listen: mousedown, select; listen:mousedown, zoom" data-display="bind: popup, scenario.popup"><div class="cardpicture"></div><div class="cardtitle" data-labels="bind:innerHTML, scenariolbl"></div></div></div><div class="drawarea"><div class="decks"><div class="drawbutton drawtech" "name"="tech" data-quicktechevent="listen: mousedown, push; listen:mouseup, draw" data-display="bind: setReload, left"></div></div><div class="cards"><div class="card tech defaultcard" name="tech1" data-quicktechevent="listen: mousedown, select; listen:mouseup, zoom" data-techcards="bind:removeDefault, 0.pic" data-display="bind: popup, tech1.popup"><div class="cardpicture" data-techcards="bind:setPic, 0.pic"></div><div class="cardtitle" data-techcards="bind:formatTitle, 0.title" data-labels="bind:innerHTML, tech1lbl"></div></div><div class="card tech defaultcard" name="tech2" data-quicktechevent="listen: mousedown, select; listen:mouseup, zoom" data-techcards="bind:removeDefault, 1.pic" data-display="bind: popup, tech2.popup"><div class="cardpicture" data-techcards="bind:setPic, 1.pic"></div><div class="cardtitle" data-techcards="bind:formatTitle, 1.title" data-labels="bind:innerHTML,tech2lbl"></div></div><div class="card tech defaultcard" name="tech3" data-quicktechevent="listen: mousedown, select; listen:mouseup, zoom" data-techcards="bind:removeDefault, 2.pic" data-display="bind: popup, tech3.popup"><div class="cardpicture" data-techcards="bind:setPic, 2.pic"></div><div class="cardtitle" data-techcards="bind:formatTitle, 2.title" data-labels="bind:innerHTML, tech3lbl"></div></div></div><div class="confirmdraw"><div class="drawok" name="tech1" data-display="bind:setSelected, tech1.selected" data-quicktechevent="listen: mousedown,  accept"></div><div class="drawok" name="tech2" data-display="bind:setSelected, tech2.selected" data-quicktechevent="listen: mousedown, accept"></div><div class="drawok" name="tech3" data-display="bind:setSelected, tech3.selected" data-quicktechevent="listen: mousedown, accept"></div></div><div class="next-button" data-labels="bind:innerHTML, nextbutton" data-quicktechevent="listen: mousedown, press; listen:mouseup, next" data-display="bind:updateNext, tech1.selected;bind:updateNext, tech2.selected;bind:updateNext, tech3.selected"></div></div></div>',y.place(t.get("quicktech")),y.press=function(e,t){t.classList.add("pressed")},y.next=function(e,t){var i=new Date;i.getTime()-L,B.spin(t.parentNode),t.classList.add("invisible"),t.classList.remove("pressed"),"step"===E?(E="screen",g.set("techno",O),clearInterval(f),S.set("display",!0),y.updateSessionScore(S.get("timer")).then(function(){return p.unsync(),p.sync(s.get("db"),p.get("_id"))}).then(function(){var e=p.get("elapsedTimers");e.quicktech=S.get("timer"),p.set("elapsedTimers",e),p.set("techno",[[O.get(0).id,O.get(1).id,O.get(2).id]]),m("quicktech")})):m("quicktech")},y.stopSpinner=function(){B.stop(),y.dom.querySelector(".next-button").classList.remove("invisible")},y.help=function(){a.setContent("quicktechhelp"),document.getElementById("cache").classList.add("appear"),document.getElementById("help-popup").classList.add("appear")},y.prev=function(e,t){t.classList.remove("pressed"),h("quicktech")},y.toggleProgress=function(){v()},y.toggleTimer=function(){S.set("display",!S.get("display"))},y.select=function(e,t){var i=t.getAttribute("name");(i.search("tech")<0||N>0||"screen"===E)&&t.classList.add("highlighted")},y.zoom=function(e,t){var i=t.getAttribute("name");(i.search("tech")<0||N>0||"screen"===E)&&y.setPopup(i)},y.setPopup=function(e){var t,i={x:0,y:337},n="left",s=C.get(w)||"",a=new o,r=C.get(e);s&&(s.popup=!1,C.set(w,s)),r.popup=!0,C.set(e,r),w=e,"scenario"===e?(i.x=147,i.y=275,a.reset(p.get("scenario")[0]),a.set("type",5),t=a.toJSON()):("tech1"===e&&(i.x=467),"tech2"===e&&(i.x=186,n="right"),"tech3"===e&&(i.x=333,n="right"),D[e].get("_id")&&(t=D[e].toJSON())),t&&b.reset(t,i,n,document.getElementById("quicktech-popup"))},y.closePopup=function(){var e=C.get(w);e.popup=!1,C.set(w,e),w=""},y.push=function(e,t){var i=t.getAttribute("name");t.classList.contains("drawok")?D[i].get("_id")&&"step"===E&&t.classList.add("pushed"):t.classList.add("pushed")},y.draw=function(e,t){var i=[];"step"===E&&q&&(q=!1,["tech1","tech2","tech3"].forEach(function(e){C.get(e).selected||i.push(e)}),y.drawTech(i).then(function(){t.classList.remove("pushed"),q=!0}))},y.drawTech=function(e){var t,i=[],n=new l;return e.forEach(function(e){x.length<=0&&(x=g.get("deck").techno.concat(),["tech1","tech2","tech3"].forEach(function(e,t){C.get(e).selected&&i.push(O.get(t).id)}),x.filter(function(e){return!(i.indexOf(e)>-1)})),t=Math.floor(Math.random()*x.length),y.getCardDetails(x[t],e),C.set("left",x.length),N++,x.splice(t,1)}),n.fulfill(),n},y.getCardDetails=function(e,t){var i=new r,n=["tech1","tech2","tech3"].indexOf(t),a=new l;return i.setTransport(T),i.sync(s.get("db"),e).then(function(){D[t].reset(JSON.parse(i.toJSON())),O.update(n,"id",e),O.update(n,"title",i.get("title")),O.update(n,"pic",i.get("picture_file")),a.fulfill(),i.unsync()}),a},y.accept=function(e,t){var i=t.getAttribute("name"),n=["tech1","tech2","tech3"].indexOf(i),s=C.get(i);"step"===E&&(O.get(n).id?(s.selected=!s.selected,C.set(i,s)):alert("please draw a card first"))},y.reset=function(e){var t=p.get("techno")[0];C.reset({left:"",scenario:{popup:!1},tech1:{popup:!1,selected:!1},tech2:{popup:!1,selected:!1},tech3:{popup:!1,selected:!1}}),O.reset([{id:"",title:"",pic:""},{id:"",title:"",pic:""},{id:"",title:"",pic:""}]),E="step",e&&t&&t.length?(E="screen",y.getCardDetails(t[0],"tech1").then(function(){return y.getCardDetails(t[1],"tech2")}).then(function(){return y.getCardDetails(t[2],"tech3")}).then(function(){["tech1","tech2","tech3"].forEach(function(e){C.set(e,{popup:!1,selected:!0})}),g.set("techno",O)})):(x=[],N=0,H.reset(),_.reset(),I.reset(),O.reset([{id:"",title:"",pic:""},{id:"",title:"",pic:""},{id:"",title:"",pic:""}])),k=p.get("elapsedTimers").quicktech?p.get("elapsedTimers").quicktech:0,S.set("timer",k),"screen"===E?S.set("display",!0):y.initTimer(k)},y.updateSessionScore=function(e){var t=new l,i={sid:p.get("_id"),step:"quicktech",time:e,cards:N};return T.request("UpdateSessionScore",i,function(e){"ok"===e.res?t.fulfill():t.reject()}),t},y.initTimer=function(e){var t=new Date,i=t.getTime(),n=e||0;S.set("display",!1),S.set("timer",n),"quicktech"===p.get("step")&&(f=setInterval(function(){var e=new Date;S.set("timer",n+e.getTime()-i)},1e3))},b=new c(y.closePopup),g.watchValue("deck",function(e){x=e.techno.concat(),C.set("left",x.length)}),y}}),define("brainstorm/quickb/quickidea",["OObject","service/map","Bind.plugin","Event.plugin","service/config","service/cardpopup","../whiteboard/whiteboard","Store","CouchDBDocument","Promise","service/utils","lib/spin.min"],function(e,t,i,n,s,a,o,r,l,c,d,u){return function(p,g,h,m,v){var f,b,w,y=new e,L="step",k=0,S=new r({timer:null,display:!1}),T=new r({title:"",description:"",solution:"",visibility:"private"}),M=new r,A=new r([]),C=[],x={cardpopup:{scenario:!1,techs:[!1,!1,!1]},postit:"inactive","import":"inactive",drawing:"inactive",ready:!1,showidea:!1,shownext:!1,readonly:!1},q=new r(x),H=new r([]),_=new o("idea",H,q),I=s.get("transport"),D=s.get("labels"),N=s.get("user"),O=new u({color:"#657B99",lines:10,length:8,width:4,radius:8,top:665,left:690}).spin();return y.plugins.addAll({labels:new i(D,{setPlaceholder:function(e){this.setAttribute("placeholder",e)}}),scenario:new i(M),techs:new i(A,{setPic:function(e){var t=this;e?e.search("img/decks")>-1?this.setAttribute("style","background-image:url('"+e+"');"):(json={dir:"cards",filename:e},s.get("transport").request("GetFile",json,function(e){t.setAttribute("style","background:white; background-image: url('"+e+"'); background-repeat: no-repeat; background-position: center center; background-size:contain;")})):this.setAttribute("style","background-image: none;")}}),wbtools:new i(q,{setActive:function(e){"active"===e?this.classList.add("pushed"):this.classList.remove("pushed")},setReady:function(e){e?this.classList.remove("invisible"):this.classList.add("invisible")},toggleToolbox:function(e){e?this.classList.add("invisible"):this.classList.remove("invisible")},setReadonly:function(e){e?this.setAttribute("readonly","readonly"):this.removeAttribute("readonly")},popup:function(e){var t;"scenario"===this.getAttribute("name")?e?this.classList.add("highlighted"):this.classList.remove("highlighted"):(t=this.getAttribute("data-techs_id"),e[t]?this.classList.add("highlighted"):this.classList.remove("highlighted"))}}),quickideatimer:new i(S,{setTime:function(e){e&&(this.innerHTML=d.formatDuration(e))},displayTimer:function(e){e?this.classList.add("showtimer"):this.classList.remove("showtimer")}}),idea:new i(T,{setVisibility:function(e){"public"===e?(this.value=0,this.setAttribute("style","background-image:url('img/brainstorm/publicforslider.png'); background-position: 50px center; background-repeat:no-repeat; background-size: 30px;")):(this.value=1,this.setAttribute("style","background-image:url('img/brainstorm/privateforslider.png'); background-position: 15px center; background-repeat:no-repeat; background-size: 20px;"))}}),wbstack:_,quickideaevent:new n(y)}),y.template='<div id = "quickidea"><div class="previousbutton" data-quickideaevent="listen: mousedown, press; listen: mousedown, prev"></div><div class="brainstorm-header header blue-light" data-labels="bind: innerHTML, quickidea" data-quickideaevent="listen:mousedown, toggleProgress"></div><div class="timer" data-quickideatimer="bind:setTime, timer; bind: displayTimer, display" data-quickideaevent="listen:mousedown,toggleTimer"></div><div id="quickidea-left" class="leftarea"><div class="card defaultscenario" name="scenario" data-quickideaevent="listen: mousedown, select; listen:mouseup, zoom" data-wbtools="bind: popup,cardpopup.scenario"><div class="cardpicture"></div><div class="cardtitle" data-scenario="bind:innerHTML, title"></div></div><ul class="cardlist" data-techs="foreach"><li><div class="card tech" data-quickideaevent="listen: mousedown, select; listen:mouseup, zoom" data-wbtools="bind: popup,cardpopup.techs"><div class="cardpicture" data-techs="bind:setPic, pic"></div><div class="cardtitle" data-techs="bind:innerHTML,title"></div></div></li></ul></div><div id="quickidea-popup"></div><div id="quickidea-right" class="workarea"><div id="idea-whiteboard" class="whiteboard"><div class="stack" data-wbstack="destination"></div></div><div id="toolbox" data-wbtools="bind:toggleToolbox, showidea"><div class="toolbox-button"><div class="postit-button" name="postit" data-wbtools="bind:setActive, postit" data-quickideaevent="listen: mousedown, push; listen:mouseup, post"></div><legend data-labels="bind:innerHTML, post">Post-it</legend></div><div class="toolbox-button"><div class="importpic-button" name="import" data-wbtools="bind:setActive, import" data-quickideaevent="listen: mousedown, push; listen:mouseup, importpic"></div><legend data-labels="bind:innerHTML, import">Import pictures</legend></div><div class="toolbox-button"><div class="drawingtool-button" name="drawing" data-wbtools="bind:setActive, drawing" data-quickideaevent="listen: mousedown, push; listen:mouseup, draw"></div><legend data-labels="bind:innerHTML, draw">Drawing tool</legend></div></div><div class="finish-button invisible" data-wbtools="bind:setReady, ready" data-labels="bind:innerHTML, finishbutton" data-quickideaevent="listen: mousedown, press; listen:mouseup, finish"></div><div id = "quickidea-writeup" class="writeup invisible" data-wbtools="bind: setReady,showidea"><textarea class = "enterTitle" maxlength="30" data-labels="bind:setPlaceholder, ideatitleplaceholder" data-idea="bind:value, title" data-wbtools="bind:setReadonly, readonly"></textarea><input class="visibility-slider" type="range" min="0" max="1" value ="1" data-idea="bind: setVisibility, visibility" data-quickideaevent="listen:mouseup, toggleVisibility" data-wbtools="bind:setReadonly, readonly"><textarea class = "enterDesc" data-labels="bind:setPlaceholder, ideadescplaceholder" data-idea="bind:value, description" data-wbtools="bind:setReadonly, readonly"></textarea><textarea class = "enterSol" data-labels="bind:setPlaceholder, ideasolplaceholder" data-idea="bind:value, solution" data-wbtools="bind:setReadonly, readonly"></textarea></div><div class="next-button invisible" data-wbtools="bind:setReady, shownext" data-labels="bind:innerHTML, nextbutton" data-quickideaevent="listen: mousedown, press; listen:mouseup, next"></div></div></div>',y.place(t.get("quickidea")),y.press=function(e,t){t.classList.add("pressed")},y.next=function(e,t){var i;new Date,O.spin(t.parentNode),t.classList.add("invisible"),t.classList.remove("pressed"),"step"===L?(L="screen",clearInterval(w),S.set("display",!0),i=y.getSessionDuration(),g.set("idea",JSON.parse(T.toJSON())),y.createIdeaDoc().then(function(){return y.updateSessionScore(S.get("timer"))}).then(function(){return p.unsync(),p.sync(s.get("db"),p.get("_id"))}).then(function(){var e=p.get("elapsedTimers");return e.quickidea=S.get("timer"),p.set("idea",[JSON.parse(T.toJSON())]),p.set("elapsedTimers",e),p.set("duration",i),p.set("status","completed"),q.set("readonly",!0),m("quickidea")}).then(function(){N.set("sessionInProgress",{}),user.upload()})):m("quickidea")},y.stopSpinner=function(){O.stop(),y.dom.querySelector(".next-button").classList.remove("invisible")},y.prev=function(e,t){t.classList.remove("pressed"),h("quickidea")},y.toggleProgress=function(){v()},y.toggleTimer=function(){S.set("display",!S.get("display"))},y.toggleVisibility=function(){"step"===L&&("public"===T.get("visibility")?T.set("visibility","private"):T.set("visibility","public"))},y.push=function(e,t){var i=t.getAttribute("name");q.set(i,"active")},y.select=function(e,t){t.classList.add("higlighted")},y.zoom=function(e,t){var i,n;"scenario"===t.getAttribute("name")?i="scenario":(i="techno",n=t.getAttribute("data-techs_id")),y.setPopup(i,n)},y.setPopup=function(e,t){var i,n={x:147,y:30},a="left",o=q.get("cardpopup"),c=new r,d="";b&&("scenario"===b.type?o.scenario=!1:o.techs[b.id]=!1,q.set("cardpopup",o)),"scenario"===e?o.scenario=!0:o.techs[t]=!0,q.set("cardpopup",o),b={type:e,id:t},"scenario"===e?(n.y=55,c.reset(g.get("scenario")),c.set("type",5),d=c.toJSON(),f.reset(d,n,a,document.getElementById("quickidea-popup"))):(0==t&&(n.y=200),1==t&&(n.y=260),2==t&&(n.y=350),C[t]?(d=C[t],f.reset(d,n,a,document.getElementById("quickidea-popup"))):(i=new l,i.setTransport(I),i.sync(s.get("db"),g.get("techno").get(t).id).then(function(){d=i.toJSON(),f.reset(d,n,a,document.getElementById("quickidea-popup")),C[t]=d})))},y.closePopup=function(){var e=q.get("cardpopup");e[b]=!1,q.set("cardpopup",e),b=""},f=new a(y.closePopup),y.post=function(){_.selectScreen("postit"),q.set("import","inactive"),q.set("drawing","inactive")},y.importpic=function(){_.selectScreen("import"),q.set("postit","inactive"),q.set("drawing","inactive")},y.draw=function(){_.selectScreen("drawing"),q.set("import","inactive"),q.set("postit","inactive")},y.exitTool=function(e){q.set(e,"inactive")},y.finish=function(e,t){_.setReadonly(!0),q.set("ready",!1),q.set("showidea",!0),t.classList.remove("pressed")},y.updateSessionScore=function(e){var t=new c,i={sid:p.get("_id"),step:"quickidea",time:e,wbcontent:H.toJSON(),idea:T.toJSON()};return I.request("UpdateSessionScore",i,function(e){"ok"===e.res?t.fulfill():t.reject()}),t},y.getSessionDuration=function(){var e=p.get("elapsedTime"),t=p.get("resumeTime")||p.get("startTime");return now=new Date,now.getTime()-t+e},y.createIdeaDoc=function(){var e=new l(s.get("ideaTemplate")),t=new Date,i="I:"+t.getTime(),n=new c;return e.setTransport(I),e.set("title",T.get("title")),e.set("sessionId",p.get("_id")),e.set("authors",[p.get("initiator").id]),e.set("description",T.get("description")),e.set("solution",T.get("solution")),e.set("creation_date",[t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds()]),e.set("character",p.get("characters")[0]),e.set("problem",p.get("problems")[0]),e.set("context",p.get("contexts")[0]),e.set("techno",p.get("techno")[0]),e.set("visibility",T.get("visibility")),e.set("authornames",p.get("initiator").username),e.set("lang",p.get("lang").substring(0,2)),e.set("_id",i),e.sync(s.get("db"),i).then(function(){return e.upload()}).then(function(){"public"===e.get("visibility")&&I.request("UpdateUIP",{userid:N.get("_id"),type:e.get("type"),docId:e.get("_id"),docTitle:e.get("title")},function(e){"ok"!==e&&console.log(e)}),n.fulfill(),e.unsync()}),n},y.reset=function(){q.reset({cardpopup:{scenario:!1,techs:[!1,!1,!1]},postit:"inactive","import":"inactive",drawing:"inactive",ready:!1,showidea:!1,shownext:!1,readonly:!1}),A.reset(),_.setSessionId(p.get("_id")),H.reset(p.get("ideaWB")),_.init(),H.getNbItems()?_.selectScreen("main"):_.selectScreen("default"),clearInterval(w),p.get("idea").length?(_.setReadonly(!0),q.set("ready",!1),q.set("showidea",!0),T.reset(p.get("idea")[0]),g.set("idea",p.get("idea")[0]),q.set("readonly",!0),q.set("shownext",!0),L="screen"):(T.reset({title:"",description:"",solution:"",visibility:"private"}),H.getNbItems()?q.set("ready",!0):q.set("ready",!1),_.setReadonly(!1),L="step"),p.get("elapsedTimers").quickidea&&(k=p.get("elapsedTimers").quickidea,S.set("timer",k)),"screen"===L?S.set("display",!0):y.initTimer(k)},y.initTimer=function(e){var t=new Date,i=t.getTime(),n=e||0;S.set("display",!1),S.set("timer",n),"quickidea"===p.get("step")&&(clearInterval(w),w=setInterval(function(){var e=new Date;S.set("timer",n+e.getTime()-i)},1e3))},p.watchValue("_id",function(e){_.setSessionId(e)}),g.watchValue("scenario",function(){M.reset(g.get("scenario"))}),g.watchValue("techno",function(){A.reset(JSON.parse(g.get("techno").toJSON()))}),["added","deleted","updated"].forEach(function(e){H.watch(e,function(){JSON.stringify(p.get("ideaWB"))!==H.toJSON()&&(p.set("ideaWB",JSON.parse(H.toJSON())),p.upload()),H.getNbItems()?q.set("ready",!0):q.set("ready",!1)})}),T.watch("updated",function(){T.get("title")&&T.get("description")&&T.get("solution")?q.set("shownext",!0):q.set("shownext",!1)}),y}}),define("brainstorm/quickb/quickwrapup",["OObject","service/map","Bind.plugin","Event.plugin","service/config","Store","service/utils"],function(e,t,i,n,s,a,o){return function(r,l,c,d,u){var p=new e,g=new a,h=new a([]),m=s.get("labels");return p.plugins.addAll({labels:new i(m),wrapup:new i(g,{formatTitle:function(e){e&&(this.innerHTML=e.substring(0,1).toUpperCase()+e.substring(1).toLowerCase())},setScore:function(e){e&&(this.innerHTML=e+" ip")},setTime:function(e){e&&(this.innerHTML=o.formatDuration(e))}}),cards:new i(h,{formatTitle:function(e){var t=this.getAttribute("data-cards_id");e&&(3>t?this.innerHTML=e.substring(0,1).toUpperCase()+e.substring(1).toLowerCase():(this.innerHTML=e.toUpperCase(),this.setAttribute("style","font-family:Helvetica;")))},setPic:function(e){var t=this;e?e.search("img/decks")>-1?this.setAttribute("style","background-image:url('"+e+"');"):(json={dir:"cards",filename:e},s.get("transport").request("GetFile",json,function(e){t.setAttribute("style","background:white; background-image: url('"+e+"'); background-repeat: no-repeat; background-position: center center; background-size:contain;")})):this.setAttribute("style","background-image: none;")}}),quickwrapupevent:new n(p)}),p.template='<div id = "quickwrapup"><div class="previousbutton" data-quickwrapupevent="listen: mousedown, press; listen: mousedown, prev"></div><div class="brainstorm-header header blue-light" data-labels="bind: innerHTML, quickwrapup" data-quickwrapupevent="listen:mousedown, toggleProgress"></div><div class="congrats"><div class="message"><span class="messagetitle" data-labels="bind:innerHTML, congratulations"></span><span class="sessioncompleted" data-labels="bind:innerHTML, sessioncompleted"></span></div><div class="enddeedee"></div></div><div class="summary"><div class="storysummary"><div class="storyheader" data-labels="bind:innerHTML, storytitlelbl">Your Story</div><div class="storytitle" data-wrapup="bind:formatTitle, scenario.title"></div><div class="storycontent"><p class="summaryheader" data-labels="bind:innerHTML, scenarioheader"></p><p class="content" data-wrapup="bind:innerHTML, scenario.story"></p><p class="summaryheader" data-labels="bind:innerHTML, scenariosolution"></p><p class="content" data-wrapup="bind:innerHTML, scenario.solution">solution content</p></div></div><div class="ideasummary"><div class="ideaheader" data-labels="bind:innerHTML, ideatitlelbl"></div><div class="ideatitle" data-wrapup="bind:formatTitle, idea.title"></div><div class="ideacontent"><p class="summaryheader" data-labels="bind:innerHTML, ideadescription"></p><p class="content" data-wrapup="bind:innerHTML, idea.description"></p><p class="summaryheader" data-labels="bind:innerHTML, ideaimplementation"></p><p class="content" data-wrapup="bind:innerHTML, idea.solution">solution content</p></div></div></div><div class="sessionresults"><div class ="sessiontime"><span data-labels="bind:innerHTML, yourtime"></span><span data-wrapup = "bind: setTime, duration"></span></div><div class="sessionscore"><span data-labels="bind:innerHTML, yourscore"></span><span data-wrapup="bind:setScore, score"></span></div></div><div class="sessioncards" data-quickwrapupevent="listen:mousedown, toggleCards"><legend>Cards used during this session</legend><ul class="cardlist" data-cards="foreach"><li class="card"><div class="cardpicture" data-cards="bind:setPic,pic"></div><div class="cardtitle" data-cards="bind: formatTitle, title"></div></li></ul></div></div>',p.place(t.get("quickwrapup")),p.press=function(e,t){t.classList.add("pressed")},p.next=function(e,t){t.classList.remove("pressed"),d("quickwrapup")},p.prev=function(e,t){t.classList.remove("pressed"),c("quickwrapup")},p.toggleProgress=function(){u()},p.toggleCards=function(e,t){t.classList.contains("expanded")?t.classList.remove("expanded"):t.classList.add("expanded")},p.reset=function(){h.reset([]),g.reset()},l.watchValue("scenario",function(e){g.set("scenario",e)}),l.watchValue("idea",function(e){g.set("idea",e)}),["characters","contexts","problems","techno"].forEach(function(e){l.watchValue(e,function(t){switch(e){case"characters":h.set(0,t);break;case"contexts":h.set(1,t);break;case"problems":h.set(2,t);break;case"techno":t.loop(function(e,t){h.set(t+3,e)})}})}),r.watchValue("score",function(e){g.set("score",e)}),r.watchValue("duration",function(e){g.set("duration",e)}),p}}),define("brainstorm/quickb/quickb",["OObject","service/map","Amy/Stack-plugin","Bind.plugin","Event.plugin","./quickstart","./quicksetup","./quickscenario","./quicktech","./quickidea","./quickwrapup","CouchDBDocument","CouchDBView","service/config","Promise","Store","lib/spin.min"],function(e,t,i,n,s,a,o,r,l,c,d,u,p,g,h,m,v){return function(f,b){var w=new e,y=new e,L=(document.createDocumentFragment(),new i),k=g.get("labels"),S=new m([{name:"quickstart",label:k.get("quickstepstart"),currentStep:!0,status:"ongoing"},{name:"quicksetup",label:k.get("quickstepsetup"),currentStep:!1,status:null},{name:"quickscenario",label:k.get("quickstepscenario"),currentStep:!1,status:null},{name:"quicktech",label:k.get("quicksteptech"),currentStep:!1,status:null},{name:"quickidea",label:k.get("quickstepidea"),currentStep:!1,status:null},{name:"quickwrapup",label:k.get("quickstepwrapup"),currentStep:!1,status:null}]),T=g.get("user"),M=new u,A=new m,C=new v({color:"#9AC9CD",lines:10,length:20,width:8,radius:15}).spin();return w.plugins.add("quickstack",L),w.template='<div id="ideafy-quick"><div class="stack" data-quickstack="destination"></div></div>',w.place(t.get("ideafy-quick")),y.plugins.addAll({labels:new n(k),step:new n(S,{setCurrent:function(e){e?this.classList.add("pressed"):this.classList.remove("pressed")},setActive:function(e){e?this.classList.remove("inactive"):this.classList.add("inactive")}}),progressevent:new s(y)}),y.template='<div class = "progressbar invisible"><ul id = "quicksteplist" class="steplist" data-step="foreach"><li class="step inactive" data-step="bind: innerHTML, label; bind:setCurrent, currentStep; bind:setActive, status" data-progressevent="listen: mousedown, highlightStep; listen:mouseup, changeStep"></li></ul><div class="exit-brainstorm" data-progressevent="listen: mousedown, press; listen:mouseup, exit"></div></div>',y.place(w.dom),y.highlightStep=function(e,t){t.classList.toggle("inactive")},y.changeStep=function(e,t){var i=t.getAttribute("data-step_id");S.get(i).status?(S.loop(function(e,t){i==t?S.update(t,"currentStep",!0):S.update(t,"currentStep",!1)}),L.getStack().show(S.get(i).name)):e.stopImmediatePropagation(),y.dom.classList.add("invisible")},y.press=function(e,t){t.classList.add("pressed")},y.exit=function(e,t){t.classList.remove("pressed"),y.dom.classList.add("invisible"),b()},w.retrieveSession=function(e){C.spin(document.getElementById("brainstorm")),A.reset(),M.unsync(),M.reset(),w.sessionExists(e.id).then(function(){return M.sync(g.get("db"),e.id)}).then(function(){var t=M.get("step"),i=1e4;S.getNbItems(),L.getStack().get("quickstart").reset(e),L.getStack().get("quicksetup").reset(e),L.getStack().get("quickscenario").reset(e),L.getStack().get("quicktech").reset(e),L.getStack().get("quickidea").reset(e),L.getStack().get("quickwrapup").reset(e),S.loop(function(e,n){i>n&&(e.name===t?(i=n,S.update(n,"currentStep",!0),"quickwrapup"===e.name?S.update(n,"status","done"):S.update(n,"status","ongoing")):S.update(n,"status","done"))}),"quickwrapup"===t?(C.stop(),L.getStack().show("quickwrapup"),S.update(0,"currentStep",!1)):(S.update(0,"currentStep",!0),S.update(i,"currentStep",!1),C.stop(),L.getStack().show("quickstart"),"completed"!==M.get("status")&&(T.set("sessionInProgress",e),T.upload()))},function(){C.stop(),alert("session could not be retrieved")})},w.startNewSession=function(){M.unsync(),M.reset(g.get("sessionTemplate")),A.reset({}),M.set("initiator",{id:T.get("_id"),username:T.get("username"),picture_file:T.get("picture_file")}),M.set("mode","quick"),M.set("step","quickstart"),M.set("deck",T.get("active_deck")),L.getStack().get("quickstart").reset(),L.getStack().get("quicksetup").reset(),L.getStack().get("quickscenario").reset(),L.getStack().get("quicktech").reset(),L.getStack().get("quickidea").reset(),L.getStack().get("quickwrapup").reset(),L.getStack().show("quickstart")
},w.sessionExists=function(e){var t=new h,i=new p;return i.setTransport(g.get("transport")),i.sync(g.get("db"),"library","_view/sessioncount",{key:'"'+e+'"'}).then(function(){i.getNbItems()?t.fulfill():t.reject("not found")}),t},w.reset=function(e){S.reset([{name:"quickstart",label:k.get("quickstepstart"),currentStep:!0,status:"ongoing"},{name:"quicksetup",label:k.get("quickstepsetup"),currentStep:!1,status:null},{name:"quickscenario",label:k.get("quickstepscenario"),currentStep:!1,status:null},{name:"quicktech",label:k.get("quicksteptech"),currentStep:!1,status:null},{name:"quickidea",label:k.get("quickstepidea"),currentStep:!1,status:null},{name:"quickwrapup",label:k.get("quickstepwrapup"),currentStep:!1,status:null}]),e?w.retrieveSession(e):w.startNewSession()},w.prev=function(e){var t;S.loop(function(i,n){i.name===e&&(t=n)}),t>0?(S.update(t,"currentStep",!1),S.update(t-1,"currentStep",!0),L.getStack().show(S.get(t-1).name)):(alert("Exiting session"),b())},w.next=function(e){var t,i,n=L.getStack().get(e),s=new h;return S.loop(function(i,n){i.name===e&&(t=n)}),t<S.getNbItems()-1&&(S.update(t,"currentStep",!1),S.update(t+1,"currentStep",!0),"done"!==S.get(t).status?(S.update(t,"status","done"),S.update(t+1,"status","ongoing"),M.set("step",S.get(t+1).name),M.upload().then(function(){i=L.getStack().get(S.get(t+1).name),i.initTimer&&i.initTimer(),n.stopSpinner(),L.getStack().show(S.get(t+1).name),s.fulfill()})):(n.stopSpinner(),L.getStack().show(S.get(t+1).name),s.fulfill())),s},w.toggleProgress=function(){y.dom.classList.toggle("invisible")},w.init=function(e){M.setTransport(g.get("transport")),L.getStack().add("quickstart",new a(M,w.prev,w.next,w.toggleProgress)),L.getStack().add("quicksetup",new o(M,A,w.prev,w.next,w.toggleProgress)),L.getStack().add("quickscenario",new r(M,A,w.prev,w.next,w.toggleProgress)),L.getStack().add("quicktech",new l(M,A,w.prev,w.next,w.toggleProgress)),L.getStack().add("quickidea",new c(M,A,w.prev,w.next,w.toggleProgress)),L.getStack().add("quickwrapup",new d(M,A,w.prev,w.next,w.toggleProgress)),w.reset(e)},w.init(f),g.get("observer").watch("reconnect",function(){M.get("_id")&&(M.unsync(),M.sync(g.get("db"),M.get("_id")))}),w}}),define("brainstorm/multi/init/newmub",["OObject","Bind.plugin","Event.plugin","CouchDBDocument","service/config","Promise","Store","service/utils","lib/spin.min"],function(e,t,n,s,a,o,r,l,c){return function(){var d=new e,u=new r({}),p=new r([]),g=new r([]),h=new r({errormsg:""}),m=a.get("labels"),v=a.get("user"),f=new r(a.get("userLanguages")),b=function(){var e=v.get("lang").substring(0,2);u.set("lang",e),f.loop(function(t,i){t.name===e?f.update(i,"selected",!0):f.update(i,"selected",!1)})},w=({title:"",description:"",initiator:{id:v.get("_id"),username:v.get("username"),intro:v.get("intro")},participants:[],date:[],startTime:null,resumeTime:null,duration:null,elapsedTime:0,elapsedTimers:{},mode:"roulette",type:8,deck:v.get("active_deck"),status:"waiting",step:"mustart",lang:v.get("lang"),characters:[],contexts:[],problems:[],scenarioWB:[],scenario:[],techno:[[]],ideaWB:[],idea:[],score:"",chat:[],invited:[]},new c({color:"#8cab68",lines:10,length:8,width:4,radius:8,top:-8,left:660}).spin());return b(),d.plugins.addAll({labels:new t(m),newmub:new t(u,{initSessionMode:function(e){switch(e){case"campfire":this.selectedIndex=1,this.setAttribute("style","color: #F27B3D;");break;case"boardroom":this.selectedIndex=2,this.setAttribute("style","color: #4D4D4D;");break;default:this.selectedIndex=0,this.setAttribute("style","color: #5F8F28;")}},setSessionInfo:function(e){switch(e){case"campfire":this.innerHTML=m.get("campfireinfo");break;case"boardroom":this.innerHTML=m.get("boardroominfo");break;default:this.innerHTML=m.get("rouletteinfo")}},displayInvitations:function(e){"boardroom"===e?this.classList.remove("invisible"):this.classList.add("invisible")},setTitle:function(e){new Date,e&&e.username&&this.setAttribute("placeholder",m.get("quickstarttitleplaceholderpre")+e.username+m.get("quickstarttitleplaceholderpost"))},displayLang:function(e){var t=e.substring(0,2);this.setAttribute("style","background-image:url('img/flags/"+t+".png');")}}),select:new t(f,{setBg:function(e){this.setAttribute("style","background-image:url('img/flags/"+e+".png');")},setSelected:function(e){e?this.classList.add("selected"):this.classList.remove("selected")}}),auto:new t(p,{highlight:function(e){e?this.classList.add("selected"):this.classList.remove("selected")}}),invited:new t(g,{setSelected:function(e){this.innerHTML=e?"&#10003;":""}}),errormsg:new t(h),newmubevent:new n(d)}),d.template='<div id="newmub"><div id="newmub-content"><form><div class="idealang"><div class="currentlang" data-newmub="bind: displayLang, lang" data-newmubevent="listen: mouseup, showLang"></div><ul class="invisible" data-select="foreach"><li data-select="bind: setBg, name; bind: setSelected, selected" data-newmubevent="listen: mousedown, selectFlag; listen: mouseup, setLang"></li></ul></div><label data-labels="bind:innerHTML, selectmode"></label><hr/><div class="select-mode"><select data-newmub="bind:initSessionMode, mode" data-newmubevent="listen:change, changeSessionMode"><option name="roulette" data-labels="bind:innerHTML, roulette"></option><option name="campfire" data-labels="bind:innerHTML, campfire"></option><option name="boardroom" data-labels="bind:innerHTML, boardroom"></option></select><span class="session-info" data-newmub="bind: setSessionInfo, mode"></span></div><div class="invite-contacts invisible" data-newmub="bind:displayInvitations, mode"><label></label><hr/><div class="selectall" data-labels="bind:innerHTML, selectall" data-newmubevent="listen: mousedown, press; listen:mouseup, selectAll">Select all</div><input class="search" data-newmubevent="listen:mousedown, displayAutoContact; listen:input, updateAutoContact" data-labels="bind:placeholder, tocontactlbl"><div id="invitelistauto" class="autocontact invisible"><div class="autoclose" data-newmubevent="listen:mousedown,close"></div><ul data-auto="foreach"><li data-auto="bind:innerHTML, username; bind:highlight, selected" data-newmubevent="listen:mouseup, select"></li></ul></div><div class="invitecontactlist"><ul data-invited="foreach"><li class = "contact list-item" data-newmubevent="listen:mousedown, discardContact"><p class="contact-name" data-invited="bind:innerHTML, username"></p><div class="remove-contact"></div></li></ul></div></div><label data-labels="bind:innerHTML, quickstarttitle"></label><hr/><textarea class="session-title" maxlength=60 readonly="readonly" name="title" data-newmub="bind:value, title; bind: setTitle, initiator" data-newmubevent="listen: mousedown, removeReadonly"></textarea><label data-labels="bind:innerHTML, quickstartdesc"></label><hr/><textarea class="session-desc" name="description" data-newmub="bind:value, description" data-labels="bind: placeholder, quickstartdescplaceholder"></textarea></form><div class="newmub-footer"><p class="send"><label class="clear" data-labels="bind:innerHTML, clear" data-newmubevent="listen: mousedown, press; listen:mouseup, clear"></label><label class="create" data-labels="bind:innerHTML, create" data-newmubevent="listen:mousedown, press; listen:mouseup, create"></label><label class="editerror" data-errormsg="bind:innerHTML, errormsg"></label></p></div></div></div>',d.place(document.getElementById("newmub")),d.reset=function(){var e={title:"",description:"",initiator:{id:v.get("_id"),username:v.get("username"),intro:v.get("intro")},participants:[],date:[],startTime:null,resumeTime:null,duration:null,elapsedTime:0,elapsedTimers:{},mode:"roulette",type:8,deck:v.get("active_deck"),status:"waiting",step:"",lang:v.get("lang"),characters:[],contexts:[],problems:[],scenarioWB:[],scenario:[],techno:[[]],ideaWB:[],idea:[],score:"",chat:[],invited:[]};u.reset(e),u.set("lang",v.get("lang")),u.set("deck",v.get("active_deck")),u.set("initiator",{id:v.get("_id"),username:v.get("username"),intro:v.get("intro")}),g.reset([]),h.set("errormsg",""),p.reset(v.get("connections").concat())},d.showLang=function(){d.dom.querySelector(".idealang ul").classList.remove("invisible")},d.selectFlag=function(e,t){var i;e.stopPropagation(),i=parseInt(t.getAttribute("data-select_id"),10),f.loop(function(e,t){i===t?f.update(t,"selected",!0):f.update(t,"selected",!1)})},d.setLang=function(e,t){var i;e.stopPropagation(),i=t.getAttribute("data-select_id"),u.set("lang",f.get(i).name),d.dom.querySelector(".idealang ul").classList.add("invisible")},d.changeSessionMode=function(e,t){var i=t.selectedIndex,n=t.childNodes[i],s=n.getAttribute("name");p.reset(v.get("connections")),g.reset([]),u.set("mode",s)},d.displayAutoContact=function(){document.getElementById("invitelistauto").classList.remove("invisible"),p.reset(v.get("connections").concat())},d.updateAutoContact=function(e,t){var n,s=JSON.parse(p.toJSON()),a=v.get("connections").concat(),o=t.value.toLowerCase();if(""===t.value)p.reset(a);else{for(i=s.length-1;i>=0;i--)n=s[i].username.toLowerCase(),0!==n.search(o)&&s.splice(i,1);p.reset(s)}p.loop(function(e,t){g.toJSON().search(e.contact.userid)>-1&&p.update(t,"selected",!0)})},d.close=function(e,t){t.parentNode.classList.add("invisible")},d.discardContact=function(e,t){var i=t.getAttribute("data-invited_id"),n=g.get(i).userid;g.alter("splice",i,1),p.loop(function(e,t){e.userid===n&&setTimeout(function(){p.update(t,"selected",!1)},200)}),d.unselectGroup(n)},d.select=function(e,t){var i=t.getAttribute("data-auto_id");p.get(i).selected?(d.removeContact(p.get(i)),setTimeout(function(){p.update(i,"selected",!1),document.getElementById("invitelistauto").classList.add("invisible")},200)):(d.addContact(p.get(i)),d.selectGroup(),setTimeout(function(){p.update(i,"selected",!0),document.getElementById("invitelistauto").classList.add("invisible")},200))},d.selectAll=function(e,t){t.classList.remove("pressed"),g.reset([]),p.reset(v.get("connections")),p.loop(function(e,t){p.update(t,"selected",!0),"user"===e.type&&g.alter("push",e)})},d.removeContact=function(e){if("group"===e.type)for(j=e.contacts.length-1;j>=0;j--)d.removeContact(e.contacts[j]);else g.loop(function(t,i){t.userid===e.userid&&g.alter("splice",i,1)}),d.unselectGroup(e.userid),p.loop(function(t,i){t.userid===e.userid&&p.update(i,"selected",!1)})},d.selectGroup=function(){var e,t=!1;p.loop(function(i,n){if("group"===i.type&&!i.selected){for(e=i.contacts,t=!0,j=e.length-1;j>=0;j--)if(g.toJSON().search(e[j].userid)<0){t=!1;break}t&&p.update(n,"selected",!0)}})},d.unselectGroup=function(e){p.loop(function(t,i){"group"===t.type&&t.selected&&JSON.stringify(t.contacts).search(e)>0&&p.update(i,"selected",!1)})},d.addContact=function(e){var t,i,n=!0;if("user"===e.type)g.alter("push",e);else for(t=0,i=e.contacts.length;i>t;t++)g.loop(function(i){i.userid===e.contacts[t].userid&&(n=!1)}),n&&(g.alter("push",e.contacts[t]),p.loop(function(i,n){i.userid===e.contacts[t].userid&&p.update(n,"selected",!0)}))},d.removeReadonly=function(e,t){t.removeAttribute("readonly")},d.press=function(e,t){t.classList.add("pressed")},d.clear=function(e,t){t.classList.remove("pressed"),d.reset()},d.create=function(e,t){t.classList.remove("pressed"),h.set("errormsg",""),u.get("title").length<3||u.get("description").length<3?h.set("errormsg",m.get("providesessioninfo")):"roulette"!==u.get("mode")&&v.get("connections").length<1?h.set("errormsg",m.get("nofriendtoinvite")):"boardroom"!==u.get("mode")||g.getNbItems()?(t.classList.add("invisible"),w.spin(t.parentNode),d.uploadSession().then(function(){w.stop(),t.classList.remove("invisible"),d.reset()})):h.set("errormsg",m.get("inviteatleastone"))},d.createChat=function(e){var t=new s,i=(new Date).getTime(),n=new o;return t.setTransport(a.get("transport")),t.set("users",[{username:v.get("username"),userid:v.get("_id")}]),t.set("msg",[{user:"SYS",type:0,arg:0,time:i}]),t.set("sid",u.get("_id")),t.set("lang",u.get("lang")),t.set("readonly",!1),t.set("step",0),t.set("type",17),t.sync(a.get("db"),e).then(function(){return t.upload()}).then(function(){n.fulfill(),t.unsync()}),n},d.uploadSession=function(){var e,t=new s,i=new Date,n=u.get("chat")||[],r=new o;return u.set("_id","S:MU:"+i.getTime()),u.set("date",[i.getFullYear(),i.getMonth(),i.getDate()]),"boardroom"===u.get("mode")&&g.loop(function(e){u.get("invited").push(e.userid)}),"campfire"===u.get("mode")&&u.set("invited",l.getUserContactIds()),e=u.get("_id")+"_0",n.push(e),u.set("chat",n),t.reset(JSON.parse(u.toJSON())),t.setTransport(a.get("transport")),t.sync(a.get("db"),t.get("_id")).then(function(){return d.createChat(e)}).then(function(){return t.upload()}).then(function(){"boardroom"===t.get("mode")?(h.set("errormsg",m.get("sendinginvites")),d.sendInvites(t.get("invited"),t.get("_id"),t.get("title")).then(function(){a.get("observer").notify("start-mu_session",t.get("_id")),r.fulfill(),t.unsync()})):(a.get("observer").notify("start-mu_session",t.get("_id")),r.fulfill(),t.unsync())}),r},d.sendInvites=function(e,t,i){var n=new o,s=new Date,r={type:"INV",status:"unread",date:[s.getFullYear(),s.getMonth(),s.getDate(),s.getHours(),s.getMinutes(),s.getMinutes()],author:v.get("_id"),username:v.get("username"),firstname:v.get("firstname"),toList:"",ccList:"",object:"",body:"",signature:"",docId:t,docTitle:i,dest:e};return a.get("transport").request("Notify",r,function(){h.set("errormsg",m.get("invitesent")),n.fulfill()}),n},d.reset(),v.watchValue("lang",function(){var e=JSON.parse(u.toJSON()),t=JSON.parse(h.toJSON());u.reset({}),u.reset(e),h.reset({}),h.reset(t)}),d}}),define("brainstorm/multi/init/mupreview",["OObject","service/config","CouchDBDocument","Store","Bind.plugin","Event.plugin","service/avatar","service/utils","lib/spin.min"],function(e,t,i,n,s,a,o,r,l){return function(){var r,c=new e,d=t.get("labels"),u=new i,p=new n({msg:""}),g=new n([]),h=new l({color:"#5F8F28",lines:10,length:10,width:6,radius:10,left:269,top:306}).spin();return u.setTransport(t.get("transport")),c.plugins.addAll({labels:new s(d),model:new s(u,{setTitle:function(e){this.innerHTML=e,user.get("_id")===session.get("initiator").id?this.setAttribute("contenteditable",!0):this.setAttribute("contenteditable",!1)},setDescription:function(e){this.innerHTML=e.replace(/\n/g,"<br>"),user.get("_id")===session.get("initiator").id?this.setAttribute("contenteditable",!0):this.setAttribute("contenteditable",!1)},setAvatar:function(e){var t,i;this.setAttribute("style","background:none;"),t=document.createDocumentFragment(),i=new o([e]),i.place(t),this.hasChildNodes()?this.replaceChild(t,this.firstChild):this.appendChild(t)},setIntro:function(e){this.innerHTML=e?e:" "}}),participant:new s(g,{setAvatar:function(e){var t,i;this.setAttribute("style","background:none;"),t=document.createDocumentFragment(),i=new o([e]),i.place(t),this.hasChildNodes()?this.replaceChild(t,this.firstChild):this.appendChild(t)},setIntro:function(e){this.innerHTML=e?e:" "}}),info:new s(p),previewevent:new a(c)}),c.template='<div id="mupreview" class="invisible"><div class="cache"></div><div class="contentarea"><div class="close" data-previewevent="listen:mousedown, closePreview"></div><div class="mubwait-title" name="title" data-model="bind:setTitle, title"></div><div class="mubdesc"><label data-labels="bind:innerHTML, quickstepstart"></label><p name="description" data-model="bind:setDescription, description"></p></div><div class="mubroster"><label data-labels="bind:innerHTML, participants">Participants</label><div class="mubleader contact"><div data-model="bind:setAvatar, initiator.id"></div><p class="contact-name" data-model="bind:innerHTML, initiator.username"></p><p class="contact-intro" data-model="bind:setIntro, initiator.intro"></p></div><ul class="participants" data-participant="foreach"><li class="contact"><div data-participant="bind:setAvatar, id"></div><p class="contact-name" data-participant="bind:innerHTML, username"></p><p class="contact-intro" data-participant="bind:setIntro, intro"></p></li></ul></div><div class="start-button" data-labels="bind:innerHTML, joinbutton" data-previewevent="listen: mousedown, press; listen:mouseup, join"></div><div class="infopreview invisible" data-info="bind:innerHTML, msg"></div></div></div>',c.reset=function(e){document.getElementById("mupreview").classList.remove("invisible"),u.sync(t.get("db"),e).then(function(){g.reset(u.get("participants"))})},c.closePreview=function(){c.dom.classList.add("invisible"),u.unsync(),u.reset(),r()},c.press=function(e,t){t.classList.add("pressed")},c.join=function(e,i){i.classList.add("invisible"),i.classList.remove("pressed"),h.spin(i.parentNode),t.get("observer").notify("join-musession",u.get("_id")),setTimeout(function(){h.stop(),c.dom.classList.add("invisible"),u.unsync(),u.reset()},15e3)},c.init=function(e){r=e},u.watchValue("participants",function(e){var t=document.getElementById("mupreview"),i=t.querySelector(".start-button"),n=t.querySelector(".infopreview");g.reset(e),e.length<3&&"waiting"===u.get("status")?(i.classList.remove("invisible"),n.classList.add("invisible")):(3===e.length&&"waiting"===u.get("status")&&p.set("msg",d.get("sessionfull")),i.classList.add("invisible"),n.classList.remove("invisible"))}),u.watchValue("status",function(e){var t=document.getElementById("mupreview"),i=t.querySelector(".start-button"),n=t.querySelector(".infopreview");"waiting"===e&&u.get("participants").length<3?(i.classList.remove("invisible"),n.classList.add("invisible")):(3===u.get("participants").length&&"waiting"===e&&p.set("msg",d.get("sessionfull")),"in progress"===e&&(p.set("msg",d.get("sessionstarted")),u.unsync()),"deleted"===e&&(p.set("msg",d.get("sessiondeleted")),u.unsync()),i.classList.add("invisible"),n.classList.remove("invisible"))}),SPIP=h,c}}),define("brainstorm/multi/init/mulist",["OObject","Bind.plugin","Event.plugin","CouchDBView","service/config","Promise","Store","service/utils","lib/spin.min","Place.plugin","./mupreview"],function(e,t,i,n,s,a,o,r,l,c,d){return function(){var u=new e,p=s.get("labels"),g=s.get("user"),h=s.get("db"),m=s.get("transport"),v=new o([]),f=new o([]),b=new d,w=(new o([]),new o({modes:["allmodes","roulette","campfire","boardroom"],selectedLang:"all",selectedMode:"allmodes"})),y=new o([{name:"*"}]),L=s.get("userLanguages"),k="mulistall",S=r.getUserContactIds(),T=new l({color:"#9AC9CD",lines:10,length:10,width:6,radius:10,top:200}).spin();return L.forEach(function(e){y.alter("push",e)}),u.plugins.addAll({labels:new t(p),options:new t(w,{setBg:function(e){"all"===e?(this.setAttribute("style","background-image: none;"),this.innerHTML="*"):(this.innerHTML=" ",this.setAttribute("style","background-image:url('img/flags/"+e+".png');"))},setMode:function(e){var t,i,n="";for(t=0,i=e.length;i>t;t++)n+="<option>"+p.get(e[t])+"</option>";this.innerHTML=n}}),select:new t(y,{setBg:function(e){"*"===e?(this.setAttribute("style","background-image: none;background: whitesmoke;text-align: center;"),this.innerHTML="*"):(this.innerHTML=" ",this.setAttribute("style","background-image:url('img/flags/"+e+".png');"))}}),muall:new t(v,{setParticipants:function(e){var t,i=e.length+1,n="<ul>";for(t=0;i>t;t++)n+="<li></li>";n+="</ul>",this.innerHTML=n},setMode:function(e){switch(e){case"campfire":this.setAttribute("style","background-image:url('img/brainstorm/campfire-orange.png');");break;case"boardroom":this.setAttribute("style","background-image:url('img/brainstorm/boardroom.png');");break;default:this.setAttribute("style","background-image:url('img/brainstorm/roulette-green.png');")}},setLang:function(e){this.setAttribute("style","background-image: url('img/flags/"+e.substring(0,2)+".png');"),this.innerHTML=" "}}),musearch:new t(f,{setParticipants:function(e){var t,i=parseInt(e,10)+1,n="<ul>";for(t=0;i>t;t++)n+="<li></li>";n+="</ul>",this.innerHTML=n},setMode:function(e){switch(e){case"campfire":this.setAttribute("style","background-image:url('img/brainstorm/campfire-orange.png');");break;case"boardroom":this.setAttribute("style","background-image:url('img/brainstorm/boardroom.png');");break;default:this.setAttribute("style","background-image:url('img/brainstorm/roulette-green.png');")}},setLang:function(e){var t=e.substring(0,2);this.setAttribute("style","background-image:url('img/flags/"+t+".png');"),this.innerHTML=" "}}),mupreview:new c({preview:b}),mulistevent:new i(u)}),u.template='<div id="mulist"><div id="mulist-content"><div id="mulistspinner"></div><div data-mupreview = "place: preview"></div><legend data-labels="bind:innerHTML, selectsession"></legend><div class="mulistoptions"><input class="search" type="search" data-mulistevent="listen: keypress, search"><select class="modes" data-options="bind: setMode, modes" data-mulistevent="listen:change, filterMode"></select><div class="selectlang"><div data-options="bind:setBg, selectedLang"></div><button data-mulistevent = "listen:mouseup, displayLang"></button></div><ul class="langlist invisible" data-select="foreach"><li data-select="bind: setBg, name" data-mulistevent="listen: mouseup, filterLang"></li></ul></div><hr/><div class="mulistheader"><div class="mumode" data-labels="bind:innerHTML, mode"></div><div class="mutitle" data-labels="bind:innerHTML, title"></div><div class="mulang" data-labels="bind:innerHTML, lang"></div><div class="muleadername" data-labels="bind:innerHTML, leader"></div><div class="muparts" data-labels="bind:innerHTML, participants"></div></div><div class="noresult invisible" data-labels="bind:innerHTML, nosessionfound"></div><ul id="mulistall" data-muall="foreach"><li data-mulistevent="listen: mousedown, zoom"><div class="mumode" data-muall="bind:setMode, value.mode"></div><div class="mutitle" data-muall="bind:innerHTML, value.title">Title</div><div class="mulang" data-muall="bind:setLang, value.lang"></div><div class="muleadername" data-muall="bind:innerHTML, value.initiator.username">Leader</div><div class="muparts" data-muall="bind: setParticipants, value.participants"></div></li></ul><ul id="musearch" class="invisible" data-musearch="foreach"><li data-mulistevent="listen: mousedown, zoom"><div class="mumode" data-musearch="bind:setMode, fields.mode"></div><div class="mutitle" data-musearch="bind:innerHTML, fields.title">Title</div><div class="mulang" data-musearch="bind:setLang, fields.lang"></div><div class="muleadername" data-musearch="bind:innerHTML, fields.initiator">Leader</div><div class="muparts" data-musearch="bind: setParticipants, fields.participants"></div></li></ul></div></div>',u.reset=function(){k="mulistall",T.spin(document.getElementById("mulistspinner")),w.set("selectedLang","all"),w.set("selectedMode","allmodes"),u.buildList(k).then(function(){T.stop()})},u.buildList=function(e,t){var i=[],n=new a;return"mulistall"===e&&(v.reset([]),u.addSessions(i,"roulette").then(function(){return u.addSessions(i,"campfire")}).then(function(){return u.addSessions(i,"boardroom")}).then(function(){i.length?u.dom.querySelector(".noresult").classList.add("invisible"):u.dom.querySelector(".noresult").classList.remove("invisible"),v.reset(i),n.fulfill()})),"musearch"===e&&(f.reset([]),u.syncSearch(i,t).then(function(){i.length?u.dom.querySelector(".noresult").classList.add("invisible"):u.dom.querySelector(".noresult").classList.remove("invisible"),f.reset(i),n.fulfill()})),n},u.syncSearch=function(e,t,i){var s=new a,o=new n;return o.setTransport(m),o.sync("_fti/local/"+h,"indexedsessions","waiting",{q:t,descending:!0}).then(function(){o.loop(function(t){var n=!1;"roulette"===t.fields.mode?n=!0:"campfire"===t.fields.mode&&S.indexOf(t.fields.initiator.id)>-1?n=!0:"boardroom"===t.fields.mode&&t.fields.invited.search(g.get("_id"))>-1&&(n=!0),n&&(i?t.fields.mode.search(i.mode)>-1&&t.fields.lang.search(i.lang)>-1&&e.push(t):e.push(t))}),s.fulfill()}),s},u.addSessions=function(e,t,i){var s=new a,o=new n,r="_view/"+t,l={};return o.setTransport(m),l="roulette"===t?i?{key:'"'+i+'"',descending:!1,limit:50}:{descending:!1,limit:50}:i?{key:'["'+g.get("_id")+'","'+i+'"]',descending:!1}:{startkey:'["'+g.get("_id")+'",{}]',endkey:'["'+g.get("_id")+'"]',descending:!0},o.sync(h,"library",r,l).then(function(){o.loop(function(t){e.unshift(t)}),s.fulfill(),o.unsync()},function(e){console.log(e,t)}),s},u.search=function(e,t){13===e.keyCode&&(""===t.value?u.toggleList("mulistall"):u.toggleList("musearch"))},u.displayLang=function(){u.dom.querySelector(".langlist").classList.remove("invisible")},u.filterLang=function(e,t){var i=parseInt(t.getAttribute("data-select_id"),10);u.dom.querySelector(".langlist").classList.add("invisible"),0===i?w.set("selectedLang","all"):w.set("selectedLang",y.get(i).name),T.spin(document.getElementById("mulistspinner")),u.filterList().then(function(){T.stop()})},u.filterMode=function(e,t){var i=t.selectedIndex;switch(w.set("selectedMode",w.get("modes")[i]),i){case 1:t.setAttribute("style","color: #5F8F28;");break;case 2:t.setAttribute("style","color: #F27B3D");break;case 3:t.setAttribute("style","color: #4D4D4D;");break;default:t.setAttribute("style","color: black;")}T.spin(document.getElementById("mulistspinner")),u.filterList().then(function(){T.stop()})},u.filterList=function(){var e=[],t=document.getElementById("mulist-content").querySelector("input").value,i=new a,n="",s="";return"allmodes"!==w.get("selectedMode")&&(n=w.get("selectedMode")),"all"!==w.get("selectedLang")&&(s=w.get("selectedLang")),""===n&&""===s?u.buildList(k,t).then(function(){i.fulfill()}):"mulistall"===k?(v.reset([]),n?u.addSessions(e,n,s).then(function(){v.reset(e),e.length?u.dom.querySelector(".noresult").classList.add("invisible"):u.dom.querySelector(".noresult").classList.remove("invisible"),i.fulfill()}):u.addSessions(e,"roulette",s).then(function(){return u.addSessions(e,"campfire",s)}).then(function(){return u.addSessions(e,"boardroom",s)}).then(function(){v.reset(e),e.length?u.dom.querySelector(".noresult").classList.add("invisible"):u.dom.querySelector(".noresult").classList.remove("invisible"),i.fulfill()})):(f.reset([]),u.syncSearch(e,t,{mode:n,lang:s}).then(function(){f.reset(e),e.length?u.dom.querySelector(".noresult").classList.add("invisible"):u.dom.querySelector(".noresult").classList.remove("invisible"),i.fulfill()})),i},u.zoom=function(e,t){var i;t.classList.add("pressed"),"mulistall"===k?(i=parseInt(t.getAttribute("data-muall_id"),10),b.reset(v.get(i).id)):"musearch"===k&&(i=t.getAttribute("data-musearch_id"),b.reset(f.get(i).id))},u.toggleList=function(e){e!==k&&(document.getElementById(k).classList.add("invisible"),document.getElementById(e).classList.remove("invisible"),k=e),T.spin(document.getElementById("mulistspinner")),u.filterList().then(function(){T.stop()})},u.refreshList=function(){u.toggleList(k)},b.init(u.refreshList),g.watchValue("lang",function(){var e;w.set("modes",["allmodes","roulette","campfire","boardroom"]),e=w.get("lang"),e.splice(0,1,p.get("all")),w.set("lang",e)}),u}}),define("brainstorm/multi/mubinit",["OObject","Amy/Stack-plugin","Bind.plugin","Event.plugin","service/config","Promise","Store","./init/newmub","./init/mulist"],function(e,t,i,n,s,a,o,r,l){return function(a){var o=new e,c=new r(a),d=new l(a),u=new t,p=s.get("labels");return o.plugins.addAll({labels:new i(p),muinitstack:u,muinitevent:new n(o)}),o.template='<div id="mub-init"><div id="muinitsliderlbl"><label data-labels="bind:innerHTML, startnewmub"></label><label data-labels="bind:innerHTML, joinmub"></label></div><input id="muinitslider" type="range" min="0" max="1" value ="1" data-muinitevent="listen: mouseup, toggleMode"><div class="exit-brainstorm" data-muinitevent="listen: mousedown, press; listen: mouseup, exit"></div><div class="stack" data-muinitstack="destination"></div></div>',o.place(document.getElementById("mub-init")),o.toggleMode=function(e,t){var i;i="1"===t.value?"new":"list",u.getStack().show(i),u.getStack().get(i).reset()},o.press=function(e,t){t.classList.add("pressed")},o.exit=function(e,t){t.classList.remove("pressed"),a()},o.reset=function(){c.reset(),d.reset()},u.getStack().add("new",c),u.getStack().add("list",d),u.getStack().show("new"),o}}),define("brainstorm/multi/session/mubchat",["OObject","service/config","CouchDBDocument","Store","Bind.plugin","Event.plugin","service/avatar","service/utils","lib/spin.min","Promise"],function(e,t,i,n,s,a,o,r,l,c){function d(){var e=this,d=new n([]),u=new i,p=t.get("labels"),g=t.get("user"),h="null",m=new l({color:"#9AC9CD",lines:10,length:10,width:6,radius:10,top:20}).spin();u.setTransport(t.get("transport")),e.plugins.addAll({labels:new s(p),model:new s(u,{setReadonly:function(e){e?(this.setAttribute("contenteditable",!1),this.setAttribute("style","display:none;")):(this.setAttribute("style","dispaly:table-cell;"),this.setAttribute("contenteditable",!0))},setHeight:function(e){e?this.classList.add("extended"):this.classList.remove("extended")}}),chat:new s(d,{setLiStyle:function(e){e===h?this.setAttribute("style","text-align: right;"):this.setAttribute("style","text-align: left;")},setInnerMsgStyle:function(e){"SYS"===e?this.setAttribute("style","background: none; border: none"):e===h?this.setAttribute("style","background: #9AC9CD; border: 1px solid #808080; border-radius: 5px;"):this.setAttribute("style","background: #E6E6E6; border: 1px solid #808080; border-radius: 5px;float: left;max-width: 556px;")},setTime:function(e){e&&(this.innerHTML=r.formatTime(e))},setAvatar:function(e){var t,i,n;"SYS"===e?(this.classList.remove("invisible"),this.classList.add("doctor-deedee")):e===h?this.classList.add("invisible"):"number"==typeof e&&(this.classList.remove("invisible"),t=document.createDocumentFragment(),n=u.get("users")[e].userid,i=new o([n]),i.place(t),this.hasChildNodes()?this.replaceChild(t,this.firstChild):this.appendChild(t))},setUserName:function(e){"number"==typeof e&&e!==h&&(this.innerHTML=" "+u.get("users")[e].username+p.get("said"))},setMsg:function(e){var t,i;e?(this.innerHTML=e,this.setAttribute("style","color: #292929; font-size: 14px;")):(this.setAttribute("style","color: #CCCCCC; font-size: 12px;"),t=this.getAttribute("data-chat_id"),i=d.get(t).type,this.innerHTML=3>=i?u.get("users")[d.get(t).arg].username+p.get("chatmsg"+i):5===i?p.get("chatmsg"+i)+p.get(d.get(t).arg):p.get("chatmsg"+i))}}),chatevent:new a(e)}),e.template='<div class="mubchat"><div id="chatspinner"></div><div class="chatread" data-model="bind:setHeight, readonly"><ul class="chatmessages" data-chat="foreach"><li data-chat="bind:setLiStyle, user"><div class="container" data-chat="bind:setAvatar, user"></div><div class="innerchatmsg" data-chat="bind:setInnerMsgStyle, user"><span class="time" data-chat="bind: setTime, time"></span><span class="username" data-chat="bind:setUserName, user"></span><br/><span class="chatmsg" data-chat="bind: setMsg, msg"></span></div></li></ul></div><div class="chatwrite placeholder" data-model="bind:setReadonly, readonly" data-labels="bind:innerHTML, typemsg" data-chatevent = "listen:mousedown, removePlaceholder; listen: keypress, post"></div></div>',e.removePlaceholder=function(e,t){t.innerHTML===p.get("typemsg")&&(t.innerHTML="",t.classList.remove("placeholder"))},e.post=function(t,i){var n,s,a;13===t.keyCode&&""!==i.innerHTML&&(n=(new Date).getTime(),s=u.get("msg"),d.alter("push",{user:h,time:n,msg:i.innerHTML}),a=d.getNbItems()-1,e.dom.querySelector("li[data-chat_id='"+a+"']").scrollIntoView(),s.push({user:h,time:n,msg:i.innerHTML}),u.set("msg",s),i.innerHTML=p.get("typemsg"),i.classList.add("placeholder"),i.blur(),u.upload())},e.setReadonly=function(){u.set("readonly",!0)},e.conclude=function(t){e.setReadonly(),e.setMessage(t)},e.setMessage=function(t,i){var n,s,a=(new Date).getTime(),o=u.get("msg"),r=new c;switch(t){case"start":s={user:"SYS",time:a,type:4};break;case"end":d.alter("push",{user:"SYS",type:2,time:a,arg:h}),o.push({user:"SYS",type:2,time:a,arg:h}),a=(new Date).getTime(),s={user:"SYS",time:a,type:7},e.setReadonly();break;case"leave":s={user:"SYS",type:2,time:a,arg:h};break;case"next":s={user:"SYS",type:6,time:a};break;case"initStep":s={user:"SYS",type:5,time:a,arg:i}}return d.alter("push",s),n=d.getNbItems()-1,e.dom.querySelector("li[data-chat_id='"+n+"']").scrollIntoView(),o.push(s),u.set("msg",o),u.upload().then(function(){r.fulfill()
}),r},e.clear=function(){d.reset([])},e.reset=function(i){var n=new c;return h="null",e.dom.querySelector(".chatwrite").classList.add("placeholder"),e.dom.querySelector(".chatwrite").innerHTML=p.get("typemsg"),u.unsync(),u.reset({}),d.reset([]),m.spin(e.dom.querySelector("#chatspinner")),u.sync(t.get("db"),i).then(function(){var t,i=u.get("users");for(t=0;t<i.length;t++)if(i[t].userid===g.get("_id")){h=t;break}isNaN(h)&&!u.get("readonly")?e.joinChat().then(function(){m.stop(),n.fulfill()}):(d.reset(u.get("msg")),m.stop(),n.fulfill())}),n},e.joinChat=function(){var e=new c,t=u.get("users"),i=t.length,n=(new Date).getTime(),s=u.get("msg");return t.push({username:g.get("username"),userid:g.get("_id")}),u.set("users",t),u.get("_id").search("_0")>-1&&(s.push({user:"SYS",time:n,type:1,arg:i}),u.set("msg",s),d.reset(s)),u.upload().then(function(){h=i,e.fulfill()}),e},e.leave=function(){var t=new c;return u.get("users"),e.setMessage("leave").then(function(){return u.upload()}).then(function(){t.fulfill(),u.unsync(),u.reset(),d.reset([])}),t},e.cancel=function(){u.remove(),u.unsync(),u.reset({}),d.reset([])},e.getModel=function(){return u},u.watchValue("msg",function(t){var i=t.length-1;d.reset(t),e.dom.querySelector("li[data-chat_id='"+i+"']").scrollIntoView()})}return function(){return d.prototype=new e,new d}}),define("brainstorm/multi/mubwait",["OObject","Store","CouchDBDocument","service/map","Bind.plugin","Event.plugin","Place.plugin","service/config","service/help","service/utils","service/confirm","Promise","service/avatar","./session/mubchat","lib/spin.min"],function(e,t,i,n,s,a,o,r,l,c,d,u,p,g,h){return function(n,m){var v,f,b,w=new e,y=new i,L=new t,k=new t({msg:""}),S=r.get("user"),T=r.get("labels"),M=new g,A={listener:null},C=new h({color:"#5F8F28",lines:10,length:10,width:6,radius:10,left:269,top:306}).spin();return y.setTransport(r.get("transport")),w.plugins.addAll({labels:new s(T),model:new s(y,{setTitle:function(e){e&&(this.innerHTML=e),S.get("_id")===y.get("initiator").id?this.setAttribute("contenteditable",!0):this.setAttribute("contenteditable",!1)},setDescription:function(e){e&&(this.innerHTML=e.replace(/\n/g,"<br>")),S.get("_id")===y.get("initiator").id?this.setAttribute("contenteditable",!0):this.setAttribute("contenteditable",!1)},setAvatar:function(e){var t,i;e&&(this.setAttribute("style","background:none;"),t=document.createDocumentFragment(),i=new p([e]),i.place(t),this.hasChildNodes()?this.replaceChild(t,this.firstChild):this.appendChild(t))},setIntro:function(e){this.innerHTML=e?e:" "},showStartButton:function(e){e&&e.length&&S.get("_id")===y.get("initiator").id?this.classList.remove("invisible"):this.classList.add("invisible")}}),participant:new s(L,{setAvatar:function(e){var t,i;e&&(this.setAttribute("style","background:none;"),t=document.createDocumentFragment(),i=new p([e]),i.place(t),this.hasChildNodes()?this.replaceChild(t,this.firstChild):this.appendChild(t))},setIntro:function(e){this.innerHTML=e?e:" "}}),info:new s(k),place:new o({chat:M}),mubwaitevent:new a(w)}),w.template='<div id="mubwait"><div class="brainstorm-header header blue-light" data-labels="bind: innerHTML, waitingroomlbl"></div><div class="help-brainstorm" data-mubwaitevent="listen:mousedown, help"></div><form class="mubwait-form"><div class="mubwait-title" name="title" data-model="bind:setTitle, title" data-mubwaitevent="listen: keypress, checkUpdate; listen:blur, updateField"></div><div class="mubdesc"><label data-labels="bind:innerHTML, quickstepstart"></label><p name="description" data-model="bind:setDescription, description" data-mubwaitevent="listen: keypress, checkUpdate; listen:blur, updateField"></p></div><div class="mubroster"><label data-labels="bind:innerHTML, participants">Participants</label><div class="mubleader contact"><div data-model="bind:setAvatar, initiator.id"></div><p class="contact-name" data-model="bind:innerHTML, initiator.username"></p><p class="contact-intro" data-model="bind:setIntro, initiator.intro"></p></div><ul class="participants" data-participant="foreach"><li class="contact"><div data-participant="bind:setAvatar, id"></div><p class="contact-name" data-participant="bind:innerHTML, username"></p><p class="contact-intro" data-participant="bind:setIntro, intro"></p></li></ul></div><div class="start-button invisible" data-labels="bind:innerHTML, startbutton" data-model="bind: showStartButton, participants" data-mubwaitevent="listen: mousedown, press; listen:mouseup, start"></div></form><div class="sessionmsg invisible"> <span data-info="bind:innerHTML, msg"></span></div><div class="sessionchat" data-place="place:chat"></div></div>',w.place(document.getElementById("mubwait")),w.help=function(){l.setContent("mustarthelp"),document.getElementById("cache").classList.add("appear"),document.getElementById("help-popup").classList.add("appear")},v=new d(document.body,null,null,"musession-confirm"),w.reset=function(e){M.clear(),y.unsync(),y.reset({}),L.reset([]),f=function(e){e?(S.set("sessionInProgress",""),S.upload(),y.get("initiator").id===S.get("_id")?w.cancelSession():w.leaveSession()):v.hide()},A.listener=c.exitListener("mubwait",w.leave),y.sync(r.get("db"),e).then(function(){y.get("initiator").id===S.get("_id")?v.reset(T.get("leaderleave"),f):v.reset(T.get("participantleave"),f),L.reset(y.get("participants")),M.reset(y.get("chat")[0]),S.set("sessionInProgress",{id:e,type:"musession",mode:"join"}),S.upload()})},w.leave=function(e){b=e.getAttribute("href")||e,v.show()},w.leaveSession=function(){var e,t=y.get("participants");for(e=t.length-1;e>=0;e--)if(t[e].id===S.get("_id")){t.splice(e,1);break}y.set("participants",t),y.set("status","waiting"),y.upload().then(function(){return M.leave()}).then(function(){y.unsync(),y.reset({})}),w.goToScreen()},w.cancelSession=function(){var e=5e3;y.get("participants").length||(e=2e3),w.displayInfo("deleting",e).then(function(){y.remove(),w.goToScreen()})},w.displayInfo=function(e,t){var i,n=document.querySelector(".sessionmsg"),s=new u,a=function(){n.classList.add("invisible"),clearInterval(i),k.set("msg",""),s.fulfill()};return v.hide(),document.body.removeChild(document.querySelector(".confirm")),n.classList.remove("invisible"),i=setInterval(function(){"deleting"!==e?k.set("msg",e):k.set("msg",T.get("deletingsession")+t/1e3+"s"),0>=t&&a(),t-=1e3},1e3),"deleting"===e&&(y.set("status","deleted"),y.upload().then(function(){M.cancel()})),s},w.goToScreen=function(){var e;b.getAttribute&&b.getAttribute("data-notify_id")?(v.hide(),document.body.removeChild(document.querySelector(".confirm")),n(),r.get("observer").notify("goto-screen","#connect"),document.removeEventListener("mousedown",A.listener,!0),e=b.getAttribute("data-notify_id"),observer.notify("display-message",parseInt(e,10))):["#public","#library","#brainstorm","#connect","#dashboard"].forEach(function(e){b===e&&(v.hide(),document.body.removeChild(document.querySelector(".confirm")),n(),r.get("observer").notify("goto-screen",e),document.removeEventListener("mousedown",A.listener,!0))}),L.reset([]),y.reset({})},w.checkUpdate=function(e,t){var i=t.getAttribute("name");13===e.keyCode&&(w.updateSession(i,t.innerHTML),t.blur())},w.updateField=function(e,t){var i=t.getAttribute("name");w.updateSession(i,t.innerHTML)},w.updateSession=function(e,t){y.get(e)!==t&&(y.set(e,t),y.upload())},w.press=function(e,t){t.classList.add("pressed")},w.start=function(e,t){var i=new Date,n=y.get("chat");document.body.removeChild(document.querySelector(".confirm")),M.conclude("start"),t.classList.add("invisible"),t.classList.remove("pressed"),C.spin(t.parentNode),y.set("status","in progress"),y.set("step","musetup"),y.set("startTime",i.getTime()),y.set("date",[i.getFullYear(),i.getMonth(),i.getDate()]),n.push(y.get("_id")+"_1"),y.set("chat",n),w.createChat(y.get("chat")[1]).then(function(){return y.upload()}).then(function(){document.removeEventListener("mousedown",A.listener,!0),y.unsync(),C.stop(),t.classList.remove("invisible"),m(y.get("_id"))})},w.createChat=function(e){var t=new i,n=(new Date).getTime(),s=new u;return t.setTransport(r.get("transport")),t.set("users",M.getModel().get("users")),t.set("msg",[{user:"SYS",type:5,arg:"quicksetup",time:n}]),t.set("sid",y.get("_id")),t.set("lang",y.get("lang")),t.set("readonly",!1),t.set("step",1),t.set("type",17),t.sync(r.get("db"),e).then(function(){return t.upload()}).then(function(){s.fulfill(),t.unsync()}),s},y.watchValue("status",function(e){"deleted"===e&&y.get("initiator").id!==S.get("_id")&&w.displayInfo(T.get("canceledbyleader"),2e3).then(function(){y.unsync(),n(),document.removeEventListener("mousedown",A.listener,!0)}),"in progress"===e&&y.get("initiator").id!==S.get("_id")&&(document.removeEventListener("mousedown",A.listener,!0),y.unsync(),m(y.get("_id")),y.reset({}),L.reset([]))}),y.watchValue("participants",function(e){L.reset(e)}),w}}),define("brainstorm/multi/session/mustart",["OObject","service/map","Bind.plugin","Event.plugin","service/config","service/help","lib/spin.min","service/avatar","./mubchat","Store","Place.plugin"],function(e,t,i,n,s,a,o,r,l,c,d){return function(u,p,g,h){var m=new e,v=(s.get("user"),s.get("db"),s.get("labels")),f="step",b=new c([]),w=new l,y=new o({color:"#657B99",lines:10,length:8,width:4,radius:8,top:360,left:545}).spin();return m.plugins.addAll({labels:new i(v),model:new i(u,{setAvatar:function(e){var t,i;e&&(this.setAttribute("style","background:none;"),t=document.createDocumentFragment(),i=new r([e]),i.place(t),this.hasChildNodes()?this.replaceChild(t,this.firstChild):this.appendChild(t))},setIntro:function(e){this.innerHTML=e?e:" "},setDescription:function(e){this.innerHTML=e.replace(/\n/g,"<br>")}}),participant:new i(b,{setAvatar:function(e){var t,i;e&&(this.setAttribute("style","background:none;"),t=document.createDocumentFragment(),i=new r([e]),i.place(t),this.hasChildNodes()?this.replaceChild(t,this.firstChild):this.appendChild(t))},setIntro:function(e){this.innerHTML=e?e:" "}}),place:new d({chat:w}),mustartevent:new n(m)}),m.template='<div id = "mustart"><div class="previousbutton" data-mustartevent="listen: mousedown, press; listen: mousedown, prev"></div><div class="brainstorm-header header blue-light" data-labels="bind: innerHTML, quickstart" data-mustartevent="listen:mousedown, toggleProgress"></div><div class="help-brainstorm" data-mustartevent="listen:mousedown, help"></div><form class="mubwait-form"><div class="mubwait-title" name="title" data-model="bind:innerHTML, title"></div><div class="mubdesc"><label data-labels="bind:innerHTML, quickstepstart"></label><p name="description" data-model="bind:setDescription, description"></p></div><div class="mubroster"><label data-labels="bind:innerHTML, participants"></label><div class="mubleader contact"><div data-model="bind:setAvatar, initiator.id"></div><p class="contact-name" data-model="bind:innerHTML, initiator.username"></p><p class="contact-intro" data-model="bind:setIntro, initiator.intro"></p></div><ul class="participants" data-participant="foreach"><li class="contact"><div data-participant="bind:setAvatar, id"></div><p class="contact-name" data-participant="bind:innerHTML, username"></p><p class="contact-intro" data-participant="bind:setIntro, intro"></p></li></ul></div></form><div class="sessionchat" data-place="place:chat"></div><div>',m.place(t.get("mustart")),m.press=function(e,t){t.classList.add("pressed")},m.next=function(e,t){y.spin(t.parentNode),t.classList.add("invisible"),t.classList.remove("pressed"),g("mustart")},m.prev=function(e,t){t.classList.remove("pressed"),p("quickstart")},m.toggleProgress=function(){h()},m.reset=function(e){f="step",b.reset(u.get("participants")),w.reset(u.get("chat")[0]).then(function(){w.setReadonly(),e&&w.dom.querySelector(".chatread").classList.add("extended")})},m.help=function(){a.setContent("mustarthelp"),document.getElementById("cache").classList.add("appear"),document.getElementById("help-popup").classList.add("appear")},u.watchValue("participants",function(e){b.reset(e)}),m}}),define("brainstorm/multi/session/musetup",["OObject","service/map","Bind.plugin","Place.plugin","Event.plugin","service/config","CouchDBDocument","Store","Promise","service/cardpopup","service/help","service/utils","lib/spin.min","./mubchat"],function(e,t,i,n,s,a,o,r,l,c,d,u,p,g){return function(t,h,m,v,f){var b,w,y=new e,L=new g,k=a.get("labels"),S=a.get("transport"),T=a.get("db"),M=a.get("user"),A={},C=new r({timer:null,display:!1}),x=new r({"char":{selected:!1,left:null,popup:!1},context:{selected:!1,left:null,popup:!1},problem:{selected:!1,left:null,popup:!1}}),q=new r({"char":{id:"",title:k.get("char"),pic:""},context:{id:"",title:k.get("context"),pic:""},problem:{id:"",title:k.get("problem"),pic:""}}),H={"char":0,context:0,problem:0},_=!0,I={"char":new r,context:new r,problem:new r},D="",N=0,O="step",E=new p({color:"#657B99",lines:10,length:8,width:4,radius:8,top:337,left:490}).spin(),B={};return y.plugins.addAll({labels:new i(k),musetup:new i(x,{setReload:function(e){0===e?this.classList.add("reload"):this.classList.remove("reload")},updateNext:function(){"step"===O&&x.get("char").selected&&x.get("context").selected&&x.get("problem").selected&&M.get("_id")===t.get("initiator").id?this.classList.remove("invisible"):this.classList.add("invisible")},popup:function(e){e?this.classList.add("highlighted"):this.classList.remove("highlighted")},setSelected:function(e){e?this.classList.add("pushed"):this.classList.remove("pushed")}}),musetuptimer:new i(C,{setTime:function(e){e&&(this.innerHTML=u.formatDuration(e))},displayTimer:function(e){e?this.classList.add("showtimer"):this.classList.remove("showtimer")}}),musetupcards:new i(q,{removeDefault:function(e){e?this.classList.remove("defaultcard"):this.classList.add("defaultcard")},formatTitle:function(e){this.innerHTML=e?e.substring(0,1).toUpperCase()+e.substring(1).toLowerCase():e},setPic:function(e){var t=this;e?e.search("img/decks")>-1?this.setAttribute("style","background-image:url('"+e+"');"):(json={dir:"cards",filename:e},a.get("transport").request("GetFile",json,function(e){t.setAttribute("style","background:white; background-image: url('"+e+"'); background-repeat: no-repeat; background-position: center center; background-size:contain;")})):this.setAttribute("style","background-image: none;")}}),place:new n({chat:L}),musetupevent:new s(y)}),y.template='<div id = "musetup"><div class="previousbutton" data-musetupevent="listen: mousedown, press; listen: mousedown, prev"></div><div id="musetup-popup" class="invisible"></div><div class="brainstorm-header header blue-light" data-labels="bind: innerHTML, musetup" data-musetupevent="listen:mousedown, toggleProgress"></div><div class="timer" data-musetuptimer="bind:setTime, timer; bind: displayTimer, display" data-musetupevent="listen:mousedown,toggleTimer"></div><div class="help-brainstorm" data-musetupevent="listen:mousedown, help"></div><div class="drawarea"><div class="decks"><div class="drawbutton drawchar" name="char" data-musetupevent="listen: mousedown, push; listen:mouseup, draw" data-musetup="bind: setReload, char.left"></div><div class="drawbutton drawcontext" name="context" data-musetupevent="listen: mousedown, push; listen:mouseup, draw" data-musetup="bind:setReload, context.left"></div><div class="drawbutton drawproblem" name="problem" data-musetupevent="listen: mousedown, push; listen:mouseup, draw" data-musetup="bind:setReload, problem.left"></div></div><div class="cards"><div class="card char defaultcard" name="char" data-musetupevent="listen:mousedown, zoom" data-musetupcards="bind:removeDefault, char.pic" data-musetup="bind: popup, char.popup"><div class="cardpicture" data-musetupcards="bind: setPic, char.pic"></div><div class="cardtitle" data-musetupcards="bind:formatTitle, char.title">Character</div></div><div class="card context defaultcard" name="context" data-musetupevent="listen:mousedown, zoom" data-musetupcards="bind:removeDefault, context.pic" data-musetup="bind: popup, context.popup"><div class="cardpicture" data-musetupcards="bind: setPic, context.pic"></div><div class="cardtitle" data-musetupcards="bind:formatTitle, context.title">Context</div></div><div class="card problem defaultcard" name="problem" data-musetupevent="listen:mousedown, zoom" data-musetupcards="bind:removeDefault, problem.pic" data-musetup="bind: popup, problem.popup"><div class="cardpicture" data-musetupcards="bind: setPic, problem.pic"></div><div class="cardtitle" data-musetupcards="bind:formatTitle, problem.title">Problem</div></div></div><div class="confirmdraw"><div class="drawok" name="char" data-musetup="bind:setSelected, char.selected" data-musetupevent="listen: mousedown, pushOk; listen:mouseup, accept"></div><div class="drawok" name="context" data-musetup="bind:setSelected, context.selected" data-musetupevent="listen: mousedown, pushOk; listen:mouseup, accept"></div><div class="drawok" name="problem" data-musetup="bind:setSelected, problem.selected" data-musetupevent="listen: mousedown, pushOk; listen:mouseup, accept"></div></div><div class="next-button invisible" data-labels="bind:innerHTML, nextbutton" data-musetupevent="listen: mousedown, press; listen:mouseup, next" data-musetup="bind:updateNext, char.selected;bind:updateNext, context.selected;bind:updateNext, problem.selected"></div></div><div class="sessionchat" data-place="place:chat"></div></div>',y.press=function(e,t){t.classList.add("pressed")},y.next=function(e,i){E.spin(i.parentNode),i.classList.add("invisible"),i.classList.remove("pressed"),"step"===O?(O="screen",h.set("characters",q.get("char")),h.set("contexts",q.get("context")),h.set("problems",q.get("problem")),clearInterval(w),C.set("display",!0),y.updateSessionScore(C.get("timer")).then(function(){return t.unsync(),t.sync(a.get("db"),t.get("_id"))}).then(function(){L.conclude("next"),t.set("elapsedTimers",{musetup:C.get("timer")}),t.set("characters",[q.get("char").id]),t.set("contexts",[q.get("context").id]),t.set("problems",[q.get("problem").id]),v("musetup")})):v("musetup")},y.stopSpinner=function(){E.stop()},y.help=function(){d.setContent("musetuphelp"),document.getElementById("cache").classList.add("appear"),document.getElementById("help-popup").classList.add("appear")},y.prev=function(e,t){t.classList.remove("pressed"),m("musetup")},y.toggleProgress=function(){f()},y.toggleTimer=function(){t.get("initiator").id===M.get("_id")&&C.set("display",!C.get("display"))},y.push=function(e,i){"screen"!==O&&M.get("_id")===t.get("initiator").id&&i.classList.add("pushed")},y.draw=function(e,i){var n=i.getAttribute("name"),s=x.get(n);_now=new Date,M.get("_id")===t.get("initiator").id&&"step"===O&&_&&(_=!1,0===s.left&&(A[n]=h.get("deck")[n].concat(),s.left=A[n].length,x.set(n,s)),s.selected?(_=!0,alert("please unlock selected card first")):s.selected===!1?y.drawCard(n).then(function(){var e=!1;i.classList.remove("pushed"),_=!0,x.loop(function(t){t.popup===!0&&(e=!0)}),e&&y.setPopup(n)}):(i.classList.remove("pushed"),_=!0))},y.pushOk=function(e,i){var n=B[i.getAttribute("name")]||null;M.get("_id")===t.get("initiator").id&&"step"===O&&(n?B[i.getAttribute("name")].spin(i):B[i.getAttribute("name")]=(new p).spin(i))},y.accept=function(e,i){var n=i.getAttribute("name"),s=x.get(n);"step"===O&&t.get("initiator").id===M.get("_id")&&(s.selected=q.get(n).id?!s.selected:!1,t.unsync(),t.sync(a.get("db"),t.get("_id")).then(function(){return t.set("selected_"+n,s.selected),t.upload()}).then(function(){B[i.getAttribute("name")].stop(),selection.set(n,s)}))},y.zoom=function(e,t){var i=t.getAttribute("name");y.setPopup(i)},y.setPopup=function(e){var t={x:0,y:257},i="left",n=x.get(D)||"",s=x.get(e);n&&(n.popup=!1,x.set(D,n)),s.popup=!0,x.set(e,s),D=e,"char"===e&&(t.x=382),"context"===e&&(t.x=102,i="right"),"problem"===e&&(t.x=249,i="right"),I[e].getNbItems()&&b.reset(I[e].toJSON(),t,i,document.getElementById("musetup-popup"))},y.closePopup=function(){var e=x.get(D);e.popup=!1,x.set(D,e),D=""},b=new c(y.closePopup),y.getChatUI=function(){return L},y.initTimer=function(e){var i=new Date,n=i.getTime(),s=e||0;C.set("timer",s),"musetup"===t.get("step")&&(clearInterval(w),w=setInterval(function(){var e=new Date;C.set("timer",s+e.getTime()-n)},1e3))},y.reset=function(e){L.clear(),t.get("chat")[1]&&L.reset(t.get("chat")[1]),e?(O="screen",L.dom.querySelector(".chatread").classList.add("extended"),N=t.get("elapsedTimers").musetup||0,x.reset({"char":{selected:!0,left:1,popup:!1},context:{selected:!0,left:1,popup:!1},problem:{selected:!0,left:1,popup:!1}}),D="",C.set("timer",N),C.set("display",!0),t.get("characters").length&&y.getDeck(t.get("deck")).then(function(){return y.getCard(t.get("characters")[0],I.char)}).then(function(){var e=I.char;return q.set("char",{id:e.get("_id"),title:e.get("title"),pic:e.get("picture_file")}),h.set("characters",q.get("char")),y.getCard(t.get("contexts")[0],I.context)}).then(function(){var e=I.context;return q.set("context",{id:e.get("_id"),title:e.get("title"),pic:e.get("picture_file")}),h.set("contexts",q.get("context")),y.getCard(t.get("problems")[0],I.problem)}).then(function(){var e=I.problem;q.set("problem",{id:e.get("_id"),title:e.get("title"),pic:e.get("picture_file")}),h.set("problems",q.get("problem"))})):y.init()},y.getDeck=function(e){var t=new l,i=new o;return i.setTransport(S),i.sync(T,e).then(function(){var e,n={},s=a.get("user").get("lang");e=i.get("default_lang")&&i.get("default_lang")!==s?i.get("translations")&&i.get("translations")[s]?i.get("translations")[s]:JSON.parse(i.toJSON()):JSON.parse(i.toJSON()),n.char=e.content.characters,n.context=e.content.contexts,n.problem=e.content.problems,n.techno=e.content.techno,["char","context","problem","techno"].forEach(function(e){"newcard"===n[e][0]&&n[e].shift()}),h.set("deck",n),t.fulfill(),i.unsync()}),t},y.getCard=function(e,t){var i=new l,n=new o;return n.setTransport(S),n.sync(T,e).then(function(){t.reset(JSON.parse(n.toJSON())),i.fulfill(),n.unsync()}),i},y.drawCard=function(e){var i=new l,n=Math.floor(Math.random()*A[e].length),s=A[e][n];return t.set("drawn_"+e,s),t.upload().then(function(){H[e]++,A[e].splice(n,1),i.fulfill()}),i},y.updateDrawnCard=function(e,t){var i,n,s=new l;return e&&t&&(i=x.get(e),n=q.get(e),y.getCard(t,I[e]).then(function(){var a=I[e];n.id=t,n.title=a.get("title"),n.pic=a.get("picture_file"),q.set(e,n),i.left=A[e].length,x.set(e,i),s.fulfill()})),s},y.updateSessionScore=function(e){var i=new l,n={sid:t.get("_id"),step:"musetup",time:e,cards:H.char+H.context+H.problem};return S.request("UpdateSessionScore",n,function(e){"ok"===e.res?i.fulfill():i.reject()}),i},y.init=function(){q.reset({"char":{id:"",title:k.get("char"),pic:""},context:{id:"",title:k.get("context"),pic:""},problem:{id:"",title:k.get("problem"),pic:""}}),x.reset({"char":{selected:!1,left:null,popup:!1},context:{selected:!1,left:null,popup:!1},problem:{selected:!1,left:null,popup:!1}}),H.char=0,H.context=0,H.problem=0,I={"char":new r,context:new r,problem:new r},D="",M.get("_id")===t.get("initiator").id?y.getDeck(t.get("deck")).then(function(){var e=h.get("deck");A.char=e.char.concat(),A.context=e.context.concat(),A.problem=e.problem.concat(),_=!0,y.initTimer()}):C.set("display",!1),O="step"},t.watchValue("drawn_char",function(e){e&&y.updateDrawnCard("char",e)}),t.watchValue("drawn_context",function(e){e&&y.updateDrawnCard("context",e)}),t.watchValue("drawn_problem",function(e){e&&y.updateDrawnCard("problem",e)}),t.watchValue("selected_char",function(e){var t;t=x.get("char"),t.selected=e,x.set("char",t),e&&h.set("characters",q.get("char"))}),t.watchValue("selected_context",function(e){var t;t=x.get("context"),t.selected=e,x.set("context",t),e&&h.set("contexts",q.get("context"))}),t.watchValue("selected_problem",function(e){var t;t=x.get("problem"),t.selected=e,x.set("problem",t),e&&h.set("problems",q.get("problem"))}),t.watchValue("elapsedTimers",function(e){e.musetup&&(C.set("timer",e.musetup),C.set("display",!0))}),y}}),define("brainstorm/multi/session/muscenario",["OObject","service/map","Bind.plugin","Event.plugin","Place.plugin","service/config","Store","CouchDBDocument","service/cardpopup","../../whiteboard/whiteboard","Promise","service/utils","lib/spin.min","./mubchat"],function(e,t,i,n,s,a,o,r,l,c,d,u,p,g){return function(h,m,v,f,b){var w,y,L,k,S=new e,T=new g,M=a.get("labels"),A=a.get("user"),C=a.get("db"),x=new o,q=new o,H=new o,_=new o({"char":{id:"",title:"",pic:""},context:{id:"",title:"",pic:""},problem:{id:"",title:"",pic:""}}),I={cardpopup:{"char":!1,context:!1,problem:!1},postit:"inactive","import":"inactive",drawing:"inactive",ready:!1,showstory:!1,shownext:!1,readonly:!1},D=new o(I),N=new o({timer:null,display:!1}),O=new o({title:"",story:"",solution:""}),E=new o([]),B=new c("scenario",E,D,"mu"),P=0,j="step",R=a.get("transport"),F=new p({color:"#657B99",lines:10,length:8,width:4,radius:8,top:695,left:670}).spin();return S.isLeader=function(){return h.get("initiator")&&h.get("initiator").id===A.get("_id")},S.plugins.addAll({labels:new i(M,{setPlaceholder:function(e){this.setAttribute("placeholder",e)}}),cards:new i(_,{formatTitle:function(e){e&&(this.innerHTML=e.substring(0,1).toUpperCase()+e.substring(1).toLowerCase())},setPic:function(e){var t=this;e?e.search("img/decks")>-1?this.setAttribute("style","background-image:url('"+e+"');"):(json={dir:"cards",filename:e},a.get("transport").request("GetFile",json,function(e){t.setAttribute("style","background:white; background-image: url('"+e+"'); background-repeat: no-repeat; background-position: center center; background-size:contain;")})):this.setAttribute("style","background-image: none;")}}),wbtools:new i(D,{setActive:function(e){"active"===e?this.classList.add("pushed"):this.classList.remove("pushed")},setReady:function(e){S.isLeader()?e?this.classList.remove("invisible"):this.classList.add("invisible"):this.classList.add("invisible")},showStory:function(e){e?this.classList.remove("invisible"):this.classList.add("invisible")},toggleToolbox:function(e){e?this.classList.add("invisible"):this.classList.remove("invisible")},setReadonly:function(e){e?this.setAttribute("readonly","readonly"):this.removeAttribute("readonly")},popup:function(e){e?this.classList.add("highlighted"):this.classList.remove("highlighted")}}),muscenariotimer:new i(N,{setTime:function(e){this.innerHTML=u.formatDuration(e)},displayTimer:function(e){e?this.classList.add("showtimer"):this.classList.remove("showtimer")}}),scenario:new i(O),wbstack:B,place:new s({chat:T}),muscenarioevent:new n(S)}),S.template='<div id = "muscenario"><div class="previousbutton" data-muscenarioevent="listen: mousedown, press; listen: mousedown, prev"></div><div class="brainstorm-header header blue-light" data-labels="bind: innerHTML, muscenario" data-muscenarioevent="listen:mousedown, toggleProgress"></div><div class="timer" data-muscenariotimer="bind:setTime, timer; bind: displayTimer, display" data-muscenarioevent="listen:mousedown,toggleTimer"></div><div id="muscenario-left"><div class="scenario-cards leftarea folded" data-muscenarioevent="listen:mousedown, fold"><div class = "card char" data-wbtools="bind:popup,cardpopup.char" name="char" data-muscenarioevent="listen:mousedown, zoom"><div class="cardpicture" data-cards="bind:setPic,char.pic"></div><div class="cardtitle" data-cards="bind:formatTitle,char.title">Character</div></div><div class="card context" name="context" data-wbtools="bind: popup,cardpopup.context" data-muscenarioevent="listen:mousedown, zoom"><div class="cardpicture" data-cards="bind:setPic,context.pic"></div><div class="cardtitle" data-cards="bind: formatTitle,context.title">Context</div></div><div class="card problem" name="problem" data-wbtools="bind:popup, cardpopup.problem" data-muscenarioevent="listen:mousedown, zoom"><div class="cardpicture" data-cards="bind:setPic,problem.pic"></div><div class="cardtitle" data-cards="bind:formatTitle,problem.title">Problem</div></div><div class="caret"></div></div><div id="muscenario-popup"></div><div class ="toolbox" data-wbtools="bind:toggleToolbox, showstory"><div class="toolbox-button"><div class="postit-button" name="postit" data-wbtools="bind:setActive, postit" data-muscenarioevent="listen: mousedown, push; listen:mouseup, post"></div><legend data-labels="bind:innerHTML, post">Post-it</legend></div><div class="toolbox-button"><div class="importpic-button" name="import" data-wbtools="bind:setActive, import" data-muscenarioevent="listen: mousedown, push; listen:mouseup, importpic"></div><legend data-labels="bind:innerHTML, import">Import pictures</legend></div><div class="toolbox-button"><div class="drawingtool-button" name="drawing" data-wbtools="bind:setActive, drawing" data-muscenarioevent="listen: mousedown, push; listen:mouseup, draw"></div><legend data-labels="bind:innerHTML, draw">Drawing tool</legend></div><div class="finish-button invisible" data-wbtools="bind:setReady, ready" data-labels="bind:innerHTML, finishbutton" data-muscenarioevent="listen: mousedown, press; listen:mouseup, finish"></div></div></div><div id="muscenario-right" class="workarea"><div id="scenario-whiteboard" class="whiteboard" data-muscenarioevent = "listen:mousedown, toggleView"><div class="stack" data-wbstack="destination"></div><div class="caret descending invisible" data-muscenarioevent="listen:mousedown, toggleCaret"></div></div><div id = "muscenario-writeup" class="writeup invisible" data-wbtools="bind: showStory,showstory"><textarea class = "enterTitle" maxlength="30" data-labels="bind:setPlaceholder, storytitleplaceholder" data-scenario="bind:value, title" data-wbtools="bind:setReadonly, readonly" data-muscenarioevent="listen:input, updateField"></textarea><div class="setPrivate"></div><div class="setPublic"></div><textarea class = "enterDesc" data-labels="bind:setPlaceholder, storydescplaceholder" data-scenario="bind:value, story" data-wbtools="bind:setReadonly, readonly" data-muscenarioevent="listen:input, updateField"></textarea><textarea class = "enterSol" data-labels="bind:setPlaceholder, storysolplaceholder" data-scenario="bind:value, solution" data-wbtools="bind:setReadonly, readonly" data-muscenarioevent="listen:input, updateField"></textarea></div><div class="next-button invisible" data-wbtools="bind:setReady, shownext" data-labels="bind:innerHTML, nextbutton" data-muscenarioevent="listen: mousedown, press; listen:mouseup, next"></div></div><div class="sessionchat" data-place="place:chat"></div></div>',S.place(t.get("muscenario")),S.press=function(e,t){t.classList.add("pressed")},S.isLeader=function(){return h.get("initiator")&&h.get("initiator").id===A.get("_id")},S.next=function(e,t){F.spin(t.parentNode),t.classList.add("invisible"),t.classList.remove("pressed"),"step"===j?(j="screen",D.set("readonly",!0),clearInterval(L),N.set("display",!0),clearInterval(k),m.set("scenario",JSON.parse(O.toJSON())),h.unsync(),h.sync(C,h.get("_id")).then(function(){var e;return T.conclude("next"),e=h.get("elapsedTimers"),e.muscenario=N.get("timer"),h.set("elapsedTimers",e),h.set("scenario",[m.get("scenario")]),h.upload()}).then(function(){return S.updateSessionScore(N.get("timer"))}).then(function(){f("muscenario")})):f("muscenario")},S.stopSpinner=function(){F.stop()},S.prev=function(e,t){t.classList.remove("pressed"),v("muscenario")},S.toggleProgress=function(){b()},S.toggleTimer=function(){S.isLeader()&&N.set("display",!N.get("display"))},S.push=function(e,t){var i=t.getAttribute("name");D.set(i,"active")},S.zoom=function(e,t){e.stopPropagation();var i=t.getAttribute("name");S.setPopup(i)},S.fold=function(e,t){h.get("scReady")||(t.classList.toggle("folded"),t.querySelector(".caret").classList.toggle("folding"),y&&w.close())},S.setPopup=function(e){var t,i={x:147,y:130},n="left",s=_.get(e),a=D.get("cardpopup"),o="";y&&(a[y]=!1),a[e]=!0,D.set("cardpopup",a),y=e,"char"===e&&(i.y=120,s.id===x.get("_id")&&(o=x.toJSON())),"context"===e&&(i.y=290,s.id===q.get("_id")&&(o=q.toJSON())),"problem"===e&&(i.y=350,s.id===H.get("_id")&&(o=H.toJSON())),o?w.reset(o,i,n,document.getElementById("muscenario-popup")):(t=new r,t.setTransport(R),t.sync(C,s.id).then(function(){o=t.toJSON(),w.reset(o,i,n,document.getElementById("muscenario-popup")),"char"===e&&x.reset(JSON.parse(t.toJSON())),"context"===e&&q.reset(JSON.parse(t.toJSON())),"problem"===e&&H.reset(JSON.parse(t.toJSON()))
}))},S.closePopup=function(){var e=D.get("cardpopup");e[y]=!1,D.set("cardpopup",e),y=""},w=new l(S.closePopup),S.getChatUI=function(){return T},S.post=function(){B.selectScreen("postit"),D.set("import","inactive"),D.set("drawing","inactive")},S.importpic=function(){B.selectScreen("import"),D.set("postit","inactive"),D.set("drawing","inactive")},S.draw=function(){B.selectScreen("drawing"),D.set("import","inactive"),D.set("postit","inactive")},S.exitTool=function(e){D.set(e,"inactive")},S.finish=function(e,t){var i=new p({color:"#657B99",lines:10,length:8,width:4,radius:8,top:550,left:50}).spin();i.spin(t.parentNode),t.classList.add("invisible"),h.unsync(),h.sync(C,h.get("_id")).then(function(){return h.set("scReady",!0),h.upload()}).then(function(){i.stop(),t.classList.remove("pressed"),D.set("ready",!1),S.displayStory(),S.updateScenario()})},S.updateField=function(e,t){t.classList.contains("enterTitle")&&O.set("title",t.value),t.classList.contains("enterDesc")&&O.set("story",t.value),t.classList.contains("enterSol")&&O.set("solution",t.value)},S.displayStory=function(){B.setReadonly(!0),D.set("showstory",!0),S.dom.querySelector(".scenario-cards").classList.remove("folded"),S.dom.querySelector(".scenario-cards .caret").classList.add("invisible"),S.dom.querySelector(".writeup").scrollIntoView(),S.dom.querySelector(".whiteboard .caret").classList.remove("invisible")},S.hideStory=function(){S.dom.querySelector(".scenario-cards").classList.add("folded"),S.dom.querySelector(".scenario-cards .caret").classList.remove("invisible"),S.dom.querySelector(".whiteboard .caret").classList.add("invisible")},S.toggleCaret=function(e,t){e.stopPropagation();var i=S.dom.querySelector(".writeup"),n=S.dom.querySelector(".whiteboard");t.classList.toggle("descending"),t.classList.contains("descending")?i.scrollIntoView():n.scrollIntoView()},S.toggleView=function(e,t){var i=t.querySelector(".caret"),n=S.dom.querySelector(".writeup"),s=S.dom.querySelector(".whiteboard");i.classList.contains("descending")?(i.classList.remove("descending"),s.scrollIntoView()):e.pageY-t.scrollHeight>0&&(i.classList.add("descending"),n.scrollIntoView())},S.updateScenario=function(){k=setInterval(function(){var e=h.get("scenario")[0]||{title:"",story:"",solution:""},t=e.title,i=e.story,n=e.solution,s={};(O.get("title")!==t||O.get("story")!==i||O.get("solution")!==n)&&(s.title=O.get("title"),s.story=O.get("story"),s.solution=O.get("solution"),h.set("scenario",[s]),h.upload().then(function(){return console.log("scenario updated in CouchDB"),!0},function(e){console.log("failed to update scenario",e)}))},8e3)},S.updateSessionScore=function(e){var t=new d,i={sid:h.get("_id"),step:"muscenario",time:e,wbcontent:E.toJSON(),scenario:O.toJSON()};return R.request("UpdateSessionScore",i,function(e){console.log(e),"ok"===e.res?(h.unsync(),h.sync(C,h.get("_id")).then(function(){t.fulfill()})):t.reject()}),t},S.reset=function(e){T.clear(),h.get("chat")[2]&&T.reset(h.get("chat")[2]),D.reset({cardpopup:{"char":!1,context:!1,problem:!1},postit:"inactive","import":"inactive",drawing:"inactive",ready:!1,showstory:!1,shownext:!1,readonly:!1}),B.setSessionId(h.get("_id")),E.reset(h.get("scenarioWB")),B.init(),E.getNbItems()?B.selectScreen("main"):B.selectScreen("default"),e||h.get("scenario").length?(j="screen",T.dom.querySelector(".chatread").classList.add("extended"),D.set("ready",!1),S.displayStory(),D.set("readonly",!0),D.set("shownext",!1),O.reset(h.get("scenario")[0]),m.set("scenario",h.get("scenario")[0])):(O.reset({title:"",story:"",solution:""}),E.getNbItems()?D.set("ready",!0):D.set("ready",!1),B.setReadonly(!1),S.hideStory(),j="step"),h.get("elapsedTimers").muscenario&&(P=h.get("elapsedTimers").muscenario,N.set("timer",P),"screen"===j?N.set("display",!0):S.isLeader()&&S.initTimer(P))},S.initTimer=function(e){var t=new Date,i=t.getTime(),n=e||0;N.set("display",!1),N.set("timer",n),"muscenario"===h.get("step")&&(clearInterval(L),L=setInterval(function(){var e=new Date;N.set("timer",n+e.getTime()-i)},1e3))},m.watchValue("characters",function(e){_.set("char",e)}),m.watchValue("contexts",function(e){_.set("context",e)}),m.watchValue("problems",function(e){_.set("problem",e)}),h.watchValue("_id",function(e){B.setSessionId(e)}),h.watchValue("chat",function(e){3===e.length&&T.getModel().get("_id")!==e[2]&&T.reset(e[2])}),["added","deleted","updated"].forEach(function(e){E.watch(e,function(){D.get("showstory")||((h.get("scenarioWB").length!==E.getNbItems()||JSON.stringify(h.get("scenarioWB"))!==E.toJSON())&&(h.set("scenarioWB",JSON.parse(E.toJSON())),h.upload().then(function(e){console.log("success : ",e)},function(e){console.log("failure : ",e)})),E.getNbItems()&&"step"===j?D.set("ready",!0):D.set("ready",!1))})}),h.watchValue("scenarioWB",function(e){"muscenario"!==h.get("step")||D.get("showstory")||(e.length&&"default"===B.getStack().getCurrentName()&&B.selectScreen("main"),e.length||B.selectScreen("default"),(e.length!==E.getNbItems()||JSON.stringify(e)!==E.toJSON())&&E.reset(e))}),h.watchValue("scReady",function(e){"muscenario"===h.get("step")&&e&&!S.isLeader()&&(D.set("readonly",!0),S.displayStory())}),h.watchValue("scenario",function(e){S.isLeader()||(O.reset(e[0]),m.set("scenario",JSON.parse(O.toJSON())))}),O.watch("updated",function(){S.isLeader()&&O.get("title")&&O.get("story")&&O.get("solution")?D.set("shownext",!0):D.set("shownext",!1)}),S}}),define("brainstorm/multi/session/mutech",["OObject","service/map","Place.plugin","Bind.plugin","Event.plugin","service/config","service/help","Store","CouchDBDocument","Promise","service/cardpopup","service/utils","lib/spin.min","./mubchat"],function(e,t,i,n,s,a,o,r,l,c,d,u,p,g){return function(h,m,v,f,b){var w,y,L,k=new e,S=null,T=null,M=new r({timer:null,display:!1}),A=a.get("transport"),C=a.get("user"),x=a.get("db"),q=a.get("labels"),H=new g,_=new r({left:"",scenario:{popup:!1},tech1:{popup:!1,selected:!1},tech2:{popup:!1,selected:!1},tech3:{popup:!1,selected:!1}}),I=[],D=!0,N=new r,O=new r,E=new r,B={tech1:N,tech2:O,tech3:E},P=0,j=new r([{id:"",title:"",pic:""},{id:"",title:"",pic:""},{id:"",title:"",pic:""}]),R="step",F=new p({color:"#657B99",lines:10,length:8,width:4,radius:8,top:336,left:481}).spin(),V={};return k.isLeader=function(){return h.get("initiator")&&h.get("initiator").id===C.get("_id")},k.plugins.addAll({labels:new n(q),display:new n(_,{setReload:function(e){!e&&P>0?this.classList.add("reload"):this.classList.remove("reload")},updateNext:function(){k.isLeader()&&_.get("tech1").selected&&_.get("tech2").selected&&_.get("tech3").selected&&"step"===R?this.classList.remove("invisible"):this.classList.add("invisible")},setSelected:function(e){e?this.classList.add("pushed"):this.classList.remove("pushed")},popup:function(e){e?this.classList.add("highlighted"):this.classList.remove("highlighted")}}),techcards:new n(j,{removeDefault:function(e){e?this.classList.remove("defaultcard"):this.classList.add("defaultcard")},formatTitle:function(e){this.innerHTML=e?e.toUpperCase():q.get(this.parentNode.getAttribute("name")+"lbl")},setPic:function(e){var t=this;e?e.search("img/decks")>-1?this.setAttribute("style","background-image:url('"+e+"');"):(json={dir:"cards",filename:e},a.get("transport").request("GetFile",json,function(e){t.setAttribute("style","background:white; background-image: url('"+e+"'); background-repeat: no-repeat; background-position: center center; background-size:contain;")})):this.setAttribute("style","background-image: none;")}}),mutechtimer:new n(M,{setTime:function(e){this.innerHTML=u.formatDuration(e)},displayTimer:function(e){e?this.classList.add("showtimer"):this.classList.remove("showtimer")}}),place:new i({chat:H}),mutechevent:new s(k)}),k.template='<div id = "mutech"><div class="previousbutton" data-mutechevent="listen: mousedown, press; listen: mousedown, prev"></div><div id="mutech-popup" class="invisible"></div><div class="brainstorm-header header blue-light" data-labels="bind: innerHTML, mutech" data-mutechevent="listen:mousedown, toggleProgress"></div><div class="timer" data-mutechtimer="bind:setTime, timer; bind: displayTimer, display" data-mutechevent="listen:mousedown,toggleTimer"></div><div class="help-brainstorm" data-mutechevent="listen:mousedown, help"></div><div id="mutech-left" class="leftarea"><div class="card defaultscenario" name="scenario" data-mutechevent="listen: mousedown, select; listen:mousedown, zoom" data-display="bind: popup, scenario.popup"><div class="cardpicture"></div><div class="cardtitle" data-labels="bind:innerHTML, scenariolbl"></div></div></div><div class="drawarea"><div class="decks"><div class="drawbutton drawtech" "name"="tech" data-mutechevent="listen: mousedown, push; listen:mouseup, draw" data-display="bind: setReload, left"></div></div><div class="cards"><div class="card tech defaultcard" name="tech1" data-mutechevent="listen: mousedown, select; listen:mouseup, zoom" data-techcards="bind:removeDefault, 0.pic" data-display="bind: popup, tech1.popup"><div class="cardpicture" data-techcards="bind:setPic, 0.pic"></div><div class="cardtitle" data-techcards="bind:formatTitle, 0.title" data-labels="bind:innerHTML, tech1lbl"></div></div><div class="card tech defaultcard" name="tech2" data-mutechevent="listen: mousedown, select; listen:mouseup, zoom" data-techcards="bind:removeDefault, 1.pic" data-display="bind: popup, tech2.popup"><div class="cardpicture" data-techcards="bind:setPic, 1.pic"></div><div class="cardtitle" data-techcards="bind:formatTitle, 1.title" data-labels="bind:innerHTML,tech2lbl"></div></div><div class="card tech defaultcard" name="tech3" data-mutechevent="listen: mousedown, select; listen:mouseup, zoom" data-techcards="bind:removeDefault, 2.pic" data-display="bind: popup, tech3.popup"><div class="cardpicture" data-techcards="bind:setPic, 2.pic"></div><div class="cardtitle" data-techcards="bind:formatTitle, 2.title" data-labels="bind:innerHTML, tech3lbl"></div></div></div><div class="confirmdraw"><div class="drawok" name="tech1" data-display="bind:setSelected, tech1.selected" data-mutechevent="listen: mousedown, pushOk; listen:mouseup, accept"></div><div class="drawok" name="tech2" data-display="bind:setSelected, tech2.selected" data-mutechevent="listen: mousedown, pushOk; listen:mouseup, accept"></div><div class="drawok" name="tech3" data-display="bind:setSelected, tech3.selected" data-mutechevent="listen: mousedown, pushOk; listen:mouseup, accept"></div></div><div class="next-button" data-labels="bind:innerHTML, nextbutton" data-mutechevent="listen: mousedown, press; listen:mouseup, next" data-display="bind:updateNext, tech1.selected;bind:updateNext, tech2.selected;bind:updateNext, tech3.selected"></div></div><div class="sessionchat" data-place="place:chat"></div></div>',k.place(t.get("mutech")),k.press=function(e,t){t.classList.add("pressed")},k.next=function(e,t){var i=new Date;i.getTime()-S,F.spin(t.parentNode),t.classList.add("invisible"),t.classList.remove("pressed"),"step"===R?(R="screen",m.set("techno",j),clearInterval(w),M.set("display",!0),k.updateSessionScore(M.get("timer")).then(function(){h.unsync(),h.sync(x,h.get("_id")).then(function(){var e=h.get("elapsedTimers");H.conclude("next"),e.mutech=M.get("timer"),h.set("elapsedTimers",e),h.set("techno",[[j.get(0).id,j.get(1).id,j.get(2).id]]),f("mutech")})})):f("mutech")},k.stopSpinner=function(){F.stop()},k.help=function(){o.setContent("mutechhelp"),document.getElementById("cache").classList.add("appear"),document.getElementById("help-popup").classList.add("appear")},k.prev=function(e,t){t.classList.remove("pressed"),v("mutech")},k.toggleProgress=function(){b()},k.toggleTimer=function(){k.isLeader()&&M.set("display",!M.get("display"))},k.select=function(e,t){var i=t.getAttribute("name");(i.search("tech")<0||P>0||"screen"===R)&&t.classList.add("highlighted")},k.zoom=function(e,t){var i=t.getAttribute("name");(i.search("tech")<0||P>0||"screen"===R)&&k.setPopup(i)},k.setPopup=function(e){var t,i={x:0,y:257},n="left",s=_.get(L)||"",a=new r,o=_.get(e);s&&(s.popup=!1,_.set(L,s)),o.popup=!0,_.set(e,o),L=e,"scenario"===e?(i.x=147,i.y=275,a.reset(h.get("scenario")[0]),a.set("type",5),t=a.toJSON()):("tech1"===e&&(i.x=467),"tech2"===e&&(i.x=186,n="right"),"tech3"===e&&(i.x=333,n="right"),B[e].get("_id")&&(t=B[e].toJSON())),t&&y.reset(t,i,n,document.getElementById("mutech-popup"))},k.closePopup=function(){var e=_.get(L);e.popup=!1,_.set(L,e),L=""},k.push=function(e,t){var i=t.getAttribute("name");t.classList.contains("drawok")?B[i].get("_id")&&"step"===R&&k.isLeader()&&t.classList.add("pushed"):t.classList.add("pushed")},k.draw=function(e,t){var i=[];k.isLeader()&&"step"===R&&D?(D=!1,["tech1","tech2","tech3"].forEach(function(e){_.get(e).selected||i.push(e)}),k.drawTech(i).then(function(){t.classList.remove("pushed"),D=!0})):t.classList.remove("pushed")},k.drawTech=function(e){var t,i=[],n=new c,s=new r({count:e.length});return e.length?(e.forEach(function(e){I.length<=0&&(I=m.get("deck").techno.concat(),["tech1","tech2","tech3"].forEach(function(e,t){_.get(e).selected&&i.push(j.get(t).id)}),I.filter(function(e){return!(i.indexOf(e)>-1)})),t=Math.floor(Math.random()*I.length),k.getCardDetails(I[t],e).then(function(){var e=s.get("count");e--,s.set("count",e)}),_.set("left",I.length),P++,I.splice(t,1)}),s.watchValue("count",function(e){e||(h.unsync(),h.sync(x,h.get("_id")).then(function(){return["tech1","tech2","tech3"].forEach(function(e,t){h.set("drawn"+e,j.get(t).id)}),h.upload()}).then(function(){n.fulfill()}))})):n.fulfill(),DRS=s,n},k.getCardDetails=function(e,t){var i=new l,n=["tech1","tech2","tech3"],s=n.indexOf(t),a=new c;return i.setTransport(A),i.sync(x,e).then(function(){B[t].reset(JSON.parse(i.toJSON())),j.update(s,"id",e),j.update(s,"title",i.get("title")),j.update(s,"pic",i.get("picture_file")),a.fulfill(),i.unsync()}),a},k.pushOk=function(e,t){var i=V[t.getAttribute("name")]||null;k.isLeader()&&"step"===R&&(i?V[t.getAttribute("name")].spin(t):V[t.getAttribute("name")]=(new p).spin(t))},k.accept=function(e,t){var i=t.getAttribute("name"),n=["tech1","tech2","tech3"],s=n.indexOf(i),a=_.get(i);"step"===R&&k.isLeader()&&(a.selected=j.get(s)&&j.get(s).id?!a.selected:!1,h.unsync(),h.sync(x,h.get("_id")).then(function(){return h.set("selected_"+i,a.selected),h.upload()}).then(function(){V[t.getAttribute("name")].stop(),_.set(i,a)}))},k.reset=function(e){var t=h.get("techno")[0];H.clear(),h.get("chat")[3]&&H.reset(h.get("chat")[3]),_.reset({left:"",scenario:{popup:!1},tech1:{popup:!1,selected:!1},tech2:{popup:!1,selected:!1},tech3:{popup:!1,selected:!1}}),e||t.length?(R="screen",H.dom.querySelector(".chatread").classList.add("extended"),k.getCardDetails(t[0],"tech1").then(function(){return k.getCardDetails(t[1],"tech2")}).then(function(){return k.getCardDetails(t[2],"tech3")}).then(function(){["tech1","tech2","tech3"].forEach(function(e){_.set(e,{popup:!1,selected:!0})}),m.set("techno",j)})):(I=[],P=0,R="step",N.reset(),O.reset(),E.reset(),j.reset([{id:"",title:"",pic:""},{id:"",title:"",pic:""},{id:"",title:"",pic:""}])),h.get("elapsedTimers").mutech&&(T=h.get("elapsedTimers").mutech,M.set("timer",T),"screen"===R?M.set("display",!0):k.isLeader()&&k.initTimer(T))},k.updateSessionScore=function(e){var t=new c,i={sid:h.get("_id"),step:"mutech",time:e,cards:P};return A.request("UpdateSessionScore",i,function(e){"ok"===e.res?t.fulfill():t.reject()}),t},k.initTimer=function(e){var t=new Date,i=t.getTime(),n=e||0;M.set("display",!1),M.set("timer",n),"mutech"===h.get("step")&&(clearInterval(w),w=setInterval(function(){var e=new Date;M.set("timer",n+e.getTime()-i)},1e3))},y=new d(k.closePopup),k.getChatUI=function(){return H},h.watchValue("chat",function(e){4===e.length&&H.getModel().get("_id")!==e[3]&&H.reset(e[3])}),m.watchValue("deck",function(e){I=e.techno.concat(),_.set("left",I.length)}),["tech1","tech2","tech3"].forEach(function(e){h.watchValue("drawn"+e,function(t){k.isLeader()||k.getCardDetails(t,e)}),h.watchValue("selected_"+e,function(t){var i;k.isLeader()||(i=_.get(e),i.selected=t,_.set(e,i),t&&m.set("techno",j))})}),k}}),define("brainstorm/multi/session/muvote",["OObject","service/map","Bind.plugin","Event.plugin","service/config","Store","lib/spin.min"],function(e,t,i,n,s,a,o){return function(){var r,l=new e,c=s.get("labels"),d=new a,u=s.get("user"),p=null,g=!1;return l.plugins.addAll({label:new i(c),model:new i(d,{setVisible:function(e){e?this.classList.remove("invisible"):this.classList.add("invisible")},setButton:function(e){e?this.setAttribute("style","display: inline-block;"):this.setAttribute("style","display:none;")},displayVote:function(e){var t=this.getAttribute("name"),i=d.get(t+"Votes"),n=this.querySelector(".yesvote"),s=this.querySelector(".novote");e?i.indexOf(u.get("_id"))>-1?s.classList.add("invisible"):n.classList.add("invisible"):(n.classList.remove("invisible"),s.classList.remove("invisible"))},setResult:function(e){this.innerHTML=e?c.get(e):""}}),event:new n(l)}),l.template='<div class = "confirm invisible"><legend><span data-label="bind:innerHTML, decidemsg"></span><span class="unanimity" data-label="bind: innerHTML, unanimity"></span></legend><div class="votingitem invisible" name="public" data-model="bind:setVisible,public; bind: displayVote, publicVote"><div class="sessionquestion" data-label="bind:innerHTML,setpublic"></div><div class = "votingbuttons" name="public"><span class="yesvote" data-label="bind:innerHTML, yeslbl" data-event="listen: mousedown, push; listen: mouseup, vote">Yes</span><span class="novote" data-label="bind:innerHTML, nolbl" data-event="listen: mousedown, push; listen: mouseup, vote">No</span></div><div class="votingresult" data-model="bind: setResult, publicResult"></div></div><div class="votingitem invisible" name = "replay" data-model="bind:setVisible,replay; bind: displayVote, replayVote"><div class="sessionquestion" data-label="bind:innerHTML,enablereplay"></div><div class = "votingbuttons" name="replay"><span class="yesvote" data-label="bind:innerHTML, yeslbl" data-event="listen: mousedown, push; listen: mouseup, vote">Yes</span><span class="novote" data-label="bind:innerHTML, nolbl" data-event="listen: mousedown, push; listen: mouseup, vote">No</span></div><div class="votingresult" data-model="bind: setResult, replayResult"></div></div><div id="muvotespinner"></div><div class="option left votebutton" data-event="listen:mousedown, press; listen:mouseup, submit" data-model="bind:setButton, submit" data-label="bind: innerHTML, submitlbl">Submit</div><div class="option right votebutton" data-event="listen:mousedown, press; listen:mouseup, skip" data-model="bind:setButton, skip" data-label="bind:innerHTML, skiplbl">Skip</div></div>',l.press=function(e,t){e.stopPropagation(),t.classList.add("pressed")},l.push=function(e,t){var i=t.parentNode,n=i.getAttribute("name");d.get(n+"Vote")||d.get(n+"Result")||t.setAttribute("style","-webkit-box-shadow: 0px 0px 2px #657B99;")},l.vote=function(e,t){var i=t.parentNode,n=i.getAttribute("name");if(t.setAttribute("style","-webkit-box-shadow: none;"),d.get("leader"))t.classList.toggle("voted"),t.classList.contains("yesvote")?t.classList.contains("voted")?(d.set(n+"Votes",[u.get("_id")]),i.querySelector(".novote").classList.remove("voted")):d.set(n+"Votes",[]):(i.querySelector(".yesvote").classList.remove("voted"),d.set(n+"Votes",[])),d.get("publicVotes").length||d.get("replayVotes").length?d.set("submit",!0):d.set("submit",!1);else if(!d.get(n+"Vote")){var s=d.get(n+"Votes");t.classList.contains("novote")?("public"===n&&d.set("publicResult","rejected"),"replay"===n&&d.set("replayResult","rejected")):(s.push(u.get("_id")),d.set(n+"Votes",s),s.length===p.get("participants").length+1&&("public"===n&&d.set("publicResult","accepted"),"replay"===n&&d.set("replayResult","accepted"))),t.classList.add("voted"),d.set(n+"Vote",!0),g?setTimeout(l.uploadVote,3e3):l.uploadVote()}},l.uploadVote=function(){var e;d.get("leader")||(e=p.get("vote"),g=!0,e.public&&(e.publicVotes=d.get("publicVotes"),e.publicResult=d.get("publicResult")),e.replay&&(e.replayVotes=d.get("replayVotes"),e.replayResult=d.get("replayResult")),p.set("vote",e),p.upload().then(function(){g=!1},function(e){console.log(e)}))},l.submit=function(e,t){var i={};t.classList.remove("pressed"),d.set("skip",!1),d.set("submit",!1),["public","replay"].forEach(function(e){d.get(e+"Votes").length?(i[e]=!0,i[e+"Votes"]=[u.get("_id")]):d.get(e+"Vote")?d.set(e+"Result","rejected"):d.set(e,!1),d.set(e+"Vote",!0)}),p.set("vote",i),p.upload().then(function(){console.log("VOTE : leader upload successful")},function(e){console.log(e)})},l.skip=function(e,t){t&&t.classList.remove("pressed"),l.close(),r({visibility:"private",replay:!1})},l.close=function(){t.get("cache").classList.remove("votingcache"),l.dom.classList.add("invisible"),p=null},l.isActive=function(){return!(null===p)},l.show=function(){t.get("cache").classList.add("votingcache"),l.dom.classList.remove("invisible")},l.reset=function(e,i){var n;p=e,r=i,d.reset({}),p.get("vote")&&d.reset(p.get("vote")),p.get("initiator").id===u.get("_id")?(d.set("leader",!0),d.set("submit",!1),d.set("skip",!0),["public","replay"].forEach(function(e){d.set(e,!0),d.set(e+"Vote",!1),d.set(e+"Votes",[]),d.set(e+"Result","")})):(d.set("leader",!1),d.set("submit",!1),d.set("skip",!1)),d.set("publicVote",!1),d.set("replayVote",!1),l.show(),n=p.watchValue("vote",function(e){var i={},s=new o({lines:10,length:8,width:4,radius:8,top:10});exitVote=function(){p.unwatch(n),s.spin(l.dom.querySelector("#muvotespinner")),setTimeout(function(){s.stop(),t.get("cache").classList.remove("votingcache"),r&&r(i)},5e3)},e&&e.public&&e.replay?(d.set("publicResult",e.publicResult),d.set("replayResult",e.replayResult),e.publicResult&&e.replayResult&&(i.visibility="accepted"===e.publicResult?"public":"private",i.replay="accepted"===e.replayResult?!0:!1,exitVote())):e&&e.public?(d.set("publicResult",e.publicResult),i.replay=!1,e.publicResult&&(i.visibility="accepted"===e.publicResult?"public":"private",i.replay=!1,exitVote())):e&&e.replay&&(d.set("replayResult",e.replayResult),i.visibility="private",e.replayResult&&(i.replay="accepted"===e.replayResult?!0:!1,exitVote()))})},l}}),define("brainstorm/multi/session/muidea",["OObject","service/map","Bind.plugin","Event.plugin","Place.plugin","service/config","service/cardpopup","../../whiteboard/whiteboard","Store","CouchDBDocument","Promise","service/utils","lib/spin.min","./mubchat","./muvote"],function(e,t,i,n,s,a,o,r,l,c,d,u,p,g,h){return function(m,v,f,b,w){var y,L,k,S,T=new e,M=new g,A=new h,C="step",x=0,q=new l({timer:null,display:!1}),H=new l({title:"",description:"",solution:"",visibility:"private"}),_=new l,I=new l([]),D=[],N={cardpopup:{scenario:!1,techs:[!1,!1,!1]},postit:"inactive","import":"inactive",drawing:"inactive",ready:!1,showidea:!1,shownext:!1,readonly:!1},O=new l(N),E=new l([]),B=new r("idea",E,O,"mu"),P=a.get("transport"),j=a.get("user"),R=a.get("db"),F=a.get("labels"),V=!1,J=new p({color:"#657B99",lines:10,length:8,width:4,radius:8,top:695,left:670}).spin();return T.isLeader=function(){return m.get("initiator")&&m.get("initiator").id===j.get("_id")},T.plugins.addAll({labels:new i(F,{setPlaceholder:function(e){this.setAttribute("placeholder",e)}}),scenario:new i(_),techs:new i(I,{setPic:function(e){var t=this;e?e.search("img/decks")>-1?this.setAttribute("style","background-image:url('"+e+"');"):(json={dir:"cards",filename:e},a.get("transport").request("GetFile",json,function(e){t.setAttribute("style","background:white; background-image: url('"+e+"'); background-repeat: no-repeat; background-position: center center; background-size:contain;")})):this.setAttribute("style","background-image: none;")}}),wbtools:new i(O,{setActive:function(e){"active"===e?this.classList.add("pushed"):this.classList.remove("pushed")},setReady:function(e){T.isLeader()?e?this.classList.remove("invisible"):this.classList.add("invisible"):this.classList.add("invisible")},showIdea:function(e){e?this.classList.remove("invisible"):this.classList.add("invisible")},toggleToolbox:function(e){e?this.classList.add("invisible"):this.classList.remove("invisible")},setReadonly:function(e){e?this.setAttribute("readonly","readonly"):this.removeAttribute("readonly")},popup:function(e){var t;"scenario"===this.getAttribute("name")?e?this.classList.add("highlighted"):this.classList.remove("highlighted"):(t=this.getAttribute("data-techs_id"),e[t]?this.classList.add("highlighted"):this.classList.remove("highlighted"))}}),muideatimer:new i(q,{setTime:function(e){this.innerHTML=u.formatDuration(e)},displayTimer:function(e){e?this.classList.add("showtimer"):this.classList.remove("showtimer")}}),idea:new i(H),wbstack:B,place:new s({chat:M,vote:A}),muideaevent:new n(T)}),T.template='<div id = "muidea"><div class="previousbutton" data-muideaevent="listen: mousedown, press; listen: mousedown, prev"></div><div class="brainstorm-header header blue-light" data-labels="bind: innerHTML, muidea" data-muideaevent="listen:mousedown, toggleProgress"></div><div class="timer" data-muideatimer="bind:setTime, timer; bind: displayTimer, display" data-muideaevent="listen:mousedown,toggleTimer"></div><div id="muidea-left"><div class="idea-cards leftarea folded" data-muideaevent="listen:mousedown, fold"><div class="card defaultscenario" name="scenario" data-muideaevent="listen: mousedown, zoom" data-wbtools="bind: popup,cardpopup.scenario"><div class="cardpicture"></div><div class="cardtitle" data-scenario="bind:innerHTML, title"></div></div><ul class="cardlist" data-techs="foreach"><li><div class="card tech" data-muideaevent="listen: mousedown, zoom" data-wbtools="bind: popup,cardpopup.techs"><div class="cardpicture" data-techs="bind:setPic, pic"></div><div class="cardtitle" data-techs="bind:innerHTML,title"></div></div></li></ul><div class="caret"></div></div><div id="muidea-popup"></div><div class ="toolbox" data-wbtools="bind:toggleToolbox, showidea"><div class="toolbox-button"><div class="postit-button" name="postit" data-wbtools="bind:setActive, postit" data-muideaevent="listen: mousedown, push; listen:mouseup, post"></div><legend data-labels="bind:innerHTML, post">Post-it</legend></div><div class="toolbox-button"><div class="importpic-button" name="import" data-wbtools="bind:setActive, import" data-muideaevent="listen: mousedown, push; listen:mouseup, importpic"></div><legend data-labels="bind:innerHTML, import">Import pictures</legend></div><div class="toolbox-button"><div class="drawingtool-button" name="drawing" data-wbtools="bind:setActive, drawing" data-muideaevent="listen: mousedown, push; listen:mouseup, draw"></div><legend data-labels="bind:innerHTML, draw">Drawing tool</legend></div><div class="finish-button invisible" data-wbtools="bind:setReady, ready" data-labels="bind:innerHTML, finishbutton" data-muideaevent="listen: mousedown, press; listen:mouseup, finish"></div></div></div><div id="muidea-right" class="workarea"><div id="idea-whiteboard" class="whiteboard"><div class="stack" data-wbstack="destination"></div><div class="caret descending invisible" data-muideaevent="listen:mousedown, toggleCaret"></div></div><div id = "muidea-writeup" class="writeup invisible" data-wbtools="bind: showIdea,showidea"><textarea class = "enterTitle" maxlength="30" data-labels="bind:setPlaceholder, ideatitleplaceholder" data-idea="bind:value, title" data-wbtools="bind:setReadonly, readonly" data-muideaevent="listen:input, updateField"></textarea><textarea class = "enterDesc" data-labels="bind:setPlaceholder, ideadescplaceholder" data-idea="bind:value, description" data-wbtools="bind:setReadonly, readonly" data-muideaevent="listen:input, updateField"></textarea><textarea class = "enterSol" data-labels="bind:setPlaceholder, ideasolplaceholder" data-idea="bind:value, solution" data-wbtools="bind:setReadonly, readonly" data-muideaevent="listen:input, updateField"></textarea></div><div class="next-button invisible" data-wbtools="bind:setReady, shownext" data-labels="bind:innerHTML, nextbutton" data-muideaevent="listen: mousedown, press; listen:mouseup, next"></div></div><div class="sessionvote" data-place="place:vote"></div><div class="sessionchat" data-place="place:chat"></div></div>',T.place(t.get("muidea")),T.press=function(e,t){t.classList.add("pressed")},T.next=function(e,t){var i,n,s,a=(new Date,new d);t.classList.add("invisible"),t.classList.remove("pressed"),"step"===C?(C="screen",O.set("readonly",!0),clearInterval(k),q.set("display",!0),clearInterval(S),i=T.getSessionDuration(),A.reset(m,function(e){V=!0,n=e.visibility,s=e.replay,H.set("visibility",n),H.set("sessionReplay",s),a.fulfill(),A.close()}),a.then(function(){return J.spin(t.parentNode),v.set("idea",JSON.parse(H.toJSON())),T.createIdeaDoc()}).then(function(){return m.unsync(),m.sync(R,m.get("_id"))}).then(function(){var e=m.get("elapsedTimers");return M.conclude("next"),e.muidea=q.get("timer"),m.set("idea",[JSON.parse(H.toJSON())]),s&&m.set("replayIdeas",[]),m.set("elapsedTimers",e),m.set("duration",i),m.set("status","completed"),m.set("idea",[v.get("idea")]),m.upload()}).then(function(){return T.updateSessionScore(q.get("timer"))}).then(function(){b("muidea")})):b("muidea")},T.stopSpinner=function(){J.stop()},T.prev=function(e,t){t.classList.remove("pressed"),f("muidea")},T.toggleProgress=function(){w()},T.toggleTimer=function(){T.isLeader()&&q.set("display",!q.get("display"))},T.toggleVisibility=function(){"step"===C&&T.isLeader()&&("public"===H.get("visibility")?H.set("visibility","private"):H.set("visibility","public"))},T.push=function(e,t){var i=t.getAttribute("name");O.set(i,"active")},T.zoom=function(e,t){var i,n;"scenario"===t.getAttribute("name")?i="scenario":(i="techno",n=t.getAttribute("data-techs_id")),T.setPopup(i,n)},T.fold=function(e,t){m.get("ideaReady")||(t.classList.toggle("folded"),t.querySelector(".caret").classList.toggle("folding"),L&&y.close())},T.setPopup=function(e,t){var i,n={x:147,y:30},s="left",o=O.get("cardpopup"),r=new l,d="";L&&("scenario"===L.type?o.scenario=!1:o.techs[L.id]=!1,O.set("cardpopup",o)),"scenario"===e?o.scenario=!0:o.techs[t]=!0,O.set("cardpopup",o),L={type:e,id:t},"scenario"===e?(n.y=55,r.reset(v.get("scenario")),r.set("type",5),d=r.toJSON(),y.reset(d,n,s,document.getElementById("muidea-popup"))):(0==t&&(n.y=200),1==t&&(n.y=260),2==t&&(n.y=350),D[t]?(d=D[t],y.reset(d,n,s,document.getElementById("muidea-popup"))):(i=new c,i.setTransport(P),i.sync(a.get("db"),v.get("techno").get(t).id).then(function(){d=i.toJSON(),y.reset(d,n,s,document.getElementById("muidea-popup")),D[t]=d})))},T.closePopup=function(){var e=O.get("cardpopup");e[L]=!1,O.set("cardpopup",e),L=""},y=new o(T.closePopup),T.getChatUI=function(){return M},T.post=function(){B.selectScreen("postit"),O.set("import","inactive"),O.set("drawing","inactive")},T.importpic=function(){B.selectScreen("import"),O.set("postit","inactive"),O.set("drawing","inactive")},T.draw=function(){B.selectScreen("drawing"),O.set("import","inactive"),O.set("postit","inactive")},T.exitTool=function(e){O.set(e,"inactive")},T.finish=function(e,t){var i=new p({color:"#657B99",lines:10,length:8,width:4,radius:8,top:550,left:50}).spin();i.spin(t.parentNode),t.classList.add("invisible"),m.unsync(),m.sync(R,m.get("_id")).then(function(){return m.set("ideaReady",!0),m.upload()}).then(function(){i.stop(),t.classList.remove("pressed"),O.set("ready",!1),T.displayIdea(),T.updateIdea()})},T.updateField=function(e,t){t.classList.contains("enterTitle")&&H.set("title",t.value),t.classList.contains("enterDesc")&&H.set("description",t.value),t.classList.contains("enterSol")&&H.set("solution",t.value)},T.displayIdea=function(){B.setReadonly(!0),O.set("showidea",!0),T.dom.querySelector(".idea-cards").classList.remove("folded"),T.dom.querySelector(".idea-cards .caret").classList.add("invisible"),T.dom.querySelector(".writeup").scrollIntoView(),T.dom.querySelector(".whiteboard .caret").classList.remove("invisible")},T.hideIdea=function(){T.dom.querySelector(".idea-cards").classList.add("folded"),T.dom.querySelector(".idea-cards .caret").classList.remove("invisible"),T.dom.querySelector(".whiteboard .caret").classList.add("invisible")
},T.toggleCaret=function(e,t){e.stopPropagation();var i=T.dom.querySelector(".writeup"),n=T.dom.querySelector(".whiteboard");t.classList.toggle("descending"),t.classList.contains("descending")?i.scrollIntoView():n.scrollIntoView()},T.toggleView=function(e,t){var i=t.querySelector(".caret"),n=T.dom.querySelector(".writeup"),s=T.dom.querySelector(".whiteboard");i.classList.contains("descending")?(i.classList.remove("descending"),s.scrollIntoView()):e.pageY-t.scrollHeight>0&&(i.classList.add("descending"),n.scrollIntoView())},T.updateIdea=function(){S=setInterval(function(){var e=m.get("idea")[0]||{title:"",description:"",solution:""},t=e.title,i=e.description,n=e.solution,s={};(H.get("title")!==t||H.get("description")!==i||H.get("solution")!==n)&&(s.title=H.get("title"),s.description=H.get("description"),s.solution=H.get("solution"),m.set("idea",[s]),m.upload().then(function(){return console.log("idea updated in CouchDB"),!0},function(e){console.log("failed to update idea",e)}))},8e3)},T.updateSessionScore=function(e){var t=new d,i={sid:m.get("_id"),step:"muidea",time:e,wbcontent:E.toJSON(),idea:H.toJSON()};return P.request("UpdateSessionScore",i,function(e){"ok"===e.res?(m.unsync(),m.sync(R,m.get("_id")).then(function(){t.fulfill()})):t.reject()}),t},T.getSessionDuration=function(){var e=m.get("elapsedTime"),t=m.get("resumeTime")||m.get("startTime");return now=new Date,now.getTime()-t+e},T.createIdeaDoc=function(){var e=new c(a.get("ideaTemplate")),t=new Date,i="I:"+t.getTime(),n=[],s=[],o=new d;return n.push(m.get("initiator").id),s.push(m.get("initiator").username),m.get("participants").forEach(function(e){n.push(e.id),s.push(e.username)}),e.setTransport(P),e.set("title",H.get("title")),e.set("sessionId",m.get("_id")),e.set("authors",n),e.set("description",H.get("description")),e.set("solution",H.get("solution")),e.set("creation_date",[t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds()]),e.set("character",m.get("characters")[0]),e.set("problem",m.get("problems")[0]),e.set("context",m.get("contexts")[0]),e.set("techno",m.get("techno")[0]),e.set("visibility",H.get("visibility")),e.set("sessionReplay",H.get("sessionReplay")),e.set("authornames",s.join(", ")),e.set("lang",m.get("lang").substring(0,2)),e.set("_id",i),e.sync(a.get("db"),i).then(function(){return e.upload()}).then(function(){"public"===e.get("visibility")&&(P.request("UpdateUIP",{userid:j.get("_id"),type:e.get("type"),docId:e.get("_id"),docTitle:e.get("title")},function(e){"ok"!==e&&console.log(e)}),m.get("participants").forEach(function(t){P.request("UpdateUIP",{userid:t.id,type:e.get("type"),docId:e.get("_id"),docTitle:e.get("title")},function(e){"ok"!==e&&console.log(t.id," "+e)})})),o.fulfill(),e.unsync()}),o},T.reset=function(e){M.clear(),m.get("chat")[4]&&M.reset(m.get("chat")[4]),O.reset({cardpopup:{scenario:!1,techs:[!1,!1,!1]},postit:"inactive","import":"inactive",drawing:"inactive",ready:!1,showidea:!1,shownext:!1,readonly:!1}),I.reset(),B.setSessionId(m.get("_id")),E.reset(m.get("ideaWB")),B.init(),E.getNbItems()?B.selectScreen("main"):B.selectScreen("default"),clearInterval(k),e||m.get("idea").length?(C="screen",M.dom.querySelector(".chatread").classList.add("extended"),O.set("ready",!1),T.displayIdea(),H.reset(m.get("idea")[0]),v.set("idea",m.get("idea")[0]),O.set("readonly",!0),O.set("shownext",!1)):(H.reset({title:"",description:"",solution:"",visibility:"private"}),E.getNbItems()?O.set("ready",!0):O.set("ready",!1),B.setReadonly(!1),C="step",V=!1),m.get("elapsedTimers").muidea&&(x=m.get("elapsedTimers").muidea,q.set("timer",x),"screen"===C?q.set("display",!0):T.isLeader()&&T.initTimer(x))},T.initTimer=function(e){var t=new Date,i=t.getTime(),n=e||0;q.set("display",!1),q.set("timer",n),"muidea"===m.get("step")&&(k=setInterval(function(){var e=new Date;q.set("timer",n+e.getTime()-i)},1e3))},m.watchValue("_id",function(e){B.setSessionId(e)}),m.watchValue("chat",function(e){5===e.length&&M.getModel().get("_id")!==e[4]&&M.reset(e[4])}),v.watchValue("scenario",function(){_.reset(v.get("scenario"))}),v.watchValue("techno",function(){I.reset(JSON.parse(v.get("techno").toJSON()))}),["added","deleted","updated"].forEach(function(e){E.watch(e,function(){O.get("showidea")||((m.get("ideaWB").length!==E.getNbItems()||JSON.stringify(m.get("ideaWB"))!==E.toJSON())&&(m.set("ideaWB",JSON.parse(E.toJSON())),m.upload().then(function(e){console.log("success : ",e)},function(e){console.log("failure : ",e)})),E.getNbItems()?O.set("ready",!0):O.set("ready",!1))})}),m.watchValue("ideaWB",function(e){"muidea"!==m.get("step")||O.get("showidea")||(e.length&&"default"===B.getStack().getCurrentName()&&B.selectScreen("main"),e.length||B.selectScreen("default"),(e.length!==E.getNbItems()||JSON.stringify(e)!==E.toJSON())&&E.reset(e))}),m.watchValue("ideaReady",function(e){"muidea"===m.get("step")&&e&&!T.isLeader()&&(O.set("readonly",!0),T.displayIdea())}),m.watchValue("idea",function(e){T.isLeader()||(H.reset(e[0]),v.set("idea",JSON.parse(H.toJSON())))}),H.watch("updated",function(){T.isLeader()&&H.get("title")&&H.get("description")&&H.get("solution")?O.set("shownext",!0):O.set("shownext",!1)}),m.watchValue("vote",function(e){!e||V||T.isLeader()||A.isActive()||(A.reset(m,function(e){e&&A.close()}),V=!0)}),T}}),define("brainstorm/multi/session/muwrapup",["OObject","service/map","Bind.plugin","Event.plugin","Place.plugin","service/config","Store","service/utils","./mubchat"],function(e,t,i,n,s,a,o,r,l){return function(c,d,u,p,g){var h,m=new e,v=new o,f=new o([]),b=a.get("labels"),w=new l;return m.plugins.addAll({labels:new i(b),wrapup:new i(v,{formatTitle:function(e){e&&(this.innerHTML=e.substring(0,1).toUpperCase()+e.substring(1).toLowerCase())},setScore:function(e){e&&(this.innerHTML=e+" ip")},setTime:function(e){e&&(this.innerHTML=r.formatDuration(e))},alertMsg:function(e){var t=this;e&&m.dom.querySelector(".sessionchat").classList.contains("folded")?h=setInterval(function(){t.classList.toggle("flashing")},300):h&&clearInterval(h)},setVisibility:function(e){e&&"public"===e?this.classList.add("publicwrapup"):this.classList.remove("publicwrapup")},setReplay:function(e){e?this.classList.remove("invisible"):this.classList.add("invisible")}}),cards:new i(f,{formatTitle:function(e){var t=this.getAttribute("data-cards_id");e&&(3>t?this.innerHTML=e.substring(0,1).toUpperCase()+e.substring(1).toLowerCase():(this.innerHTML=e.toUpperCase(),this.setAttribute("style","font-family:Helvetica;")))},setPic:function(e){var t=this;e?e.search("img/decks")>-1?this.setAttribute("style","background-image:url('"+e+"');"):(json={dir:"cards",filename:e},a.get("transport").request("GetFile",json,function(e){t.setAttribute("style","background:white; background-image: url('"+e+"'); background-repeat: no-repeat; background-position: center center; background-size:contain;")})):this.setAttribute("style","background-image: none;")}}),place:new s({chat:w}),muwrapupevent:new n(m)}),m.template='<div id = "muwrapup"><div class="previousbutton" data-muwrapupevent="listen: mousedown, press; listen: mousedown, prev"></div><div class="brainstorm-header header blue-light" data-labels="bind: innerHTML, muwrapup" data-muwrapupevent="listen:mousedown, toggleProgress"></div><div class="congrats"><div class="message"><span class="messagetitle" data-labels="bind:innerHTML, congratulations"></span><span class="sessioncompleted" data-labels="bind:innerHTML, sessioncompleted"></span></div><div class="enddeedee"></div></div><div class="summary"><div class="storysummary"><div class="storyheader" data-labels="bind:innerHTML, storytitlelbl">Your Story</div><div class="storytitle" data-wrapup="bind:formatTitle, scenario.title"></div><div class="storycontent"><p class="summaryheader" data-labels="bind:innerHTML, scenarioheader"></p><p class="content" data-wrapup="bind:innerHTML, scenario.story"></p><p class="summaryheader" data-labels="bind:innerHTML, scenariosolution"></p><p class="content" data-wrapup="bind:innerHTML, scenario.solution">solution content</p></div></div><div class="ideasummary"><div class="ideaheader" data-labels="bind:innerHTML, ideatitlelbl"></div><div class="ideatitle" data-wrapup="bind:formatTitle, idea.title"></div><div class="ideacontent"><p class="summaryheader" data-labels="bind:innerHTML, ideadescription"></p><p class="content" data-wrapup="bind:innerHTML, idea.description"></p><p class="summaryheader" data-labels="bind:innerHTML, ideaimplementation"></p><p class="content" data-wrapup="bind:innerHTML, idea.solution">solution content</p></div></div></div><div class="sessionresults"><div class ="sessiontime"><span data-labels="bind:innerHTML, yourtime"></span><span data-wrapup = "bind: setTime, duration"></span></div><div class="sessionscore"><span data-labels="bind:innerHTML, yourscore"></span><span data-wrapup="bind:setScore, score"></span></div><div class="wrapupvisibility" data-wrapup="bind:setVisibility, idea.visibility"></div><div class="wrapupreplay invisible" data-wrapup="bind:setReplay, idea.sessionReplay"></div></div><div class="exit-brainstorm" data-progressevent="listen: mousedown, press; listen:mouseup, exit"></div><div class="sessioncards" data-muwrapupevent="listen:mousedown, toggleCards"><legend>Cards used during this session</legend><ul class="cardlist" data-cards="foreach"><li class="card"><div class="cardpicture" data-cards="bind:setPic,pic"></div><div class="cardtitle" data-cards="bind: formatTitle, title"></div></li></ul></div><div class="togglechat" data-wrapup="bind:alertMsg, newmsg" data-muwrapupevent="listen: mousedown, toggleChat"></div><div class="sessionchat folded" data-place="place:chat"></div></div>',m.place(t.get("muwrapup")),m.press=function(e,t){t.classList.add("pressed")},m.next=function(e,t){t.classList.remove("pressed"),p("muwrapup")},m.exit=function(){g(!0)},m.prev=function(e,t){t.classList.remove("pressed"),u("muwrapup")},m.toggleProgress=function(){g()},m.toggleCards=function(e,t){t.classList.contains("expanded")?t.classList.remove("expanded"):t.classList.add("expanded")},m.toggleChat=function(){v.set("newmsg",!1),m.dom.querySelector(".sessionchat").classList.toggle("folded")},m.getChatUI=function(){return w},m.reset=function(e){f.reset([]),v.reset(),w.clear(),c.get("chat")[5]&&w.reset(c.get("chat")[5]).then(function(){e?(w.dom.querySelector(".chatread").classList.add("replayed"),v.set("newmsg",!1),h&&clearInterval(h)):w.getModel().watchValue("msg",function(e){e.length>1&&(v.set("newmsg",!0),setTimeout(function(){clearInterval(h)},2500))})}),v.set("scenario",d.get("scenario")),v.set("idea",d.get("idea")),v.set("score",c.get("score")),v.set("duration",c.get("duration")),f.reset([]),e?["characters","contexts","problems","techno"].forEach(function(e){d.watchValue(e,function(t){switch(e){case"characters":f.set(0,t);break;case"contexts":f.set(1,t);break;case"problems":f.set(2,t);break;case"techno":t.loop(function(e,t){f.set(t+3,e)})}})}):f.reset([d.get("characters"),d.get("contexts"),d.get("problems"),d.get("techno").get(0),d.get("techno").get(1),d.get("techno").get(2)])},d.watchValue("scenario",function(e){v.set("scenario",e)}),d.watchValue("idea",function(e){v.set("idea",e)}),c.watchValue("score",function(e){v.set("score",e)}),c.watchValue("duration",function(e){v.set("duration",e)}),c.watchValue("chat",function(e){6===e.length&&w.getModel().get("_id")!==e[5]&&(w.reset(e[5]),w.getModel().get("readonly")||w.getModel().watchValue("msg",function(e){e.length>1&&v.set("newmsg",!0)}))}),m}}),define("brainstorm/multi/session/mucontroller",["OObject","service/map","Amy/Stack-plugin","Bind.plugin","Event.plugin","./mustart","./musetup","./muscenario","./mutech","./muidea","./muwrapup","CouchDBDocument","service/config","Promise","Store","lib/spin.min","Place.plugin","service/confirm"],function(e,t,i,n,s,a,o,r,l,c,d,u,p,g,h,m,v,f){return function(t){var b,w,y,L,k,S,T,M,A=new e,C=new e,x=(document.createDocumentFragment(),new i),q=p.get("labels"),H=[{name:"mustart",label:q.get("quickstepstart"),currentStep:!1,status:"done"},{name:"musetup",label:q.get("quickstepsetup"),currentStep:!1,status:null},{name:"muscenario",label:q.get("quickstepscenario"),currentStep:!1,status:null},{name:"mutech",label:q.get("quicksteptech"),currentStep:!1,status:null},{name:"muidea",label:q.get("quickstepidea"),currentStep:!1,status:null},{name:"muwrapup",label:q.get("quickstepwrapup"),currentStep:!1,status:null}],_=new h(H),I=p.get("user"),D=p.get("db"),N=new u,O=new h,E=new h({msg:""}),B=new m({color:"#9AC9CD",lines:10,length:20,width:8,radius:15}).spin();return C.plugins.addAll({labels:new n(q),step:new n(_,{setCurrent:function(e){e?this.classList.add("pressed"):this.classList.remove("pressed")},setActive:function(e){e?this.classList.remove("inactive"):this.classList.add("inactive")}}),progressevent:new s(C)}),C.template='<div class = "progressbar invisible"><ul id = "musteplist" class="steplist" data-step="foreach"><li class="step inactive" data-step="bind: innerHTML, label; bind:setCurrent, currentStep; bind:setActive, status" data-progressevent="listen: mousedown, changeStep"></li></ul><div class="exit-brainstorm" data-progressevent="listen: mousedown, press; listen:mouseup, exit"></div></div>',C.changeStep=function(e,t){var i=t.getAttribute("data-step_id");_.get(i).status?(_.loop(function(e,t){i==t?_.update(t,"currentStep",!0):_.update(t,"currentStep",!1)}),x.getStack().show(_.get(i).name)):e.stopImmediatePropagation()},C.press=function(e,t){t.classList.add("pressed")},C.exit=function(e,i){i.classList.remove("pressed"),I.get("sessionInProgress").id!==N.get("_id")?t():"muwrapup"===N.get("step")?N.get("initiator").id===I.get("_id")?S.getChatUI().setMsg("end").then(function(){return I.set("sessionInProgress",""),I.upload()}).then(function(){t()}):(S.getChatUI().leave(),I.set("sessionInProgress",""),I.upload().then(function(){t()})):T.show()},A.template='<div id="musession"><div data-place="place:progress"></div><div class="sessionmsg invisible"> <span data-info="bind:innerHTML, msg"></div><div class="stack" data-musessionstack="destination"></div></div>',A.plugins.addAll({musessionstack:x,place:new v({progress:C}),info:new n(E)}),A.toggleProgress=function(e){e?C.exit():C.dom.classList.toggle("invisible")},A.leaveSession=function(){var e,i=N.get("participants"),n=x.getStack().get(N.get("step"));for(e=i.length-1;e>=0;e--)if(i[e].id===I.get("_id")){i.splice(e,1);break}N.set("participants",i),N.upload().then(function(){n.getChatUI().leave(),N.unsync(),T.hide(),document.body.removeChild(document.querySelector(".confirm"))}),I.set("sessionInProgress",""),I.upload().then(function(){t()})},A.cancelSession=function(){var e=5e3;A.displayInfo("deleting",e).then(function(){t()})},A.displayInfo=function(e,t){var i,n=document.querySelector(".sessionmsg"),s=new g,a=function(){n.classList.add("invisible"),clearInterval(i),E.set("msg",""),s.fulfill()};return T.hide(),document.body.removeChild(document.querySelector(".confirm")),n.classList.remove("invisible"),i=setInterval(function(){switch(e){case"deleting":E.set("msg",q.get("deletingsession")+t/1e3+"s");break;case"participantsleft":E.set("msg",q.get("participantsleft")+" "+t/1e3+"s");break;default:e!==E.get("msg")&&E.set("msg",e)}0>=t&&a(),t-=1e3},1e3),("deleting"===e||"participantsleft"===e)&&(N.set("status","deleted"),N.upload().then(function(){return I.set("sessionInProgress",""),I.upload()}).then(function(){var e=N.get("chat"),t=e.length,i=new g;return t?e.forEach(function(e){var n=new u;n.setTransport(p.get("transport")),n.sync(D,e).then(function(){return n.remove()}).then(function(){t--,0>=t&&i.fulfill})}):i.fulfill(),i}).then(function(){N.remove()})),s},A.createChat=function(e){var t,i,n=new u,s=(new Date).getTime(),a=[],o=new g;switch(a.push({username:N.get("initiator").username,userid:N.get("initiator").id}),N.get("participants").forEach(function(e){a.push({username:e.username,userid:e.id})}),n.set("users",a),e){case 1:t="quicksetup";break;case 2:t="quickscenario";break;case 3:t="quicktech";break;case 4:t="quickidea";break;case 5:t="quickwrapup";break;default:t="quickstart"}return n.set("msg",[{user:"SYS",type:5,arg:t,time:s}]),n.set("sid",N.get("_id")),n.set("lang",N.get("lang")),n.set("readonly",!1),n.set("step",e),n.set("type",17),i=n.get("sid")+"_"+e,n.setTransport(p.get("transport")),n.sync(D,i).then(function(){return n.upload()}).then(function(){var e=N.get("chat").concat();n.unsync(),e.push(i),N.set("chat",e),o.fulfill()}),o},A.retrieveSession=function(e,t){B.spin(document.getElementById("brainstorm")),N.reset({}),N.sync(D,e).then(function(){var e=N.get("step"),i=1e4;_.getNbItems(),t||(T=new f(document.body,null,null,"musession-confirm"),M=function(e){e?N.get("initiator").id===I.get("_id")?A.cancelSession():A.leaveSession():T.hide()},N.get("initiator").id===I.get("_id")?T.reset(q.get("leaderleave"),M):T.reset(q.get("participantleave"),M)),_.loop(function(n,s){i>s&&(x.getStack().get(n.name).reset(t),_.update(s,"status","done"),n.name===e&&(i=s,_.update(s,"currentStep",!0),"muwrapup"===n.name?_.update(s,"status","done"):_.update(s,"status","ongoing")))}),t?(B.stop(),x.getStack().show("muwrapup")):(B.stop(),x.getStack().show(e))})},A.reset=function(e,t){N.unsync(),O.reset(),document.querySelector(".confirm")&&document.body.removeChild(document.querySelector(".confirm")),_.reset([{name:"mustart",label:q.get("quickstepstart"),currentStep:!1,status:"done"},{name:"musetup",label:q.get("quickstepsetup"),currentStep:!1,status:null},{name:"muscenario",label:q.get("quickstepscenario"),currentStep:!1,status:null},{name:"mutech",label:q.get("quicksteptech"),currentStep:!1,status:null},{name:"muidea",label:q.get("quickstepidea"),currentStep:!1,status:null},{name:"muwrapup",label:q.get("quickstepwrapup"),currentStep:!1,status:null}]),e&&A.retrieveSession(e,t)},A.prev=function(e){var i;_.loop(function(t,n){t.name===e&&(i=n)}),i>0?(_.update(i,"currentStep",!1),_.update(i-1,"currentStep",!0),x.getStack().show(_.get(i-1).name)):(alert("Exiting session"),t())},A.next=function(e){var t,i,n=x.getStack().get(e),s="",a=new g;return _.loop(function(i,n){i.name===e&&(t=n)}),t<_.getNbItems()&&(s=_.get(t+1).name,i=x.getStack().get(s),_.update(t,"currentStep",!1),_.update(t+1,"currentStep",!0),"done"!==_.get(t).status?(_.update(t,"status","done"),_.update(t+1,"status","ongoing"),"muwrapup"===_.get(t+1).name&&_.update(t+1,"status","done"),i.reset(),A.createChat(t+1).then(function(){return N.set("step",s),N.upload()}).then(function(){i.initTimer&&i.initTimer(),n.stopSpinner(),x.getStack().show(s),"muwrapup"===s?(I.unsync(),I.sync(p.get("db"),I.get("_id")).then(function(){return I.set("sessionInProgress",""),I.upload()}).then(function(){a.fulfill()})):a.fulfill()})):(n.stopSpinner(),x.getStack().show(s),a.fulfill())),a},A.init=function(){b=new a(N,A.prev,A.next,A.toggleProgress),w=new o(N,O,A.prev,A.next,A.toggleProgress),y=new r(N,O,A.prev,A.next,A.toggleProgress),L=new l(N,O,A.prev,A.next,A.toggleProgress),k=new c(N,O,A.prev,A.next,A.toggleProgress),S=new d(N,O,A.prev,A.next,A.toggleProgress),N.setTransport(p.get("transport")),x.getStack().add("mustart",b),x.getStack().add("musetup",w),x.getStack().add("muscenario",y),x.getStack().add("mutech",L),x.getStack().add("muidea",k),x.getStack().add("muwrapup",S)},A.init(),N.watchValue("status",function(e){"deleted"===e&&N.get("initiator").id!==I.get("_id")&&(I.set("sessionInProgress",""),I.upload(),A.displayInfo(q.get("canceledbyleader"),2e3).then(function(){N.unsync(),t()}))}),N.watchValue("step",function(e){var t,i=N.get("step");N.get("initiator")&&N.get("initiator").id!==I.get("_id")&&(_.loop(function(e,n){e.name===i&&(t=n)}),_.update(t-1,"status","done"),_.update(t,"status","ongoing"),_.update(t-1,"currentStep",!1),_.update(t,"currentStep",!0),x.getStack().get(e).reset(),x.getStack().show(e)),"muwrapup"===step&&(I.unsync(),I.sync(p.get("db"),I.get("_id")).then(function(){return I.set("sessionInProgress",""),I.upload()}))}),N.watchValue("participants",function(e){0===e.length&&"muwrapup"!==N.get("step")&&A.displayInfo("participantsleft",1e4).then(function(){return I.set("sessionInProgress",""),I.upload()}).then(function(){t(),document.body.removeChild(document.querySelector(".confirm"))})}),A}}),define("brainstorm/multi/mub",["OObject","Amy/Stack-plugin","Bind.plugin","Event.plugin","CouchDBDocument","CouchDBView","service/config","Promise","Store","./mubinit","./mubwait","./session/mucontroller","lib/spin.min"],function(e,t,i,n,s,a,o,r,l,c,d,u,p){return function(i,n){var a,r,l,g=new e,h=new t,m=o.get("user");return new p({color:"#9AC9CD",lines:10,length:12,width:6,radius:10,top:328}).spin(),g.plugins.add("mustack",h),g.template='<div id="ideafy-multi"><div class="stack" data-mustack="destination"></div></div>',g.place(document.getElementById("ideafy-multi")),g.reset=function(e){e?"join"===e.mode?g.join(e.id):g.replayMUSession(e.id):(r.reset(),h.getStack().show("mubinit"))},g.replayMUSession=function(e){l.reset(e,!0),h.getStack().show("musession")},g.join=function(e){var t=new s;t.setTransport(o.get("transport")),t.sync(o.get("db"),e).then(function(){var i=t.get("participants"),n=!1;i.forEach(function(e){e.id===m.get("_id")&&(n=!0)}),n?"mustart"===t.get("step")?(a.reset(e),h.getStack().show("mubwait")):g.startSession(e):(i.push({id:m.get("_id"),username:m.get("username"),intro:m.get("intro")}),t.set("participants",i),3===i.length&&t.set("status","full"),t.upload().then(function(){a.reset(e),h.getStack().show("mubwait")},function(e){console.log(e),alert("failed to join session")}))},function(e){console.log(e),alert("failed to join session")})},g.startSession=function(e){h.getStack().show("musession"),l.reset(e)},r=new c(n),a=new d(n,g.startSession),l=new u(n),h.getStack().add("mubinit",r),h.getStack().add("mubwait",a),h.getStack().add("musession",l),i?"join"===i.mode?g.join(i.id):g.replayMUSession(i.id):h.getStack().show("mubinit"),o.get("observer").watch("start-mu_session",function(e){a.reset(e),h.getStack().show("mubwait")}),g}}),define("brainstorm/brainstorm",["OObject","service/map","service/submenu","Amy/Stack-plugin","Bind.plugin","service/config","Store","service/utils","./ideafy-menu","./quickb/quickb","./multi/mub"],function(e,t,i,n,s,a,o,r,l,c,d){return function(){var r,u=new e,p=new o,g=new n;return a.get("user"),u.plugins.addAll({brainstormstack:g,header:new s(p,{setDate:function(e){e&&(this.innerHTML=e.toLocaleDateString())},setTime:function(e){var t=e.getHours(),i=e.getMinutes(),n=e.getSeconds();10>t&&(t="0"+t),10>i&&(i="0"+i),10>n&&(n="0"+n),this.innerHTML=t+":"+i+":"+n}})}),u.template='<div id="brainstorm"><div id="brainstorm-menu"></div><div class="brainstorm-header header blue-light"><div class="date" data-header="bind: setDate, date"></div><span class="headerTitle" data-header="bind: innerHTML, headertitle"></span><div class="clock" data-header="bind: setTime, date">hh:mm</div></div><div class="stack" data-brainstormstack="destination"></div></div>',u.place(t.get("brainstorm")),u.showMenu=function(){r.toggleActive(!0)},u.hideMenu=function(){r.toggleActive(!1)},u.exitSession=function(){g.getStack().show("menu")},u.reset=function(){g.getStack().get("menu").reset(),g.getStack().show("menu")},u.selectScreen=function(e,t){if("continue"===e&&(e=t.type),"tutorial"!==e&&g.getStack().get(e))g.getStack().get(e).reset(t),g.getStack().show(e);else{switch(t?e=t.type:t=null,e){case"quick":g.getStack().add("quick",new c(t,u.exitSession));break;case"musession":g.getStack().add("musession",new d(t,u.exitSession));break;case"tutorial":a.get("observer").notify("display-tutorials");break;default:e=""}e&&g.getStack().show(e)}},r=new i(u.dom.querySelector("#brainstorm-menu")),r.toggleActive(!1),p.set("headertitle",a.get("labels").get("brainstormheadertitle")),setInterval(function(){var e=new Date;p.set("date",e)},1e3),g.getStack().add("menu",new l(u.selectScreen)),g.getStack().show("menu"),a.get("observer").watch("replay-session",function(e){var t={};t.id=e,e.toLowerCase().search("quick")>-1&&(t.type="quick"),e.toLowerCase().search("s:mu")>-1&&(t.type="musession"),u.selectScreen(t.type,t)}),a.get("observer").watch("join-musession",function(e){var t={type:"musession",id:e,mode:"join"};u.selectScreen(t.type,t)}),u}}),define("connect/contacts/addcontact",["OObject","service/config","Bind.plugin","Event.plugin","CouchDBView","Store","service/avatar","Promise","lib/spin.min"],function(e,t,n,s,a,o,r,l,c){return function(){var d=new e,u=new a,p=new o({email:"",firstname:"",lastname:"",result:"",display:!1,sentok:!1,message:"",invite:!1}),g=new o([]),h={},m=t.get("user"),v=t.get("transport"),f=t.get("labels"),b=new c({color:"#5F8F28",lines:8,length:8,width:4,radius:8,left:-20,top:-36}).spin(),w=function(e,t){var i=/^[a-z0-9._-]+@[a-z0-9.-]+\.[a-z]{2,4}$/;"email"===e?i.test(t.toLowerCase())?(p.set("result",""),y("userid",t.toLowerCase())):p.set("result",f.get("signupinvalidemail")):p.get("email")?p.set("result",f.get("clearemailfirst")):p.get("firstname")&&p.get("lastname")?(p.set("result",""),y("username",p.get("firstname").toLowerCase()+" "+p.get("lastname").toLowerCase())):p.set("result",f.get("needbothfnln"))},y=function(e,i){var n=new a;n.setTransport(v),"userid"===e?n.sync(t.get("db"),"users","_view/searchbyid",{key:'"'+i+'"',descending:!0}).then(function(){g.reset(JSON.parse(n.toJSON())),g.getNbItems()?p.set("display",!0):p.set("invite",!0),n.unsync()}):n.sync(t.get("db"),"users","_view/searchbyusername",{key:'"'+i+'"',descending:!0}).then(function(){g.reset(JSON.parse(n.toJSON())),g.getNbItems()?p.set("display",!0):p.set("result",f.get("noentryfound")),n.unsync()})},L=function(e){var t,i,n,s,a=!1,o=m.get("sentMessages")||[],r=m.get("connections"),l=!1,c=!1;if(e.userid===m.get("_id"))p.set("result",f.get("cannotaddself"));else{for(i=0,n=r.length;n>i;i++)if(r[i].userid===e.userid){c=!0;break}if(c)p.set("result",e.username+f.get("alreadyconnected"));else{for(t=0,s=o.length;s>t;t++)if("CXR"===o[t].type&&o[t].toList.search(e.username)>-1){l=!0;break}l?p.set("result",f.get("alreadysentCXR")+e.username):a=!0}}return a},k=function(e){var t=new Date,i={};L(e)&&(i.dest=[e.userid],i.type="CXR",i.status="unread",i.date=[t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds()],i.author=m.get("_id"),i.username=m.get("username"),i.firstname=m.get("firstname"),i.toList=e.username,i.ccList="",i.object=m.get("username")+f.get("CXRobject"),i.body=p.get("message"),i.signature=m.get("signature"),i.contactInfo={firstname:m.get("firstname"),lastname:m.get("lastname"),userid:m.get("_id"),username:m.get("username"),intro:m.get("intro"),type:"user"},v.request("Notify",i,function(e){var t=JSON.parse(e);"ok"===t[0].res?(p.set("result",f.get("CXRsent")),setTimeout(function(){d.reset()},2e3)):model.set("result","There was an error, please try again later")}))};return d.plugins.addAll({label:new n(f),count:new n(u),search:new n(p,{setVisible:function(e){e?this.classList.remove("invisible"):this.classList.add("invisible")},setStyle:function(e){e?this.setAttribute("style","color: #5F8F28;"):this.setAttribute("style","color: #F27B3D;")}}),contacts:new n(g,{setAvatar:function(e){_frag=document.createDocumentFragment(),_ui=new r([e]),_ui.place(_frag),this.hasChildNodes()?this.replaceChild(_frag,this.firstChild):this.appendChild(_frag)},setSelected:function(e){this.innerHTML=e?"&#10003;":""}}),searchdbevent:new s(d),invitecontactevent:new s(d)}),d.template='<div id="addcontact"><div class="header blue-dark"><span class="newcontactlbl" data-label="bind:innerHTML, newcontactlbl"></span></div><div class = "detail-contents"><div class="doctor-deedee"></div><div class="addcontactform"><p class="half"><span data-label="bind:innerHTML, beforecount"></span><strong><span data-count="bind:innerHTML, 0.value"></span></strong><span data-label="bind:innerHTML, aftercount"></span></p><p class="half" data-label="bind: innerHTML, addcontactrightintro"></p><legend data-label="bind:innerHTML, addcontactnow"></legend><input class="search" type="text" name="email" data-label="bind:placeholder, searchcontactplaceholder" data-search="bind: value, email" data-searchdbevent="listen: keypress, searchDB"><legend data-label="bind:innerHTML, lookup"></legend><div class="searchcontact"><input type="text" class="search half" name="fn" data-label="bind:placeholder, firstnameplaceholder" data-search="bind: value, firstname" data-searchdbevent="listen: keypress, searchDB"><input class="search half right" type="text" name="ln" data-label="bind: placeholder, lastnameplaceholder" data-search="bind: value, lastname" data-searchdbevent="listen: keypress, searchDB"></div><p class="searchresult" data-search="bind: innerHTML, result; bind:setStyle, sentok"></p></div><div class="contactinvite" data-search="bind: setVisible, invite"><p>The person you are looking for was not found in Ideafy. Would you like to send him/her an invitation ? You will receive 200 Ideafy Points if the person joins the community</p><div><span class="sendmail" data-label="bind:innerHTML, sendlbl" data-invitecontactevent="listen: mousedown, press; listen:mouseup, sendInvite">Accept</span><span class="cancelmail" data-label="bind:innerHTML, cancellbl" data-invitecontactevent="listen: mousedown, press; listen:mouseup, cancelInvite">Cancel</span></div></div><div class = "contactlist invisible" data-search="bind: setVisible, display"><legend data-label="bind:innerHTML, selectcontact"></legend><ul data-contacts="foreach"><li class = "contact list-item"><div data-contacts="bind:setAvatar, value.userid"></div><p class="contact-name" data-contacts="bind:innerHTML, value.username"></p><p class="contact-intro" data-contacts="bind:innerHTML, value.intro"></p><div class="select-contact" data-searchdbevent="listen:mousedown, check"></div></li></ul><textarea class="input" data-label="bind:placeholder, addamessage" data-search="bind:value, message"></textarea><div class="addcontactbtns"><div class="addct" data-searchdbevent="listen:mousedown, push; listen:mouseup, add"></div><div class="cancelct" data-searchdbevent="listen:mousedown, push; listen:mouseup, cancel"></div></div></div></div></div>',d.init=function(){var e=new l;return u.setTransport(v),u.sync(t.get("db"),"users","_view/count").then(function(){e.fulfill()}),e},d.searchDB=function(e,t){var i;13===e.keyCode&&(e.target.blur(),i=t.getAttribute("name"),w(i,t.value))},d.check=function(e,t){var i=t.getAttribute("data-contacts_id");t.innerHTML?(t.innerHTML="",h[i]=!1):(t.innerHTML="&#10003;",h[i]=!0)},d.reset=function(){p.reset({email:"",firstname:"",lastname:"",result:"",display:!1,sentok:!1,message:"",invite:!1}),g.reset([])},d.push=function(e,t){t.classList.add("pushed")},d.cancel=function(e,t){t.classList.remove("pushed"),d.reset()},d.press=function(e,t){t.classList.add("pressed")},d.cancelInvite=function(e,t){t.classList.remove("pressed"),d.reset()},d.sendInvite=function(e,t){var i={id:p.get("email").toLowerCase(),senderid:m.get("_id"),sendername:m.get("username"),subject:m.get("username")+f.get("invitesyou"),body:f.get("invitebody")};b.spin(t),v.request("Invite",i,function(e){"ok"===e&&alert(f.get("invitationsent")),"alreadyinvited"===e&&alert(f.get("alreadyinvited")),b.stop(),t.classList.remove("pressed"),d.reset()})},d.add=function(e,t){t.classList.remove("pushed");for(i in Object.keys(h))k(g.get(i).value)},d}}),define("connect/contacts/addgroup",["OObject","service/config","Bind.plugin","Event.plugin","Store","service/avatar"],function(e,t,n,s,a,o){return function(){var r=new e,c=new a({username:"",intro:"",type:"group",color:"graygroup.png",contacts:[]}),d=new a([{color:"#4D4D4D",icon:"graygroup.png",selected:!0},{color:"#657B99",icon:"bluegroup.png",selected:!1},{color:"#9AC9CD",icon:"azurgroup.png",selected:!1},{color:"#5F8F28",icon:"greengroup.png",selected:!1},{color:"#F2E520",icon:"yellowgroup.png",selected:!1},{color:"#F27B3D",icon:"orangegroup.png",selected:!1},{color:"#BD262C",icon:"redgroup.png",selected:!1}]),u=new a([]),p=new a([]),g=new a({error:""}),h=t.get("user"),m=t.get("labels");
return r.plugins.addAll({label:new n(m),error:new n(g),color:new n(d,{setColor:function(e){this.setAttribute("style","background:"+e+";")},setSelected:function(e){this.innerHTML=e?"&#10003;":""}}),group:new n(c,{setColor:function(e){this.setAttribute("style","background: url('img/connect/"+e+"') no-repeat top left; background-size: contain;")},setStyle:function(e){e?this.setAttribute("style","color: #5F8F28;"):this.setAttribute("style","color: #F27B3D;")},setVisible:function(e){e.length?this.classList.remove("invisible"):this.classList.add("invisible")}}),contacts:new n(u,{setAvatar:function(e){_frag=document.createDocumentFragment(),_ui=new o([e]),_ui.place(_frag),this.hasChildNodes()?this.replaceChild(_frag,this.firstChild):this.appendChild(_frag)},setSelected:function(e){this.innerHTML=e?"&#10003;":""}}),auto:new n(p,{highlight:function(e){e?this.classList.add("selected"):this.classList.remove("selected")}}),addgrpevent:new s(r)}),r.template='<div id="addgroup"><div class="header blue-dark"><span class="newfolderlbl" data-label="bind:innerHTML, newfolderlbl"></span></div><div class = "detail-contents"><div class="folderpic" data-group="bind: setColor, color"></div><form><p><input type="text" class="input" data-group="bind:value, username" data-label="bind:placeholder, groupnamelbl"></p><p><textarea class="input" data-group="bind:value, intro" data-label="bind:placeholder, groupdesclbl"></textarea></p><legend data-label="bind:innerHTML, colortouch"></legend><ul class="groupcolors" data-color="foreach"><li data-color="bind:setColor, color; bind:setSelected, selected" data-addgrpevent="listen: mousedown, selectColor"></li></ul></form><div class = "groupcontactlist" data-group="bind: setVisible, contacts"><legend name="list" data-label="bind:innerHTML, grpcontacts" data-addgrpevent="listen: mousedown, toggleHide"></legend><ul class="contactlistdetail" data-contacts="foreach"><li class = "contact list-item" data-addgrpevent="listen:mousedown, discardContact"><div data-contacts="bind:setAvatar, userid"></div><p class="contact-name" data-contacts="bind:innerHTML, username"></p><div class="remove-contact"></div><p class="contact-intro" data-contacts="bind:innerHTML, intro"></p></li></ul></div><div class="addgroupbtns"><span class="errormsg" data-error="bind:innerHTML, error"></span><div class="addct" data-addgrpevent="listen:mousedown, press; listen:mouseup, add"></div><div class="cancelct" data-addgrpevent="listen:mousedown, press; listen:mouseup, cancel"></div></div><div class="addgrpcontacts"><legend name="add" data-label="bind:innerHTML, addgrpcontacts" data-addgrpevent="listen: mousedown, toggleHide"></legend><div class="addgrpcontactdetails"><input class="search" data-addgrpevent="listen:keyup, updateAutoContact" data-labels="bind:placeholder, tocontactlbl"><div class = "autocontact"><ul data-auto="foreach"><li data-auto="bind:innerHTML, contact.username; bind:highlight, selected" data-addgrpevent="listen:mouseup, select"></li></ul></div></div></div></div>',r.init=function(){h.get("connections").forEach(function(e){"user"===e.type&&p.alter("push",{contact:e,selected:!1})})},r.selectColor=function(e,t){var i=t.getAttribute("data-color_id");d.loop(function(e,t){d.update(t,"selected",!1)}),d.update(i,"selected",!0),c.set("color",d.get(i).icon)},r.toggleHide=function(e,t){var i=t.getAttribute("name");t.classList.contains("hide")?(t.classList.remove("hide"),"add"===i?document.querySelector(".addgrpcontactdetails").classList.remove("invisible"):document.querySelector(".contactlistdetail").classList.remove("invisible")):(t.classList.add("hide"),"add"===i?document.querySelector(".addgrpcontactdetails").classList.add("invisible"):document.querySelector(".contactlistdetail").classList.add("invisible"))},r.select=function(e,t){var i=t.getAttribute("data-auto_id");p.get(i).selected?(r.removeContact(i),setTimeout(function(){p.update(i,"selected",!1)},200)):(r.addContact(i),setTimeout(function(){p.update(i,"selected",!0)},200))},r.addContact=function(e){var t=JSON.parse(u.toJSON()),n=p.get(e).contact,s=0;if(u.toJSON().search(n.userid)<0){for(i=0,l=t.length;l>i;i++)n.lastname>t[i].lastname?s++:n.lastname===t[i].lastname&&n.username>t[i].username&&s++;t.splice(s,0,n),u.reset(t),c.set("contacts",t)}},r.removeContact=function(e){var t=JSON.parse(u.toJSON());for(i=t.length-1;i>=0;i--)t[i].userid===p.get(e).contact.userid&&t.splice(i,1);u.reset(t)},r.updateAutoContact=function(e,t){var n,s=JSON.parse(p.toJSON()),a=h.get("connections"),o=t.value.toLowerCase();if(""===t.value)for(s=[],i=0,l=a.length;l>i;i++)"user"===a[i].type&&s.push({contact:a[i],selected:!1});else if(8===e.keyCode||46===e.keyCode){for(s=[],i=0,l=a.length;l>i;i++)"user"===a[i].type&&s.push({contact:a[i],selected:!1});for(i=s.length-1;i>=0;i--)0!==s[i].contact.username.toLowerCase().search(o)&&s.splice(i,1)}else for(i=s.length-1;i>=0;i--)n=s[i].contact.username.toLowerCase(),0!==n.search(o)&&s.splice(i,1);p.reset(s),p.loop(function(e,t){u.toJSON().search(e.contact.userid)>-1&&p.update(t,"selected",!0)})},r.discardContact=function(e,t){var i=t.getAttribute("data-contacts_id"),n=u.get(i).userid;u.alter("splice",i,1),p.loop(function(e,t){e.contact.userid===n&&setTimeout(function(){p.update(t,"selected",!1)},200)})},r.reset=function(){c.reset({username:"",intro:"",type:"group",color:"graygroup.png",contacts:[]}),u.reset([]),p.reset([]),g.reset({error:""}),h.get("connections").forEach(function(e){"user"===e.type&&p.alter("push",{contact:e,selected:!1})})},r.press=function(e,t){t.classList.add("pushed")},r.cancel=function(e,t){t.classList.remove("pushed"),r.reset(),document.querySelector("#addgroup input.search").value=""},r.add=function(e,t){var n=h.get("connections"),s=0,a=JSON.parse(c.toJSON());if(t.classList.remove("pushed"),g.set("error",""),""===a.username)g.set("error",m.get("nogrpname"));else if(""===a.intro)g.set("error",m.get("nogrpintro"));else if(a.contacts.length){for(i=0,l=n.length;l>i;i++)"user"===n[i].type?a.username>n[i].lastname&&s++:(a.username===n[i].username&&g.set("error",m.get("grpnameexists")),a.username>n[i].username&&s++);g.get("error")||(n.splice(s,0,a),h.set("connections",n),h.upload().then(function(){r.reset()}))}else g.set("error",m.get("nocontactselected"))},r}}),define("connect/contacts/contact-detail",["OObject","service/config","service/map","Store","Bind.plugin","Event.plugin","service/avatar","service/utils"],function(e,t,n,s,a,o,r,l){return function(){var c=new e,d=new s,u=new s,p=new s([]),g=new s([]),h=t.get("labels"),m=t.get("user");return t.get("transport"),c.plugins.addAll({label:new a(h),basicinfo:new a(u,{setAvatar:function(e){var t=document.createDocumentFragment(),i=new r([e]);i.place(t),this.hasChildNodes()?this.replaceChild(t,this.firstChild):this.appendChild(t)}}),ctdetails:new a(d),grades:new a(p,{showBadge:function(e){this.setAttribute("style","background: url('img/profile/"+e+"') no-repeat center center; background-size: cover;")}}),achievements:new a(g,{showBadge:function(e){this.setAttribute("style","background: url('img/profile/"+e+"') no-repeat center center; background-size: cover;")}}),ctdetailsevent:new o(c)}),c.template='<div id = "contactdetails"><div class="header blue-dark"><span class="subjectlbl" data-details="bind:innerHTML, username"></span></div><div class = "detail-contents"><div class = "contactessentials"><div class="avatar" data-basicinfo="bind:setAvatar, userid"></div><div class="basicinfo"><h2 data-basicinfo="bind:innerHTML,username"></h2><p data-basicinfo="bind:innerHTML, intro"></p></div><div class="contactdashboard"><div class="contactstats"><legend data-label="bind:innerHTML, stats"></legend><div class="userscore"><span class="ip" data-ctdetails="bind:innerHTML, ip"></span><span data-label="bind:innerHTML, ideafypoints"></span></div><table><tr class ="myids"><th data-label="bind:innerHTML, ideaslbl"></th><td data-ctdetails="bind: innerHTML, ideas_count"></td></tr><tr class ="myss"><th data-label="bind:innerHTML, sessionslbl"></th><td data-ctdetails="bind: innerHTML, sessions"></td></tr><tr class="myctcts"><th data-label="bind:innerHTML, contactslbl"></th><td data-ctdetails="bind: innerHTML, contacts"></td></tr><tr class="my2q"><th data-label="bind:innerHTML, toquestionslbl"></th><td data-ctdetails="bind: innerHTML, twoquestions_count"></td></tr></table></div><div class="contactbadges"><legend data-label="bind:innerHTML, achievements"></legend><p class="grade" data-stats="bind:innerHTML, title"></p><ul class="badges" data-grades="foreach"><li class="contactbadge"><div data-grades="bind:showBadge, badge"></div><label data-grades="bind:innerHTML, title"></label></li></ul><ul class="badges" data-achievements="foreach"><li class="contactbadge"><div data-achievements="bind:showBadge, badge"></div><label data-achievements="bind:innerHTML, label"></label></li></ul></div></div></div></div><div class = "contactnotes"><legend data-label="bind: innerHTML, mynotes"></legend><div id = "cancelnotes" class="invisible" data-ctdetailsevent="listen:mousedown, push; listen:mouseup, cancelNotes"></div><div id = "uploadnotes" class="invisible" data-ctdetailsevent="listen:mousedown, push;listen:mouseup, uploadNotes"></div><textarea id="ctnotes" class = "input" data-label="bind:placeholder,writesomething" data-basicinfo="bind: value, notes" data-ctdetailsevent="listen:input, displayNoteBtns"></textarea></div></div></div>',c.place(n.get("contactdetails")),c.updateContact=function(e){var t,i,n,s=m.get("connections"),a=s.length;for(t=0;a>t;t++)if(s[t].userid===e._id&&(s[t].username=e.username,s[t].firstname=e.firstname,s[t].lastname=e.lastname,s[t].intro=e.intro),"group"===s[t].type){for(i=s[t].contacts,n=0;n<i.length;n++)i[n].userid===e._id&&(i[n].username=e.username,i[n].firstname=e.firstname,i[n].lastname=e.lastname,i[n].intro=e.intro);s[t].contacts=i}m.set("connections",s),m.upload()},c.getUserInfo=function(e){l.getUserDetails(e,function(e){(e.username!==u.get("username")||e.firstname!==u.get("firstname")||e.lastname!==u.get("lastname")||e.intro!==u.get("intro"))&&c.updateContact(e),d.reset(e),d.set("sessions",d.get("su_sessions_count")+d.get("mu_sessions_count")),l.getGrade(e.ip,function(e){p.alter("push",e.grade),e.distinction&&p.alter("push",e.distinction)}),g.reset(e.achievements)})},c.reset=function(e){u.reset(e),p.reset([]),g.reset([]),u.get("notes")||u.set("notes",""),c.getUserInfo(e.userid)},c.displayNoteBtns=function(){document.getElementById("uploadnotes").classList.remove("invisible"),document.getElementById("cancelnotes").classList.remove("invisible")},c.hideNoteBtns=function(){document.getElementById("uploadnotes").classList.add("invisible"),document.getElementById("cancelnotes").classList.add("invisible")},c.push=function(e,t){t.classList.add("pushed")},c.uploadNotes=function(e,t){var i,n,s,a=m.get("connections"),o=a.length;for(document.getElementById("uploadnotes"),document.getElementById("cancelnotes"),i=0;o>i;i++)if(a[i].userid===u.get("userid")&&(a[i].notes=u.get("notes")),"group"===a[i].type){for(n=a[i].contacts,s=0;s<n.length;s++)n[s].userid===u.get("userid")&&(n[s].notes=u.get("notes"));a[i].contacts=n}m.set("connections",a),m.upload().then(function(){t.classList.remove("pushed"),c.hideNoteBtns()})},c.cancelNotes=function(e,t){var n=m.get("connections"),s=n.length;for(i=0;s>i;i++)n[i].userid===u.get("userid")&&u.set("notes",n[i].notes);t.classList.add("pushed"),c.hideNoteBtns()},c}}),define("connect/contacts/group-detail",["OObject","service/config","Bind.plugin","Event.plugin","Store","service/avatar"],function(e,t,n,s,a,o){return function(){var r,c=new e,d=new a,u=new a([]),p=[{color:"#4D4D4D",icon:"graygroup.png",selected:!1},{color:"#657B99",icon:"bluegroup.png",selected:!1},{color:"#9AC9CD",icon:"azurgroup.png",selected:!1},{color:"#5F8F28",icon:"greengroup.png",selected:!1},{color:"#F2E520",icon:"yellowgroup.png",selected:!1},{color:"#F27B3D",icon:"orangegroup.png",selected:!1},{color:"#BD262C",icon:"redgroup.png",selected:!1}],g=new a(p),h=new a([]),m=new a({error:""}),v=t.get("user"),f=t.get("labels");return c.template='<div id="groupdetails"><div class="header blue-dark"><span class="newfolderlbl" data-group="bind:innerHTML, username"></span></div><div class = "detail-contents"><div class="folderpic" data-group="bind: setColor, color"></div><form><p><input type="text" class="input" data-group="bind:value, username" data-label="bind:placeholder, groupnamelbl"></p><p><textarea class="input" data-group="bind:value, intro" data-label="bind:placeholder, groupdesclbl"></textarea></p><legend data-label="bind:innerHTML, colortouch"></legend><ul class="groupcolors" data-color="foreach"><li data-color="bind:setColor, color; bind:setSelected, selected" data-grpdetailsevent="listen: mousedown, selectColor"></li></ul></form><div class = "grpcontactlist" data-group="bind: setVisible, contacts"><legend name="list" data-label="bind:innerHTML, grpcontacts" data-grpdetailsevent="listen: mousedown, toggleHide"></legend><ul class="contactlistdetail" data-grpcontacts="foreach"><li class = "contact list-item" data-grpdetailsevent="listen:mousedown, discardContact"><div data-grpcontacts="bind:setAvatar, userid"></div><p class="contact-name" data-grpcontacts="bind:innerHTML, username"></p><div class="remove-contact"></div><p class="contact-intro" data-grpcontacts="bind:innerHTML, intro"></p></li></ul></div><p class="update"><label class="cancelmail" data-label="bind:innerHTML, cancellbl" data-grpdetailsevent="listen: mousedown, press; listen:mouseup, cancel">Cancel</label><label class="sendmail" data-label="bind:innerHTML, updatelbl" data-grpdetailsevent="listen:mousedown, press; listen:mouseup, updateGroup"></label><label class="editerror" data-error="bind:innerHTML, error"></label><div class="addgrpcontacts"><legend name="add" data-label="bind:innerHTML, addgrpcontacts" data-grpdetailsevent="listen: mousedown, toggleHide"></legend><div class="addgrpcontactdetails"><input class="search" data-grpdetailsevent="listen:keyup, updateAutoContact" data-label="bind:placeholder, tocontactlbl"><div class = "autocontact"><ul data-auto="foreach"><li data-auto="bind:innerHTML, contact.username; bind:highlight, selected" data-grpdetailsevent="listen:mouseup, select"></li></ul></div></div></div></div>',c.plugins.addAll({label:new n(f),error:new n(m),color:new n(g,{setColor:function(e){this.setAttribute("style","background:"+e+";")},setSelected:function(e){this.innerHTML=e?"&#10003;":""}}),group:new n(d,{setColor:function(e){this.setAttribute("style","background: url('img/connect/"+e+"') no-repeat top left; background-size: contain;")},setStyle:function(e){e?this.setAttribute("style","color: #5F8F28;"):this.setAttribute("style","color: #F27B3D;")},setVisible:function(e){e.length?this.classList.remove("invisible"):this.classList.add("invisible")}}),grpcontacts:new n(u,{setAvatar:function(e){e&&(_frag=document.createDocumentFragment(),_ui=new o([e]),_ui.place(_frag),this.hasChildNodes()?this.replaceChild(_frag,this.firstChild):this.appendChild(_frag))},setSelected:function(e){this.innerHTML=e?"&#10003;":""}}),auto:new n(h,{highlight:function(e){e?this.classList.add("selected"):this.classList.remove("selected")}}),grpdetailsevent:new s(c)}),c.selectColor=function(e,t){var i=t.getAttribute("data-color_id");g.loop(function(e,t){g.update(t,"selected",!1)}),g.update(i,"selected",!0),d.set("color",g.get(i).icon)},c.toggleHide=function(e,t){var i=t.getAttribute("name");t.classList.contains("hide")?(t.classList.remove("hide"),"add"===i?document.querySelector(".addgrpcontactdetails").classList.remove("invisible"):document.querySelector(".contactlistdetail").classList.remove("invisible")):(t.classList.add("hide"),"add"===i?document.querySelector(".addgrpcontactdetails").classList.add("invisible"):document.querySelector(".contactlistdetail").classList.add("invisible"))},c.select=function(e,t){var i=t.getAttribute("data-auto_id");h.get(i).selected?(c.removeContact(i),setTimeout(function(){h.update(i,"selected",!1)},200)):(c.addContact(i),setTimeout(function(){h.update(i,"selected",!0)},200))},c.addContact=function(e){var t=JSON.parse(u.toJSON()),n=h.get(e).contact,s=0;if(u.toJSON().search(n.userid)<0){for(i=0,l=t.length;l>i;i++)n.lastname>t[i].lastname?s++:n.lastname===t[i].lastname&&n.username>t[i].username&&s++;t.splice(s,0,n),u.reset(t),d.set("contacts",t)}},c.removeContact=function(e){var t=JSON.parse(u.toJSON());for(i=t.length-1;i>=0;i--)t[i].userid===h.get(e).contact.userid&&t.splice(i,1);u.reset(t),d.set("contacts",t)},c.updateAutoContact=function(e,t){var n=JSON.parse(h.toJSON()),s=v.get("connections");if(""===t.value)for(n=[],i=0,l=s.length;l>i;i++)"user"===s[i].type&&n.push({contact:s[i],selected:!1});else if(8===e.keyCode||46===e.keyCode){for(n=[],i=0,l=s.length;l>i;i++)"user"===s[i].type&&n.push({contact:s[i],selected:!1});for(i=n.length-1;i>=0;i--)0!==n[i].contact.username.search(t.value)&&n.splice(i,1)}else for(i=n.length-1;i>=0;i--)0!==n[i].contact.username.search(t.value)&&n.splice(i,1);h.reset(n),h.loop(function(e,t){u.toJSON().search(e.contact.userid)>-1&&h.update(t,"selected",!0)})},c.discardContact=function(e,t){var i=t.getAttribute("data-grpcontacts_id"),n=u.get(i).userid;u.alter("splice",i,1),h.loop(function(e,t){e.contact.userid===n&&setTimeout(function(){h.update(t,"selected",!1)},200)}),d.set("contacts",JSON.parse(u.toJSON()))},c.press=function(e,t){t.classList.add("pressed")},c.cancel=function(e,t){t.classList.remove("pressed"),c.reset(r),document.querySelector("#groupdetails input.search").value=""},c.updateGroup=function(e,t){var i,n=v.get("connections"),s=JSON.parse(d.toJSON());if(t.classList.remove("pressed"),m.set("error",""),""===s.username)m.set("error",f.get("nogrpname"));else if(""===s.intro)m.set("error",f.get("nogrpintro"));else if(s.contacts.length)for(i=n.length-1;i>=0;i--)"group"===n[i].type&&n[i].username===r.username&&(m.get("error")||(n.splice(i,1,s),v.set("connections",n),v.upload().then(function(){c.reset(s),m.set("error",f.get("groupupdated"))})));else m.set("error",f.get("nocontactselected"))},c.reset=function(e){g.reset(p),g.loop(function(t,i){t.icon===e.color?g.update(i,"selected",!0):g.update(i,"selected",!1)}),d.reset(e),r=e,u.reset(e.contacts),h.reset([]),m.reset({error:""}),v.get("connections").forEach(function(e){"user"===e.type&&h.alter("push",{contact:e,selected:!1})}),h.loop(function(e,t){u.toJSON().search(e.contact.userid)>-1&&h.update(t,"selected",!0)})},c.init=function(){v.get("connections").forEach(function(e){"user"===e.type&&h.alter("push",{contact:e,selected:!1})})},c}}),define("connect/contacts/contacts",["OObject","service/map","service/config","Amy/Stack-plugin","Bind.plugin","Event.plugin","Amy/Control-plugin","Store","service/avatar","service/actionbar","./addcontact","./addgroup","./contact-detail","./group-detail"],function(e,t,n,s,a,o,r,c,d,u,p,g,h,m){return function(){var v=new e,f=new s,b=new p,w=new g,y=new h,L=new m,k=new c([{name:"all",label:"allbtn",selected:!0},{name:"users",label:"usrbtn",selected:!1},{name:"groups",label:"grpbtn",selected:!1}]),S=0,T=new c([]),M=null,A=n.get("user"),C=n.get("labels"),x=function(e){var t=k.get(e).name,n=A.get("connections"),s=n.length,a=[];switch(t){case"users":for(i=0;s>i;i++)"user"===n[i].type&&a.push(n[i]);break;case"groups":for(i=0;s>i;i++)"group"===n[i].type&&a.push(n[i]);break;default:a=n}return a},q=function(e){var t=[],n=[];if(t=A.get("connections").concat(),""===e)n=t,k.update(0,"selected",!0),S=0;else for(i=0,l=t.length;l>i;i++)JSON.stringify(t[i]).toLowerCase().search(e.toLowerCase())>-1&&n.push(t[i]);return n};return v.plugins.addAll({label:new a(C),sort:new a(k,{setLabel:function(e){this.innerHTML=C.get(e)},setSelected:function(e){e?this.classList.add("pressed"):this.classList.remove("pressed")}}),contact:new a(T,{setAvatar:function(e){var t,i,n=this.getAttribute("data-contact_id");"group"===e?(this.hasChildNodes()&&this.removeChild(this.firstChild),this.setAttribute("style","background: url('img/connect/"+T.get(n).color+"') no-repeat center center; background-size: contain;display:block; width:40px; height:40px;float:left;")):"user"===e&&(this.setAttribute("style","background:none;"),t=document.createDocumentFragment(),i=new d([T.get(n).userid]),i.place(t),this.hasChildNodes()?this.replaceChild(t,this.firstChild):this.appendChild(t))},setIntro:function(e){this.innerHTML=e?e:" "}}),contactdetailstack:f,contactlistcontrol:new r(v),contactlistevent:new o(v)}),v.template='<div id="connect-contacts"><div class="contacts"><div class="header blue-light"><span data-label="bind: innerHTML, contactlistheadertitle">My Contacts</span><div class="option right" data-contactlistevent="listen: mousedown, plus"></div></div><ul class="selectors" data-sort = "foreach"><li class="sort-button" data-sort="bind: setLabel, label; bind:setSelected, selected, bind: name, name" data-contactlistevent="listen:mousedown, displaySort"></li></ul><input class="search" type="text" data-label="bind: placeholder, searchmsgplaceholder" data-contactlistevent="listen: keypress, search"><div class="contactlist overflow" data-contactlistcontrol="radio:li,selected,mousedown,selectContact"><ul data-contact="foreach"><li class="contact list-item" data-contactlistevent="listen:mousedown, setStart; listen:dblclick, showActionBar"><div data-contact="bind:setAvatar, type"></div><p class="contact-name" data-contact="bind:innerHTML, username"></p><p class="contact-intro" data-contact="bind:setIntro, intro"></p><div class="select-contact"></div></li></ul></div></div><div id="toggleadd" class="group" data-contactlistevent="listen:mousedown, press; listen:mouseup, toggleAddUI"></div><div id="contact-detail" class="details" data-contactdetailstack="destination"></div></div>',v.place(t.get("connect-contacts")),v.plus=function(){var e=document.getElementById("toggleadd");f.getStack().get("#addcontact").reset(),f.getStack().show("#addcontact"),e.classList.contains("user")&&e.classList.remove("user"),e.classList.add("group")},v.init=function(){T.reset(A.get("connections")),b.init().then(function(){f.getStack().show("#addcontact")}),w.init(),L.init()},v.reset=function(){T.reset(A.get("connections")),b.reset(),f.getStack().show("#addcontact")},v.getSelectedContact=function(){var e=document.querySelector(".contact.selected"),t=-1;return e&&(t=e.getAttribute("data-contact_id")),t},v.selectContact=function(e){var t=e.target.getAttribute("data-contact_id"),i=T.get(t);document.getElementById("toggleadd").classList.remove("group"),document.getElementById("toggleadd").classList.remove("user"),"user"===i.type?(y.reset(T.get(t)),"#contactdetails"!==f.getStack().getCurrentName()&&f.getStack().show("#contactdetails")):(L.reset(T.get(t)),"#groupdetails"!==f.getStack().getCurrentName()&&f.getStack().show("#groupdetails"))},v.displaySort=function(e,t){var i=t.getAttribute("data-sort_id");T.reset([]),S>-1&&k.update(S,"selected",!1),k.update(i,"selected",!0),S=i,T.reset(x(i))},v.search=function(e,t){13===e.keyCode&&(k.update(S,"selected",!1),S=-1,T.reset(q(t.value)))},v.setStart=function(){M&&M.hide()},v.showActionBar=function(e,t){var i,n=t.getAttribute("data-contact_id"),s=!1;M&&M.getParent()===t&&(s=!0),s||(M=new u("contact",t,T.get(n)),i=document.createDocumentFragment(),M.place(i),t.appendChild(i),s=!0)},v.press=function(e,t){t.classList.add("pressed")},v.toggleAddUI=function(e,t){t.classList.remove("pressed"),t.classList.contains("group")?(t.classList.remove("group"),f.getStack().get("#addgroup").reset(),f.getStack().show("#addgroup"),t.classList.add("user")):(t.classList.remove("user"),f.getStack().get("#addcontact").reset(),f.getStack().show("#addcontact"),t.classList.add("group"))},f.getStack().add("#contactdetails",y),f.getStack().add("#groupdetails",L),f.getStack().add("#addcontact",b),f.getStack().add("#addgroup",w),w.init(),v.init(),A.watchValue("connections",function(){var e;S>-1&&T.reset(x(S)),"#contactdetails"===f.getStack().getCurrentName()&&(e=v.getSelectedContact(),e>-1?(contactDetail.reset(T.get(e)),f.getStack().show("#contactdetails")):(f.getStack().show("#addcontact"),document.getElementById("toggleadd").classList.add("group")))}),n.get("observer").watch("contact-deleted",function(){f.getStack().show("#addcontact")}),A.watchValue("lang",function(){var e;k.loop(function(t,i){t.selected&&(e=i)}),k.reset([{name:"all",label:"allbtn",selected:!1},{name:"users",label:"usrbtn",selected:!1},{name:"groups",label:"grpbtn",selected:!1}]),k.update(e,"selected",!0)}),v}}),define("connect/messages/message-reply",["OObject","Store","Bind.plugin","Event.plugin","service/config","service/utils","Promise","service/autocontact"],function(e,t,n,s,a,o,r,c){return function(){var d,u=new e,p=new t,g={},h=new t({errormsg:""}),m=a.get("labels"),v=a.get("user"),f=a.get("transport"),b=!1,w=function(e){var t=p.get("toList").toLowerCase().split(/,|;/),n=p.get("ccList").toLowerCase().split(/,|;/),s=JSON.stringify(v.get("connections")).toLowerCase(),a=[],o={},c=new r;for(arr=[],i=0,l=t.length;l>i;i++){if(!(s.search(t[i].trim())>-1||d.toList.search(t[i].trim())>-1||d.ccList.search(t[i].trim())>-1)){h.set("errormsg",m.get("tolbl")+" : "+t[i].trim()+m.get("notavalidcontact")),b=!1,c.reject();break}a.push(t[i].trim())}if(!h.get("errormsg")&&""!==n[0])for(i=0,l=n.length;l>i;i++){if(!(s.search(n[i].trim())>-1||d.toList.search(n[i].trim())>-1||d.ccList.search(n[i].trim())>-1)){h.set("errormsg",m.get("tolbl")+" : "+n[i].trim()+m.get("notavalidcontact")),b=!1,c.reject();break}a.push(n[i].trim())}return h.get("errormsg")||(o.list=a,f.request("CheckRecipientList",o,function(t){var n=[];if(t.error)h.set("errormsg",t.error),c.reject();else{for(i=0,l=t.length;l>i;i++)n.push(t[i].value);e(n),c.fulfill()}})),c};return u.plugins.addAll({labels:new n(m),errormsg:new n(h),reply:new n(p,{setAvatar:function(){this.setAttribute("style","background: url('"+a.get("avatar")+"') no-repeat center center;background-size:cover;")},setCC:function(e){switch(e){case"replyall":break;case"forward":break;default:this.innerHTML=p.get("message").username}},setSubject:function(e){switch(e){case"replyall":break;case"forward":break;default:this.innerHTML="  Re : "+p.get("message").object}}}),replyevent:new s(u)}),u.template='<div><div class="avatar" data-reply="bind: setAvatar, message.author"></div><form class="form"><p><textarea name="toList" class="mail-header" data-labels="bind:placeholder, tocontactlbl" data-reply="bind: value, toList" data-replyevent="listen: mousedown, displayAutoContact; listen:keypress, updateAutoContact"></textarea></p><div id="tolistauto" class="invisible"></div><p><textarea name="ccList" class="mail-header" data-labels="bind:placeholder, cclbl" data-reply="bind: value, ccList" data-replyevent="listen: mousedown, displayAutoContact; listen:keypress, updateAutoContact"></textarea></p><div id="cclistauto" class="invisible"></div><p><span class="subject" data-labels="bind:innerHTML, subjectlbl"></span><span data-reply="bind:innerHTML, object"></span></p><p><textarea class="input" data-reply="bind:value, body"></textarea></p><blockquote class="original" data-reply="bind:innerHTML, original"></blockquote><p><legend>Signature</legend><textarea class="signature" data-reply="bind:value, signature"></textarea></p><div class="sendmail-footer"><p class="send"><label class="cancelmail" data-labels="bind:innerHTML, cancellbl" data-replyevent="listen: mousedown, press; listen:mouseup, cancel">Cancel</label><label class="sendmail" data-labels="bind:innerHTML, sendlbl" data-replyevent="listen:mousedown, press; listen:mouseup, send">Send</label><label class="editerror" data-errormsg="bind:innerHTML, errormsg"></label></p></div></div>',u.reset=function(e,t){switch(d=e,p.reset({signature:"",original:"",author:v.get("_id"),username:v.get("username"),firstname:v.get("firstname"),toList:"",ccList:"",object:"",body:""}),p.set("type",t),v.get("signature")?p.set("signature",v.get("signature")):p.set("signature",v.get("username")),p.set("original",m.get("on")+o.formatDate(e.date)+"</p><p>"+e.username+m.get("ideawrotelbl")+"</p><p>"+m.get("subjectlbl")+e.object+"</p><hr><p>"+e.body+"</p>"),t){case"replyall":e.ccList?p.set("toList",e.username.concat(", "+e.ccList)):p.set("toList",e.username),0!==e.object.search("Re :")?p.set("object","Re : "+e.object):p.set("object",e.object);break;case"forward":p.set("toList",""),0!==e.object.search("Fwd :")?p.set("object","Fwd : "+e.object):p.set("object",e.object);break;default:p.set("toList",e.username),0!==e.object.search("Re :")?p.set("object","Re : "+e.object):p.set("object",e.object)}p.set("message",e),u.place(document.getElementById("msgreply"))},u.displayAutoContact=function(e,t){var i,n,s=t.getAttribute("name"),a=function(e){p.set(s,e)};i="toList"===s?document.getElementById("tolistauto"):document.getElementById("cclistauto"),n=new c(i,t,a),g.name=n,i.classList.remove("invisible")},u.updateAutoContact=function(e,t){t.getAttribute("name"),13===e.keyCode?t.removeChild(t.firstChild):186===e.keyCode||188===e.keyCode?g.name.init():g.name.updateList()},u.press=function(e,t){t.classList.add("pressed")},u.cancel=function(e,t){t.classList.remove("pressed"),b=!1,document.getElementById("msgreply").classList.add("invisible")},u.send=function(e,t){var i=new Date,n={};t.classList.remove("pressed"),b||(b=!0,h.set("errormsg",""),n=JSON.parse(p.toJSON()),n.type="MSG",n.body=n.body.concat("<br><br>"+n.original),n.dest=[],w(function(e){n.dest=e}).then(function(){h.get("errormsg")?(console.log(result),b=!1):(n.date=[i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds()],f.request("Notify",n,function(){b=!1,h.set("errormsg",m.get("messagesentok")),setTimeout(function(){h.set("errormsg",""),b=!1,document.getElementById("msgreply").classList.add("invisible")},2e3)}))}))},u}}),define("connect/messages/message-detail",["OObject","service/config","Store","CouchDBDocument","Bind.plugin","Event.plugin","service/avatar","service/utils","./message-reply"],function(e,t,n,s,a,o,r,c,d){return function(u){var p=new e,g=new d,h=new n,m=new n({response:""}),v=t.get("labels"),f=t.get("user"),b=t.get("observer"),w=t.get("transport");return p.template='<div id="msgdetail"><div class="header blue-dark"><span class="subjectlbl" data-label="bind:innerHTML, subjectlbl"></span><span data-message="bind:setObject, type"></span></div><div class="msgdetailarea"><div class = "detail-contents"><div class="detail-header"><div class="msgoptions" data-message="bind: showOptions, type"><div class="defaultmsgoption"><div name="reply" class="msgreply" data-messageevent="listen:mousedown, press; listen:mouseup, action"></div><div name="more" class="more" data-messageevent="listen:mousedown, press; listen:mouseup, action"></div></div><div class="msgoptionlist invisible"><div name="replyall" class="replyall sort-button" data-label="bind:innerHTML, replyalllbl" data-messageevent="listen:mousedown, press; listen:mouseup, action"></div><div name="forward" class="forward sort-button" data-label="bind:innerHTML, forwardlbl" data-messageevent="listen:mousedown, press; listen:mouseup, action"></div><div name="deletemsg" class="deletemsg sort-button" data-label="bind:innerHTML, deletelbl" data-messageevent="listen:mousedown, press; listen:mouseup, action"></div></div></div><div data-message="bind:setAvatar, author"></div><p data-message="bind:innerHTML, username"></p><p class="toList"><span data-label="bind: innerHTML, tolbl"></span><span data-message="bind: setToList, toList"></span></p><p class="toList invisible" data-message="bind:showCcList, ccList"><span data-label="bind: innerHTML, cclbl"></span><span data-message="bind: innerHTML, ccList"></span></p><p class="msgdate"><span class="date" data-message="bind: date, date"></span></p></div><div class="detail-body"><p data-message="bind:setBody, type"></p><p data-message="bind:setSignature, type"></p><p class="invisible" data-message="bind:setJoinMsg, sessionStatus"></p><div class="showdoc" data-message="bind: showDocBtn, type" data-messageevent="listen:mousedown, press; listen:mouseup, showDoc"></div><div class="gotosession invisible" data-message="bind: showSessionBtn, sessionStatus" data-messageevent="listen:mousedown, press; listen:mouseup, gotoSession"></div><div class="goto2q invisible" data-message = "bind: showTwoQ, type" data-messageevent="listen: mousedown, press; listen: mouseup, showTwoQ"></div><div class="acceptrejectCXR invisible" data-message="bind:showCXRbtn, type"><div class="acceptCXR" data-label="bind:innerHTML, accept" data-messageevent="listen:mousedown, press; listen:mouseup, acceptCXR"></div><div class="rejectCXR" data-label="bind:innerHTML, reject" data-messageevent="listen:mousedown, press; listen:mouseup, rejectCXR"></div></div></div></div><div id="msgreply" class="invisible"></div><div id="CXRconfirm" class="invisible" data-cxr="bind:setVisibility, response"><span class="CXRconfirmed" data-cxr="bind:setResponseMessage, response"></span></div></div></div>',p.plugins.addAll({label:new a(v),message:new a(h,{date:function y(y){var e=new Date,t=y[3],i=y[4],n=y[5];
y&&y[0]===e.getFullYear()&&y[1]===e.getMonth()&&y[2]===e.getDate()?(10>t&&(t="0"+t),10>i&&(i="0"+i),10>n&&(n="0"+n),this.innerHTML=t+":"+i+":"+n):this.innerHTML=c.formatDate(y)+"  "+t+":"+i},setObject:function(e){switch(e){case"CXR":this.innerHTML=h.get("username")+v.get("CXRobject");break;case"INV":this.innerHTML=h.get("username")+v.get("INVObject");break;case"CXRaccept":this.innerHTML=h.get("username")+v.get("acceptedCXR");break;case"CXRreject":this.innerHTML=h.get("username")+v.get("rejectedCXR");break;case"CXCancel":this.innerHTML=h.get("username")+v.get("canceledCX");break;case"DOC":this.innerHTML=h.get("username")+v.get("sentdocmsg");break;case"2Q+":this.innerHTML=h.get("username")+v.get("askednew");break;case"2C+":this.innerHTML=h.get("username")+v.get("senttc");break;case"REF":this.innerHTML=messages.get(id).username+v.get("joinedideafy");break;default:this.innerHTML=h.get("object")}},setBody:function(e){switch(e){case"CXRaccept":this.innerHTML=v.get("youlbl")+v.get("nowconnected")+h.get("username");break;case"DOC":this.innerHTML="<p>"+h.get("body")+"</p><p>"+h.get("username")+"</p><p>"+h.get("signature")+"</p><br><br><p>"+v.get("clicktoview")+" : <b>"+h.get("docTitle")+"</b></p>";break;case"INV":this.innerHTML=h.get("username")+v.get("INVObject")+" : <b>"+h.get("docTitle")+"</b>";break;case"REF":this.innerHTML=v.get("referral");break;default:this.innerHTML=h.get("body").replace(/\n/g,"<br>")}},setSignature:function(e){"MSG"===e?(this.classList.remove("invisible"),this.innerHTML=h.get("signature")):this.classList.add("invisible")},showOptions:function(e){e.search("CX")>-1||"2Q+"===e||"INV"===e?this.classList.add("invisible"):this.classList.remove("invisible")},setToList:function(e){this.innerHTML=e?e:v.get("melbl")},showCcList:function(e){e?this.classList.remove("invisible"):this.classList.add("invisible")},showCXRbtn:function(e){"CXR"===e?this.classList.remove("invisible"):this.classList.add("invisible")},showDocBtn:function(e){"DOC"===e?this.classList.remove("invisible"):this.classList.add("invisible")},showSessionBtn:function(e){e&&"waiting"===e&&!h.get("joined")?this.classList.remove("invisible"):this.classList.add("invisible")},setJoinMsg:function(e){e?(this.classList.remove("invisible"),"unavailable"===e?this.innerHTML=v.get("nolongerjoin"):"joined"===e?this.innerHTML=v.get("joinedsession"):"waiting"===e&&(this.innerHTML=v.get("clicktojoin"))):this.classList.add("invisible")},showTwoQ:function(e){"2Q+"===e||"2C+"===e?this.classList.remove("invisible"):this.classList.add("invisible")},setAvatar:function(e){var t=document.createDocumentFragment(),i=new r([e]);i.place(t),this.hasChildNodes()?this.replaceChild(t,this.firstChild):this.appendChild(t)}}),cxr:new a(m,{setVisibility:function(e){e?this.classList.remove("invisible"):this.classList.add("invisible")},setResponseMessage:function(e){this.innerHTML="YES"===e?v.get("CXRaccepted")+h.get("username")+v.get("isnowacontact"):v.get("CXRrejected")}}),messageevent:new o(p)}),p.showDoc=function(e,t){t.classList.remove("pushed"),"DOC"===h.get("type")&&b.notify("display-doc",h.get("docId"),h.get("docType"))},p.showTwoQ=function(e,t){t.classList.remove("pushed"),"2Q+"===h.get("type")&&b.notify("display-twoq",h.get("docId"),h.get("author")),"2C+"===h.get("type")&&b.notify("display-twoc")},p.press=function(e,t){t.classList.add("pushed")},p.action=function(e,t){var i=t.getAttribute("name"),n=document.getElementById("msgreply"),s=document.querySelector(".msgoptionlist");switch(i){case"more":s.classList.remove("invisible");break;case"reply":s.classList.add("invisible"),g.reset(JSON.parse(h.toJSON()),"reply"),n.classList.remove("invisible"),n.scrollIntoView();break;case"replyall":s.classList.add("invisible"),g.reset(JSON.parse(h.toJSON()),"replyall"),n.classList.remove("invisible"),n.scrollIntoView();break;case"forward":s.classList.add("invisible"),g.reset(JSON.parse(h.toJSON()),"forward"),n.classList.remove("invisible"),n.scrollIntoView();break;case"deletemsg":s.classList.add("invisible"),p.deletemsg(h.toJSON()),u("#defaultPage")}t.classList.remove("pushed")},p.deletemsg=function(e){var t,n=f.get("notifications").concat();for(i=0,l=n.length;l>i;i++)if(JSON.stringify(n[i])===e){t=i;break}n.splice(t,1),f.set("notifications",n),f.upload()},p.acceptCXR=function(e,t){var n=f.get("connections"),s=f.get("news")||[],a=0,o=new Date,r=[o.getFullYear(),o.getMonth(),o.getDate(),o.getHours(),o.getMinutes(),o.getSeconds()];for(t.classList.remove("pushed"),i=0,l=n.length;l>i;i++)"user"===n[i].type?(n[i].lastname<h.get("contactInfo").lastname&&a++,n[i].lastname===h.get("contactInfo").lastname&&n[i].firstname<h.get("contactInfo").firstname&&a++):n[i].username<h.get("contactInfo").lastname&&a++;n.splice(a,0,h.get("contactInfo")),f.set("connections",n),s.unshift({type:"CX+",date:r,content:{userid:h.get("author"),username:h.get("username")}}),f.set("news",s),f.upload().then(function(){var e={dest:[h.get("author")],date:r,original:"",type:"CXRaccept",author:f.get("_id"),username:f.get("username"),firstname:f.get("firstname"),toList:h.get("username"),ccList:"",object:f.get("username")+v.get("acceptedCXR"),body:v.get("youlbl")+v.get("nowconnected")+f.get("username"),signature:"",contactInfo:{firstname:f.get("firstname"),lastname:f.get("lastname"),userid:f.get("_id"),username:f.get("username"),intro:f.get("intro"),type:"user"}};m.set("response","YES"),w.request("Notify",e,function(e){"ok"===JSON.parse(e)[0].res&&setTimeout(function(){p.deletemsg(h.toJSON()),u("#defaultPage")},1e3)})})},p.rejectCXR=function(e,t){var i,n=new Date;t.classList.remove("pushed"),m.set("response","NO"),i={dest:[h.get("author")],original:"",date:[n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds()],type:"CXRreject",author:f.get("_id"),username:f.get("username"),firstname:f.get("firstname"),toList:h.get("username"),ccList:"",object:f.get("username")+v.get("rejectedCXR"),body:"",signature:""},w.request("Notify",i,function(e){"ok"===JSON.parse(e)[0].res&&setTimeout(function(){p.deletemsg(h.toJSON()),u("#defaultPage")},1500)})},p.checkSessionStatus=function(e){var i=new s;i.setTransport(w),i.sync(t.get("db"),e).then(function(){"waiting"===i.get("status")?h.set("sessionStatus","waiting"):h.set("sessionStatus","unavailable"),i.unsync()},function(e){alert(e)})},p.gotoSession=function(e,n){var s=f.get("notifications");for(n.classList.remove("pushed"),h.set("joined",!0),t.get("observer").notify("join-musession",h.get("docId")),i=0,l=s.length;l>i;i++)if("INV"===s[i].type&&s[i].docId===h.get("docId")){s[i].joined=!0;break}f.set("notifications",s),f.upload()},p.reset=function(e){h.reset({}),m.reset({response:""}),h.reset(e),g.reset(e,"reply"),"INV"===h.get("type")&&(h.get("joined")?h.set("joined",!0):(h.set("sessionStatus",null),p.checkSessionStatus(h.get("docId"))))},p}}),define("connect/messages/newmessage",["OObject","Bind.plugin","Event.plugin","service/config","Store","Promise","service/autocontact","lib/spin.min"],function(e,t,n,s,a,o,r,c){return function(d){var u=new e,p=new a,g=new a({errormsg:""}),h=s.get("labels"),m=s.get("user"),v=s.get("transport"),f=!1,b=new c({color:"#8cab68",lines:10,length:8,width:4,radius:8,top:-8,left:340}).spin(),w={},y=function(e){var t=p.get("toList").toLowerCase().split(/,|;/),n=p.get("ccList").toLowerCase().split(/,|;/),s=JSON.stringify(m.get("connections")).toLowerCase(),a=[],r={},c=new o;for(arr=[],i=0,l=t.length;l>i;i++){if(!(s.search(t[i].trim())>-1)){g.set("errormsg",h.get("tolbl")+" : "+t[i].trim()+h.get("notavalidcontact")),f=!1,c.reject();break}a.push(t[i].trim())}if(!g.get("errormsg")&&""!==n[0])for(i=0,l=n.length;l>i;i++){if(!(s.search(n[i].trim())>-1)){g.set("errormsg",h.get("tolbl")+" : "+n[i].trim()+h.get("notavalidcontact")),f=!1,c.reject();break}a.push(n[i].trim())}return g.get("errormsg")||(r.list=a,v.request("CheckRecipientList",r,function(t){var n=[];if(t.error)g.set("errormsg",t.error),c.reject();else{for(i=0,l=t.length;l>i;i++)n.push(t[i].value);e(n),c.fulfill()}})),c};return u.plugins.addAll({labels:new t(h),errormsg:new t(g),newmessage:new t(p,{setAvatar:function(){this.setAttribute("style","background: url('"+s.get("avatar")+"') no-repeat center center;background-size:cover;")}}),newmessageevent:new n(u)}),u.template='<div id="newmsg"><div class="header blue-dark"><span data-labels="bind: innerHTML, newmsg">New message</span></div><div class="avatar" data-newmessage="bind: setAvatar, author"></div><form class="form"><p><textarea class="mail-header" name="toList" data-newmessage="bind: value, toList" data-newmessageevent="listen: mousedown, displayAutoContact; listen:keyup, updateAutoContact" data-labels="bind:placeholder, tocontactlbl"></textarea></p><div id="tolistauto" class="invisible"></div><p><textarea class="mail-header" name="ccList" data-newmessage="bind: value, ccList" data-labels="bind:placeholder, cclbl" data-newmessageevent="listen: mousedown, displayAutoContact; listen:keyup, updateAutoContact"></textarea></p><div id="cclistauto" class="invisible"></div><p><input type="text" class="input" data-newmessage="bind:value, object" data-labels="bind:placeholder, subjectlbl"></p><p><textarea class="input" data-newmessage="bind:value, body"></textarea></p><p><legend>Signature</legend><textarea class="signature" data-newmessage="bind:value, signature"></textarea></p><div class="sendmail-footer"><p class="send"><label class="cancelmail" data-labels="bind:innerHTML, cancellbl" data-newmessageevent="listen: mousedown, press; listen:mouseup, cancel">Cancel</label><label class="sendmail" data-labels="bind:innerHTML, sendlbl" data-newmessageevent="listen:mousedown, press; listen:mouseup, send">Send</label><label class="editerror" data-errormsg="bind:innerHTML, errormsg"></label></p></div></form></div>',u.reset=function(e){var t,i,n="";if(p.reset({author:m.get("_id"),username:m.get("username"),firstname:m.get("firstname"),type:"MSG",signature:m.get("username"),toList:"",ccList:"",object:"",body:"",date:null}),m.get("signature")?p.set("signature",m.get("signature")):p.set("signature",m.get("username")),g.reset({errormsg:""}),e)if("user"===e.type)p.set("toList",e.username);else{for(t=0,i=e.contacts.length;i>t;t++)n=n?n+", "+e.contacts[t].username:e.contacts[t].username;p.set("toList",n)}},u.press=function(e,t){t.classList.add("pressed")},u.cancel=function(e,t){t.classList.remove("pressed"),f=!1,u.reset(),d("#defaultPage")},u.displayAutoContact=function(e,t){var i,n,s=t.getAttribute("name"),a=function(e){p.set(s,e)};i="toList"===s?document.getElementById("tolistauto"):document.getElementById("cclistauto"),n=new r(i,t,a),w.name=n,i.classList.remove("invisible")},u.updateAutoContact=function(e,t){t.getAttribute("name"),13===e.keyCode?t.removeChild(t.firstChild):186===e.keyCode||188===e.keyCode?w.name.init():w.name.updateList()},u.send=function(e,t){var i=new Date,n={};t.classList.add("invisible"),t.classList.remove("pressed"),b.spin(t.parentNode),f||(f=!0,g.set("errormsg",""),n.author=p.get("author"),n.username=p.get("username"),n.firstname=p.get("firstname"),n.signature=p.get("signature"),n.toList=p.get("toList"),n.ccList=p.get("ccList"),n.object=p.get("object"),n.body=p.get("body"),n.type="MSG",p.get("object")||(g.set("errormsg",h.get("entersubjectlbl")),f=!1,b.stop(),t.classList.remove("invisible")),n.dest=[],y(function(e){n.dest=e}).then(function(){g.get("errormsg")?(f=!1,b.stop(),t.classList.remove("invisible")):(n.date=[i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds()],v.request("Notify",n,function(){f=!1,b.stop(),t.classList.remove("invisible"),u.reset(),g.set("errormsg",h.get("messagesentok")),setTimeout(function(){g.set("errormsg",""),t.classList.remove("invisible"),d("#defaultPage")},2e3)}))}))},u}}),define("connect/messages/messages",["OObject","service/map","Bind.plugin","Event.plugin","Amy/Control-plugin","Amy/Stack-plugin","Store","service/config","service/avatar","service/utils","./message-detail","./newmessage","service/actionbar","Promise"],function(e,t,n,s,a,o,r,c,d,u,p,g,h,m){return function(){var v=new e,f=new a(v),b=new o,w=function(e){b.getStack().show(e)},y="#defaultPage",L=new e,k=new p(w),S=new g(w),T=new r([{name:"all",label:"allbtn",selected:!0},{name:"messages",label:"msgbtn",selected:!1},{name:"notifications",label:"notifbtn",selected:!1},{name:"unread",label:"unreadbtn",selected:!1}]),M=0,A=new r([]),C=c.get("labels"),x=null,q=c.get("user"),H=c.get("observer"),_=function(e){var t,i=T.get(e).name,n=q.get("notifications"),s=n.length,a=[];switch(i){case"messages":for(t=0;s>t;t++)"MSG"===n[t].type&&a.push(n[t]);break;case"notifications":for(t=0;s>t;t++)"MSG"!==n[t].type&&a.push(n[t]);break;case"unread":for(t=0;s>t;t++)"unread"===n[t].status&&a.push(n[t]);break;default:a=n}return a},I=function(e){var t=[],n=[];if(t=q.get("notifications").concat(),""===e)n=t,T.update(0,"selected",!0),M=0;else for(i=0,l=t.length;l>i;i++)JSON.stringify(t[i]).toLowerCase().search(e.toLowerCase())>-1&&n.push(t[i]);return n};return v.plugins.addAll({label:new n(C),sort:new n(T,{setLabel:function(e){this.innerHTML=C.get(e)},setSelected:function(e){e?this.classList.add("pressed"):this.classList.remove("pressed")}}),msg:new n(A,{setObject:function(e){var t=this.getAttribute("data-msg_id");switch(e){case"INV":this.innerHTML=A.get(t).username+C.get("INVObject");break;case"CXR":this.innerHTML=A.get(t).username+C.get("CXRobject");break;case"CXRaccept":this.innerHTML=A.get(t).username+C.get("acceptedCXR");break;case"CXRreject":this.innerHTML=A.get(t).username+C.get("rejectedCXR");break;case"CXCancel":this.innerHTML=A.get(t).username+C.get("canceledCX");break;case"DOC":this.innerHTML=A.get(t).username+C.get("sentdocmsg");break;case"2Q+":this.innerHTML=A.get(t).username+C.get("askednew");break;case"2C+":this.innerHTML=A.get(t).username+C.get("senttc");break;case"REF":this.innerHTML=A.get(t).username+C.get("joinedideafy");break;default:this.innerHTML=A.get(t).object}},date:function D(D){var e=new Date;if(D&&D[0]===e.getFullYear()&&D[1]===e.getMonth()&&D[2]===e.getDate()){var t=D[3],i=D[4],n=D[5];10>t&&(t="0"+t),10>i&&(i="0"+i),10>n&&(n="0"+n),this.innerHTML=t+":"+i+":"+n}else this.innerHTML=u.formatDate(D)},highlight:function(e){e&&"unread"===e?this.classList.add("unread"):this.classList.remove("unread")},setAvatar:function(e){var t,i;e&&(t=document.createDocumentFragment(),i=new d([e]),i.place(t),this.hasChildNodes()?this.replaceChild(t,this.firstChild):this.appendChild(t))}}),msglistevent:new s(v),msglistcontrol:f,msgdetailstack:b}),v.template='<div id="connect-messages"><div class="messages"><div class="header blue-light"><span data-label="bind: innerHTML, msglistheadertitle">My Messages</span><div class="option right" data-msglistevent="listen: mousedown, plus"></div></div><ul class="selectors" data-sort = "foreach"><li class="sort-button" data-sort="bind: setLabel, label; bind:setSelected, selected, bind: name, name" data-msglistevent="listen:mousedown, displaySort"></li></ul><input class="search" type="text" data-label="bind: placeholder, searchmsgplaceholder" data-msglistevent="listen: keypress, search"><div class="msglist overflow" data-msglistcontrol="radio:li,selected,mouseup,selectMsg"><ul data-msg="foreach"><li class="msg list-item" data-msglistevent="listen:mousedown, setStart; listen:dblclick, showActionBar"><div data-msg="bind:setAvatar, author"></div><p class="msg-author unread" data-msg="bind:highlight, status; bind:innerHTML, username">Author</p><div class="select-msg"></div><span class="date" data-msg="bind: date, date"></span><p class="msg-subject unread" data-msg="bind:highlight, status; bind:setObject, type">Subject</p></li></ul></div></div><div id="msg-detail" class="details" data-msgdetailstack="destination"></div></div>',v.place(t.get("connect-messages")),v.plus=function(){b.getStack().get("#newmsg").reset(),b.getStack().show("#newmsg")},v.displaySort=function(e,t){var i=t.getAttribute("data-sort_id");A.reset([]),b.getStack().show("#defaultPage"),M>-1&&T.update(M,"selected",!1),T.update(i,"selected",!0),M=i,A.reset(_(i))},v.search=function(e,t){13===e.keyCode&&(T.update(M,"selected",!1),M=-1,A.reset(I(t.value)))},v.selectMsg=function(e){var t=e.target.getAttribute("data-msg_id"),n=q.get("notifications");if("unread"===A.get(t).status){for(i=0,l=n.length;l>i;i++)if(JSON.stringify(n[i])===JSON.stringify(A.get(t))){index=i;break}A.update(t,"status","read"),n[index]=A.get(t),q.set("notifications",n),q.upload()}b.getStack().show("#msgdetail"),k.reset(A.get(t)),y="#msgdetail"},v.init=function(){A.reset(q.get("notifications")),v.cleanOld()},v.reset=function(){T.reset([{name:"all",label:"allbtn",selected:!0},{name:"messages",label:"msgbtn",selected:!1},{name:"notifications",label:"notifbtn",selected:!1},{name:"unread",label:"unreadbtn",selected:!1}]),v.init(),b.getStack().show("#defaultPage"),display=!1},v.getSelectedmsg=function(){var e=document.querySelector(".msg.selected"),t=-1;return e&&(t=e.getAttribute("data-msg_id")),t},v.cleanOld=function(){var e,t,n=new m,s=new Date,a=!1,o=q.get("notifications")||[],r=q.get("sentMessages")||[];for(i=o.length-1;i>=0;i--)e=new Date(o[i].date[0],o[i].date[1],o[i].date[2],o[i].date[3],o[i].date[4],o[i].date[5]),s.getTime()-e.getTime()>2592e6&&(o.pop(),a=!0);for(i=r.length-1;i>=0;i--)t=new Date(r[i].date[0],r[i].date[1],r[i].date[2],r[i].date[3],r[i].date[4],r[i].date[5]),s.getTime()-t.getTime()>2592e6&&(r.pop(),a=!0);return a?(q.set("notifications",o),q.set("sentMessages",r),q.upload().then(function(){n.fulfill()})):n.fulfill(),n},v.setStart=function(){x&&x.hide()},v.showActionBar=function(e,t){var i,n=t.getAttribute("data-msg_id"),s=!1;x&&x.getParent()===t&&(s=!0),s||(x=new h("message",t,A.get(n)),i=document.createDocumentFragment(),x.place(i),t.appendChild(i),s=!0)},L.template='<div class="msgsplash"><div class="header blue-dark"><span>'+c.get("labels").get("messageview")+'</span></div><div class="innersplash" data-labels="bind: innerHTML, messagecenter"></div></div>',L.plugins.add("labels",new n(C)),v.init(),b.getStack().add("#defaultPage",L),b.getStack().add("#msgdetail",k),b.getStack().add("#newmsg",S),b.getStack().show("#defaultPage"),q.watchValue("notifications",function(){var e,t=[];A.reset([]),t=_(M),A.reset(t),"#msgdetail"===b.getStack().getCurrentName()&&(e=v.getSelectedmsg(),e>-1?k.reset(A.get(e)):b.getStack().show("#defaultPage"))}),H.watch("display-message",function(e){var t=q.get("notifications");T.update(M,"selected",!1),"MSG"===t[e].type?(T.update(1,"selected",!0),M=1):(T.update(2,"selected",!0),M=2),t[e].status="read",q.set("notifications",t),q.upload(),A.reset([t[e]]),document.querySelector('li[data-msg_id="0"]').classList.add("selected"),f.init(document.querySelector('li[data-msg_id="0"]')),b.getStack().show("#msgdetail"),k.reset(t[e]),y="#msgdetail"}),H.watch("message-contact",function(e){S.reset(e),b.getStack().show("#newmsg")}),q.watchValue("lang",function(){var e;T.loop(function(t,i){t.selected&&(e=i)}),T.reset([{name:"all",label:"allbtn",selected:!0},{name:"messages",label:"msgbtn",selected:!1},{name:"notifications",label:"notifbtn",selected:!1},{name:"unread",label:"unreadbtn",selected:!1}]),T.update(e,"selected",!0)}),v}}),define("connect/twocents/mtc-details",["OObject","service/config","Store","Bind.plugin","Event.plugin","twocents/writetwocent","twocents/twocentlist","service/avatar","service/utils","Place.plugin"],function(e,t,i,n,s,a,o,r,l,c){return function(){var i=new e,s=t.get("labels"),a=t.get("user"),r=new o("connect");return i.plugins.addAll({labels:new n(s),place:new c({TwocentUI:r})}),i.template='<div class="twocent-detail"><div class="header blue-dark"><span data-labels="bind: innerHTML, mytwocentwall"></span></div><div class = "detail-contents"><div id="connect-twocents" class="twocents" data-place="place: TwocentUI"></div></div></div>',i.reset=function(){r.reset(a.get("_id"),"connect")},i}}),define("connect/twocents/mtq-details",["OObject","service/config","Store","Bind.plugin","Event.plugin","twocents/writetwocent","twocents/twocentlist","service/avatar","service/utils","Place.plugin"],function(e,t,i,n,s,a,o,r,l,c){return function(){var d,u=new e,p=t.get("labels"),g=t.get("user"),h=new i,m=new a("connect"),v=new o("connect");return u.plugins.addAll({labels:new n(p),tqdetail:new n(h,{setHeader:function(e){this.innerHTML=e?e===g.get("_id")?p.get("mytqdetailheader"):p.get("tqheaderprefix")+h.get("username")+p.get("tqheadersuffix"):p.get("selecttq")},displayWriteTwocent:function(e){e&&e!==g.get("_id")?this.classList.remove("invisible"):this.classList.add("invisible")},displayTwocentList:function(e){e&&e.length&&document.getElementById("connect-writetwocents").classList.add("invisible")},displayTwocentNB:function(e){var t=e.length||0;this.innerHTML=t?1===t?t+" "+p.get("showonetcreply"):t+p.get("showtcrepliesafter"):p.get("noreplyyet")},date:function f(f){f&&(this.innerHTML=l.formatDate(f))},setAuthor:function(e){this.innerHTML=e===g.get("username")&&h.get("author")===g.get("_id")?p.get("youlbl"):e},setWrotelbl:function(e){this.innerHTML=e===g.get("_id")?p.get("youwrotelbl"):p.get("ideawrotelbl")},setAvatar:function(e){var t=document.createDocumentFragment(),i=new r([e]);i.place(t),this.hasChildNodes()?this.replaceChild(t,this.firstChild):this.appendChild(t)}}),place:new c({TwoQTwocentList:v}),tqevent:new s(u)}),u.template='<div class="twocent-detail"><div class="header blue-dark"><span data-tqdetail="bind: setHeader, author"></span></div><div class = "detail-contents"><div class="detail-header"><div class="avatar" data-tqdetail="bind:setAvatar, author"></div><span class="author" data-tqdetail="bind:setAuthor,username"></span><span class="commentlbl" data-tqdetail="bind: setWrotelbl, author"></span><p data-tqdetail="bind:innerHTML,question"></p><span class="date" data-tqdetail="bind:date, creation_date"></span></div><div class="detail-body"></div><div class="detail-footer"><div class="tcbutton" data-tqevent="listen:mousedown, press; listen: mouseup, write"></div><div class="tcreplies" data-tqdetail = "bind: displayTwocentNB, twocents"></div></div><div id="connect-writetwocents" class="invisible" data-tqdetail="bind: displayWriteTwocent, author"></div><div id="connect-twocents" class="twocents" data-tqdetail="bind: displayTwocentList, twocents" data-place="place:TwoQTwocentList"></div></div></div>',u.press=function(e,t){t.classList.add("pressed")},u.write=function(e,t){t.classList.remove("pressed"),document.getElementById("connect-writetwocents").classList.remove("invisible")},u.hide=function(){document.querySelector(".detail-contents").classList.add("invisible"),h.reset({})},u.reset=function(e){h.reset(e.value),m.reset(h.get("_id")),v.reset(h.get("_id")),d=u.dom.querySelector("#connect-writetwocents"),m.place(d)},u.place(document.createDocumentFragment()),u}}),define("connect/twocents/mtc-stack",["OObject","service/map","Amy/Stack-plugin","Bind.plugin","./mtc-details","./mtq-details","service/config","Store"],function(e,t,i,n,s,a,o){return function(){var t=new e,r=new e,l=o.get("labels"),c=new i;return t.template='<div id = "mtcdetailstack" data-mtcdetailstack = "destination"></div>',t.plugins.addAll({mtcdetailstack:c}),t.setView=function(e){var t=c.getStack().getCurrentName();"2Q"===e&&"twoqdetail"!==t?c.getStack().show("twoqdetail"):"2C"===e&&"twocdetail"!==t?(c.getStack().get("twocdetail").reset(),c.getStack().show("twocdetail")):c.getStack().show("defaultPage")},t.reset=function(e,t){"2Q"===e&&t&&(c.getStack().get("twoqdetail").reset(t),c.getStack().show("twoqdetail")),"default"!==e&&t||c.getStack().show("defaultPage")},r.template='<div class="msgsplash"><div class="header blue-dark" data-labels="bind: innerHTML, twocentview"><span></span></div><div class="innersplash" data-labels="bind: innerHTML, twocentcenter"></div></div>',r.plugins.add("labels",new n(l)),t.init=function(e,t){var i=new a,n=new s;c.getStack().add("twoqdetail",i),c.getStack().add("twocdetail",n),c.getStack().add("defaultPage",r),"default"===e&&c.getStack().show("defaultPage"),"2Q"===e&&(c.getStack().show("twoqdetail"),twoQDetail.reset(t))},t}}),define("connect/twocents/twoqlist",["OObject","Store","CouchDBView","service/config","Bind.plugin","Event.plugin","service/utils","service/avatar","service/actionbar","Promise"],function(e,t,i,n,s,a,o,r,l,c){function d(e,d,u,p,g){var h=new i([]),m=new t([]),v="",f=null,b={db:d,view:p,design:u,query:{descending:!0}},w=n.get("labels"),y=this;h.setTransport(n.get("transport")),v="contact"===e?"contacttwoqlist":"",this.template='<div><ul class="twoq-list '+v+'" data-twoqlist="foreach"><li class="list-item" data-twoqlistevent="listen:mousedown, setStart"><div class="item-header"><span class="date" data-twoqlist="bind:date,value.creation_date"></span></div><div class="item-body"><p data-twoqlist="bind:innerHTML,value.question"></p></div><div class="item-footer"><a class="item-twocent"></a><span class="replies" data-twoqlist="bind:showReplies, value.twocents"></span></div></li></ul><ul class="twoq-searchlist invisible '+v+'" data-twoqsearch="foreach"><li class="list-item" data-twoqlistevent="listen:mousedown, setStart"><div class="item-header"><span class="date" data-twoqsearch="bind:date,value.creation_date"></span></div><div class="item-body"><p data-twoqsearch="bind:innerHTML,value.question"></p></div><div class="item-footer"><a class="item-twocent"></a><span class="replies" data-twoqsearch="bind:showReplies, value.twocents"></span></div></li></ul></div>',this.plugins.addAll({twoqlist:new s(h,{date:function L(L){this.innerHTML=L?o.formatDate(L):""},showReplies:function(e){var t;e&&(t=e.length),0===t?this.innerHTML=w.get("noreplyyet"):1===t?this.innerHTML=t+" "+w.get("showonetcreply"):t>1&&(this.innerHTML=t+" "+w.get("showtcrepliesafter"))},setAvatar:function(e){var t,i;e&&(i=document.createDocumentFragment(),t=new r([e]),t.place(i),this.hasChildNodes()?this.replaceChild(i,this.firstChild):this.appendChild(i))},setVisibility:function(e){e&&"public"===e?this.classList.add("public"):this.classList.remove("public")}}),twoqsearch:new s(m,{date:function k(k){this.innerHTML=k?o.formatDate(k):""},showReplies:function(e){var t;e&&(t=e.length),0===t?this.innerHTML=w.get("noreplyyet"):1===t?this.innerHTML=t+" "+w.get("showonetcreply"):t>1&&(this.innerHTML=t+" "+w.get("showtcrepliesafter"))},setAvatar:function(e){var t,i;e&&(i=document.createDocumentFragment(),t=new r([e]),t.place(i),this.hasChildNodes()?this.replaceChild(i,this.firstChild):this.appendChild(i))},setVisibility:function(e){e&&"public"===e?this.classList.add("public"):this.classList.remove("public")}}),twoqlistevent:new a(this)}),this.getModel=function(){var e,t;return t=!y.dom.querySelector(".twoq-searchlist").classList.contains("invisible"),e=t?m:h},this.resetQuery=function(e){var t=new c;return b.query=e,h.unsync(),h.reset([]),y.hideSearch(),h.sync(b.db,b.design,b.view,b.query).then(function(){t.fulfill()}),t},this.setStart=function(){f&&f.hide()},this.showActionBar=function(e,t){var i,n=t.getAttribute("data-twoqlist_id"),s=!1,a=document.getElementById("mtc-list");f&&f.getParent()===t&&(s=!0),a.classList.contains("mosaic")||s||(f=new l("2Q",t,h.get(n).value),i=document.createDocumentFragment(),f.place(i),t.appendChild(i),s=!0)},this.showSearch=function(){var e=document.querySelector(".twoq-searchlist"),t=document.querySelector(".twoq-list");e&&e.classList.contains("invisible")&&(t.classList.add("invisible"),e.classList.remove("invisible"))},this.hideSearch=function(){var e=this.dom.querySelector(".twoq-searchlist"),t=this.dom.querySelector(".twoq-list");e&&!e.classList.contains("invisible")&&(t.classList.remove("invisible"),e.classList.add("invisible"))},this.search=function(e){m.reset([]),e.toLowerCase()?(this.showSearch(),h.loop(function(t){JSON.stringify(t).search(e)>-1&&m.alter("push",t)})):this.hideSearch()},g&&(b.query=g),this.init=function(){var e=new c;return h.sync(b.db,b.design,b.view,b.query).then(function(){e.fulfill()}),e}}return function(t,i,n,s,a){return d.prototype=new e,new d(t,i,n,s,a)}}),define("connect/twocents/mytwocents",["OObject","service/map","service/config","Bind.plugin","Place.plugin","Amy/Delegate-plugin","Amy/Stack-plugin","Amy/Control-plugin","./mtc-stack","./twoqlist","Store"],function(e,t,n,s,a,o,r,c,d,u,p){return function(){var g,h,m=new e,v=new r,f=new c(m),b=new d,w=[{name:"#mytwoq",active:!0},{name:"#contacttwoq",active:!1},{name:"#mytwoc",active:!1}],y=new p(w),L=new p({view:"#mytwoq"}),k=new p([]),S=n.get("user"),T=S.get("connections"),M=n.get("labels"),A=n.get("db");for(m.plugins.addAll({labels:new s(M),twoqbuttons:new s(y,{setBg:function(e){switch(e){case"#mytwoq":this.classList.add("mytwoq");break;case"#contacttwoq":this.classList.add("contacttwoq");break;case"#mytwoc":this.classList.add("mytwoc")}},setActive:function(e){e?this.classList.add("pushed"):this.classList.remove("pushed")}}),mtctools:new s(L,{setVisible:function(e){this.getAttribute("name")===e?this.classList.remove("invisible"):this.classList.add("invisible")},setLegend:function(e){switch(e){case"#mytwoq":this.innerHTML=M.get("mytwoquestions");break;case"#contacttwoq":this.classList.add("contacttwoq");break;case"#mytwoc":this.innerHTML=M.get("mytwocents")}},updateLegend:function(e){e&&"#contacttwoq"===L.get("view")&&(this.innerHTML=M.get("twoqprefix")+e+M.get("twoqsuffix"))}}),auto:new s(k),mtcliststack:v,mtcdetails:new a({mtcDetails:b}),mtccontrol:f,mtcevent:new o(m)}),m.template='<div id="connect-tc"><div id="mtc-list"><div class="header blue-light"><span data-labels="bind: innerHTML, mtcheadertitle"></span><div class="option right" data-mtcevent="listen: mousedown, plus"></div></div><ul class="twoqbuttons" data-twoqbuttons="foreach"><li data-twoqbuttons="bind: setBg,name; bind:setActive, active" data-mtcevent="listen:mousedown, selectView; listen: mouseup, showView"></li></ul><div class="selectcontact" name = "#contacttwoq" data-mtctools="bind:setVisible, view"><legend>Select a contact</legend><input class="search" data-mtcevent="listen:mousedown, updateAutoContact; listen:keyup, updateAutoContact" data-labels="bind:placeholder, tocontactlbl" data-mtctools = "bind:value, contact"><div class="rightcaret" data-mtcevent="listen: mousedown, updateAutoContact"></div><div class = "autocontact invisible"><ul data-auto="foreach"><li data-auto="bind:innerHTML, contact.username; bind:highlight, selected" data-mtcevent="listen:mousedown, highlightContact; listen:mouseup, selectContact"></li></ul></div></div><legend data-mtctools="bind:setLegend, view; bind: updateLegend, contact"></legend><input name="#mytwoq" class="search" type="text" data-mtctools="bind:setVisible, view" data-labels="bind: placeholder, searchmsgplaceholder" data-mtcevent="listen: input, search"><input name="#contacttwoq" class="search" type="text" data-mtctools="bind:setVisible, view" data-labels="bind: placeholder, searchmsgplaceholder" data-mtcevent="listen: keypress, search"><input name="#mytwoc" class="search" type="text" data-mtctools="bind:setVisible, view" data-labels="bind: placeholder, searchmsgplaceholder" data-mtcevent="listen: keypress, search"><div data-mtcliststack="destination" data-mtccontrol="radio:li,selected,mousedown,selectStart"></div></div><div id="mtc-detail" data-mtcdetails="place:mtcDetails" class="details"></div></div>',m.place(t.get("connect-twocents")),m.plus=function(){t.get("new2q-popup").classList.add("appear"),t.get("cache").classList.add("appear")},m.selectView=function(e,t){var i=t.getAttribute("data-twoqbuttons_id");y.loop(function(e,t){t===parseInt(i)?y.update(t,"active",!0):y.update(t,"active",!1)}),L.set("view",y.get(i).name)},m.showView=function(e,t){var i=t.getAttribute("data-twoqbuttons_id");switch(y.get(i).name){case"#mytwoq":v.getStack().show("#mytwoq"),b.setView("#defaultPage");break;case"#contacttwoq":v.getStack().show("#contacttwoq"),b.setView("#defaultPage");break;case"#mytwoc":v.getStack().show("#blank"),b.setView("2C")}},m.updateAutoContact=function(e,t){var n,s,a=JSON.parse(k.toJSON()),o=document.getElementById("mtc-list"),r=o.querySelector(".autocontact");
if(r.classList.contains("invisible")&&r.classList.remove("invisible"),8===e.keyCode&&(t.value=""),t.value&&""!==t.value){for(s=t.value.toLowerCase(),i=a.length-1;i>=0;i--)n=a[i].contact.username.toLowerCase(),0!==n.search(s)&&a.splice(i,1);k.reset(a)}else{for(a=[],i=0,l=T.length;l>i;i++)"user"===T[i].type&&a.push({contact:T[i]});k.reset(a)}13===e.keyCode&&(""===t.value?(v.getStack().show("#blank"),b.getStack().show("defaultPage")):k.getNbItems()?(L.set("contact",k.get(0).contact.username),h.resetQuery({key:'"'+k.get(0).contact.userid+'"',descending:!0}).then(function(){var e,t=h.getModel();t.getNbItems()?(v.getStack().show("#contacttwoq"),b.reset("2Q",t.get(0)),e=h.dom.querySelector("li[data-twoqlist_id='0']"),f.init(e),e.classList.add("selected"),b.reset("2Q",t.get(0))):(v.getStack().show("#blank"),b.reset("default"))})):(v.getStack().show("#blank"),b.reset("default")))},m.highlightContact=function(e,t){t.classList.add("highlighted")},m.selectContact=function(e,t){var i=t.getAttribute("data-auto_id"),n=document.getElementById("mtc-list"),s=n.querySelector(".autocontact");t.classList.remove("highlighted"),L.set("contact",k.get(i).contact.username),s.classList.add("invisible"),h.resetQuery({key:'"'+k.get(i).contact.userid+'"',descending:!0}).then(function(){var e,t=h.getModel();t.getNbItems()?(v.getStack().show("#contacttwoq"),b.reset("2Q",t.get(0)),e=h.dom.querySelector("li[data-twoqlist_id='0']"),f.init(e),e.classList.add("selected"),b.reset("2Q",t.get(0))):(v.getStack().show("#blank"),b.reset("default"))})},m.selectStart=function(e){var t,i=v.getStack().getCurrentScreen().getModel();("#mytwoq"===L.get("view")||"#contacttwoq"===L.get("view"))&&(t=e.target.getAttribute("data-twoqlist_id")||e.target.getAttribute("data-twoqsearch_id"),b.reset("2Q",i.get(t)))},m.search=function(e,t){v.getStack().getCurrentScreen().search(t.value)},m.reset=function(){var e;for(y.reset(w),L.set("view","#mytwoq"),k.reset([]),T=S.get("connections"),e=0,l=T.length;l>e;e++)"user"===T[e].type&&k.alter("push",{contact:T[e],selected:!1});g.resetQuery({key:'"'+S.get("_id")+'"',descending:!0}).then(function(){v.getStack().show("#mytwoq"),b.reset("default")})},n.get("observer").watch("display-twoq",function(e,t){h.resetQuery({key:'"'+t+'"',descending:!0}).then(function(){var t,i,n=h.getModel();v.getStack().show("#contacttwoq"),L.set("view","#contacttwoq"),y.loop(function(e,t){"#contacttwoq"===e.name?y.update(t,"active",!0):y.update(t,"active",!1)}),n.loop(function(i,n){i.id===e&&(t=n,L.set("contact",i.value.username))}),i=h.dom.querySelector("li[data-twoqlist_id='"+t+"']"),f.init(i),i.classList.add("selected"),b.reset("2Q",n.get(t))})}),n.get("observer").watch("display-twoc",function(){v.getStack().show("#blank"),L.set("view","#mytwoc"),y.loop(function(e,t){"#mytwoc"===e.name?y.update(t,"active",!0):y.update(t,"active",!1)}),b.setView("2C")}),i=0,l=T.length;l>i;i++)"user"===T[i].type&&k.alter("push",{contact:T[i],selected:!1});return g=new u("user",A,"questions","_view/questionsbyauthor",{key:'"'+S.get("_id")+'"',descending:!0}),h=new u("contact",A,"questions","_view/questionsbyauthor",{key:'"Blank_List"',descending:!0}),blank=new u("user",A,"questions","_view/questionsbyauthor",{key:'"Blank_List"',descending:!0}),v.getStack().add("#mytwoq",g),v.getStack().add("#contacttwoq",h),v.getStack().add("#blank",blank),h.init(),blank.init(),g.init().then(function(){v.getStack().show("#mytwoq"),b.init("default")}),m}}),define("connect/connect",["OObject","service/map","Amy/Stack-plugin","service/submenu","./contacts/contacts","./messages/messages","./twocents/mytwocents","service/config"],function(e,t,i,n,s,a,o,r){return function(){var l,c=new e,d=new i,u=r.get("observer"),p=function(e){d.getStack().show(e)},g=new a,h=new s,m=new o;return c.plugins.add("connectstack",d),c.template='<div id="connect"><div id="connect-menu"></div><div class="stack" data-connectstack="destination"></div></div>',c.place(t.get("connect")),c.showMenu=function(){l.toggleActive(!0)},c.hideMenu=function(){l.toggleActive(!1)},c.reset=function(){l.reset(),h.reset(),g.reset(),m.reset(),d.getStack().show("#messages")},l=new n(c.dom.querySelector("#connect-menu"),p),l.toggleActive(!1),g.init(),h.init(),d.getStack().add("#messages",g),d.getStack().add("#contacts",h),d.getStack().add("#twocents",m),d.getStack().show("#messages"),u.watch("display-message",function(){l.setWidget("#messages")}),u.watch("display-twoq",function(){l.setWidget("#twocents")}),u.watch("display-twoc",function(){l.setWidget("#twocents")}),u.watch("message-contact",function(){l.setWidget("#messages")}),c}}),define("dashboard/profile/leaderboard",["OObject","service/config","Bind.plugin","Event.plugin","CouchDBView","service/utils","service/avatar"],function(e,t,i,n,s,a,o){return function(){var r=new e,l=new s([]);return r.template='<div><ul data-leaders="foreach"><li class="leader" data-leaders="bind:setSpotLight, value.userid"><div data-leaders="bind:setAvatar, value.userid"></div><div class="username" data-leaders="bind:innerHTML, value.username"></div><div class="distinction" data-leaders="bind:setDistinction, value.ip"></div><div class="grade" data-leaders="bind:setGrade, value.ip"></div><div class="score" data-leaders="bind: setScore, value.ip"></div></li></ul></div>',r.plugins.addAll({leaders:new i(l,{setSpotLight:function(e){e===t.get("user").get("_id")?(this.classList.add("userleader"),this.scrollIntoView(!1)):this.classList.remove("userleader")},setAvatar:function(e){var t,i;e&&(i=document.createDocumentFragment(),t=new o([e]),t.place(i),this.hasChildNodes()?this.replaceChild(i,this.firstChild):this.appendChild(i))},setGrade:function(e){var t=this;a.getGrade(e,function(e){t.setAttribute("style","background: url('img/profile/"+e.grade.badge+"') no-repeat center center; background-size: 40px 40px;")})},setDistinction:function(e){var t=this;a.getGrade(e,function(e){e.distinction&&t.setAttribute("style","background: url('img/profile/"+e.distinction.badge+"') no-repeat center center; background-size: 40px 40px;")})},setScore:function(e){this.innerHTML=e+" ip"}}),leaderevent:new n(r)}),r.init=function(e){l.setTransport(t.get("transport")),l.sync(t.get("db"),"users","_view/leaderboard",{limit:100,descending:!0}).then(function(){r.place(e)})},t.get("observer").watch("reconnect",function(){l.unsync(),l.reset([]),l.sync(t.get("db"),"users","_view/leaderboard",{limit:100,descending:!0})}),r}}),define("dashboard/profile/editprofile",["OObject","service/config","Bind.plugin","Event.plugin","service/avatar","service/utils","Store","lib/spin.min","LocalStore"],function(e,t,i,n,s,a,o,r,l){return function(){var s=new e,c=t.get("user"),d=new o,u=[{name:"azur",file:"img/avatars/deedee0.png",selected:!1},{name:"blue",file:"img/avatars/deedee1.png",selected:!1},{name:"green",file:"img/avatars/deedee2.png",selected:!1},{name:"grey",file:"img/avatars/deedee3.png",selected:!1},{name:"orange",file:"img/avatars/deedee4.png",selected:!1},{name:"red",file:"img/avatars/deedee5.png",selected:!1},{name:"yellow",file:"img/avatars/deedee6.png",selected:!1}],p=new o(u),g={},h=new o({status:null}),m=t.get("labels"),v=new r({color:"#8cab68",lines:10,length:8,width:4,radius:8,top:-8,left:360}).spin(),f=80,b=80,w=function(e){var t,i,n=document.createElement("canvas"),s=n.getContext("2d");return t=e.width,i=e.height,i>t?(i*=f/t,t=f):(t*=b/i,i=b),n.width=t,n.height=i,s.drawImage(e,0,0,t,i),n.toDataURL("image/png")},y=function(e){var t,i,n=new Image,s=document.createElement("canvas"),a=document.getElementById("avatarcanvas"),o=s.getContext("2d"),r=a.scrollWidth,l=a.scrollHeight;n.src=e,setTimeout(function(){s.width=r,s.height=l,t=Math.floor(Math.max(0,(n.width-r)/2)),i=Math.floor(Math.max(0,(n.height-l)/2)),o.drawImage(n,t,i,r,l,0,0,r,l),d.set("avatar",s.toDataURL("image/png"))},300)},L=function(){var e="/upload",t=new FormData;t.append("type","avatar"),t.append("filename",g.picture_file),t.append("img",d.get("avatar")),a.uploadFile(e,t,h,function(e){"ok"!==e.response&&console.log(e)})};return s.plugins.addAll({label:new i(m),avatars:new i(p,{setPic:function(e){this.setAttribute("style","background-image: url('"+e+"');background-repeat: no-repeat; background-position: center center; background-size: cover;")},setChecked:function(e){this.innerHTML=e?"&#10003;":""}}),progress:new i(h,{showProgress:function(e){var t=0;e&&(t=Math.floor(80*(e/100))),this.setAttribute("style","width:"+t+"px;"),this.innerHTML=100===e?m.get("uploadcomplete"):""}}),profile:new i(d,{setAvatar:function(e){this.setAttribute("style","background-image: url('"+e+"');background-repeat: no-repeat; background-position: center center; background-size: cover;")},setDay:function(e){e[2]&&(this.value=e[2])},setMonth:function(e){var t=e[1]||0;this.value=this.options[t].innerHTML},setYear:function(e){e[0]&&(this.value=e[0])},setFamilyStatus:function(e){(e||0===e)&&(this.selectedIndex=e)},setChildren:function(e){(e||0===e)&&(this.selectedIndex=e)},setSituation:function(e){(e||0===e)&&(this.selectedIndex=e)},setLeisureName:function(e){var t=this,i=t.getAttribute("name");[0,1,2].forEach(function(n){e[n]&&i.search(n)>0&&(t.value=e[n].name)})},setLeisureDesc:function(e){var t=this,i=t.getAttribute("name");[0,1,2].forEach(function(n){e[n]&&i.search(n)>0&&(t.value=e[n].comment)})},setInterestName:function(e){var t=this,i=t.getAttribute("name");[0,1,2].forEach(function(n){e[n]&&i.search(n)>0&&(t.value=e[n].name)})},setInterestDesc:function(e){var t=this,i=t.getAttribute("name");[0,1,2].forEach(function(n){e[n]&&i.search(n)>0&&(t.value=e[n].comment)})}}),editprofileevent:new n(s)}),s.template='<div><div class = "setavatar"><canvas id ="avatarcanvas" class="currentavatar" data-profile="bind:setAvatar, avatar" data-editprofileevent="listen:mousedown, changeAvatar"></canvas><div id="rotate" class="invisible" data-editprofileevent="listen:mousedown, rotateAvatar"></div><div id="changeavatar" class="invisible"><div class="avatarcache"></div><span class="importbutton"><input type="file" enctype="multipart/form-data" accept = "image/gif, image/jpeg, image/png" data-editprofileevent="listen: mousedown, selectpress; listen: change, uploadnDisplay"><div data-label="bind:innerHTML, importlbl" data-editprofileevent="listen: mousedown, press; listen: mouseup, release"></div></span><p data-label="bind:innerHTML, selectavatar"></p><ul class="defaultlist" data-avatars="foreach"><li><div class="defaultAvatar" data-avatars="bind: setPic, file"></div><div class="checkbox" data-avatars="bind: setChecked, selected" data-editprofileevent="listen: mouseup, setDefaultAvatar"></div></li></ul></div></div><form class="profileinfo"><div class = "username"><div class = "firstname"><label data-label="bind:innerHTML, firstnameplaceholder"></label><input class="input" name="firstname" type="text" data-profile="bind: value, firstname" data-editprofileevent="listen: input, updateField"></div><div class = "lastname"><label data-label="bind:innerHTML, lastnameplaceholder"></label><input class="input" type="text" name="lastname" data-profile="bind: value, lastname" data-editprofileevent="listen: input, updateField"></div></div><label data-label="bind:innerHTML, profileintro"></label><input class="input" name="intro" type="text" data-profile="bind:value, intro" data-label="bind:placeholder, shortprofiledesc" data-editprofileevent="listen: input, updateField"><label data-label="bind:innerHTML, dob"></label><div class="dob"><input class="day" name="day" type="text" data-label="bind:placeholder, day" data-profile="bind: setDay, birthdate" data-editprofileevent="listen:input, updateDate"><select name="month" data-profile="bind: setMonth, birthdate" data-editprofileevent="listen:change, updateDate"><option data-label="bind:innerHTML, jan"></option><option data-label="bind:innerHTML, feb"></option><option data-label="bind:innerHTML, mar"></option><option data-label="bind:innerHTML, apr"></option><option data-label="bind:innerHTML, may"></option><option data-label="bind:innerHTML, jun"></option><option data-label="bind:innerHTML, jul"></option><option data-label="bind:innerHTML, aug"></option><option data-label="bind:innerHTML, sep"></option><option data-label="bind:innerHTML, oct"></option><option data-label="bind:innerHTML, nov"></option><option data-label="bind:innerHTML, dec"></option></select><input class="year" name="year" type="text" data-label="bind:placeholder,year" data-profile="bind: setYear, birthdate" data-editprofileevent="listen:input, updateDate"></div><div class="postal"><label class="streetaddress" data-label="bind:innerHTML, mailaddress"></label><input class="streetaddress input" name="street1" type="text" data-label="bind:placeholder, street" data-profile="bind:value, address.street1" data-editprofileevent="listen:input, updateAddress"><div class="city"><label data-label="bind:innerHTML, city"></label><input class="input city" name="city" type="text" data-profile="bind:value, address.city" data-editprofileevent="listen:input, updateAddress"></div><div class="zipstate"><div class="state"><label data-label="bind:innerHTML, state"></label><input class="input" name="state" placeholder="" type="text" data-profile="bind:value, address.state" data-editprofileevent="listen:input, updateAddress"></div><div class="zip"><label data-label="bind:innerHTML, zip"></label><input class="input" name="zip" placeholder="" type="text" data-profile="bind:value, address.zip" data-editprofileevent="listen:input, updateAddress"></div></div><label data-label="bind:innerHTML, country"></label><input class="input" name="country" type="text" data-profile="bind:value, address.country" data-editprofileevent="listen:input, updateAddress"></div><label data-label="bind:innerHTML, myfamily"></label><div class="family"><select class="status" name="couple" data-profile="bind: setFamilyStatus, family.couple" data-editprofileevent="listen:change, updateFamily"><option data-label="bind:innerHTML, single"></option><option data-label="bind:innerHTML, married"></option><option data-label="bind:innerHTML, divorced"></option><option data-label="bind:innerHTML, widow"></option><option data-label="bind:innerHTML, relation"></option></select><select class="children" name="children" data-profile="bind: setChildren, family.children" data-editprofileevent="listen:change, updateFamily"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option><option>7</option><option>8+</option></select><label data-label="bind:innerHTML, children"></label></div><label data-label="bind:innerHTML, myoccupation"></label><div class="job"><select class="status" name="situation" data-profile="bind: setSituation, occupation.situation" data-editprofileevent="listen:change, updateJob"><option data-label="bind:innerHTML, student"></option><option data-label="bind:innerHTML, active"></option><option data-label="bind:innerHTML, retired"></option><option data-label="bind:innerHTML, unemployed"></option><option data-label="bind:innerHTML, stayathome"></option></select><div class="jobdesc"><label data-label="bind:innerHTML, jobtitle"></label><input class="input" type="text" name="job" data-profile="bind:value, occupation.job" data-label="bind:placeholder, jobtitle" data-editprofileevent="listen:input, updateJob"></div><div class="org"><label data-label="bind:innerHTML, organization"></label><input class="input" name="organization" type="text" data-profile="bind:value, occupation.organization" data-label="bind:placeholder,organization" data-editprofileevent="listen:input, updateJob"></div></div></form><form class="addtlinfo"><legend data-label="bind:innerHTML, socialnwlbl"></legend><ul class="socialnw"><li class="fb"><input class="input" type="text" name="facebook" data-profile="bind: value, facebook" data-editprofileevent="listen: input, updateField"></li><li class="gp"><input class="input" name="gplus" type="text" data-profile="bind: value, gplus" data-editprofileevent="listen: input, updateField"></li><li class="lin"><input class="input" name="linkedin" type="text" data-profile="bind: value, linkedin" data-editprofileevent="listen: input, updateField"></li><li class="tw"><input class="input" name="twitter" type="text" data-profile="bind: value, twitter" data-editprofileevent="listen: input, updateField"></li></ul><legend data-label="bind:innerHTML, hobbieslbl"></legend><label data-label="bind:innerHTML, name"></label><label class="description" data-label="bind:innerHTML, comment"></label><input name="leisure0" class="input" type="text" data-profile="bind: setLeisureName, leisure_activities" data-editprofileevent="listen: input, updateLeisureName"><input class="input description" name="leisure0" type="text" data-profile="bind: setLeisureDesc, leisure_activities" data-editprofileevent="listen: input, updateLeisureDesc"><input name="leisure1" class="input" type="text"  data-profile="bind: setLeisureName, leisure_activities" data-editprofileevent="listen: input, updateLeisureName"><input class="input description" name="leisure1" type="text" data-profile="bind: setLeisureDesc, leisure_activities" data-editprofileevent="listen: input, updateLeisureDesc"><input class="input" name="leisure2" type="text" data-profile="bind: setLeisureName, leisure_activities" data-editprofileevent="listen: input, updateLeisureName"><input class="input description" name="leisure2" type="text" data-profile="bind: setLeisureDesc, leisure_activities" data-editprofileevent="listen: input, updateLeisureDesc"><legend data-label="bind:innerHTML, interestslbl"></legend><label data-label="bind:innerHTML, field"></label><label class="description" data-label="bind:innerHTML, comment"></label><input class="input" name="interest0" type="text" data-profile="bind: setInterestName, interests" data-editprofileevent="listen: input, updateInterestName"><input class="input description" name="interest0" type="text" data-profile="bind: setInterestDesc, interests" data-editprofileevent="listen: input, updateInterestDesc"><input class="input" name="interest1" type="text" data-profile="bind: setInterestName, interests" data-editprofileevent="listen: input, updateInterestName"><input class="input description" name="interest1" type="text" data-profile="bind: setInterestDesc, interests" data-editprofileevent="listen: input, updateInterestDesc"><input class="input" name="interest2" type="text" data-profile="bind: setInterestName, interests" data-editprofileevent="listen: input, updateInterestName"><input class="input description" name="interest2" type="text" data-profile="bind: setInterestDesc, interests" data-editprofileevent="listen: input, updateInterestDesc"></form><div class="useascharacter"></div><p class="update"><label class="cancelprofile" data-label="bind:innerHTML, cancellbl" data-editprofileevent="listen: mousedown, press; listen:mouseup, cancel"></label><label class="updateprofile" data-label="bind:innerHTML, updatelbl" data-editprofileevent="listen:mousedown, press; listen:mouseup, update"></label><label class="editerror" data-errormsg="bind:innerHTML, errormsg"></label></p><div class="uploadprogress" data-progress="bind:showProgress, status"></div></div>',s.init=function(e){s.reset(),s.place(e)},s.selectpress=function(e,t){t.value=""},s.press=function(e,t){t.classList.add("pressed")},s.release=function(e,t){setTimeout(function(){t.classList.remove("pressed")},300)},s.uploadnDisplay=function(e,t){var i=new Image,n=new FileReader;new FileReader,document.getElementById("avatarcanvas"),n.onload=function(e){i.src=e.target.result,setTimeout(function(){y(w(i)),g.picture_file=c.get("_id")+"_@v@t@r",document.getElementById("changeavatar").classList.add("invisible")},300)},n.readAsDataURL(t.files[0])},s.changeAvatar=function(){document.getElementById("changeavatar").classList.remove("invisible"),h.set("status",0)},s.setDefaultAvatar=function(e,t){var i=t.getAttribute("data-avatars_id");p.loop(function(e,t){t===parseInt(i)?p.update(t,"selected",!0):p.update(t,"selected",!1)}),d.set("avatar",p.get(i).file),g.picture_file=p.get(i).file,document.getElementById("changeavatar").classList.add("invisible")},s.rotateAvatar=function(){var e=document.createElement("canvas"),t=e.getContext("2d"),i=new Image;i.src=d.get("avatar"),setTimeout(function(){e.width=i.width,e.height=i.height,t.translate(e.width/2,e.height/2),t.rotate(Math.PI/2),t.translate(-e.height/2,-e.width/2),t.drawImage(i,0,0),d.set("avatar",e.toDataURL("image/png"))},300)},s.reset=function(){d.reset(JSON.parse(c.toJSON())),d.set("avatar",t.get("avatar")),p.reset(u),g={},d.get("picture_file").search("img/avatars/deedee")>-1&&p.loop(function(e,t){d.get("picture_file").search(e.file)>-1&&p.update(t,"selected",!0)})},s.updateField=function(e,t){var i=t.getAttribute("name");g[i]=t.value,d.set(i,t.value)},s.updateDate=function(e,t){var i=d.get("birthdate"),n=t.getAttribute("name");switch(n){case"year":i[0]=t.value;break;case"month":i[1]=t.selectedIndex;break;case"day":i[2]=t.value}d.set("birthdate",i),g.birthdate=i},s.updateAddress=function(e,t){var i=d.get("address"),n=t.getAttribute("name");i[n]=t.value||"",d.set("address",i),g.address=i},s.updateFamily=function(e,t){var i=t.getAttribute("name"),n=d.get("family");n[i]=t.selectedIndex,d.set("family",n),g.family=n},s.updateJob=function(e,t){var i=d.get("occupation"),n=t.getAttribute("name");switch(n){case"situation":i.situation=t.selectedIndex;break;case"job":i.job=t.value;break;case"organization":i.organization=t.value}g.occupation=i},s.updateLeisureName=function(e,t){var i=t.getAttribute("name"),n=i.charAt(i.length-1),s=d.get("leisure_activities");s[n].name=t.value,d.set("leisure_activities",s),g.leisure_activities=s},s.updateLeisureDesc=function(e,t){var i=t.getAttribute("name"),n=i.charAt(i.length-1),s=d.get("leisure_activities");s[n].comment=t.value,d.set("leisure_activities",s),g.leisure_activities=s},s.updateInterestName=function(e,t){var i=t.getAttribute("name"),n=i.charAt(i.length-1),s=d.get("interests");s[n].name=t.value,d.set("interests",s),g.interests=s},s.updateInterestDesc=function(e,t){var i=t.getAttribute("name"),n=i.charAt(i.length-1),s=d.get("interests");s[n].comment=t.value,d.set("interests",s),g.interests=s},s.press=function(e,t){t.classList.add("pressed")},s.cancel=function(e,t){t.classList.remove("pressed"),document.querySelector(".userdetails").classList.remove("invisible"),document.querySelector(".edituserdetails").classList.add("invisible")},s.update=function(e,i){var n,s=0;i.classList.remove("pressed"),i.classList.add("invisible"),v.spin(i.parentNode);for(n in g)c.set(n,g[n]),s++;s?c.upload().then(function(){var e=new l;g.picture_file&&(t.set("avatar",d.get("avatar")),e.sync("ideafy-data"),e.set("userAvatar",t.get("avatar"))),g.picture_file&&g.picture_file.search("img/avatars/deedee")<0&&(L(),document.getElementById("rotate").classList.add("invisible")),v.stop(),i.classList.remove("invisible"),t.get("observer").notify("profile-updated"),document.querySelector(".edituserdetails").classList.add("invisible"),document.querySelector(".userdetails").classList.remove("invisible")}):(v.stop(),i.classList.remove("invisible"),document.querySelector(".userdetails").classList.remove("invisible"),document.querySelector(".edituserdetails").classList.add("invisible"))},s}}),define("dashboard/profile/profile",["OObject","service/map","Bind.plugin","Event.plugin","service/config","Store","service/utils","./leaderboard","./editprofile","Promise"],function(e,t,n,s,a,o,r,c,d,u){return function(){var p,g,h=new e,m=a.get("user"),v=(m.get("ip"),a.get("labels")),f=new o({total:0,ideas:0,sessions:0,contacts:0,twoQ:0}),b=new o({status:""}),w=new o({view:"info",completion:0,socialnw:0}),y=new o(m.get("news")),L=new o([]),k=new o;return h.plugins.addAll({label:new n(v),stats:new n(w,{setViewLbl:function(e){this.innerHTML=v.get(e),"info"===e?this.setAttribute("style","background: #9ac9cd;"):this.setAttribute("style","background: #5F8F28;")},toggleInformation:function(e){"info"===e?this.classList.remove("invisible"):this.classList.add("invisible")},toggleLeaderboard:function(e){"leaderboard"===e?this.classList.remove("invisible"):this.classList.add("invisible")},setPercentage:function(e){this.innerHTML=v.get("completionprefix")+e+v.get("completionsuffix")},setProgress:function(e){100===e?this.setAttribute("style","width:100%;border-top-right-radius:5px;border-bottom-right-radius:5px;"):this.setAttribute("style","width:"+e+"%;")},showDetails:function(e){100===e?this.classList.add("invisible"):this.classList.remove("invisible")},showSocialNW:function(e){e?this.classList.remove("invisible"):this.classList.add("invisible")}}),grades:new n(L,{showBadge:function(e){this.setAttribute("style","background: url('img/profile/"+e+"') no-repeat center center; background-size: cover;")}}),achievements:new n(k,{showBadge:function(e){this.setAttribute("style","background: url('img/profile/"+e+"') no-repeat center center; background-size: cover;")}}),progressbar:new n(f,{setWidth:function(e){this.setAttribute("style","width:"+e+"%;")}}),progress:new n(b),config:new n(a,{setAvatar:function(e){this.setAttribute("style","background: url('"+e+"') no-repeat center center;background-size:cover;")}}),user:new n(m,{setLocation:function(e){this.innerHTML=e.country?e.country.toUpperCase():v.get("completeprofile"),e.city&&e.country&&(this.innerHTML=e.city+", "+e.country.toUpperCase()),e.city&&e.state&&e.country&&(this.innerHTML=e.city+", "+e.state.toUpperCase()+" "+e.country.toUpperCase())},setAge:function(e){var t,i,n=new Date;e&&3===e.length?(t=new Date(e[0],e[1],e[2]),i=n.getTime()-t.getTime(),this.innerHTML=Math.floor(i/1e3/3600/24/365)+" "+v.get("agelbl")):this.innerHTML=v.get("completeprofile")},setFamily:function(e){var t,i,n=e.couple,s=e.children;null===n?t=v.get("completeprofile"):0===n?t=v.get("singlelbl"):1===n?t=v.get("marriedlbl"):2===n?t=v.get("divorcedlbl"):3===n&&(t=v.get("widowlbl")),s&&0!==s?(i=m.get("age")<20?1===s?s+v.get("onesiblinglbl"):s+v.get("siblingslbl"):1===s?s+v.get("onechildlbl"):s+v.get("childrenlbl"),i=", "+i):i="",this.innerHTML=t+i},setOccupation:function(e){this.innerHTML=4===e.situation?v.get("stayathome"):3===e.situation?v.get("unemployed"):0===e.situation?e.organization?v.get("student")+" @ "+e.organization:v.get("student"):2===e.situation?e.job?e.job+" ("+v.get("retired")+")":v.get("retired"):1===e.situation?e.job||e.organization?e.job&&!e.organization?e.job:!e.job&&e.organization?v.get("active")+" @ "+e.organization:e.job+" @ "+e.organization:v.get("active"):v.get("completeprofile")},showLeisure:function(e){e[0].name||e[1].name||e[2].name?this.classList.remove("invisible"):this.classList.add("invisible")},setLeisure:function(e){var t="<ul>";if(e&&e.length){for(i=0;i<e.length;i++)t+=e[i].comment?"<li>"+e[i].name+" ("+e[i].comment+")</li>":"<li>"+e[i].name+"</li>";this.innerHTML=t+"</ul>"}else this.innerHTML=""},showInterests:function(e){e[0].name||e[1].name||e[2].name?this.classList.remove("invisible"):this.classList.add("invisible")},setInterests:function(e){var t="<ul>";if(e&&e.length){for(i=0;i<e.length;i++)t+=e[i].comment?"<li>"+e[i].name+" ("+e[i].comment+")</li>":"<li>"+e[i].name+"</li>";this.innerHTML=t+"</ul>"}else this.innerHTML=""},showSN:function(e){this.innerHTML=e?e:""},setSessionCount:function(){var e=m.get("su_sessions_count")||0,t=m.get("mu_sessions_count")||0;this.innerHTML=e+t},setContactCount:function(e){var t=0;for(i=0,l=e.length;l>i;i++)"user"===e[i].type&&t++;this.innerHTML=t},setBarLength:function(e){e>=3e5?this.setAttribute("style","width: 100%"):e>=3e4?this.setAttribute("style","width: 75%"):e>=3e3?this.setAttribute("style","width: 50%"):this.setAttribute("style","width: 25%")}}),news:new n(y,{setType:function(e){e.search("CX")>-1?this.setAttribute("style","background: url('img/profileDisable.png') no-repeat center center; background-size: contain;"):e.search("RWD")>-1||e.search("RANK")>-1?this.setAttribute("style","background: url('img/brainstorm/yourScore40.png') no-repeat center center; background-size: 40px;"):e.search("ID")>-1?this.setAttribute("style","background: url('img/libraryIdeaDisabled40.png') no-repeat center center; background-size: 40px;"):e.search("2Q")>-1?this.setAttribute("style","background: url('img/2questionDisable50.png') no-repeat center center; background-size: 40px;"):e.search("2CTS")>-1&&this.setAttribute("style","background: url('img/2centDisable.png') no-repeat center center; background-size: 40px;")},setContent:function(){var e=this.getAttribute("data-news_id");switch(y.get(e).type){case"CX+":this.innerHTML="<span class='newsinfo'>"+y.get(e).content.username+"</span>"+v.get("isnowacontact");break;case"CX-":this.innerHTML="<span class='newsinfo'>"+y.get(e).content.username+"</span>"+v.get("isnolongeracontact");break;case"IDEA+":this.innerHTML=v.get("enterednewidea")+"<span class='newsinfo'>"+y.get(e).content.title+"</span>";break;case"SHID":this.innerHTML=v.get("sharedanidea")+"("+"<span class='newsinfo'>"+y.get(e).content.title+"</span>)";break;case"RANK":this.innerHTML=v.get("reachedrank")+"<span class='newsinfo'>"+y.get(e).content.label+"</span>";break;case"RWD":this.innerHTML=v.get("gotaward")+"<span class='newsinfo'>"+y.get(e).content.label+"</span>";break;case"2Q+":this.innerHTML=v.get("posted2q")+"<span class='newsinfo'>"+y.get(e).content.question+"</span>";break;case"2CTS":this.innerHTML=v.get("commentedon")+"<span class='newsinfo'>"+y.get(e).content.title+"</span>"+v.get("by")+y.get("id").content.username}},formatDate:function(e){this.innerHTML=r.formatDate(e)}}),profileevent:new s(h)}),h.template='<div id="dashboard-profile"><div class="header blue-dark"><span data-label="bind:innerHTML, profilelbl"></span></div><input class="infoslider" type="range" min="0" max="1" value ="0" data-profileevent="listen:mouseup, switchLeaderboard"><span class="slidertext" data-stats="bind:setViewLbl, view"></span><div id="profile-content" data-stats="bind:toggleInformation, view"><div class="leftprofile"><div class="userdetails"><div class="editbtn" data-profileevent="listen:mousedown, edit"></div><div class="cd-picarea"><div class="cardpicture" data-config="bind:setAvatar, avatar"></div><div class="cardinfo"><h2 data-user="bind:innerHTML,username"></h2><blockquote data-user="bind:innerHTML, intro"></blockquote><p><span class="cd-agelbl"></span><span data-user="bind:setAge, birthdate"></span></p><p><span class="cd-locationlbl"></span><span class="cd-info" data-user="bind: setLocation, address"></span></p><p><span class="cd-joblbl"></span><span class="cd-info" data-user="bind: setOccupation, occupation"></span></p><p><span class="cd-familylbl"></span><span class="cd-info" data-user="bind: setFamily, family"></span></p></div></div><div class="cd-contentarea"><div data-user="bind:showLeisure, leisure_activities"><span class="contentTitle" data-label="bind: innerHTML, hobbieslbl"></span><p class = "userinfo" data-user="bind:setLeisure, leisure_activities"></p></div><div data-user="bind:showInterests, interests"><span class="contentTitle" data-label="bind: innerHTML, interestslbl">Centers of interest</span><p class = "userinfo" data-user="bind: setInterests, interests"></p></div><div data-stats="bind:showSocialNW, socialnw"><span class="contentTitle" data-label="bind: innerHTML, socialnwlbl"></span><p class = "userinfo fb" data-user="bind:showSN, facebook"></p><p class = "userinfo gp" data-user="bind:showSN, gplus; bind:innerHTML"></p><p class = "userinfo tw" data-user="bind:showSN, twitter"></p><p class = "userinfo lin" data-user="bind:showSN, linkedin"></p></div></div><div><legend data-stats="bind: setPercentage, completion"></legend><div class="completionbar"><div class="innerbar" data-stats = "bind:setProgress, completion"></div></div></div></div><div class="edituserdetails invisible"></div><div class="mystats"><legend data-label="bind:innerHTML, mystatslbl"></legend><div class="completionbar"><ul data-user="bind: setBarLength, ip"><li class="innerbar myids" data-progressbar="bind: setWidth, ideas"></li><li class="innerbar myss" data-progressbar="bind:setWidth, sessions"></li><li class="innerbar myctcts" data-progressbar="bind: setWidth, contacts"></li><li class="innerbar my2q" data-progressbar="bind:setWidth, twoQ"></li></ul></div><table><tr class ="myids"><th data-label="bind:innerHTML, ideaslbl"></th><td data-user="bind: innerHTML, ideas_count"></td></tr><tr class ="myss"><th data-label="bind:innerHTML, sessionslbl"></th><td data-user="bind: setSessionCount, ip"></td></tr><tr class="myctcts"><th data-label="bind:innerHTML, contactslbl"></th><td data-user="bind: setContactCount, connections"></td></tr><tr class="my2q"><th data-label="bind:innerHTML, toquestionslbl"></th><td data-user="bind: innerHTML, twoquestions_count"></td></tr></table></div><div class="recentactivity"><legend data-label="bind:innerHTML, recentactivitylbl"></legend><ul data-news="foreach"><li><div class="newstype" data-news="bind:setType, type"></div><div class="newsdate" data-news="bind:formatDate, date"></div><p class="newstext" data-news="bind:setContent, content"></p></li></ul></div></div><div class = "rightprofile"><div class="userscore"><span class="ip" data-user="bind:innerHTML, ip"></span><span data-label="bind:innerHTML, ideafypoints"></span></div><div class="userachievements"><h2 class="grade" data-stats="bind:innerHTML, title"></h2><ul class="badges" data-grades="foreach"><li class="badge"><div data-grades="bind:showBadge, badge"></div><legend data-grades="bind:innerHTML, title"></legend></li></ul><ul class="badges" data-achievements="foreach"><li class="badge"><div data-achievements="bind:showBadge, badge"></div><legend data-achievements="bind:innerHTML, label"></legend></li></ul></div></div></div><div id="leaderboard" data-stats="bind:toggleLeaderboard, view"></div></div>',h.place(t.get("dashboard-profile")),h.switchLeaderboard=function(e,t){var i=document.getElementById("leaderboard");
document.getElementById("profile-content"),p||(p=new c,p.init(i)),1==t.value?w.set("view","leaderboard"):w.set("view","info")},h.edit=function(){var e=document.querySelector(".edituserdetails");document.querySelector(".userdetails").classList.add("invisible"),g?g.reset():(g=new d,g.init(e)),e.classList.remove("invisible")},a.get("observer").watch("profile-updated",function(){h.checkProfileCompletion().then(function(){h.updateGrade(),h.updateAchievements()})}),m.watchValue("ip",function(){h.updateGrade(),h.updateProgressBar()}),m.watchValue("tutorial_complete",function(){h.updateGrade(),h.updateAchievements()}),m.watchValue("settings",function(){h.updateGrade(),h.updateAchievements()}),m.watchValue("news",function(){y.reset(m.get("news"))}),m.watchValue("lang",function(){h.updateGrade().then(function(){h.updateAchievements()}),y.reset([]),y.reset(m.get("news"))}),h.checkProfileCompletion=function(){var e=r.checkProfileCompletion(),t=new u;return w.set("completion",e.percentage),w.set("missing",e.missing),e.missing.indexOf(v.get("entersocialnw"))<0&&w.set("socialnw",1),100===e.percentage&&m.get("profile_complete")!==!0?(m.set("profile_complete",!0),m.upload().then(function(){t.fulfill()})):e.percentage<100&&m.get("profile_complete")?(m.set("profile_complete",!1),m.upload().then(function(){t.fulfill()})):t.fulfill(),t},h.updateGrade=function(){var e=new u;return r.getGrade(m.get("ip"),function(t){var i;i=t.distinction?[t.grade,t.distinction]:[t.grade],L.reset(i),w.set("title",t.grade.label),e.fulfill()}),e},h.updateAchievements=function(){var e=new u;return r.getAchievements(m.get("_id"),function(t){t.length?k.reset(t):k.reset(m.get("achievements")),e.fulfill()}),e},h.updateProgressBar=function(){var e,t,i,n,s,a,o,r,l;for(t=m.get("ideas_count"),n=m.get("su_sessions_count")||0,s=m.get("mu_sessions_count")||0,i=n+s,o=m.get("twoquestions_count")||0,a=0,r=0,l=m.get("connections").length;l>r;r++)"user"===m.get("connections")[r].type&&a++;e=t+o+a+i,f.set("total",e),f.set("ideas",Math.floor(100*(t/e))),f.set("contacts",Math.floor(100*(a/e))),f.set("sessions",Math.floor(100*(i/e))),f.set("twoQ",Math.floor(100*(o/e)))},h.cleanOldNews=function(){var e,t,i=new Date,n=m.get("news"),s=new u;if(n.length){for(e=n.length-1;e>=0;e--)t=new Date(n[e].date[0],n[e].date[1],n[e].date[2]),i.getTime()-t.getTime()>1296e6&&n.splice(e,1);m.set("news",n),m.upload().then(function(){s.fulfill()})}return s},h.init=function(){h.checkProfileCompletion().then(function(){return h.updateGrade()}).then(function(){return h.updateAchievements()}).then(function(){h.updateProgressBar(),h.cleanOldNews()})},h.reset=function(){y.reset([]),y.reset(m.get("news")),h.init()},h.init(),h}}),define("dashboard/settings/settings",["OObject","service/map","Bind.plugin","Event.plugin","service/config","Store","service/utils","CouchDBBulkDocuments"],function(e,t,i,n,s,a,o,r){return function(){var l=new e,c=s.get("labels"),d=s.get("user"),u=s.get("transport"),p=[{name:c.get("public"),dest:"#public"},{name:c.get("library"),dest:"#library"},{name:c.get("brainstorm"),dest:"#brainstorm"},{name:c.get("connect"),dest:"#connect"},{name:c.get("dashboard"),dest:"#dashboard"}],g=[{name:c.get("everymin"),value:6e4},{name:c.get("everyfive"),value:3e5},{name:c.get("everyfifteen"),value:9e5},{name:c.get("never"),value:864e5}],h=new a({screens:p,timers:g,pwd:"",pwdbis:"",lang:[],pwdchange:"",contentLang:d.get("lang").substring(0,2)}),m=new a([{name:"*"}]),v=s.get("userLanguages"),f=new a;return v.forEach(function(e){m.alter("push",e)}),l.plugins.addAll({label:new i(c),options:new i(h,{setLang:function(e){var t,i,n="";for(t=0,i=e.length;i>t;t++)n+="<option>"+e[t]+"</option>";this.innerHTML=n,this.selectedIndex=e.indexOf(d.get("lang"))},setStartupScreen:function(e){var t,i,n,s="";for(t=0,i=e.length;i>t;t++)s+="<option>"+e[t].name+"</option>",e[t].dest===d.get("settings").startupScreen&&(n=t);this.innerHTML=s,this.selectedIndex=n},setPollingInterval:function(e){var t,i,n,s="";for(t=0,i=e.length;i>t;t++)s+="<option>"+e[t].name+"</option>",e[t].value===d.get("settings").polling_interval&&(n=t);this.innerHTML=s,this.selectedIndex=n},setDecks:function(e){var t,i,n,s="";for(t=0,i=e.length;i>t;t++)s+="<option>"+e[t].title+"</option>",e[t].id===d.get("active_deck")&&(n=t);this.innerHTML=s,this.selectedIndex=n},setBg:function(e){"all"===e?(this.setAttribute("style","background-image: none;"),this.innerHTML="*"):(this.innerHTML=" ",this.setAttribute("style","background-image:url('img/flags/"+e+".png');"))}}),select:new i(m,{setBg:function(e){"*"===e?(this.setAttribute("style","background-image: none;background: whitesmoke;text-align: center;"),this.innerHTML="*"):(this.innerHTML=" ",this.setAttribute("style","background-image:url('img/flags/"+e+".png');"))}}),settings:new i(f),settingsevent:new n(l)}),l.template='<div id="dashboard-settings"><div class="header blue-dark"><span data-label="bind:innerHTML, settingslbl"></span></div><div class="settingscontent"><div class="settingmodule"><legend data-label="bind:innerHTML, publicwallsettings"></legend><ul><li class="startupscreen"><span data-label="bind: innerHTML, choosepolling"></span><select data-options="bind:setPollingInterval, timers" data-settingsevent="listen: change, updatePollingInterval"></select></li></ul></div><div class="settingmodule"><legend data-label="bind:innerHTML, brainstormsettings"></legend><ul><li class="activedeck"><span data-label="bind:innerHTML, setdeck">Set brainstorming deck</span><select data-options="bind:setDecks, decks" data-settingsevent="listen: mousedown, getDecks; listen: change, updateDeck"></select></li></ul></div><div class="settingmodule"><legend data-label="bind:innerHTML, userpref"></legend><ul><li><span data-label="bind:innerHTML, setlang"></span><select data-options="bind:setLang, lang" data-settingsevent="listen: change, updateLang"></select></li><li class="activelang"><span data-label="bind:innerHTML, defaultlangfilter"></span><div class="selectlang"><div data-options="bind:setBg, contentLang"></div><button data-settingsevent = "listen:mouseup, displayLang"></button></div><ul class="langlist invisible" data-select="foreach"><li data-select="bind: setBg, name" data-settingsevent="listen: mouseup, setContentLang"></li></ul></li><li class="startupscreen"><span data-label="bind: innerHTML, choosestartup"></span><select data-options="bind:setStartupScreen, screens" data-settingsevent="listen: change, updateStartup"></select></li><li class="setting-input"><input type="checkbox" data-settings="bind: checked, showTips" data-settingsevent="listen: change, showTips"><label data-label="bind:innerHTML, showtips"></label></li><li class="setting-input"><input type="checkbox" data-settings="bind: checked, notifyPopup" data-settingsevent="listen: change, showNotif"><label data-label="bind:innerHTML, shownotif"></label></li><li class="setting-input"><input type="checkbox" data-settings="bind: checked, useascharacter" data-settingsevent="listen: change, useAsChar"><label data-label="bind:innerHTML, usechar"></label></li><li><span data-label="bind: innerHTML, changepwd"></span><input class="input" type="password" data-label="bind:placeholder, passwordplaceholder" data-options="bind: value, pwd" data-settingsevent="listen:input, updatepwd; listen: input, clearOK"><input class="input" type="password" data-label="bind:placeholder, repeatpasswordplaceholder" data-options="bind: value, pwdbis" data-settingsevent="listen:input, updatepwdbis; listen: input, clearOK"><span class="changeok" data-options="bind: innerHTML, pwdchange"></span><div class="next-button" data-label="bind:innerHTML, changelbl" data-settingsevent="listen: mousedown, press; listen:mouseup, changePWD"></div></li></ul></div></div></div>',l.place(t.get("dashboard-settings")),l.updateLang=function(e,t){t.value!==d.get("lang")&&o.updateLabels(t.value).then(function(){d.set("lang",t.value),d.upload(),h.set("timers",[{name:c.get("everymin"),value:6e4},{name:c.get("everyfive"),value:3e5},{name:c.get("everyfifteen"),value:9e5},{name:c.get("never"),value:864e5}]),h.set("screens",[{name:c.get("public"),dest:"#public"},{name:c.get("library"),dest:"#library"},{name:c.get("brainstorm"),dest:"#brainstorm"},{name:c.get("connect"),dest:"#connect"},{name:c.get("dashboard"),dest:"#dahsboard"}]),f.get("contentLang")?h.set("contentLang",f.get("contentLang")):h.set("contentLang",d.get("lang").substring(0,2))})},l.displayLang=function(){l.dom.querySelector(".langlist").classList.remove("invisible")},l.setContentLang=function(e,t){var i=parseInt(t.getAttribute("data-select_id"),10),n=d.get("settings");l.dom.querySelector(".langlist").classList.add("invisible"),0===i?(n.contentLang="all",h.set("contentLang","all")):(n.contentLang=m.get(i).name,h.set("contentLang",n.contentLang)),d.set("settings",n),d.upload()},l.getDecks=function(){var e=new r,t=d.get("taiaut_decks").concat(d.get("custom_decks")),i=[];e.setTransport(s.get("transport")),e.sync(s.get("db"),{keys:t}).then(function(){h.set("decks",[]),e.loop(function(e){var t=e.doc.content;t.characters.length>=2&&t.contexts.length>=2&&t.problems.length>=2&&t.techno.length>=4&&i.push({id:e.doc._id,title:e.doc.title})}),e.unsync(),i.sort(function(e,t){var i=e.title,n=t.title;return n>i?-1:i>n?1:i===n?0:void 0}),h.set("decks",i)})},l.updateDeck=function(e,t){var i=t.selectedIndex,n=h.get("decks")[i].id;d.set("active_deck",n),d.upload()},l.updateStartup=function(e,t){var i=t.selectedIndex,n=d.get("settings");n.startupScreen=p[i].dest,d.set("settings",n),d.upload()},l.updatePollingInterval=function(e,t){var i=t.selectedIndex,n=d.get("settings");n.polling_interval=g[i].value,d.set("settings",n),d.upload()},l.showTips=function(e,t){var i=d.get("settings");i.showTips=t.checked,d.set("settings",i),d.upload().then(function(){console.log("upload successful")})},l.showNotif=function(e,t){var i=d.get("settings");i.notifyPopup=t.checked,d.set("settings",i),d.upload()},l.useAsChar=function(e,t){var i=d.get("settings");i.useascharacter=t.checked,d.set("settings",i),d.upload()},l.press=function(e,t){t.classList.add("pressed")},l.clearOK=function(){h.set("pwdchange","")},l.updatepwd=function(e,t){h.set("pwd",t.value)},l.updatepwdbis=function(e,t){h.set("pwdbis",t.value)},l.changePWD=function(e,t){t.classList.remove("pressed"),h.get("pwd")!==h.get("pwdbis")?(h.set("pwdbis",""),h.set("pwdchange","&#10007;")):u.request("ChangePWD",{userid:d.get("_id"),pwd:h.get("pwd")},function(e){var t,i={},n={},s=d.get("notifications").concat()||[];"ok"===e&&(h.set("pwdchange","&#10003;"),i.type="pwd",i.to=d.get("_id"),i.subject=c.get("pwdchange"),i.html=c.get("pwdchangebody")+h.get("pwd"),u.request("SendMail",i,function(e){"ok"!==e.sendmail&&console.log(e)}),d.set("resetPWD",!1),t=new Date,n.type="pwd",n.status="unread",n.date=[t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds()],n.author="IDEAFY",n.username="Ideafy",n.firstname="DeeDee",n.object=c.get("pwdupdate"),n.body=c.get("pwdchangebody")+h.get("pwd"),s.unshift(n),d.set("notifications",s),d.upload().then(function(e){e.ok||console.log(e)}))})},l.reset=function(){f.reset(d.get("settings")),d.watchValue("settings",function(){f.reset(d.get("settings"))}),l.getDecks(),u.request("GetLanguages",{},function(e){h.set("lang",e)}),f.get("contentLang")?h.set("contentLang",f.get("contentLang")):h.set("contentLang",d.get("lang").substring(0,2)),h.set("timers",[{name:c.get("everymin"),value:6e4},{name:c.get("everyfive"),value:3e5},{name:c.get("everyfifteen"),value:9e5},{name:c.get("never"),value:864e5}]),h.set("screens",[{name:c.get("public"),dest:"#public"},{name:c.get("library"),dest:"#library"},{name:c.get("brainstorm"),dest:"#brainstorm"},{name:c.get("connect"),dest:"#connect"},{name:c.get("dashboard"),dest:"#dahsboard"}]),h.set("pwd",""),h.set("pwdbis",""),h.set("pwdchange","")},l.reset(),o.updateLabels(d.get("lang")),l}}),define("dashboard/about/aboutideafy",["OObject","service/config","Bind.plugin","Store"],function(e,t,i,n){return function(){var s=new e,a=t.get("labels"),o=new n([{name:a.get("solene"),contrib:a.get("contribsolene")},{name:a.get("oliviers"),contrib:a.get("contribscherrer")},{name:a.get("vincent"),contrib:a.get("contribvincent")}]);return s.plugins.addAll({labels:new i(a),credits:new i(o)}),s.template='<div class="aboutcontent"><legend data-labels="bind:innerHTML, aboutlbl"></legend><p data-labels="bind:innerHTML, ideafydesc"></p><legend data-labels="bind:innerHTML, about-taiaut"></legend><p data-labels="bind:innerHTML, taiautdesc"></p><legend data-labels="bind: innerHTML, credits"></legend><p><ul data-credits="foreach"><li><span class="contributor" data-credits="bind:innerHTML, name"></span><span class="contribution" data-credits="bind:innerHTML, contrib"></span></li></ul></p></div>',s}}),define("dashboard/about/faq",["OObject","service/config","CouchDBView","Bind.plugin","Event.plugin","Store"],function(e,t,i,n,s,a){return function(){var o=new e,r=new i,l=t.get("user");return faqlist=new a([]),o.plugins.addAll({faq:new n(faqlist),faqevent:new s(o)}),o.template='<div class="aboutcontent"><ul data-faq="foreach"><li><legend data-faq="bind:innerHTML, question"></legend><p data-faq="bind: innerHTML, response"></p></li></ul></div>',r.setTransport(t.get("transport")),o.fetch=function(e){r.unsync(),r.reset([]),faqlist.reset([]),r.sync(t.get("db"),"about","_view/faq").then(function(){r.loop(function(t){t.value.default_lang!==e&&t.value.translations[e]?faqlist.alter("push",t.value.translations[e]):faqlist.alter("push",t.value)})})},o.fetch(l.get("lang")),l.watchValue("lang",function(){o.fetch(l.get("lang"))}),o}}),define("dashboard/about/userguide",["OObject","service/config","CouchDBView","Bind.plugin","Event.plugin","Store"],function(e,t,i,n,s,a){return function(){var o=new e,r=new i,l=t.get("user"),c=t.get("labels"),d=new a([]);return o.plugins.addAll({label:new n(c),howto:new n(d),howtoevent:new s(o)}),o.template='<div class="aboutcontent"><div id="userguidetoc"><legend data-label="bind:innerHTML, toc"></legend><ul data-howto="foreach"><li><span data-howto="bind: innerHTML, title" data-howtoevent="listen: mousedown, press; listen:mouseup, goto"></span></li></ul></div><br/><ul data-howto="foreach"><li data-howto="bind:id, _id"><legend data-howto="bind:innerHTML, title"></legend><p data-howto="bind: innerHTML, body"></p><span class="backtotop" data-label="bind:innerHTML, backtotop" data-howtoevent="listen: mousedown, backToTop"></span></li></ul></div>',o.press=function(e,t){t.setAttribute("style","font-weight: bold;")},o.goto=function(e,t){var i=t.getAttribute("data-howto_id"),n=d.get(i)._id;t.setAttribute("style","font-weight: normal;"),document.getElementById(n).scrollIntoView()},o.backToTop=function(){document.getElementById("userguidetoc").scrollIntoView()},r.setTransport(t.get("transport")),o.fetch=function(e){r.unsync(),r.reset([]),d.reset([]),r.sync(t.get("db"),"about","_view/howto").then(function(){r.loop(function(t){t.value.default_lang!==e&&t.value.translations[e]?d.alter("push",t.value.translations[e]):d.alter("push",t.value)})})},o.fetch(l.get("lang")),l.watchValue("lang",function(){o.fetch(l.get("lang"))}),o}}),define("dashboard/about/tutorials",["OObject","service/config","Bind.plugin","Store"],function(e,t,i,n){return function(){var s=new e,a=t.get("labels"),o=[{name:"brainstormtutorial",src:"http://app.ideafy.com:1664/tuto04.m4v"}],r=new n(o);return s.plugins.addAll({labels:new i(a),tuto:new i(r,{setName:function(e){this.innerHTML=a.get(e)}})}),s.template='<div class="aboutcontent"><ul data-tuto="foreach"><li><legend data-tuto="bind: setName, name"></legend><div class="videocontent"><video width = "640" height="480" controls="controls"><source data-tuto="bind:src,src" type="video/mp4" /></video></div></li></ul></div>',s}}),define("dashboard/about/support",["OObject","service/config","Bind.plugin","Event.plugin","Store","CouchDBDocument"],function(e,t,i,n,s,a){return function(){var o=new e,r=t.get("labels"),l=t.get("user"),c=new s({body:"",result:""}),d=new s({}),u=new s({}),p=new a,g=new a;return p.setTransport(t.get("transport")),g.setTransport(t.get("transport")),o.plugins.addAll({labels:new i(r),support:new i(c),news:new i(d,{setVisible:function(e){e?this.classList.remove("invisible"):this.classList.add("invisible")}}),maintenance:new i(u,{setVisible:function(e){e?this.classList.remove("invisible"):this.classList.add("invisible")},setDate:function(e){this.innerHTML=new Date(e).toString()}}),supportevent:new n(o)}),o.template='<div class="aboutcontent"><p class="supportmsg invisible" data-news="bind:setVisible, active; bind:innerHTML, content"></p><legend class="support" data-labels="bind:innerHTML, supportlegend"></legend><textarea class="input" data-labels="bind:placeholder, supportplaceholder" data-support="bind: value, body"></textarea><span data-support="bind:innerHTML, result"></span><div class="cancel" data-labels="bind: innerHTML, cancellbl" data-supportevent="listen: mousedown, press; listen: mouseup, cancel"></div><div class="send" data-labels="bind: innerHTML, sendlbl" data-supportevent="listen: mousedown, press; listen: mouseup, send"></div><div class="maintenancemsg invisible" data-maintenance="bind:setVisible,active"><legend data-labels="bind:innerHTML, schedmaintenance"></legend><p><span data-labels="bind: innerHTML, nextmaintenance"></span><span class="dateandtime" data-maintenance="bind:setDate, date">Sunday April 7th 6:00 EST</span><br/><span data-maintenance="bind:innerHTML, comment"></span></p></div><div class="supportus"><legend data-labels="bind: innerHTML, twoway"></legend><p data-labels="bind: innerHTML, supportusintro"><ul><li><h4 data-labels="bind: innerHTML, asanideafyer"></h4><p data-labels="bind: innerHTML, ideafyerhelp"></p></li><li><h4 data-labels="bind: innerHTML, asanexec"></h4><p data-labels="bind: innerHTML, exechelp"></p></li><li><h4 data-labels="bind: innerHTML, asadev"></h4><p data-labels="bind: innerHTML, devhelp"></p></li><li><h4 data-labels="bind: innerHTML, asaninvest"></h4><p data-labels="bind: innerHTML, investhelp"></p></li></ul></p></div></div>',o.send=function(e,t){t.classList.remove("pressed"),o.sendRequest(c.get("body"))},o.cancel=function(e,t){t.classList.remove("pressed"),c.set("body","")},o.press=function(e,t){t.classList.add("pressed")},o.sendRequest=function(e){var i={},n=new Date;i.request=e,i.date=n.getTime(),i.userid=t.get("user").get("_id"),t.get("transport").request("Support",i,function(e){"ok"===e?c.set("result",r.get("requestsent")):c.set("result",e),setTimeout(function(){c.set("result",""),c.set("body","")},3e3)})},o.setSupportMSG=function(e){p.get("lang")!==e&&p.get("translations")[e]?d.reset(p.get("translations")[e]):d.reset(JSON.parse(p.toJSON()))},o.setMaintenanceMSG=function(e){g.get("lang")!==e&&g.get("translations")[e]?u.reset(g.get("translations")[e]):u.reset(JSON.parse(g.toJSON()))},p.sync(t.get("db"),"SUPPORTMSG").then(function(){o.setSupportMSG(l.get("lang"))}),g.sync(t.get("db"),"MAINTENANCE").then(function(){o.setMaintenanceMSG(l.get("lang"))}),l.watchValue("lang",function(){o.setSupportMSG(l.get("lang"),"SUPPORTMSG"),o.setMaintenanceMSG(l.get("lang"),"MAINTENANCE")}),p.watchValue("active",function(){o.setSupportMSG(l.get("lang"))}),g.watchValue("active",function(){o.setMaintenanceMSG(l.get("lang"))}),o}}),define("dashboard/about/eula",["OObject","service/config","Bind.plugin","CouchDBDocument","Store"],function(e,t,i,n,s){return function(){var a=new e,o=t.get("user"),r=new s;return a.plugins.add("eula",new i(r)),a.template='<div class="aboutcontent"><h4 data-eula = "bind:innerHTML, title"></h4><div data-eula="bind:innerHTML, body"></div></div>',a.fetch=function(e){var i=new n;i.setTransport(t.get("transport")),i.sync(t.get("db"),"EULA-PC").then(function(){i.get("default_lang")!==e&&i.get("translations")[e]?(r.set("title",i.get("translations")[e].title),r.set("body",i.get("translations")[e].body)):(r.set("title",i.get("title")),r.set("body",i.get("body")))})},a.fetch(o.get("lang")),o.watchValue("lang",function(){a.fetch(o.get("lang"))}),a}}),define("dashboard/about/about",["OObject","service/map","Bind.plugin","Event.plugin","Amy/Stack-plugin","service/config","Store","./aboutideafy","./faq","./userguide","./tutorials","./support","./eula"],function(e,t,i,n,s,a,o,r,l,c,d,u,p){return function(){var g=new e,h=new s,m=a.get("labels"),v=[{name:"#about",label:m.get("aboutIdeafy"),currentUI:!1},{name:"#faq",label:m.get("faq"),currentUI:!1},{name:"#userguide",label:m.get("userguide"),currentUI:!1},{name:"#tutorials",label:m.get("tutorials"),currentUI:!1},{name:"#support",label:m.get("support"),currentUI:!1},{name:"#eula",label:m.get("eula"),currentUI:!1}],f=new o(v);return g.plugins.addAll({label:new i(m),aboutmenu:new i(f,{setCurrent:function(e){e?this.classList.add("pressed"):this.classList.remove("pressed")}}),aboutstack:h,aboutevent:new n(g)}),g.template='<div id="dashboard-about"><div class="header blue-dark"><span data-label="bind:innerHTML, aboutlbl"></span></div><div class = "progressbar"><ul id = "aboutmenu" class="steplist" data-aboutmenu="foreach"><li class="step" data-aboutmenu="bind: innerHTML, label; bind:setCurrent, currentUI" data-aboutevent="listen: mousedown, changeDisplay"></li></ul></div><div id="aboutstack" data-aboutstack="destination"></div></div>',g.place(t.get("dashboard-about")),g.changeDisplay=function(e,t){var i=t.getAttribute("data-aboutmenu_id");g.show(f.get(i).name)},g.show=function(e){var t;f.loop(function(i,n){f.update(n,"currentUI",!1),i.name===e&&(t=n)}),f.update(t,"currentUI",!0),h.getStack().show(f.get(t).name)},h.getStack().add("#about",new r),h.getStack().add("#faq",new l),h.getStack().add("#userguide",new c),h.getStack().add("#tutorials",new d),h.getStack().add("#support",new u),h.getStack().add("#eula",new p),h.getStack().show("#about"),f.update(0,"currentUI",!0),g}}),define("dashboard/dashboard",["OObject","service/map","service/submenu","Amy/Stack-plugin","./profile/profile","./settings/settings","./about/about","service/config"],function(e,t,i,n,s,a,o,r){return function(){var l,c,d,u,p=new e,g=new n,h=r.get("user"),m=(r.get("observer"),function(e){g.getStack().show(e)});return p.plugins.add("dashboardstack",g),p.template='<div id="dashboard"><div id="dashboard-menu"></div><div class="stack" data-dashboardstack="destination"></div></div>',p.place(t.get("dashboard")),p.showMenu=function(){u.toggleActive(!0)},p.hideMenu=function(){u.toggleActive(!1)},p.reset=function(){u.reset(),l.reset(),c.reset()},u=new i(p.dom.querySelector("#dashboard-menu"),m),u.toggleActive(!1),l=new s,c=new a,d=new o,g.getStack().add("#profile",l),g.getStack().add("#settings",c),g.getStack().add("#about",d),h.get("resetPWD")?g.getStack().show("#settings"):g.getStack().show("#profile"),r.get("observer").watch("display-tutorials",function(){u.setWidget("#about"),g.getStack().get("#about").show("#tutorials")}),r.get("observer").watch("show-about",function(){u.setWidget("#about"),g.getStack().get("#about").show("#userguide")}),p}}),define("notify",["OObject","service/config","service/map","Store","Bind.plugin","Place.plugin","Event.plugin","service/avatar"],function(e,t,n,s,a,o,r,c){return function(){var n=new e,d=new e,u=t.get("user"),p=t.get("observer"),g=t.get("labels"),h=0,m=new s({unread:0,newmsg:!1}),v=new s([]);return n.plugins.addAll({notif:new a(m,{flashNew:function(e){var t,i=this;e&&(t=setInterval(function(){i.classList.contains("orange")?i.classList.remove("orange"):i.classList.add("orange")},600),setTimeout(function(){clearInterval(t),i.classList.remove("orange"),m.set("newmsg",!1)},3e3))}}),place:new o({notifyPopup:d}),notifevent:new r(n)}),n.template='<div><div class = "notif-bubble" data-notif="bind:innerHTML, unread"></div><div class="deedee" data-notif="bind:flashNew, newmsg" data-notifevent="listen: mousedown, push; listen:mouseup, showPopup"></div><div class = "signout-bubble" data-notifevent="listen:mousedown, signout"></div><div class = "info-bubble" data-notifevent="listen:mousedown, press; listen:mouseup, showAbout">i</div><div id="notify-popup" data-place="place:notifyPopup"></div></div>',n.getUnread=function(){var e=u.get("notifications"),t=0;for(i=0,l=e.length;l>i;i++)"unread"===e[i].status&&t++;return t},n.push=function(e,t){t.classList.add("orange"),e.stopPropagation()},n.press=function(e,t){t.classList.add("pressed")},n.showPopup=function(e,t){t.classList.remove("orange"),d.showPopup()},n.signout=function(){document.getElementById("cache").classList.add("appear"),document.getElementById("dock").querySelector(".selected").classList.remove("selected"),document.querySelector('a[href="#public"]').classList.add("selected"),t.get("observer").notify("signout")},n.showAbout=function(e,i){i.classList.remove("pressed"),t.get("observer").notify("goto-screen","#dashboard"),t.get("observer").notify("show-about")},d.plugins.addAll({labels:new a(g),notify:new a(v,{setObject:function(e){var t=this.getAttribute("data-notify_id");if(e)switch(e){case"CXR":this.innerHTML=v.get(t).username+g.get("CXRobject");break;case"INV":this.innerHTML=v.get(t).username+g.get("INVObject");break;case"CXRaccept":this.innerHTML=v.get(t).username+g.get("acceptedCXR");break;case"CXRreject":this.innerHTML=v.get(t).username+g.get("rejectedCXR");break;case"CXCancel":this.innerHTML=v.get(t).username+g.get("canceledCX");break;case"DOC":this.innerHTML=v.get(t).username+g.get("sentdocmsg");break;case"2Q+":this.innerHTML=v.get(t).username+g.get("askednew");break;case"2C+":this.innerHTML=v.get(t).username+g.get("senttc");break;case"REF":this.innerHTML=v.get(t).username+g.get("joinedideafy");break;default:this.innerHTML=v.get(t).object}},setStyle:function(e){"unread"===e?this.setAttribute("style","font-weight: bold;"):this.setAttribute("style","font-weight: normal;")},setAvatar:function(e){var t,i,n=this;e&&(t=document.createDocumentFragment(),i=new c([e]),i.place(t),n.firstChild?n.replaceChild(t,n.firstChild):n.appendChild(t))}}),notifyevent:new r(d)}),d.template='<div class="invisible"><div class="notify-header" data-labels="bind:innerHTML, notificationlbl" data-notifyevent="listen:mousedown, closePopup"></div><ul class="notify-list" data-notify="foreach: messages, 0, 7"><li data-notify="bind: setStyle, status" data-notifyevent="listen:mousedown, displayComCenter"><div data-notify="bind:setAvatar, author"></div><p><span class="notify-name" data-notify="bind:innerHTML, firstname"></span> : <span class="notify-body" data-notify="bind:setObject, type"></span></p></li></ul></div>',d.closePopup=function(){d.dom.classList.add("invisible")},d.showPopup=function(){d.dom.classList.remove("invisible"),v.reset(u.get("notifications").concat())},d.displayComCenter=function(e,t){var i=t.getAttribute("data-notify_id");p.notify("display-message",i)},p.watch("display-message",function(){d.closePopup()}),n.init=function(){n.reset(),d.dom.classList.add("invisible")},n.reset=function(){h=n.getUnread(),m.set("unread",h),m.set("newmsg",!1),v.reset(u.get("notifications").concat())},u.watchValue("notifications",function(){var e=n.getUnread(),t=u.get("notifications").concat()||[];e>h?(m.set("newmsg",!0),m.set("unread",e),h=e,u.get("settings")&&u.get("settings").notifyPopup&&popup.classList.add("show-notify")):h>e&&(m.set("unread",e),h=e),v.reset(t)}),n}}),define("service/newidea",["OObject","service/map","Bind.plugin","Event.plugin","Place.plugin","service/config","CouchDBDocument","lib/spin.min","service/utils","Promise","attach/add"],function(e,t,i,n,s,a,o,r,l,c,d){return function(){var c=new e,u=new d,p=a.get("transport"),g=new o(a.get("userLanguages")),h=a.get("user"),m=a.get("observer"),v=new o(a.get("ideaTemplate")),f=new o([]),b=function(){var e=h.get("lang").substring(0,2);v.set("lang",e),g.loop(function(t,i){t.name===e?g.update(i,"selected",!0):g.update(i,"selected",!1)})},w=a.get("labels"),y=new o({error:""}),L=new r({color:"#8cab68",lines:10,length:8,width:4,radius:8,top:-8,left:340}).spin();return v.setTransport(p),b(),c.plugins.addAll({newidea:new i(v,{displayLang:function(e){var t=e.substring(0,2);this.setAttribute("style","background-image:url('img/flags/"+t+".png');")},setVisibility:function(e){"public"===e?(this.innerHTML=w.get("publicidealbl"),this.setAttribute("style","background-image:url('img/brainstorm/publicforslider.png'); background-position: 135px center; background-repeat:no-repeat; background-size: 30px;")):(this.innerHTML=w.get("privateidealbl"),this.setAttribute("style","background-image:url('img/brainstorm/privateforslider.png'); background-position: 15px center; background-repeat:no-repeat; background-size: 20px;"))},setWarning:function(e){"public"===e?this.classList.remove("invisible"):this.classList.add("invisible")}}),alist:new i(f,{setType:function(e){var t=this;switch(e){case"pic":break;case"drawing":break;default:t.setAttribute("style","background-image:url('img/brainstorm/importDisable100.png');")}},setBg:function(e){var t=a.get("catColors"),i=this;i.setAttribute("style","background-color: transparent;"),a.get("cat").forEach(function(n,s){n===e&&i.setAttribute("style","background-color:"+t[s])})}}),select:new i(g,{setBg:function(e){this.setAttribute("style","background-image:url('img/flags/"+e+".png');")},setSelected:function(e){e?this.classList.add("selected"):this.classList.remove("selected")}}),place:new s({AddAttachment:u}),labels:new i(w),errormsg:new i(y,{setError:function(e){switch(e){case"notitle":this.innerHTML=w.get("titlefield")+w.get("emptyfielderror");break;case"nodesc":this.innerHTML=w.get("descriptionfield")+w.get("emptyfielderror");break;case"nosol":this.innerHTML=w.get("solutionfield")+w.get("emptyfielderror");break;case"noaname":this.innerHTML=w.get("noaname");break;case"noacat":this.innerHTML=w.get("noacat");break;default:this.innerHTML=e}this.setAttribute("style","color: #F27B3D;")}}),newideaevent:new n(c)}),c.template='<div><div class = "header blue-dark"><span data-labels="bind: innerHTML, createidealbl"></span><div class="close-popup" data-newideaevent="listen:mousedown, cancel"></div></div><form class="form"><div class="idealang"><div class="currentlang" data-newidea="bind: displayLang, lang" data-newideaevent="listen: mouseup, showLang"></div><ul class="invisible" data-select="foreach"><li data-select="bind: setBg, name; bind: setSelected, selected" data-newideaevent="listen: mousedown, selectFlag; listen: mouseup, setLang"></li></ul></div><input maxlength=40 type="text" class="input newideatitle" data-labels="bind:placeholder, ideatitleplaceholder" data-newidea="bind: value, title" data-newideaevent="listen: input, resetError"><textarea class="description input" data-labels="bind:placeholder, ideadescplaceholder" data-newidea="bind: value, description" data-newideaevent="listen: input, resetError"></textarea><textarea class="solution input" data-labels="bind:placeholder, ideasolplaceholder" data-newidea="bind: value, solution" data-newideaevent="listen: input, resetError"></textarea><legend class="a-legend" data-labels="bind:innerHTML, alegend"></legend><div data-place="place:AddAttachment"></div><ul class="a-list" data-alist="foreach" style="display:none"><li data-alist="bind:setBg, category"><label class="a-type" data-alist="bind:setType, type"></label><label class="a-name" data-alist="bind:innerHTML, name"></label><div class="a-del" data-newideaevent="listen:mousedown, removeAttachment"></div></li></ul><div class="visibility-input"><input class="visibility-slider" type="range" min=0 max=1 value =1 data-newideaevent="listen:change, toggleVisibility" data-wbtools="bind:setReadonly, readonly"><div class="private" data-newidea="bind: setVisibility, visibility"></div></div><div class="newidea-footer"><div class="publicwarning invisible" data-newidea="bind: setWarning, visibility"><div data-labels="bind: innerHTML, publicwarning"></div><div class="close-warning" data-newideaevent="listen:mousedown, closeWarning"></div></div><span class="errormsg" data-errormsg="bind:setError, error"></span><div class="sendmail" data-newideaevent="listen:mousedown, press; listen:mouseup, upload" data-labels="bind:innerHTML, publishlbl">Publish</div></div></form></div>',c.render(),c.place(t.get("newidea-popup")),c.showLang=function(e){e.stopPropagation(),e.preventDefault(),c.dom.querySelector(".idealang ul").classList.remove("invisible")
},c.selectFlag=function(e,t){var i;e.stopPropagation(),e.preventDefault(),i=parseInt(t.getAttribute("data-select_id"),10),g.loop(function(e,t){i===t?g.update(t,"selected",!0):g.update(t,"selected",!1)})},c.setLang=function(e,t){var i;e.stopPropagation(),i=t.getAttribute("data-select_id"),v.set("lang",g.get(i).name),c.dom.querySelector(".idealang ul").classList.add("invisible")},c.resetAttachment=function(){u.reset("new","idea",f)},c.removeAttachment=function(e,t){var i=parseInt(t.getAttribute("data-alist_id"),10),n=f.get(i).docId;f.alter("splice",i,1),l.deleteAttachmentDoc(n)},c.toggleVisibility=function(e,t){"1"===t.value?v.set("visibility","private"):v.set("visibility","public")},c.closeWarning=function(e,t){t.parentNode.classList.add("invisible")},c.press=function(e,t){t.classList.add("pressed"),c.dom.querySelector(".publicwarning").classList.add("invisible")},c.release=function(e,t){t.classList.remove("pressed")},c.clearAttachments=function(){u.getFileName()&&l.deleteAttachmentFile(u.getFileName()),f.getNbItems()&&f.loop(function(e){l.deleteAttachmentDoc(e.docId).then(function(){delCount++})}),u.reset()},c.closePopup=function(){document.getElementById("newidea-popup").classList.remove("appear"),document.getElementById("cache").classList.remove("appear"),u.getFileName()&&l.deleteAttachmentFile(v.get("_id"),u.getFileName()),c.resetAttachment(),u.abortReq(),v.unsync(),v.reset({title:"",sessionId:"",sessionReplay:!1,authors:[],description:"",solution:"",creation_date:[],character:"",problem:"",lang:"en-us",context:"",techno:[],type:6,sharedwith:[],modification_date:[],inspired_by:"",visibility:"private",votes:[],rating:"",authornames:"",twocents:[],attachments:[]}),b(),y.reset({error:""}),f.reset([]),c.dom.querySelector(".visibility-slider").value=1,c.dom.querySelector(".idealang ul").classList.add("invisible")},c.resetError=function(e,t){var i;t.scrollTop=99999,y.get("error")&&(i=t.classList.contains("description")?"nodesc":t.classList.contains("solution")?"nosol":"notitle",y.get("error")===i&&t.value&&y.set("error",""))},c.cancel=function(){f.getNbItems()&&c.clearAttachments(),c.closePopup()},c.upload=function(e,t){var i,n=new Date,s=u.getDocId()||"I:"+n.getTime(),o=v.get("attachments")||[];t.classList.remove("pressed"),v.get("title")?v.get("description")?v.get("solution")||y.set("error","nosol"):y.set("error","nodesc"):y.set("error","notitle"),y.get("error")||(t.classList.add("invisible"),L.spin(t.parentNode),i=setInterval(function(){y.get("error")===w.get("uploadinprogress")?y.set("error",w.get("uploadinprogress")+"..."):y.set("error",w.get("uploadinprogress"))},100),v.set("authors",[h.get("_id")]),v.set("authornames",h.get("username")),v.set("creation_date",[n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds()]),f.getNbItems()&&(f.loop(function(e){o.push(e)}),o.sort(function(e,t){return e.category>t.category?1:e.category<t.category?-1:e.name>t.name?1:-1}),v.set("attachments",o)),v.sync(a.get("db"),s).then(function(){return v.upload()}).then(function(){"public"===v.get("visibility")?(m.notify("NewIdea",s,"public"),p.request("UpdateUIP",{userid:h.get("_id"),type:v.get("type"),docId:s,docTitle:v.get("title")},function(e){"ok"!==e&&console.log(e),L.stop(),t.classList.remove("invisible"),c.closePopup(),clearInterval(i)})):(m.notify("NewIdea",s),L.stop(),t.classList.remove("invisible"),c.closePopup(),clearInterval(i))}))},c.resetAttachment(),["added","updated","deleted"].forEach(function(e){f.watch(e,function(){var e=c.dom.querySelector(".a-list");f.getNbItems()?e.setAttribute("style","display:block;"):e.setAttribute("style","display:none;")})}),c}}),define("service/new2q",["OObject","service/map","Bind.plugin","Event.plugin","service/config","CouchDBDocument","Promise","lib/spin.min"],function(e,t,i,n,s,a,o,r){return function(){var o=new e,l=new a(s.get("TQTemplate")),c=new a(s.get("userLanguages")),d=s.get("user"),u=function(){l.set("lang",d.get("lang")),c.loop(function(e,t){e.name===d.get("lang").substring(0,2)?c.update(t,"selected",!0):c.update(t,"selected",!1)})},p=s.get("labels"),g=140,h=new a({error:""}),m=new r({color:"#8cab68",lines:10,length:8,width:4,radius:8,top:-8,left:340}).spin();return l.setTransport(s.get("transport")),u(),o.plugins.addAll({new2q:new i(l,{displayLang:function(e){var t=e.substring(0,2);this.setAttribute("style","background-image:url('img/flags/"+t+".png');")},setLength:function(e){10===e&&this.setAttribute("maxlength",g)}}),select:new i(c,{setBg:function(e){this.setAttribute("style","background-image:url('img/flags/"+e+".png');")},setSelected:function(e){e?this.classList.add("selected"):this.classList.remove("selected")}}),labels:new i(p),errormsg:new i(h,{setError:function(e){switch(e){case"noquestion":this.innerHTML=p.get("noquestion");break;case"lengthexceeded":this.innerHTML=p.get("lengthexceeded")+" ("+g+p.get("characters")+")";break;default:this.innerHTML=e}}}),new2qevent:new n(o)}),o.template='<div><div class = "header blue-dark"><span data-labels="bind: innerHTML, createquestion"></span><div class="close-popup" data-new2qevent="listen:mousedown, cancel"></div></div><form class="form"><div class="idealang"><div class="currentlang" data-new2q="bind: displayLang, lang" data-new2qevent="listen: mouseup, showLang"></div><ul class="invisible" data-select="foreach"><li data-select="bind: setBg, name; bind: setSelected, selected" data-new2qevent="listen: mousedown, selectFlag; listen: mouseup, setLang"></li></ul></div><p><textarea class="description input" data-labels="bind:placeholder, questionplaceholder" data-new2q="bind: value, question; bind: setLength, type" data-new2qevent="listen:input, checkLength"></textarea></p><div><span class="errormsg" data-errormsg="bind:setError, error"></span><div class="sendmail" data-new2qevent="listen:mousedown, press; listen:mouseup, upload" data-labels="bind:innerHTML, publishlbl">Publish</div></div></form></div>',o.render(),o.place(t.get("new2q-popup")),o.showLang=function(e){e.stopPropagation(),e.preventDefault(),o.dom.querySelector(".idealang ul").classList.remove("invisible")},o.selectFlag=function(e,t){var i;e.stopPropagation(),i=parseInt(t.getAttribute("data-select_id"),10),c.loop(function(e,t){i===t?c.update(t,"selected",!0):c.update(t,"selected",!1)})},o.setLang=function(e,t){var i;e.stopPropagation(),i=t.getAttribute("data-select_id"),l.set("lang",c.get(i).name),o.dom.querySelector(".idealang ul").classList.add("invisible")},o.press=function(e,t){t.classList.add("pressed"),o.dom.querySelector(".description").blur()},o.closePopup=function(){document.getElementById("new2q-popup").classList.remove("appear"),document.getElementById("cache").classList.remove("appear"),l.unsync(),l.reset(s.get("TQTemplate")),u(),h.reset({error:""}),o.dom.querySelector(".idealang ul").classList.add("invisible")},o.cancel=function(){o.closePopup()},o.upload=function(e,t){var i,n=new Date,a="Q:"+n.getTime();t.classList.remove("pressed"),l.get("question")||h.set("error","noquestion"),h.get("error")||l.get("_id")||(t.classList.add("invisible"),m.spin(t.parentNode),i=setInterval(function(){h.get("error")===p.get("uploadinprogress")?h.set("error",p.get("uploadinprogress")+"..."):h.set("error",p.get("uploadinprogress"))},150),l.set("author",d.get("_id")),l.set("username",d.get("username")),l.set("creation_date",[n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds()]),l.set("lang",d.get("lang")),l.sync(s.get("db"),a).then(function(){return l.upload()}).then(function(){s.get("transport").request("UpdateUIP",{userid:d.get("_id"),type:l.get("type"),docId:a,question:l.get("question")},function(e){var r,c=d.get("connections"),u=c.length,g=[],v={type:"2Q+",docId:a,status:"unread",date:[n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds()],author:d.get("_id"),username:d.get("username"),firstname:d.get("firstname"),toList:"",ccList:"",object:d.get("username")+p.get("askednew"),body:l.get("question"),signature:""};for("ok"!==e&&console.log(e),clearInterval(i),i=setInterval(function(){h.get("error")===p.get("notifyingcontacts")?h.set("error",p.get("notifyingcontacts")+"..."):h.set("error",p.get("notifyingcontacts"))},150),r=0;u>r;r++)"user"===c[r].type&&g.push(c[r].userid);v.dest=g,s.get("transport").request("Notify",v,function(e){console.log(e)}),m.stop(),t.classList.remove("invisible"),o.closePopup()})}))},o.checkLength=function(e,t){t.value.length>=g?h.set("error","lengthexceeded"):h.set("error","")},o}}),define("service/tips",["OObject","service/map","Bind.plugin","Event.plugin","service/config","Store","CouchDBView"],function(e,t,i,n,s,a,o){return function(){var r=new e,l=s.get("labels"),c=new o([]),d=s.get("user"),u=new a([]),p=new a({});return c.setTransport(s.get("transport")),r.plugins.addAll({labels:new i(l),tip:new i(p,{setTitle:function(e){this.innerHTML="TIP:0"===e?l.get("signupwelcomeobject"):l.get("dyknow")}}),tipevent:new n(r)}),r.template='<div><div class="help-doctor"></div><div class="close-tip" data-tipevent="listen:mousedown, close"></div><div class="tip-screen"><legend data-tip="bind:setTitle, id"></legend><p data-tip = "bind: innerHTML, body"></p><div class="next-button" data-labels = "bind: innerHTML, nextbutton" data-tipevent="listen: mousedown, press; listen:mouseup, next"></div></div><div class="tip-footer"><input type="checkbox" data-tipevent="listen: change, doNotShow"><label data-labels="bind: innerHTML, notips"></label></div></div>',r.init=function(e){c.sync(s.get("db"),"about","_view/tip").then(function(){var i=d.get("lang");c.loop(function(e){var t=e.value;t.default_lang!==i&&t.translations[i]?u.alter("push",{id:t._id,title:t.translations[i].title,body:t.translations[i].body}):u.alter("push",{id:t._id,title:t.title,body:t.body})}),e?p.reset(u.get(0)):(u.alter("splice",0,1),r.getRandomTip()),r.place(t.get("tip-popup")),document.getElementById("tip-popup").classList.add("visible"),document.getElementById("cache").classList.add("appear")})},r.getRandomTip=function(){var e=u.getNbItems(),t=Math.floor(Math.random()*e);0===e?r.close():(p.reset(u.get(t)),u.alter("splice",t,1))},r.press=function(e,t){t.classList.add("pressed")},r.next=function(e,t){t.classList.remove("pressed"),r.getRandomTip()},r.close=function(){document.getElementById("tip-popup").classList.remove("visible"),document.getElementById("cache").classList.remove("appear")},r.doNotShow=function(e,t){var i;t.setAttribute("readonly","readonly"),t.checked===d.get("settings").showTips&&(i=d.get("settings"),i.showTips=!t.checked,d.set("settings",i),d.upload().then(function(){t.removeAttribute("readonly")}))},r}}),define("dock",["OObject","Place.plugin","Amy/Stack-plugin","Amy/Control-plugin","public/public","library/library","brainstorm/brainstorm","connect/connect","dashboard/dashboard","service/map","service/config","./notify","service/newidea","service/help","service/new2q","service/new2c","service/tips"],function(e,t,i,n,s,a,o,r,l,c,d,u,p,g,h,m,v){return function(){var g,m,f,b,w,y,L,k,S=new e,T=new u,M=new n(this),A=d.get("observer"),C=d.get("user"),x=new i;return S.plugins.addAll({dockstack:x,dockcontrol:M,place:new t({notify:T})}),S.template='<div id="wrapper"><nav id="dock" data-dockcontrol="radio:a,selected,mousedown,setCurrentWidget"><a class="dock-item selected" href="#public" data-dockcontrol="init"></a><a class="dock-item" href="#library"></a><a class="dock-item" href="#brainstorm"></a><a class="dock-item" href="#connect"></a><a class="dock-item" href="#dashboard"></a></nav><div class="stack" data-dockstack="destination"></div><div id="notify" data-place="place:notify"></div></div>',S.place(c.get("dock")),S.setDisplay=function(){var e=window.innerWidth,t=window.innerHeight,i=S.dom.clientWidth||1024,n=S.dom.clientHeight||748,s="";console.log(e,i),e>i&&(s+="left:50%; margin-left:-"+i/2+"px;"),t>n&&(s+="top:50%; margin-top:-"+n/2+"px;"),S.dom.setAttribute("style",s)},S.init=function(){S.setDisplay(),b=new s,console.log("public ok"),w=new a,console.log("library ok"),y=new o,console.log("brainstorm ok"),L=new r,console.log("connect ok"),k=new l,console.log("dashboard ok"),x.getStack().add("#public",b),x.getStack().add("#library",w),x.getStack().add("#brainstorm",y),x.getStack().add("#connect",L),x.getStack().add("#dashboard",k),T.init(),g=new p,m=new h,f=new v},S.start=function(e){var t=S.dom.querySelector('a[href="#public"]'),i=S.dom.querySelector('a[href="#dashboard"]'),n=S.dom.querySelector("a.selected"),s=S.dom.querySelector('a[href="'+C.get("settings").startupScreen+'"]');C.get("settings").startupScreen||C.get("resetPWD")?C.get("resetPWD")?(M.radioClass(i,n,"selected"),M.init(i),x.getStack().show("#dashboard")):(M.radioClass(s,n,"selected"),M.init(s),x.getStack().show(C.get("settings").startupScreen)):(n!==t&&(M.radioClass(t,n,"selected"),M.init(t)),x.getStack().show("#public")),(e||C.get("settings").showTips!==!1)&&f.init(e),C.set("online",!0),C.upload()},S.reset=function(){b.reset(),w.reset(),y.reset(),L.reset(),k.reset(),T.reset()},this.setCurrentWidget=function(e){var t=e.target.getAttribute("href"),i=1500;e.preventDefault(),t!==x.getStack().getCurrentName()?(x.getStack().getCurrentScreen().hideMenu(),x.getStack().show(t),x.getStack().getCurrentScreen().showMenu(),setTimeout(function(){x.getStack().getCurrentScreen().hideMenu()},i)):x.getStack().getCurrentScreen().showMenu()},A.watch("replay-session",function(){var e=document.querySelector(".dock-item.selected"),t=document.querySelector(".dock-item[href='#brainstorm']");x.getStack().show("#brainstorm"),M.radioClass(t,e,"selected"),M.init(t)}),A.watch("display-doc",function(){var e=document.querySelector(".dock-item.selected"),t=document.querySelector(".dock-item[href='#library']");x.getStack().show("#library"),M.radioClass(t,e,"selected"),M.init(t)}),A.watch("display-message",function(){var e=document.querySelector(".dock-item.selected"),t=document.querySelector(".dock-item[href='#connect']");x.getStack().show("#connect"),M.radioClass(t,e,"selected"),M.init(t)}),A.watch("display-tutorials",function(){var e=document.querySelector(".dock-item.selected"),t=document.querySelector(".dock-item[href='#dashboard']");x.getStack().show("#dashboard"),M.radioClass(t,e,"selected"),M.init(t)}),A.watch("join-musession",function(){var e=document.querySelector(".dock-item.selected"),t=document.querySelector(".dock-item[href='#brainstorm']");"#brainstorm"!==x.getStack().getCurrentName()&&(x.getStack().show("#brainstorm"),M.radioClass(t,e,"selected"),M.init(t))}),A.watch("goto-screen",function(e){var t=document.querySelector(".dock-item.selected"),i=document.querySelector(".dock-item[href='"+e+"']");x.getStack().getCurrentName()!==e&&(x.getStack().show(e),M.radioClass(i,t,"selected"),M.init(i))}),S}}),define("login",["OObject","Amy/Stack-plugin","service/map","Event.plugin","service/config","Bind.plugin","Store","lib/spin.min","Promise","CouchDBDocument","service/confirm"],function(e,t,i,n,s,a,o,r,l,c,d){return function(u,p,g){var h,m,v,f=new e,b=new e,w=new e,y=new e,L=new e,k=new e,S=new t,T=new o({email:"",firstname:"",lastname:"","confirm-password":"",password:"",error:"",reset:!1}),M=s.get("labels"),A=s.get("transport"),C=s.get("db"),x=new r({color:"#657B99",lines:10,length:10,width:8,radius:15,top:270}).spin(),q=!1,H=new c;return f.plugins.addAll({loginstack:S}),y.plugins.add("label",new a(M)),y.template='<div id="loading"><p data-label="bind: innerHTML, loadingmessage"></p><div id="loadingspin"></div></div>',y.place(document.getElementById("loading")),L.plugins.add("label",new a(M)),L.template='<div id="serverdown"><p data-label="bind: innerHTML, maintenancemessage"></p><div id="loadingspin"></div></div>',k.plugins.add("label",new a(M)),k.template='<div id="nointernt"><p data-label="bind: innerHTML, nointernet"></p><div id="loadingspin"></div></div>',w.plugins.addAll({label:new a(M),loginmodel:new a(T),signupevent:new n(w)}),w.template='<form id="signup-form"><p class="login-fields"><input name="email" data-loginmodel="bind:value,email" data-label="bind:placeholder, emailplaceholder" type="text" data-signupevent="listen: input, resetError"><input name="password" data-loginmodel="bind:value,password" type="password" data-label="bind:placeholder, passwordplaceholder" data-signupevent="listen: input, resetError"><input name="confirm-password" data-loginmodel="bind:value,confirm-password" type="password" data-label="bind:placeholder, repeatpasswordplaceholder" data-signupevent="listen: input, resetError"><input name="firstname" data-loginmodel="bind:value,firstname" type="text" data-label="bind:placeholder, firstnameplaceholder" data-signupevent="listen: input, resetError"><input name="lastname" data-loginmodel="bind:value,lastname" type="text" data-label="bind:placeholder, lastnameplaceholder" data-signupevent="listen:input, resetError; listen:keypress, entersignup"></p><p><label data-loginmodel="bind:innerHTML,error" class="login-error"></label></p><p><label id="signup" class="login-button pressed-btn" data-label="bind:innerHTML, signupbutton" data-signupevent="listen: mousedown, press; listen: mouseup, release; listen:mouseup, signup"></label></p><p><label class="login-button pressed-btn" name="#login-screen" data-signupevent="listen: mousedown, press; listen:mouseup, release; listen: mouseup, showLogin" data-label="bind:innerHTML, loginbutton"></label></p></form>',w.press=function(e,t){t.focus(),t.classList.add("pressed")},w.release=function(e,t){t.classList.remove("pressed")},w.entersignup=function(e){13===e.keyCode&&(e.target.blur(),w.signup())},w.showLogin=function(){f.reset(),S.getStack().show("#login-screen")},w.resetError=function(e,t){var i=t.getAttribute("name"),n=w.dom.querySelector("#signup");T.set("error",""),T.set(i,t.value),T.get("email")&&T.get("password")&&T.get("confirm-password")&&T.get("firstname")&&T.get("lastname")?n.classList.add("btn-ready"):n.classList.remove("btn-ready")},w.getEULA=function(){H.setTransport(A),H.sync(C,"EULA-PC").then(function(){var e,t=M.get("language");H.get("translations")&&(e=H.get("translations")[t]),v=e?"<h4>"+e.title+"</h4></div>"+e.body+"</div>":"<h4>"+H.get("title")+"</h4></div>"+H.get("body")+"</div>",console.log(H.toJSON(),v,t,M.toJSON()),M.watchValue("language",function(t){e=H.get("translations")[t],v=e?"<h4>"+e.title+"</h4></div>"+e.body+"</div>":"<h4>"+H.get("title")+"</h4></div>"+H.get("body")+"</div>"})})},w.showEULA=function(){m||(m=new d(w.dom,v,w.completeSignup,"EULA"),m.show())},w.completeSignup=function(e){var t=T.get("firstname"),i=T.get("lastname"),n=T.get("email").toLowerCase(),a=(new l,new c);e?(m.hide(),x.spin(w.dom),A.request("Signup",{name:n,password:password,fn:t,ln:i,lang:s.get("lang")},function(e){if("ok"===e.signup){a.reset(s.get("userTemplate")),a.set("firstname",t),a.set("lastname",i),a.set("username",t+" "+i),a.set("lang",s.get("lang"));var o=new Date;a.set("regdate",[o.getFullYear(),o.getMonth(),o.getDate()]),a.set("notifications",[{type:"MSG",toList:t+" "+i,date:[o.getFullYear(),o.getMonth(),o.getDate(),o.getHours(),o.getMinutes(),o.getSeconds()],object:M.get("signupwelcomeobject"),status:"unread",author:"IDEAFY",firstname:"DeeDee",signature:"-- Ideas made easy!",username:"Ideafy",body:M.get("signupwelcomebody")}]),A.request("Welcome",{userid:n,language:a.get("lang")},function(e){return e}),e.db&&g.set("db",e.db),a.set("online",!0),a.set("sock",s.get("socket").socket.sessionid),a.setTransport(A),a.sync(e.db,n).then(function(){return a.upload()}).then(function(){g.set("currentLogin",n),g.set("userAvatar",a.get("picture_file")),g.sync("ideafy-data"),s.set("uid",'"'+n+'"'),a.unsync(),q?p(!0):u(!0)})}else T.set("error","error : "+e.message),T.set("email",""),x.stop()},this)):(m.hide(),T.set("error",M.get("EULArejected")))},w.signup=function(e,t){var i=T.get("email"),n=T.get("firstname"),s=T.get("lastname"),a=T.get("password"),o=T.get("confirm-password");if(t.classList.remove("btn-ready"),""===i)T.set("error",M.get("signupmissingemail"));else if(""===a)T.set("error",M.get("signupmissingpwd"));else if(""===o)T.set("error",M.get("signupmissingpwdok"));else if(""===n)T.set("error",M.get("signupmissingfn"));else if(""===s)T.set("error",M.get("signupmissingln"));else{var r=i.toLowerCase(),l=/^[a-z0-9._-]+@[a-z0-9.-]+\.[a-z]{2,4}$/;l.test(r)?a!==o?T.set("error",M.get("signuppwdnomatch")):w.showEULA():T.set("error",M.get("signupinvalidemail"))}},b.plugins.addAll({label:new a(M),loginmodel:new a(T,{forgotpwd:function(e){e?this.classList.remove("loginvisible"):this.classList.add("loginvisible")}}),loginevent:new n(b)}),b.template='<form id="login-form"><p class="login-fields"><input name="email" data-loginmodel="bind:value,email" autofocus="autofocus" data-label="bind:placeholder, emailplaceholder" type="text" data-loginevent="listen:input, resetError"><input name="password" data-loginmodel="bind:value,password" type="password" data-label="bind:placeholder, passwordplaceholder" data-loginevent="listen: input, resetError; listen:keypress, enterlogin"></p><p><label class="login-button pressed-btn" data-label="bind: innerHTML, loginbutton" data-loginevent="listen:mousedown, press; listen: mouseup, release; listen:mouseup, login"></label></p><p class="login-error"><label data-loginmodel="bind:innerHTML,error" class="login-error"></label><label class="forgotpwd" data-loginmodel="bind:forgotpwd,reset" data-label="bind:innerHTML, forgotpwd"  data-loginevent="listen:mousedown, press; listen:mouseup, release; listen:mouseup, resetPassword">Forgot your password?</label></p><p><label id="signup-button" class="pressed-btn" name="#signup-screen" data-label="bind: innerHTML, newuserbutton" data-loginevent="listen: mousedown, press; listen:mouseup, release; listen: mouseup, showSignup"></label></p></form>',b.press=function(e,t){t.classList.add("pressed")},b.release=function(e,t){t.classList.remove("pressed")},b.enterlogin=function(e){13===e.keyCode&&(e.target.blur(),b.login())},b.showSignup=function(){f.reset(),S.getStack().show("#signup-screen")},b.resetError=function(e,t){var i=t.getAttribute("name"),n=b.dom.querySelector(".login-button");T.set("error",""),T.set("reset",!1),T.set(i,t.value),T.get("email")&&T.get("password")?n.classList.add("btn-ready"):n.classList.remove("btn-ready")},b.login=function(e,t){var i=T.get("email").toLowerCase(),n=T.get("password"),a=t||b.dom.querySelector(".login-button");i&&n?(x.spin(b.dom),A.request("Login",{name:i,password:n,sock:s.get("socket").socket.sessionid},function(e){"ok"===e.login?(s.set("uid",'"'+i+'"'),e.db&&g.set("db",e.db),g.set("currentLogin",i),A.request("GetAvatar",{id:i},function(e){e.error||(g.set("userAvatar",e),g.sync("ideafy-data"),s.set("avatar",e)),q?p():u()})):(T.set("error",M.get("invalidlogin")),T.set("reset",!0),x.stop())})):T.set("error",M.get("invalidlogin")),a.classList.remove("btn-ready")},b.resetPassword=function(){var e=T.get("email").toLowerCase();A.request("ResetPWD",{user:e},function(t){"ok"===t?T.set("error",M.get("temppwd")+e):t.rst?T.set("error",M.get("failedpwdreset")+"<a href='mailto:"+t.contact+"?Subject=Password%20support%20"+e+"'>"+M.get("support")+"</a>"):(console.log(t),T.set("error",M.get("somethingwrong")))})},S.getStack().add("#login-screen",b),S.getStack().add("#signup-screen",w),S.getStack().add("#loading-screen",y),S.getStack().add("#maintenance-screen",L),S.getStack().add("#nointernet",k),f.alive(i.get("login")),f.init=function(){S.getStack().show("#loading-screen"),h=new r({color:"#9AC9CD",lines:10,length:20,width:8,radius:15}).spin(document.getElementById("loadingspin"))},f.setScreen=function(e){S.getStack().show(e),"#signup-screen"===e&&w.getEULA()},f.reset=function(e){T.reset({email:"",firstname:"",lastname:"","confirm-password":"",password:"",error:"",reset:!1}),e&&(q=!0)},f.stopSpinner=function(){x&&x.stop(),h&&h.stop()},f}}),require(["OObject","LocalStore","service/map","Amy/Stack-plugin","Bind.plugin","Amy/Delegate-plugin","./dock","./login","service/config","service/utils","Promise"],function(e,t,i,n,s,a,o,r,l,c,d){var u,p=new e,g=null,h=new n({"#login":g}),m=new o,v=new t,f=c.updateLabels,b=c.checkServerStatus,w=l.get("labels"),y=l.get("db"),L=l.get("transport"),k=l.get("user");u=l.get("version"),p.plugins.addAll({stack:h}),p.init=function(e){h.getStack().add("#dock",m),v.get("db")&&v.get("db")!==y&&(y=v.get("db")),k.sync(y,v.get("currentLogin")).then(function(){var e=new d;return l.set("uid",'"'+k.get("_id")+'"'),k.get("lang")!==l.get("lang")?f(k.get("lang")).then(function(){e.fulfill()}):e.fulfill(),e}).then(function(){var e=new d;return k.get("picture_file").search("img/avatars/deedee")>-1?(l.set("avatar",k.get("picture_file")),e.fulfill()):v.get("userAvatar")?(l.set("avatar",v.get("userAvatar")),e.fulfill()):L.request("GetFile",{dir:"avatars",filename:k.get("_id")+"_@v@t@r"},function(t){t.error?(console.log(t.error),l.set("avatar","img/avatars/deedee1.png")):l.set("avatar",t),e.fulfill()}),e}).then(function(){m.init(),g.stopSpinner(),h.getStack().show("#dock"),m.start(e)})},p.reload=function(e){k.unsync(),k.reset(),k.sync(y,v.get("currentLogin")).then(function(){var e=new d;return l.set("uid",'"'+k.get("_id")+'"'),k.get("lang")!==l.get("lang")?f(k.get("lang")).then(function(){e.fulfill()}):e.fulfill(),e}).then(function(){var e=new d;return k.get("picture_file").search("img/avatars/deedee")>-1?(l.set("avatar",k.get("picture_file")),e.fulfill()):v.get("userAvatar")?(l.set("avatar",v.get("userAvatar")),e.fulfill()):L.request("GetFile",{dir:"avatars",filename:k.get("_id")+"_@v@t@r"},function(t){t.error?(console.log(t.error),l.set("avatar","img/avatars/deedee1.png")):l.set("avatar",t),e.fulfill()}),e}).then(function(){m.reset(),g.stopSpinner(),h.getStack().show("#dock"),m.start(e)})},p.alive(i.get("body")),v.sync("ideafy-data"),g=new r(p.init,p.reload,v),document.querySelector(".spinner").classList.add("invisible"),h.getStack().show("#login"),h.getStack().setCurrentScreen(g),g.init(),navigator.connection&&"none"===navigator.connection.type?(v.get("labels")?w.reset(v.get("labels")):w.reset(l.get("defaultLabels")),l.set("lang",w.set("language")),g.setScreen("#nointernet")):b().then(function(){v.get("labels")?(w.reset(v.get("labels")),l.set("lang",w.get("language"))):f(navigator.language),L.request("CheckVersion",{version:u},function(e){var t=w.get("outdated")||"Please update your application";"outdated"===e&&alert(t)});var e=v.get("currentLogin")||"";e?L.request("CheckLogin",{id:e,sock:l.get("socket").socket.sessionid},function(e){e.authenticated?p.init():g.setScreen("#login-screen")}):g.setScreen("#signup-screen")},function(){v.get("labels")?w.reset(v.get("labels")):w.reset(l.get("defaultLabels")),g.setScreen("#maintenance-screen")}),l.get("observer").watch("signout",function(){k.set("online",!1),k.set("sock",""),k.upload(),v.set("currentLogin",""),v.set("userAvatar",""),v.sync("ideafy-data"),h.getStack().add("#login",g),g.reset(!0),h.getStack().show("#login"),h.getStack().setCurrentScreen(g),g.setScreen("#login-screen"),document.getElementById("cache").classList.remove("appear")}),i.get("body").addEventListener("mousedown",c.checkSocketStatus,!1),l.get("observer").watch("reconnect",function(e){return v.sync("ideafy-data"),"all"!==e?(k.set("online",!0),k.set("sock",l.get("socket").socket.sessionid),k.upload()):(b().then(function(){return k.unsync(),k.sync(y,v.get("currentLogin"))},function(){g.setScreen("#maintenance-screen")}).then(function(){return k.set("online",!0),k.set("sock",l.get("socket").socket.sessionid),k.upload()}),void 0)})}),define("main",function(){});