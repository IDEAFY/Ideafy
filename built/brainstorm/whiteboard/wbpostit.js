/**
 * https://github.com/TAIAUT/Ideafy
 * Proprietary License - All rights reserved
 * Author: Vincent Weyl <vincent.weyl@taiaut.com>
 * Copyright (c) 2012-2013 TAIAUT
 */

define(["OObject","Store","Bind.plugin","Event.plugin","service/config"],function(e,t,i,s,n){return function(a,r){var c=new e,o=n.get("labels"),l="#4D4D4D",d=[{name:"blue",color:"#657B99",img:"postItBlue.png",selected:!1},{name:"azur",color:"#9AC9CD",img:"postItAzur.png",selected:!1},{name:"yellow",color:"#F2E520",img:"postItYellow.png",selected:!0},{name:"orange",color:"#F27B3D",img:"postItOrange.png",selected:!1}],u=new t(d),p=null,g=new t({type:"postit",content:"",style:{postit:"yellow",img:"postItYellow.png",marker:"#4D4D4D"}});return c.plugins.addAll({labels:new i(o),postit:new i(g,{setStyle:function(e){var t=e.marker,i=e.img;this.setAttribute("style","background-image:url('img/brainstorm/"+i+"'); color:"+t+";")}}),colors:new i(u,{setBg:function(e){this.setAttribute("style","background:"+e+";")},setSelected:function(e){this.innerHTML=e?"&#10003;":""}}),postitevent:new s(c)}),c.template='<div class="wbpostit"><div class="postit-cancel postit-close" data-postitevent="listen:touchstart,cancel"></div><div class="postit" data-postit="bind:setStyle, style"><textarea data-postit="bind: value, content"></textarea></div><span class="choosecolorlbl" data-labels="bind:innerHTML, choosecolorlbl"></span><ul class="postitcolors" data-colors="foreach"><li class="postitcolor" data-postitevent="listen:touchstart,choose" data-colors="bind:setBg, color;bind:setSelected, selected"></li></ul><div name="post" class = "postpostit" data-postitevent="listen: touchstart, press; listen:touchend, post"></div><div class = "delpostit" name="del" data-postitevent="listen:touchstart, press;listen:touchend, del"></div></div>',c.cancel=function(){r("postit")},c.choose=function(e,t){var i=t.getAttribute("data-colors_id");u.loop(function(e,t){t===parseInt(i,10)?u.update(t,"selected",!0):u.update(t,"selected",!1)}),g.set("style",{postit:u.get(i).name,marker:l,img:u.get(i).img})},c.press=function(e,t){t.classList.add("pressed")},c.post=function(e,t){p||0===p?a.alter("splice",p,1,JSON.parse(g.toJSON())):a.alter("push",JSON.parse(g.toJSON())),t.classList.remove("pressed"),r("postit"),c.reset()},c.reset=function(e){p=e,p||0===p?g.reset(a.get(p)):(g.reset({type:"postit",content:"",style:{postit:"yellow",img:"postItYellow.png",marker:"#4D4D4D"}}),u.reset([{name:"blue",color:"#657B99",img:"postItBlue.png",selected:!1},{name:"azur",color:"#9AC9CD",img:"postItAzur.png",selected:!1},{name:"yellow",color:"#F2E520",img:"postItYellow.png",selected:!0},{name:"orange",color:"#F27B3D",img:"postItOrange.png",selected:!1}]))},c.del=function(e,t){p&&a.del(p),t.classList.remove("pressed"),c.reset(),r("postit")},c}});