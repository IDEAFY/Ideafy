/**
 * https://github.com/TAIAUT/Ideafy
 * Proprietary License - All rights reserved
 * Author: Vincent Weyl <vincent.weyl@taiaut.com>
 * Copyright (c) 2012-2013 TAIAUT
 */

define(["OObject","service/map","service/submenu","Amy/Stack-plugin","Bind.plugin","service/config","Store","service/utils","./ideafy-menu","./quickb/quickb","./multi/mub"],function(e,t,i,s,n,a,r,c,o,d,u){return function(){var c,l=new e,g=new r,m=new s;return a.get("user"),l.plugins.addAll({brainstormstack:m,header:new n(g,{setDate:function(e){e&&(this.innerHTML=e.toLocaleDateString())},setTime:function(e){var t=e.getHours(),i=e.getMinutes(),s=e.getSeconds();10>t&&(t="0"+t),10>i&&(i="0"+i),10>s&&(s="0"+s),this.innerHTML=t+":"+i+":"+s}})}),l.template='<div id="brainstorm"><div id="brainstorm-menu"></div><div class="brainstorm-header header blue-light"><div class="date" data-header="bind: setDate, date"></div><span class="headerTitle" data-header="bind: innerHTML, headertitle"></span><div class="clock" data-header="bind: setTime, date">hh:mm</div></div><div class="stack" data-brainstormstack="destination"></div></div>',l.place(t.get("brainstorm")),l.showMenu=function(){c.toggleActive(!0)},l.hideMenu=function(){c.toggleActive(!1)},l.exitSession=function(){m.getStack().show("menu")},l.reset=function(){m.getStack().get("menu").reset(),m.getStack().show("menu")},l.selectScreen=function(e,t){if("continue"===e&&(e=t.type),"tutorial"!==e&&m.getStack().get(e))m.getStack().get(e).reset(t),m.getStack().show(e);else{switch(t?e=t.type:t=null,e){case"quick":m.getStack().add("quick",new d(t,l.exitSession));break;case"musession":m.getStack().add("musession",new u(t,l.exitSession));break;case"tutorial":a.get("observer").notify("display-tutorials");break;default:e=""}e&&m.getStack().show(e)}},c=new i(l.dom.querySelector("#brainstorm-menu")),c.toggleActive(!1),g.set("headertitle",a.get("labels").get("brainstormheadertitle")),setInterval(function(){var e=new Date;g.set("date",e)},1e3),m.getStack().add("menu",new o(l.selectScreen)),m.getStack().show("menu"),a.get("observer").watch("replay-session",function(e){var t={};t.id=e,e.toLowerCase().search("quick")>-1&&(t.type="quick"),e.toLowerCase().search("s:mu")>-1&&(t.type="musession"),l.selectScreen(t.type,t)}),a.get("observer").watch("join-musession",function(e){var t={type:"musession",id:e,mode:"join"};l.selectScreen(t.type,t)}),l}});