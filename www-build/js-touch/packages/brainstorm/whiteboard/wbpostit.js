/**
 * https://github.com/TAIAUT/Ideafy
 * Proprietary License - All rights reserved
 * Author: Vincent Weyl <vincent.weyl@taiaut.com>
 * Copyright (c) 2012-2013 TAIAUT
 */

define(["OObject","Store","Bind.plugin","Event.plugin","service/config"],function(e,t,n,r,i){return function(o,u){var a=new e,f=i.get("labels"),l="#4D4D4D",c=[{name:"blue",color:"#657B99",img:"postItBlue.png",selected:!1},{name:"azur",color:"#9AC9CD",img:"postItAzur.png",selected:!1},{name:"yellow",color:"#F2E520",img:"postItYellow.png",selected:!0},{name:"orange",color:"#F27B3D",img:"postItOrange.png",selected:!1}],h=new t(c),p=null,d=new t({type:"postit",content:"",style:{postit:"yellow",img:"postItYellow.png",marker:"#4D4D4D"}});return a.plugins.addAll({labels:new n(f),postit:new n(d,{setStyle:function(e){var t=e.marker,n=e.img;this.setAttribute("style","background-image:url('img/brainstorm/"+n+"'); color:"+t+";")}}),colors:new n(h,{setBg:function(e){this.setAttribute("style","background:"+e+";")},setSelected:function(e){e?this.innerHTML="&#10003;":this.innerHTML=""}}),postitevent:new r(a)}),a.template='<div class="wbpostit"><div class="postit-cancel postit-close" data-postitevent="listen:touchstart,cancel"></div><div class="postit" data-postit="bind:setStyle, style"><textarea data-postit="bind: value, content"></textarea></div><span class="choosecolorlbl" data-labels="bind:innerHTML, choosecolorlbl"></span><ul class="postitcolors" data-colors="foreach"><li class="postitcolor" data-postitevent="listen:touchstart,choose" data-colors="bind:setBg, color;bind:setSelected, selected"></li></ul><div name="post" class = "postpostit" data-postitevent="listen: touchstart, press; listen:touchend, post"></div><div class = "delpostit" name="del" data-postitevent="listen:touchstart, press;listen:touchend, del"></div></div>',a.cancel=function(e,t){u("postit")},a.choose=function(e,t){var n=t.getAttribute("data-colors_id");h.loop(function(e,t){t===parseInt(n,10)?h.update(t,"selected",!0):h.update(t,"selected",!1)}),d.set("style",{postit:h.get(n).name,marker:l,img:h.get(n).img})},a.press=function(e,t){t.classList.add("pressed")},a.post=function(e,t){!p&&p!==0?o.alter("push",JSON.parse(d.toJSON())):o.alter("splice",p,1,JSON.parse(d.toJSON())),t.classList.remove("pressed"),u("postit"),a.reset()},a.reset=function(t){p=t,!p&&p!==0?(d.reset({type:"postit",content:"",style:{postit:"yellow",img:"postItYellow.png",marker:"#4D4D4D"}}),h.reset([{name:"blue",color:"#657B99",img:"postItBlue.png",selected:!1},{name:"azur",color:"#9AC9CD",img:"postItAzur.png",selected:!1},{name:"yellow",color:"#F2E520",img:"postItYellow.png",selected:!0},{name:"orange",color:"#F27B3D",img:"postItOrange.png",selected:!1}])):d.reset(o.get(p))},a.del=function(e,t){p&&o.del(p),t.classList.remove("pressed"),a.reset(),u("postit")},a}});