/**
 * https://github.com/TAIAUT/Ideafy
 * Proprietary License - All rights reserved
 * Author: Vincent Weyl <vincent.weyl@taiaut.com>
 * Copyright (c) 2012-2013 TAIAUT
 */

define(["Olives/OObject","service/config","Store","Olives/Model-plugin","Olives/Event-plugin","twocents/writetwocent","twocents/twocentlist","service/avatar","service/utils"],function(e,t,n,r,i,s,o,u,a){return function(){var l=new e,c=t.get("labels"),h=t.get("user"),p=new n,d=new s("connect"),v=new o,m;return l.plugins.addAll({labels:new r(c),tqdetail:new r(p,{setHeader:function(e){e?e===h.get("_id")?this.innerHTML=c.get("mytqdetailheader"):this.innerHTML=c.get("tqheaderprefix")+p.get("username")+c.get("tqheadersuffix"):this.innerHTML=c.get("selecttq")},displayWriteTwocent:function(e){!e||e===h.get("_id")?this.classList.add("invisible"):this.classList.remove("invisible")},displayTwocentList:function(e){e&&e.length&&document.getElementById("connect-writetwocents").classList.add("invisible")},displayTwocentNB:function(e){var t=e.length||0;t?t===1?this.innerHTML=t+" "+c.get("showonetcreply"):this.innerHTML=t+"showtcrepliesafter":this.innerHTML=c.get("noreplyyet")},date:function g(g){g&&(this.innerHTML=a.formatDate(g))},setAuthor:function(e){e===h.get("username")&&p.get("author")===h.get("_id")?this.innerHTML=c.get("youlbl"):this.innerHTML=e},setWrotelbl:function(e){e===h.get("_id")?this.innerHTML=c.get("youwrotelbl"):this.innerHTML=c.get("ideawrotelbl")},setAvatar:function(t){var n=document.createDocumentFragment(),r=new u([t]);r.place(n),this.hasChildNodes()?this.replaceChild(n,this.firstChild):this.appendChild(n)}}),tqevent:new i(l)}),l.template='<div class="twocent-detail"><div class="header blue-dark"><span data-tqdetail="bind: setHeader, author"></span></div><div class = "detail-contents"><div class="detail-header"><div class="avatar" data-tqdetail="bind:setAvatar, author"></div><span class="author" data-tqdetail="bind:setAuthor,username"></span><span class="commentlbl" data-tqdetail="bind: setWrotelbl, author"></span><p data-tqdetail="bind:innerHTML,question"></p><span class="date" data-tqdetail="bind:date, creation_date"></span></div><div class="detail-body"></div><div class="detail-footer"><div class="tcbutton" data-tqevent="listen:mousedown, press; listen: mouseup, write"></div><div class="tcreplies" data-tqdetail = "bind: displayTwocentNB, twocents"></div></div><div id="connect-writetwocents" class="invisible" data-tqdetail="bind: displayWriteTwocent, author"></div><div id="connect-twocents" class="twocents" data-tqdetail="bind: displayTwocentList, twocents"></div></div></div>',l.press=function(e,t){t.classList.add("pressed")},l.write=function(e,t){t.classList.remove("pressed"),document.getElementById("connect-writetwocents").classList.remove("invisible")},l.hide=function(){document.querySelector(".detail-contents").classList.add("invisible"),p.reset({})},l.reset=function(t){m||(m=document.getElementById("connect-writetwocents")),d.place(m),p.reset(t.value),d.reset(p.get("_id")),v.reset(p.get("_id"),"connect")},l}});