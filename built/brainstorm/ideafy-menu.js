/**
 * https://github.com/TAIAUT/Ideafy
 * Proprietary License - All rights reserved
 * Author: Vincent Weyl <vincent.weyl@taiaut.com>
 * Copyright (c) 2012-2013 TAIAUT
 */

define(["OObject","service/map","Store","Bind.plugin","Event.plugin","service/config"],function(e,t,i,s,n,a){return function(c){var r=new e,o=a.get("user"),u=a.get("labels"),d=new i,l={name:"continue",active:!0,selected:!1,label:u.get("continuesession"),bg:"continuesession.png",bgselected:"continueactive.png"},g="";return r.plugins.addAll({ideafymenu:new s(d,{setActive:function(e){e?this.classList.remove("inactive"):this.classList.add("inactive")},setBg:function(e){var t=this.getAttribute("data-ideafymenu_id");e?this.setAttribute("style","background-image:url('img/brainstorm/"+d.get(t).bgselected+"');color:white;"):this.setAttribute("style","background-image:url('img/brainstorm/"+d.get(t).bg+"');color:#4D4D4D;")}}),labels:new s(u),ideafyevent:new n(this)}),r.template='<div id="ideafy-menu"><div class="brainstorm-header header blue-light" data-labels="bind: innerHTML, brainstormchoosemode"></div><ul class="menu" data-ideafymenu = "foreach"><li data-ideafymenu="bind:innerHTML, label; bind: setActive, active; bind:setBg, selected" data-ideafyevent="listen:touchstart, press; listen: touchend, start"></li></ul></div>',r.place(t.get("ideafy-menu")),this.press=function(e,t){var i=t.getAttribute("data-ideafymenu_id");d.update(i,"selected",!0),t.classList.add("pressed")},this.start=function(e,t){var i=t.getAttribute("data-ideafymenu_id");"continue"===d.get(i).name?c("continue",g):c(d.get(i).name),t.classList.remove("pressed"),d.update(i,"selected",!1)},r.addContinue=function(e){var t=JSON.parse(d.toJSON());"continue"!==d.get(0).name&&(t.unshift(l),d.reset(t)),g=e},r.removeContinue=function(){var e=JSON.parse(d.toJSON());"continue"===e[0].name&&e.splice(0,1),d.reset(e),g=""},r.reset=function(){d.reset([{name:"quick",active:!0,selected:!1,label:u.get("quickbmode"),bg:"quick.png",bgselected:"quickactive.png"},{name:"musession",active:!0,selected:!1,label:u.get("musession"),bg:"multiuser.png",bgselected:"multiuseractive.png"},{name:"customb",active:!1,selected:!1,label:u.get("customsession"),bg:"customb.png",bgselected:"custombactive.png"},{name:"tutorial",active:!0,selected:!1,label:u.get("ideafytutorial"),bg:"tutorial.png",bgselected:"tutorialactive.png"}]),o.get("sessionInProgress")&&o.get("sessionInProgress").id&&r.addContinue(o.get("sessionInProgress"))},r.reset(),o.watchValue("sessionInProgress",function(e){e.id&&e.type?r.addContinue(e):r.removeContinue()}),o.watchValue("lang",function(){var e=a.get("labels");d.loop(function(t,i){switch(t.name){case"continue":d.update(i,"label",e.get("continuesession"));break;case"quick":d.update(i,"label",e.get("quickbmode"));break;case"musession":d.update(i,"label",e.get("musession"));break;case"customb":d.update(i,"label",e.get("customsession"));break;case"tutorial":d.update(i,"label",e.get("ideafytutorial"))}})}),r}});