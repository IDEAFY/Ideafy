define(["OObject","Store","Bind.plugin","Event.plugin","service/config","service/utils"],function(e,t,i,n,s,a){function r(e){var r,o,c,l,d,u=s.get("user"),p=s.get("transport"),g=(new Date,{author:u.get("_id"),message:"",firstname:u.get("firstname"),date:"",datemod:"",plusones:0}),h=new t(g);this.plugins.addAll({model:new i(h,{date:function m(m){this.innerHTML=a.formatDate(m)}}),config:new i(s,{setAvatar:function(e){this.setAttribute("style","background: url('"+e+"') no-repeat center center;background-size:cover;")}}),writereplyevent:new n(this),labels:new i(s.get("labels"))}),this.template='<div class="writeTwocent writeTwocentReply"><div class="replyAvatar" data-config="bind: setAvatar, avatar"></div><textarea class="twocentText replyMessage" data-labels="bind: placeholder, addtwocentreplyplaceholder" data-model="bind: value, message"></textarea><div class="writeFooter"><ul class="twocentContext"><li class="creadate"><span class="creadatelbl" data-labels="bind:innerHTML, twocentcreationdate"></span><span class="date" data-model="bind: date, date"></span></li></ul><div class="twocentCancel" data-labels="bind: innerHTML, cancellbl" data-writereplyevent="listen: touchstart, press; listen: touchend, cancel">Cancel</div><div class="twocentPublish" data-labels="bind: innerHTML, publishlbl" data-writereplyevent="listen: touchstart, press; listen: touchend, publish;">Publish</div></div></div>',this.reset=function(e,t,i,n,s,a){var u=new Date;e&&t&&(r=e,o=t),l=s?s:"",i?(h.reset(i),editTCR=i,c=n,h.set("datemod",[u.getFullYear(),u.getMonth(),u.getDate()])):(h.reset(g),h.set("date",[u.getFullYear(),u.getMonth(),u.getDate()]),editTCR="newreply"),d=a},this.cancel=function(t,i){i.setAttribute("style","-webkit-box-shadow: none; background: #e69b73;"),h.reset(g),d?d():e.classList.add("invisible")},this.publish=function(t,i){if(i.setAttribute("style","-webkit-box-shadow: none; background: #8cab68;"),h.get("message")){var n,a,d=JSON.parse(h.toJSON());a="newreply"===editTCR?editTCR:"editreply",l&&(d.message="@ "+l+" : "+d.message),n={docId:r,type:a,position:c,twocent:o,reply:d},p.request("WriteTwocent",n,function(t){"ok"!==t?alert(s.get("labels").get("somethingwrong")):e.classList.add("invisible")})}},this.press=function(e,t){t.setAttribute("style","-webkit-box-shadow: inset 0 0 5px 1px rgba(0,0,0,0.6); background: #666666;")}}return function(t){return r.prototype=new e,new r(t)}});