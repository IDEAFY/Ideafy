define(["OObject","Store","Bind.plugin","Event.plugin","service/utils","service/config","twocents/writetwocentreply","service/avatar"],function(e,t,i,n,s,a,r,o){function c(e,c,l){var d=new t(e),u=this,p=a.get("user"),g=a.get("labels"),h=a.get("transport");u.plugins.addAll({reply:new i(d,{date:function m(m){m&&(this.innerHTML=s.formatDate(m))},setFirstname:function(e){var t=this.getAttribute("data-reply_id");this.innerHTML=e,d.get(t).author===p.get("_id")&&(this.innerHTML=g.get("youlbl"))},setReplylbl:function(){var e=this.getAttribute("data-reply_id");this.innerHTML=g.get("twocentreplycommentlbl"),d.get(e).author===p.get("_id")&&(this.innerHTML=g.get("yourepliedlbl"))},setAvatar:function(e){var t=document.createDocumentFragment(),i=new o([e]);i.place(t),this.hasChildNodes()?this.replaceChild(t,this.firstChild):this.appendChild(t)},setVisible:function(e){e&&e===p.get("_id")?this.setAttribute("style","display: block;"):this.setAttribute("style","display: none;")},setInVisible:function(e){e&&e===p.get("_id")?this.setAttribute("style","display: none;"):this.setAttribute("style","display: block;")}}),replyevent:new n(u),labels:new i(g)}),u.template='<ul class="replies" data-reply="foreach"><li class="twocentReply"><div class="twocentHeader"><div class="replyAvatar" data-reply="bind:setAvatar, author"></div><div class="twocentAuthor" data-reply="bind: setFirstname, firstname"></div><span class="commentLabel" data-labels="bind: setReplylbl, firstname"></span><br/><div class="twocentDate date" data-reply="bind: date, date"></div><div class="twocentMenu"><div class="twocentButton twocentEditButton" data-reply="bind: setVisible, author" data-replyevent="listen: touchstart, edit"></div><div class="twocentButton twocentDeleteButton" data-reply="bind: setVisible, author" data-replyevent="listen: touchstart, deleteTwocentReply"></div><div class="twocentButton twocentReplyButton" data-reply="bind: setInVisible, author" data-replyevent="listen:touchstart, reply"></div></div></div><p class="twocentMessage replyMessage" data-reply="bind: innerHTML, message"></p><div class="writePublicTwocentReply replyToReply invisible"></div></li></ul>',u.edit=function(t,i){var n=i.getAttribute("data-reply_id"),s=u.dom.children[n],a=new r,o=function(){u.dom.replaceChild(s,a.dom)},d=document.createDocumentFragment();a.reset(c,l,e[n],n,null,o),a.render(),a.place(d),u.dom.replaceChild(d,s),UI=u.dom},u.deleteTwocentReply=function(e,t){var i=t.getAttribute("data-reply_id"),n={docId:c,type:"deltcreply",twocent:l,position:i};h.request("WriteTwocent",n,function(e){"ok"!==e&&alert(a.get("labels").get("somethingwrong"))})},u.reply=function(t,i){var n=i.getAttribute("data-reply_id"),s=document.querySelector(".twocent[data-twocents_id='"+l+"']"),a=s.querySelector(".writePublicTwocentReply[data-reply_id='"+n+"']"),o=document.createDocumentFragment(),d=new r(a);d.reset(c,l,null,n,e[n].firstname),d.render(),d.place(o),a.hasChildNodes()||a.appendChild(o),a.classList.remove("invisible")}}return function(t,i,n,s){return c.prototype=new e,new c(t,i,n,s)}});