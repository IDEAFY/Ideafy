/**
 * https://github.com/TAIAUT/Ideafy
 * Proprietary License - All rights reserved
 * Author: Vincent Weyl <vincent.weyl@taiaut.com>
 * Copyright (c) 2012-2013 TAIAUT
 */

define(["OObject","service/map","service/submenu","Amy/Stack-plugin","Bind.plugin","service/config","Store","service/utils","./ideafy-menu","./quickb/quickb","./multi/mub"],function(e,t,n,r,i,s,o,u,a,f,l){return function(){var c=new e,h,p=new o,d=new r,v=s.get("user");return c.plugins.addAll({brainstormstack:d,header:new i(p,{setDate:function(e){e&&(this.innerHTML=e.toLocaleDateString())},setTime:function(e){var t=e.getHours(),n=e.getMinutes(),r=e.getSeconds();t<10&&(t="0"+t),n<10&&(n="0"+n),r<10&&(r="0"+r),this.innerHTML=t+":"+n+":"+r}})}),c.template='<div id="brainstorm"><div id="brainstorm-menu"></div><div class="brainstorm-header header blue-light"><div class="date" data-header="bind: setDate, date"></div><span class="headerTitle" data-header="bind: innerHTML, headertitle"></span><div class="clock" data-header="bind: setTime, date">hh:mm</div></div><div class="stack" data-brainstormstack="destination"></div></div>',c.place(t.get("brainstorm")),c.showMenu=function(){h.toggleActive(!0)},c.hideMenu=function(){h.toggleActive(!1)},c.exitSession=function(){d.getStack().show("menu")},c.reset=function(){d.getStack().get("menu").reset(),d.getStack().show("menu")},c.selectScreen=function(t,n){t==="continue"&&(t=n.type);if(t!=="tutorial"&&d.getStack().get(t))d.getStack().get(t).reset(n),d.getStack().show(t);else{n?t=n.type:n=null;switch(t){case"quick":d.getStack().add("quick",new f(n,c.exitSession));break;case"musession":d.getStack().add("musession",new l(n,c.exitSession));break;case"tutorial":s.get("observer").notify("display-tutorials");break;default:t=""}t&&d.getStack().show(t)}},h=new n(c.dom.querySelector("#brainstorm-menu")),h.toggleActive(!1),p.set("headertitle",s.get("labels").get("brainstormheadertitle")),setInterval(function(){var e=new Date;p.set("date",e)},1e3),d.getStack().add("menu",new a(c.selectScreen)),d.getStack().show("menu"),s.get("observer").watch("replay-session",function(e,t){var n={};n.id=e,t?n.type=t:(e.toLowerCase().search("quick")>-1&&(n.type="quick"),e.toLowerCase().search("s:mu")>-1&&(n.type="musession")),c.selectScreen(n.type,n)}),s.get("observer").watch("join-musession",function(e){var t={type:"musession",id:e,mode:"join"};c.selectScreen(t.type,t)}),c}});